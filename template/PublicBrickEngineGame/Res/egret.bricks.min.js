var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},egret;!function(t){var e=function(e){function r(t){void 0===t&&(t=null);var r=e.call(this)||this;return r._transformDirty=!0,r._colorDirty=0,r._color={r:1,g:1,b:1,a:1},r.scrollRectNode=null,r._bkNode=t||new BK.Node,r}return __extends(r,e),r.prototype._replaceNode=function(t){this._transformDirty=!0,t.vertexColor=this._bkNode.vertexColor,t.hidden=this._bkNode.hidden,t.blendMode=this._bkNode.blendMode,t.zOrder=this._bkNode.zOrder,this._bkNode.parent&&(this._bkNode.parent.addChild(t,this.parent.getChildIndex(this)),this._bkNode.parent.removeChild(this._bkNode)),this._bkNode=t},r.prototype._updateSelfColor=function(){this._bkNode.vertexColor=this._color},r.prototype._updateBKNodeMatrix=function(){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,r=t.tx,i=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY;(0!==n||0!==o)&&(r-=t.a*n+t.c*o,i-=t.b*n+t.d*o),e.set(t.a,-t.b,-t.c,t.d,r,-i)},r.prototype._updateColor=function(){var t=this.$parent;t?2===this._colorDirty||0!==t._colorDirty?(this._colorDirty=1,this._color.a=t._color.a*this.$alpha,this._updateSelfColor()):1===this._colorDirty&&(this._colorDirty=0):2===this._colorDirty?(this._colorDirty=1,this._color.a=this.$alpha,this._updateSelfColor()):1===this._colorDirty&&(this._colorDirty=0)},r.prototype.$setVisible=function(t){e.prototype.$setVisible.call(this,t),this._bkNode.hidden=!t},r.prototype.$setAlpha=function(t){e.prototype.$setAlpha.call(this,t),this._colorDirty=2},Object.defineProperty(r.prototype,"blendMode",{set:function(e){var r=this,i=t.sys.blendModeToNumber(e);r.$blendMode=i,r.updateRenderMode();var n=r.$parent;n&&!n.$cacheDirty&&(n.$cacheDirty=!0,n.$cacheDirtyUp());var o=r.$maskedObject;switch(o&&!o.$cacheDirty&&(o.$cacheDirty=!0,o.$cacheDirtyUp()),e){case t.BlendMode.NORMAL:this._bkNode.blendMode=1;break;case t.BlendMode.ADD:this._bkNode.blendMode=0;break;case t.BlendMode.ERASE:}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mask",{set:function(e){var r=this;if(e!==r){if(!(this instanceof t.BKBitmap))return void console.log("QQ 玩一玩不支持该种类型的影片剪辑被遮罩，只有 Bitmap 类型可以被遮罩，或不使用遮罩。");if(e)if(e instanceof t.BKBitmap){if(e==r.$mask)return;e.$maskedObject&&(e.$maskedObject.mask=null),e.$maskedObject=r,e._updateBKNodeMatrix(),r.$mask=e;var i=new BK.ClipNode(e._bkNode);i.zOrder=this._bkNode.zOrder,i.alphaThreshold=.5,i.inverted=!1,this._bkNode.parent&&(this._bkNode.parent.addChild(i,this.parent.getChildIndex(this)),this._bkNode.parent.removeChild(this._bkNode)),i.addChild(this._bkNode)}else console.log("QQ 玩一玩不支持该种类型的遮罩，请使用 Bitmap 遮罩，或不使用遮罩。");else{if(r.$mask,r.mask){var i=this._bkNode.parent;i&&i.parent&&(this._bkNode.zOrder=i.zOrder,i.parent.addChild(this._bkNode,this.parent.getChildIndex(this)),i.parent.removeChild(i)),r.$mask=null}r.$maskRect&&(r.$maskRect=null)}r.updateRenderMode()}},enumerable:!0,configurable:!0}),r.prototype.$setX=function(t){var e=this;return e.$x==t?!1:(e.$x=t,this._transformDirty=!0,!0)},r.prototype.$setY=function(t){var e=this;return e.$y==t?!1:(e.$y=t,this._transformDirty=!0,!0)},r.prototype.$setScaleX=function(t){e.prototype.$setScaleX.call(this,t),this._transformDirty=!0},r.prototype.$setScaleY=function(t){e.prototype.$setScaleY.call(this,t),this._transformDirty=!0},r.prototype.$setRotation=function(t){e.prototype.$setRotation.call(this,t),this._transformDirty=!0},r.prototype.$setSkewX=function(t){e.prototype.$setSkewX.call(this,t),this._transformDirty=!0},r.prototype.$setSkewY=function(t){e.prototype.$setSkewY.call(this,t),this._transformDirty=!0},r.prototype.$setMatrix=function(t,r){void 0===r&&(r=!0),e.prototype.$setMatrix.call(this,t,r),this._transformDirty=!0},Object.defineProperty(r.prototype,"scrollRect",{get:function(){return this.$scrollRect},set:function(t){this.setScrollRect(t)},enumerable:!0,configurable:!0}),r.prototype.setScrollRect=function(t){if(t){e.prototype.$setScrollRect.call(this,t);var r=this.$scrollRect;if(this.scrollRectNode){var i=this._bkNode;i.clipRegion={x:0,y:this.height+1,width:r.width,height:-r.height-1},this.scrollRectNode.position={x:r.x,y:r.y},this._transformDirty=!0}else{var n=this._bkNode.parent;this.scrollRectNode=this._bkNode,this._bkNode.parent&&this._bkNode.parent.removeChild(this._bkNode);var i=new BK.ClipRectNode(0,this.height+1,r.width,-r.height-1);n&&n.addChild(i),i.addChild(this.scrollRectNode),this._bkNode=i,this.scrollRectNode.position={x:r.x,y:r.y},this._transformDirty=!0}}else if(this.scrollRectNode){var o=this.scrollRectNode,a=this._bkNode.parent;o.parent&&o.parent.removeChild(o),a&&a.removeChild(this._bkNode),o.position={x:this._bkNode.position.x,y:this._bkNode.position.y},a.addChild(o),this._bkNode=o,this.scrollRectNode=null,this._transformDirty=!0}},r.prototype.$hitTest=function(t,e){var r=this;if(!r.$visible)return null;var i=r.$getInvertedConcatenatedMatrix();if(0==i.a&&0==i.b&&0==i.c&&0==i.d)return null;var n=r.$getContentBounds(),o=i.a*t+i.c*e+i.tx,a=i.b*t+i.d*e+i.ty;if(n.contains(o,a)){if(!r.$children){var s=r.$scrollRect?r.$scrollRect:r.$maskRect;if(s&&!s.contains(o,a))return null;if(r.$mask&&!r.$mask.$hitTest(t,e))return null}return r}return null},r.prototype.$getRenderNode=function(){var t=this,e=t._bkNode;return e?(t._updateColor(),t.$renderDirty&&(t.$updateRenderNode(),t.$renderDirty=!1,e=t._bkNode),t._transformDirty&&(t._transformDirty=!1,this._updateBKNodeMatrix()),e):null},r.prototype.$onAddToStage=function(r,i){e.prototype.$onAddToStage.call(this,r,i);var n=t.BKPlayer.instance._displayList.indexOf(this);0>n&&t.BKPlayer.instance._displayList.push(this)},r.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);var r=t.BKPlayer.instance._displayList.indexOf(this);r>=0&&t.BKPlayer.instance._displayList.splice(r,1)},r.prototype.invalidUpdate=function(){this.$getRenderNode()},r}(t.DisplayObject);t.BKDisplayObject=e,__reflect(e.prototype,"egret.BKDisplayObject"),"webgl"!=window.renderMode&&(t.DisplayObject=t.BKDisplayObject)}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var t=e.call(this,new BK.ClipRectNode(0,0,2048,-2048))||this;return t.$touchChildren=!0,t._bkClipRectNode=t._bkNode,t._bkClipRectNode.enableClip=!1,t.$children=[],t}return __extends(r,e),r.prototype._updateBKNodeMatrix=function(){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,r=t.tx,i=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY;(0!==n||0!==o)&&(r-=t.a*n+t.c*o,i-=t.b*n+t.d*o),this.$scrollRect&&(r-=this.$scrollRect.x,i-=this.$scrollRect.y),e.set(t.a,-t.b,-t.c,t.d,r,-i)},Object.defineProperty(r.prototype,"numChildren",{get:function(){return this.$children.length},enumerable:!0,configurable:!0}),r.prototype.addChild=function(t){var e=this.$children.length;return t.$parent==this&&e--,this.$doAddChild(t,e)},r.prototype.addChildAt=function(t,e){return e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length,t.$parent==this&&e--),this.$doAddChild(t,e)},r.prototype.$doAddChild=function(e,r,i){void 0===i&&(i=!0);var n=this,o=e.$parent;if(o==n)return n.doSetChildIndex(e,r),e;o&&o.removeChild(e),n.$children.splice(r,0,e),e.$setParent(n);var a=n.$stage;if(a&&e.$onAddToStage(a,n.$nestLevel+1),i&&e.dispatchEventWith(t.Event.ADDED,!0),a)for(var s=t.DisplayObjectContainer.$EVENT_ADD_TO_STAGE_LIST;s.length;){var h=s.shift();h.$stage&&i&&h.dispatchEventWith(t.Event.ADDED_TO_STAGE)}var l=e._bkNode;l.parent?this._bkNode.addChild(l.parent,r):this._bkNode.addChild(l,r);for(var c=0,d=this.$children.length;d>c;c++){var u=this.$children[c]._bkNode,p=u.parent;p&&p.parent===this._bkNode?p.zOrder=-c:u.zOrder=-c}return this.$childAdded(e,r),e},r.prototype.contains=function(t){for(;t;){if(t==this)return!0;t=t.$parent}return!1},r.prototype.getChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$children[t]:null},r.prototype.getChildIndex=function(t){return this.$children.indexOf(t)},r.prototype.getChildByName=function(t){for(var e,r=this.$children,i=r.length,n=0;i>n;n++)if(e=r[n],e.name==t)return e;return null},r.prototype.removeChild=function(t){var e=this.$children.indexOf(t);return e>=0?this.$doRemoveChild(e):null},r.prototype.removeChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$doRemoveChild(t):null},r.prototype.$doRemoveChild=function(e,r){void 0===r&&(r=!0),e=0|+e;var i=this.$children,n=i[e];if(this.$childRemoved(n,e),r&&n.dispatchEventWith(t.Event.REMOVED,!0),this.$stage){n.$onRemoveFromStage();for(var o=t.DisplayObjectContainer.$EVENT_REMOVE_FROM_STAGE_LIST;o.length>0;){var a=o.shift();r&&a.$hasAddToStage&&(a.$hasAddToStage=!1,a.dispatchEventWith(t.Event.REMOVED_FROM_STAGE)),a.$hasAddToStage=!1,a.$stage=null}}this.$displayList||this.$parentDisplayList;n.$setParent(null);var s=i.indexOf(n);-1!=s&&i.splice(s,1);var h=n._bkNode;return h.parent&&h.parent.removeChild(h),n},r.prototype.setChildIndex=function(t,e){e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length-1),this.doSetChildIndex(t,e)},r.prototype.doSetChildIndex=function(t,e){var r=this.$children.indexOf(t);if(r!=e){this.$childRemoved(t,r),this.$children.splice(r,1),this.$children.splice(e,0,t),this.$childAdded(t,e);var i=t._bkNode,n=i.parent;n&&(n.removeChild(i),n.addChild(i,e));for(var o=0,a=this.$children.length;a>o;o++){var s=this.$children[o]._bkNode,h=s.parent;h&&h.parent===this._bkNode?h.zOrder=-o:s.zOrder=-o}}},r.prototype.swapChildrenAt=function(t,e){t=0|+t,e=0|+e,t>=0&&t<this.$children.length&&e>=0&&e<this.$children.length&&this.doSwapChildrenAt(t,e)},r.prototype.swapChildren=function(t,e){var r=this.$children.indexOf(t),i=this.$children.indexOf(e);-1==r||-1==i||this.doSwapChildrenAt(r,i)},r.prototype.doSwapChildrenAt=function(t,e){if(t>e){var r=e;e=t,t=r}else if(t==e)return;var i=this.$children,n=i[t],o=i[e];this.$childRemoved(n,t),this.$childRemoved(o,e),i[t]=o,i[e]=n,this.$childAdded(o,t),this.$childAdded(n,e);var a=n._bkNode,s=o._bkNode;a.parent===this._bkNode?a.zOrder=-e:a.parent.zOrder=-e,s.parent===this._bkNode?s.zOrder=-t:s.parent.zOrder=-t},r.prototype.removeChildren=function(){for(var t=this.$children,e=t.length-1;e>=0;e--)this.$doRemoveChild(e)},r.prototype.$childAdded=function(t,e){},r.prototype.$childRemoved=function(t,e){},r.prototype.$onAddToStage=function(t,r){e.prototype.$onAddToStage.call(this,t,r);var i=this.$children,n=i.length;r++;for(var o=0;n>o;o++){var a=this.$children[o];a.$onAddToStage(t,r)}},r.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);for(var t=this.$children,r=t.length,i=0;r>i;i++){var n=t[i];n.$onRemoveFromStage()}},r.prototype.$measureChildBounds=function(e){var r=this.$children,i=r.length;if(0!=i){for(var n=0,o=0,a=0,s=0,h=!1,l=-1;i>l;l++){var c=-1==l?e:r[l].$getTransformedBounds(this,t.$TempRectangle);c.isEmpty()||(h?(n=Math.min(n,c.x),o=Math.max(o,c.x+c.width),a=Math.min(a,c.y),s=Math.max(s,c.y+c.height)):(h=!0,n=c.x,o=n+c.width,a=c.y,s=a+c.height))}e.setTo(n,a,o-n,s-a)}},Object.defineProperty(r.prototype,"touchChildren",{get:function(){return this.$getTouchChildren()},set:function(t){this.$setTouchChildren(!!t)},enumerable:!0,configurable:!0}),r.prototype.$getTouchChildren=function(){return this.$touchChildren},r.prototype.$setTouchChildren=function(t){return this.$touchChildren==t?!1:(this.$touchChildren=t,!0)},r.prototype.$hitTest=function(t,r){if(!this.$visible)return null;var i=this.$getInvertedConcatenatedMatrix(),n=i.a*t+i.c*r+i.tx,o=i.b*t+i.d*r+i.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(n,o))return null;if(this.$mask&&!this.$mask.$hitTest(t,r))return null;for(var s=this.$children,h=!1,l=null,c=s.length-1;c>=0;c--){var d=s[c];if(!d.$maskedObject&&(l=d.$hitTest(t,r))){if(h=!0,l.$touchEnabled)break;l=null}}return l?this.$touchChildren?l:this:h?this:e.prototype.$hitTest.call(this,t,r)},r.prototype.invalidUpdate=function(){for(var t=0,e=this.$children;t<e.length;t++){var r=e[t];r.invalidUpdate()}this.$getRenderNode()},Object.defineProperty(r.prototype,"scrollRect",{set:function(e){var r=this;(e||r.$scrollRect)&&(this._transformDirty=!0,e?(r.$scrollRect||(r.$scrollRect=new t.Rectangle,this._bkClipRectNode.enableClip=!0),r.$scrollRect.copyFrom(e),this._bkClipRectNode.clipRegion={x:r.$scrollRect.x,y:-r.$scrollRect.y-r.$scrollRect.height,width:r.$scrollRect.width,height:r.$scrollRect.height}):(r.$scrollRect=null,this._bkClipRectNode.enableClip=!1))},enumerable:!0,configurable:!0}),r.$EVENT_ADD_TO_STAGE_LIST=[],r.$EVENT_REMOVE_FROM_STAGE_LIST=[],r}(t.BKDisplayObject);t.BKDisplayObjectContainer=e,__reflect(e.prototype,"egret.BKDisplayObjectContainer"),"webgl"!=window.renderMode&&(t.DisplayObjectContainer=t.BKDisplayObjectContainer)}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this._contentWidth=0,this._contentHeight=0,this._size={width:0,height:0},this._rawGrid=new t.Rectangle,this._grid=new t.Rectangle,this._leftTop=new BK.Sprite(0,0,{},0,1,1,1),this._centerTop=new BK.Sprite(0,0,{},0,1,1,1),this._rightTop=new BK.Sprite(0,0,{},0,1,1,1),this._leftCenter=new BK.Sprite(0,0,{},0,1,1,1),this._centerCenter=new BK.Sprite(0,0,{},0,1,1,1),this._rightCenter=new BK.Sprite(0,0,{},0,1,1,1),this._leftBottom=new BK.Sprite(0,0,{},0,1,1,1),this._centerBottom=new BK.Sprite(0,0,{},0,1,1,1),this._rightBottom=new BK.Sprite(0,0,{},0,1,1,1),this.__nativeObj=new BK.Node,t.defineProxyProperties(this.__nativeObj,this),this.__nativeObj.addChild(this._leftTop),this.__nativeObj.addChild(this._centerTop),this.__nativeObj.addChild(this._rightTop),this.__nativeObj.addChild(this._leftCenter),this.__nativeObj.addChild(this._centerCenter),this.__nativeObj.addChild(this._rightCenter),this.__nativeObj.addChild(this._leftBottom),this.__nativeObj.addChild(this._centerBottom),this.__nativeObj.addChild(this._rightBottom)}return e.prototype._updateGrid=function(){this._grid.x=this._rawGrid.x,this._grid.y=this._rawGrid.y,this._grid.width=this._contentWidth-this._rawGrid.x-this._rawGrid.width,this._grid.height=this._contentHeight-this._rawGrid.y-this._rawGrid.height},e.prototype.dispose=function(){this.__nativeObj.dispose()},e.prototype.setTexture=function(t){this._leftTop.setTexture(t),this._centerTop.setTexture(t),this._rightTop.setTexture(t),this._leftCenter.setTexture(t),this._centerCenter.setTexture(t),this._rightCenter.setTexture(t),this._leftBottom.setTexture(t),this._centerBottom.setTexture(t),this._rightBottom.setTexture(t)},e.prototype.setScale9Grid=function(t){this._rawGrid.setTo(t.x,t.y,t.width,t.height),this._updateGrid()},e.prototype.adjustTexturePosition=function(t,e,r,i,n){this._contentWidth=r,this._contentHeight=i,this.offsetX=t,this.offsetY=e,this.rotated=n,this._updateGrid();var o=this._grid.x,a=this._grid.y,s=this._grid.width,h=this._grid.height,l=this._contentWidth-o-s,c=this._contentHeight-a-h;if(n===!0);else{var d=t,u=t+o,p=t+(r-s),f=e,g=e+h,v=e+(i-a);this._leftTop.adjustTexturePosition(d,v,o,a),this._centerTop.adjustTexturePosition(u,v,l,a),this._rightTop.adjustTexturePosition(p,v,s,a),this._leftCenter.adjustTexturePosition(d,g,o,c),this._centerCenter.adjustTexturePosition(u,g,l,c),this._rightCenter.adjustTexturePosition(p,g,s,c),this._leftBottom.adjustTexturePosition(d,f,o,h),this._centerBottom.adjustTexturePosition(u,f,l,h),this._rightBottom.adjustTexturePosition(p,f,s,h)}},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size.width=t.width,this._size.height=t.height,this._updateGrid();var e=this._grid.x,r=this._grid.y,i=this._grid.width,n=this._grid.height;this._size.width<e+i&&0!==this._size.width&&(e=this._size.width*e/this._contentWidth,i=this._size.width*i/this._contentWidth),this._size.height<r+n&&0!==this._size.height&&(r=this._size.height*r/this._contentHeight,n=this._size.height*n/this._contentHeight);var o=1,a=1,s=this._size.width-e-i,h=this._size.height-r-n;this._leftTop.position={x:0,y:n+h},this._centerTop.position={x:e,y:n+h},this._rightTop.position={x:e+s,y:n+h},this._leftCenter.position={x:0,y:n},this._centerCenter.position={x:e,y:n},this._rightCenter.position={x:e+s,y:n},this._leftBottom.position={x:0,y:0},this._centerBottom.position={x:e,y:0},this._rightBottom.position={x:e+s,y:0},this._leftTop.size={width:e+o,height:r},this._centerTop.size={width:s+o,height:r},this._rightTop.size={width:i,height:r},this._leftCenter.size={width:e+o,height:h+a},this._centerCenter.size={width:s+o,height:h+a},this._rightCenter.size={width:i,height:h+a},this._leftBottom.size={width:e+o,height:n+a},this._centerBottom.size={width:s+o,height:n+a},this._rightBottom.size={width:i,height:n+a}},enumerable:!0,configurable:!0}),e}();t.BKSprite9=e,__reflect(e.prototype,"egret.BKSprite9")}(egret||(egret={}));var egret;!function(t){function e(){if(i.length>0){var t=i.pop();return t}var e=new BK.Sprite(0,0,{},0,1,1,1);return e}var r=function(r){function n(){var e=r.call(this)||this;return e.$smoothing=t.Bitmap.defaultSmoothing,e.$text="",e.$textFieldWidth=0/0,e.$textLinesChanged=!1,e.$textFieldHeight=0/0,e.$font=null,e.$fontStringChanged=!1,e.$lineSpacing=0,e.$letterSpacing=0,e.$textAlign=t.HorizontalAlign.LEFT,e.$verticalAlign=t.VerticalAlign.TOP,e.$textWidth=0/0,e.$textHeight=0/0,e.$textOffsetX=0,e.$textOffsetY=0,e.$textStartX=0,e.$textStartY=0,e.$lineHeights=[],e._bkNodes=[],e}return __extends(n,r),n.prototype.createNativeDisplayObject=function(){},Object.defineProperty(n.prototype,"smoothing",{get:function(){return this.$smoothing},set:function(t){var e=this;t!=e.$smoothing&&(e.$smoothing=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"text",{get:function(){return this.$text},set:function(t){this.$setText(t)},enumerable:!0,configurable:!0}),n.prototype.$setText=function(t){null==t&&(t="");var e=this;return t==e.$text?!1:(e.$text=t,e.$invalidateContentBounds(),!0)},n.prototype.$getWidth=function(){var t=this,e=t.$textFieldWidth;return isNaN(e)?t.$getContentBounds().width:e},n.prototype.$setWidth=function(t){var e=this;return 0>t||t==e.$textFieldWidth?!1:(e.$textFieldWidth=t,e.$invalidateContentBounds(),!0)},n.prototype.$invalidateContentBounds=function(){this.$renderDirty=!0,this.$textLinesChanged=!0,this.$updateRenderNode()},n.prototype.$getHeight=function(){var t=this,e=t.$textFieldHeight;return isNaN(e)?t.$getContentBounds().height:e},n.prototype.$setHeight=function(t){var e=this;return 0>t||t==e.$textFieldHeight?!1:(e.$textFieldHeight=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"font",{get:function(){return this.$font},set:function(t){this.$setFont(t)},enumerable:!0,configurable:!0}),n.prototype.$setFont=function(t){var e=this;return e.$font==t?!1:(e.$font=t,e.$fontStringChanged=!0,this.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"lineSpacing",{get:function(){return this.$lineSpacing},set:function(t){this.$setLineSpacing(t)},enumerable:!0,configurable:!0}),n.prototype.$setLineSpacing=function(t){var e=this;return e.$lineSpacing==t?!1:(e.$lineSpacing=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"letterSpacing",{get:function(){return this.$letterSpacing},set:function(t){this.$setLetterSpacing(t)},enumerable:!0,configurable:!0}),n.prototype.$setLetterSpacing=function(t){var e=this;return e.$letterSpacing==t?!1:(e.$letterSpacing=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"textAlign",{get:function(){return this.$textAlign},set:function(t){this.$setTextAlign(t)},enumerable:!0,configurable:!0}),n.prototype.$setTextAlign=function(t){var e=this;return e.$textAlign==t?!1:(e.$textAlign=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"verticalAlign",{get:function(){return this.$verticalAlign},set:function(t){this.$setVerticalAlign(t)},enumerable:!0,configurable:!0}),n.prototype.$setVerticalAlign=function(t){var e=this;return e.$verticalAlign==t?!1:(e.$verticalAlign=t,e.$invalidateContentBounds(),!0)},n.prototype.$updateRenderNode=function(){var r=this,n=this.$getTextLines(),o=n.length;if(0!=o){for(var a=this.$textLinesWidth,s=r.$font,h=0,l=s._getFirstCharHeight(),c=Math.ceil(l*t.BitmapText.EMPTY_FACTOR),d=!isNaN(r.$textFieldHeight),u=r.$textWidth,p=r.$textFieldWidth,f=r.$textFieldHeight,g=r.$textAlign,v=this.$textOffsetY+this.$textStartY,x=this.$lineHeights,y=0;o>y;y++){var b=x[y];if(d&&y>0&&v+b>f)break;var $=n[y],m=$.length,T=this.$textOffsetX;if(g!=t.HorizontalAlign.LEFT){var _=p>u?p:u;g==t.HorizontalAlign.RIGHT?T+=_-a[y]:g==t.HorizontalAlign.CENTER&&(T+=Math.floor((_-a[y])/2))}for(var w=0;m>w;w++){var S=$.charAt(w),B=s.getTexture(S);if(B){var E=(B.$bitmapWidth,B.$bitmapHeight),C=void 0;h<this._bkNodes.length?C=this._bkNodes[h]:(C=e(),this._bkNodes[h]=C,this._bkNode.addChild(C)),C.setTexture(B.$bitmapData.bkTexture),C.adjustTexturePosition(B.$bitmapX,B.$sourceHeight-(B.$bitmapY+B.$bitmapHeight),B.$bitmapWidth,B.$bitmapHeight,B.$rotated),C.size={width:B.$bitmapWidth,height:B.$bitmapHeight},C.position={x:T,y:-v-E},h++,T+=(s.getConfig(S,"xadvance")||B.$getTextureWidth())+r.$letterSpacing}else" "==S?T+=c:t.$warn(1046,S)}v+=b+r.$lineSpacing}for(var y=h;y<this._bkNodes.length;++y){var C=this._bkNodes[y];i.push(C),this._bkNode.removeChild(C)}this._bkNodes.length=h}},n.prototype.$measureContentBounds=function(t){var e=this.$getTextLines();0==e.length?t.setEmpty():t.setTo(this.$textOffsetX+this.$textStartX,this.$textOffsetY+this.$textStartY,this.$textWidth-this.$textOffsetX,this.$textHeight-this.$textOffsetY)},Object.defineProperty(n.prototype,"textWidth",{get:function(){return this.$getTextLines(),this.$textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textHeight",{get:function(){return this.$getTextLines(),this.$textHeight},enumerable:!0,configurable:!0}),n.prototype.$getTextLines=function(){function e(t){return y&&i.length>0&&p>y?!1:(p+=h+c,a||s||(l-=d),i.push(t),o.push(h),n.push(l),u=Math.max(l,u),!0)}var r=this;if(!r.$textLinesChanged)return r.textLines;var i=[];r.textLines=i;var n=[];r.$textLinesWidth=n,r.$textLinesChanged=!1;var o=[];if(r.$lineHeights=o,!r.$text||!r.$font)return r.$textWidth=0,r.$textHeight=0,i;for(var a,s,h,l,c=r.$lineSpacing,d=r.$letterSpacing,u=0,p=0,f=0,g=0,v=!isNaN(r.$textFieldWidth),x=r.$textFieldWidth,y=r.$textFieldHeight,b=r.$font,$=b._getFirstCharHeight(),m=Math.ceil($*t.BitmapText.EMPTY_FACTOR),T=r.$text,_=T.split(/(?:\r\n|\r|\n)/),w=_.length,S=!0,B=0;w>B;B++){var E=_[B],C=E.length;h=0,l=0,a=!0,s=!1;for(var R=0;C>R;R++){a||(l+=d);var F=E.charAt(R),D=void 0,L=void 0,O=0,A=0,N=b.getTexture(F);if(N)D=N.$getTextureWidth(),L=N.$getTextureHeight(),O=N.$offsetX,A=N.$offsetY;else{if(" "!=F){t.$warn(1046,F),a&&(a=!1);continue}D=m,L=$}if(a&&(a=!1,f=Math.min(O,f)),S&&(S=!1,g=Math.min(A,g)),v&&R>0&&l+D>x){if(!e(E.substring(0,R)))break;E=E.substring(R),C=E.length,R=0,l=R==C-1?D:b.getConfig(F,"xadvance")||D,h=L}else l+=R==C-1?D:b.getConfig(F,"xadvance")||D,h=Math.max(L,h)}if(y&&B>0&&p>y)break;if(s=!0,!e(E))break}p-=c,r.$textWidth=u,r.$textHeight=p,this.$textOffsetX=f,this.$textOffsetY=g,this.$textStartX=0,this.$textStartY=0;var M;return x>u&&(M=r.$textAlign,M==t.HorizontalAlign.RIGHT?this.$textStartX=x-u:M==t.HorizontalAlign.CENTER&&(this.$textStartX=Math.floor((x-u)/2))),y>p&&(M=r.$verticalAlign,M==t.VerticalAlign.BOTTOM?this.$textStartY=y-p:M==t.VerticalAlign.MIDDLE&&(this.$textStartY=Math.floor((y-p)/2))),i},n.prototype._updateSelfColor=function(){for(var t=0,e=this._bkNodes;t<e.length;t++){var r=e[t];r.vertexColor=this._color}},n.EMPTY_FACTOR=.33,n}(t.BKDisplayObject);t.BKBitmapText=r,__reflect(r.prototype,"egret.BKBitmapText");var i=[];"webgl"!=window.renderMode&&(t.BitmapText=t.BKBitmapText)}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,r){void 0===r&&(r=!1);var i=t.call(this)||this;return i.width=0,i.height=0,i.source="",i.bkTexture=null,i.source=e,i.isFlip=r,"string"==typeof i.source?i.bkTexture=new BK.Texture(i.source):i.bkTexture=i.source,i.width=i.bkTexture.size.width,i.height=i.bkTexture.size.height,i}return __extends(e,t),e.$invalidate=function(){},e.prototype.$dispose=function(){},e}(t.HashObject);t.BKBitmapData=e,__reflect(e.prototype,"egret.BKBitmapData"),"webgl"!=window.renderMode&&(t.BitmapData=t.BKBitmapData)}(egret||(egret={})),console=console||{},console.warn=console.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r="";if(t)for(var i=0,n=t;i<n.length;i++){var o=n[i];r+=" "+o}BK.Script.log(1,0,r)},console.assert=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];t||console.log.apply(null,e)};var egret;!function(t){var e;!function(t){t.version="1.0.19"}(e=t.bricks||(t.bricks={}))}(egret||(egret={})),function(t){function e(t,e,r){BK.Director.ticker.setTimeout(t,r,e)}function r(t){BK.Director.ticker.removeTimeout(t)}function i(t){if(!u){u=!0,t||(t={}),d=t,n();var e=t.renderMode;"webgl"==e?a(t):o(t)}}function n(){}function o(e){"undefined"!=typeof eui&&(Object.defineProperty(eui.Image.prototype,"scale9Grid",{set:function(t){this.$setScale9Grid(t),this.invalidateDisplayList()},enumerable:!0,configurable:!0}),eui.Image.prototype.$updateRenderNode=function(){var t=this.$bitmapData;if(!t)return null;var e=this.$UIComponent,r=e[10],i=e[11];return 0===r||0===i?null:(this._size.width=this.$getWidth(),this._size.height=this.$getHeight(),void(this._bkSprite.size=this._size))}),void 0!==typeof t.WebSocket&&(t.ISocket=t.BKSocket),e.screenAdapter?t.sys.screenAdapter=e.screenAdapter:t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.DefaultScreenAdapter),t.sys.systemRenderer=new t.BKSystemRenderer,t.sys.canvasRenderer=new t.BKSystemRenderer,l=new t.BKPlayer(e)}function a(e){if(t.WebGLUtils.deleteWebGLTexture=function(t){if(t){var e=t.glContext;e?e.deleteTexture(t):(e=bkWebGLGetInstance(),e.deleteTexture(t))}},"webgl"==e.renderMode){var r=e.antialias;t.web.WebGLRenderContext.antialias=!!r}t.sys.CanvasRenderBuffer=t.web.CanvasRenderBuffer,s(e.renderMode);var i;if(e.canvasScaleFactor)i=e.canvasScaleFactor;else if(e.calculateCanvasScaleFactor)i=e.calculateCanvasScaleFactor(t.sys.canvasHitTestBuffer.context);else{var n=t.sys.canvasHitTestBuffer.context,o=n.backingStorePixelRatio||n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;i=(window.devicePixelRatio||1)/o}t.sys.DisplayList.$canvasScaleFactor=i;var a=t.ticker;h(a),e.screenAdapter?t.sys.screenAdapter=e.screenAdapter:t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.DefaultScreenAdapter),c=new t.web.BKWebPlayer(e)}function s(e){"webgl"==e&&(t.sys.RenderBuffer=t.web.WebGLRenderBuffer,t.sys.systemRenderer=new t.web.WebGLRenderer,t.sys.canvasRenderer=new t.CanvasRenderer,t.sys.customHitTestBuffer=new t.web.WebGLRenderBuffer(3,3),t.sys.canvasHitTestBuffer=new t.web.CanvasRenderBuffer(3,3),t.Capabilities.renderMode="webgl")}function h(t){BK.Director.ticker.interval=1,BK.Director.ticker.add(function(e,r){t.update()})}t.getTimer=function(){return Math.round(1e3*BK.Time.timestamp)},t.setTimeout=e,t.clearTimeout=r;var l,c,d,u=!1;t.runEgret=i}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=0,this.lineWidth=0,this.strokeColor={r:0,g:0,b:0,a:0},this.fillColor={r:0,g:0,b:0,a:0},this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0),this.includeLastPosition=!0;var e=t.lifecycle.stage;this.stageW=e.stageWidth,this.stageH=e.stageHeight}return e.prototype.$setTarget=function(t){this.targetDisplay&&(this.targetDisplay.$renderNode=null),this.targetDisplay=t},e.prototype.setStrokeWidth=function(t){switch(t){case 1:this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=1;break;case 3:this.topLeftStrokeWidth=1,this.bottomRightStrokeWidth=2;break;default:var e=0|Math.ceil(.5*t);this.topLeftStrokeWidth=e,this.bottomRightStrokeWidth=e}},e.prototype.beginFill=function(t,e){void 0===e&&(e=1),t=+t||0,e=+e||0,this.isFillPath=!0;var r=this._refitString(t,6),i=parseInt(r.substring(0,2),16)/255,n=parseInt(r.substring(2,4),16)/255,o=parseInt(r.substring(4,6),16)/255;this.fillColor={r:i,g:n,b:o,a:e}},e.prototype._refitString=function(t,e){var r=t.toString(16),i="00000000";return i.substr(0,e-r.length)+r},e.prototype.beginGradientFill=function(t,e,r,i,n){void 0===n&&(n=null)},e.prototype.endFill=function(){this.isFillPath&&(this.isFillPath=!1),this.isStrokePath&&(this.isStrokePath=!1)},e.prototype.lineStyle=function(t,e,r,i,n,o,a,s,h){if(void 0===t&&(t=0/0),void 0===e&&(e=0),void 0===r&&(r=1),void 0===i&&(i=!1),void 0===n&&(n="normal"),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=3),0>=t)this.isStrokePath=!1,this.lineWidth=0,this.setStrokeWidth(0);else{e=+e||0,r=+r||0,this.setStrokeWidth(t),this.lineWidth=t,this.isStrokePath=!0;var l=this._refitString(e,6),c=parseInt(l.substring(0,2),16)/255,d=parseInt(l.substring(2,4),16)/255,u=parseInt(l.substring(4,6),16)/255;this.strokeColor={r:c,g:d,b:u,a:r}}},e.prototype.drawRect=function(t,r,i,n){var o=+t||0,a=-r||0;if(i=+i||0,n=+n||0,this.isFillPath){var s=new BK.Texture(e.pixelPath);this.addSprite(s,o,a,i,n),this.extendBoundsByPoint(t+i,r+n),this.updatePosition(t,r)}},e.prototype.drawRoundRect=function(t,e,r,i,n,o){},e.prototype.roundRect=function(t,e,r,i,n,o){},e.prototype.drawCircle=function(t,r,i){var n=+t||0,o=-r||0;if(i=+i||0,this.isFillPath){var a=new BK.Texture(e.circlePath);this.addSprite(a,n,o,2*i,2*i,!0),this.extendBoundsByPoint(t-i-1,r-i-1),this.extendBoundsByPoint(t+i+2,r+i+2),this.updatePosition(t+i,r)}},e.prototype.addSprite=function(t,e,r,i,n,o){void 0===o&&(o=!1);var a=new BK.Sprite(i,n,t,0,1,1,1);a.vertexColor=this.fillColor,o?a.position={x:e-i/2,y:r-n/2}:a.position={x:e,y:r-n};var s=this.targetDisplay._bkNode;s.addChild(a)},e.prototype.drawEllipse=function(t,r,i,n){var o=+t||0,a=-r||0;if(i=+i||0,n=+n||0,this.isFillPath){var s=new BK.Texture(e.circlePath),h=new BK.Sprite(i,n,s,0,1,1,1);h.position={x:o,y:a-n},h.vertexColor=this.fillColor;var l=this.targetDisplay._bkNode;l.addChild(h),this.extendBoundsByPoint(t-1,r-1),this.extendBoundsByPoint(t+i+2,r+n+2),this.updatePosition(t+i,r+.5*n)}},e.prototype.moveTo=function(t,e){this.lastX=t,this.lastY=e,this.includeLastPosition=!1,this.lastX=t,this.lastY=e},e.prototype.lineTo=function(t,r){if(this.isStrokePath){var i=t||0,n=-r||0,o=void 0!==this.lastX?this.lastX:i,a=void 0!==this.lastY?-this.lastY:n,s=Math.sqrt(Math.pow(i-o,2)+Math.pow(n-a,2)),h=void 0;h=Math.atan2(n-a,i-o)/Math.PI*180;var l=new BK.Texture(e.pixelPath,6,0,0,1,1),c=new BK.Sprite(s,this.lineWidth,l,0,1,1,1);c.position={x:o,y:a},c.rotation={x:0,y:0,z:h},c.vertexColor=this.strokeColor;var d=this.targetDisplay._bkNode;d.addChild(c),this.updatePosition(t,r)}},e.prototype.curveTo=function(t,e,r,i){},e.prototype.cubicCurveTo=function(t,e,r,i,n,o){},e.prototype.drawArc=function(t,e,r,i,n,o){},e.prototype.clear=function(){this.updatePosition(0,0),this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0);for(var t=this.targetDisplay._bkNode;t.children.length>0;)t.removeChild(t.children[0]);this.isFillPath=!1,this.isStrokePath=!1},e.prototype.extendBoundsByPoint=function(t,e){this.extendBoundsByX(t),this.extendBoundsByY(e)},e.prototype.extendBoundsByX=function(t){this.minX=Math.min(this.minX,t-this.topLeftStrokeWidth),this.maxX=Math.max(this.maxX,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},e.prototype.extendBoundsByY=function(t){this.minY=Math.min(this.minY,t-this.topLeftStrokeWidth),this.maxY=Math.max(this.maxY,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},e.prototype.updateNodeBounds=function(){},e.prototype.updatePosition=function(t,e){this.includeLastPosition||(this.extendBoundsByPoint(this.lastX,this.lastY),this.includeLastPosition=!0),this.lastX=t,this.lastY=e,this.extendBoundsByPoint(t,e)},e.prototype.$measureContentBounds=function(t){this.minX===1/0?t.setEmpty():t.setTo(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY)
},e.prototype.$hitTest=function(t,e){for(var r=this.targetDisplay._bkNode,i=BK.Director.root.convertToWorldSpace({x:t,y:-e}),n=0;n<r.children.length;n++)if(r.children[n].hittest(i))return this.targetDisplay;return null},e.prototype.$onRemoveFromStage=function(){},e.pixelPath="GameRes://resource/pixel.png",e.circlePath="GameRes://resource/circle.png",e}();t.BKGraphics=e,__reflect(e.prototype,"egret.BKGraphics"),"webgl"!=window.renderMode&&(t.Graphics=t.BKGraphics)}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var t=e.call(this)||this;return t.textValue="",t.onKeyboardComplete=t.onKeyboardComplete.bind(t),t.onKeyboardInput=t.onKeyboardInput.bind(t),t}return __extends(r,e),r.prototype.$setTextField=function(t){return this.$textfield=t,!0},r.prototype.$addToStage=function(){},r.prototype.$show=function(){BK.Editor.showKeyBoard(this.onKeyboardComplete,this.onKeyboardInput),this.dispatchEvent(new t.Event("focus"))},r.prototype.onKeyboardInput=function(e){this.textValue=e,t.Event.dispatchEvent(this,"updateText",!1)},r.prototype.onKeyboardComplete=function(t){this.$textfield.text=t,this.$hide()},r.prototype.$hide=function(){this.dispatchEvent(new t.Event("blur"))},r.prototype.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},r.prototype.$setText=function(t){return this.textValue=t,!0},r.prototype.$setColor=function(t){return!0},r.prototype.$onBlur=function(){},r.prototype.$removeFromStage=function(){},r.prototype.$resetStageText=function(){},r}(t.EventDispatcher);t.BKHTML5StageText=e,__reflect(e.prototype,"egret.BKHTML5StageText",["egret.StageText"]),t.StageText=e}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r;!function(e){function r(t){if(BK.FileUtil.isFileExist(a)){var e=BK.FileUtil.readFile(a).readAsString();if(e){var r=JSON.parse(e);return r?r[t]:void 0}}}function i(t,e){var r=BK.FileUtil.readFile(a).readAsString(),i={};if(r){var n=JSON.parse(r);n&&(i=n)}i[t]=e;var o=JSON.stringify(i);return BK.FileUtil.writeFile(a,o),!0}function n(t){var e=BK.FileUtil.readFile(a).readAsString();if(e){var r=JSON.parse(e);if(r&&r[t]){delete r[t];var i=JSON.stringify(r);BK.FileUtil.writeFile(a,i)}}}function o(){if(BK.FileUtil.isFileExist(a)){var t={},e=JSON.stringify(t);BK.FileUtil.writeFile(a,e)}}var a="GameSandBox://resource/localStorage";t.localStorage.setItem=i,t.localStorage.getItem=r,t.localStorage.removeItem=n,t.localStorage.clear=o}(r=e.BKlocalStorage||(e.BKlocalStorage={}))}(e=t.localStorage||(t.localStorage={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var r=e.call(this,new BK.Mesh(t.emptyTexture,[{x:0,y:0,z:0,r:1,g:1,b:1,a:1,u:0,v:1},{x:0,y:0,z:0,r:1,g:1,b:1,a:1,u:1,v:1},{x:0,y:-0,z:0,r:1,g:1,b:1,a:1,u:0,v:0}],[0,1,2]))||this;return r._textureDirty=!0,r._boundsDirty=!0,r._bounds=new t.Rectangle,r.$bitmapData=null,r.$texture=null,r.$renderNode=new t.sys.MeshNode,r._bkMesh=r._bkNode,r}return __extends(r,e),Object.defineProperty(r.prototype,"texture",{get:function(){return this.$texture},set:function(t){this.$texture!==t&&this.$setTexture(t)},enumerable:!0,configurable:!0}),r.prototype.$setTexture=function(t){this.$texture=t,this._transformDirty=!0,this.$texture?(this.$bitmapData=this.$texture.bitmapData,this.$bitmapData.bkTexture?this._bkMesh.setTexture(this.$bitmapData.bkTexture):(this.$bitmapData=null,this._bkMesh.setTexture({}))):(this.$bitmapData=null,this._bkMesh.setTexture({}))},r.prototype.$updateVertices=function(){this._boundsDirty=!0,this.$renderDirty=!0,this.$renderNode=new t.sys.MeshNode},r.prototype.$measureContentBounds=function(t){if(this._boundsDirty){this._boundsDirty=!1;var e=this.$renderNode,r=e.vertices;if(r.length){this._bounds.setTo(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0,n=r.length;n>i;i+=2){var o=r[i],a=r[i+1];this._bounds.x>o&&(this._bounds.x=o),this._bounds.width<o&&(this._bounds.width=o),this._bounds.y>a&&(this._bounds.y=a),this._bounds.height<a&&(this._bounds.height=a)}this._bounds.width-=this._bounds.x,this._bounds.height-=this._bounds.y}else this._bounds.setTo(0,0,0,0);e.bounds.copyFrom(this._bounds)}t.copyFrom(this._bounds)},r.prototype.$updateRenderNode=function(){var t=this.$renderNode,e=t.vertices,r=t.uvs,i=this._bkMesh.getVertices();if(i||(i=[]),i.length!==e.length/2){for(var n=i.length,o=e.length/2;o>n;++n)i[n]={};for(var a=this.$texture.$rotated,s=this.$texture.$bitmapX,h=this.$texture.$bitmapY,l=this.$texture.$bitmapWidth,c=this.$texture.$bitmapHeight,d=this.$texture.$sourceWidth,u=this.$texture.$sourceHeight,p=s/d,f=a?c/d:l/d,g=h/u,v=a?l/u:c/u,n=0,x=0,o=i.length;o>n;++n,x+=2){var y=i[n],b=r[x],$=r[x+1];y.x=e[x],y.y=-e[x+1],y.z=this._bkNode.zOrder,y.r=1,y.g=1,y.b=1,y.a=1,a?(y.u=p+(1-$)*f,y.v=1-(g+b*v)):(y.u=p+b*f,y.v=1-(g+$*v))}}else for(var n=0,x=0,o=i.length;o>n;++n,x+=2){var y=i[n];y.x=e[x],y.y=-e[x+1]}this._bkMesh.setVerticesAndIndices(i,t.indices)},r}(t.BKDisplayObject);t.BKMesh=e,__reflect(e.prototype,"egret.BKMesh"),"webgl"!=window.renderMode&&(t.Mesh=t.BKMesh)}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(r){var i=e.call(this,new BK.Sprite(0,0,{},0,1,1,1))||this;return i._size={width:0,height:0},i.$texture=null,i.offsetPoint=t.Point.create(0,0),i.$movieClipData=null,i.frames=null,i.$totalFrames=0,i.frameLabels=null,i.$frameLabelStart=0,i.$frameLabelEnd=0,i.frameEvents=null,i.frameIntervalTime=0,i.$eventPool=null,i.$isPlaying=!1,i.isStopped=!0,i.playTimes=0,i.$currentFrameNum=0,i.$nextFrameNum=1,i.displayedKeyFrameNum=0,i.passedTime=0,i.$frameRate=0/0,i.$bitmapData=null,i.$scale9Grid=null,i.lastTime=0,i._bkSprite=i._bkNode,i.$smoothing=t.Bitmap.defaultSmoothing,i.setMovieClipData(r),i}return __extends(r,e),r.prototype._updateBKNodeMatrix=function(){if(this.$texture){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,r=t.tx,i=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY-this._size.height;(0!==n||0!==o)&&(r-=t.a*n+t.c*o,i-=t.b*n+t.d*o);var a=this.frames[this.$currentFrameNum-1];e.set(t.a,-t.b,-t.c,t.d,r+a.x,-i-a.y)}},Object.defineProperty(r.prototype,"smoothing",{get:function(){return this.$smoothing},set:function(t){t!=this.$smoothing&&(this.$smoothing=t)},enumerable:!0,configurable:!0}),r.prototype.$init=function(){this.$reset();var t=this.$movieClipData;t&&t.$isDataValid()&&(this.frames=t.frames,this.$totalFrames=t.numFrames,this.frameLabels=t.labels,this.frameEvents=t.events,this.$frameRate=t.frameRate,this.frameIntervalTime=1e3/this.$frameRate,this._initFrame())},r.prototype.$reset=function(){this.frames=null,this.playTimes=0,this.$isPlaying=!1,this.setIsStopped(!0),this.$currentFrameNum=0,this.$nextFrameNum=1,this.displayedKeyFrameNum=0,this.passedTime=0,this.$eventPool=[]},r.prototype._initFrame=function(){this.$movieClipData.$isTextureValid()&&(this.advanceFrame(),this.constructFrame())},r.prototype.$updateRenderNode=function(){this.frames[this.$currentFrameNum-1].res&&(this.$texture?(this._transformDirty=!0,this.$bitmapData=this.$texture.bitmapData,this.$bitmapData.bkTexture?(this._bkSprite.setTexture(this.$bitmapData.bkTexture),this._bkSprite.adjustTexturePosition(this.$texture.$bitmapX,this.$texture.$sourceHeight-(this.$texture.$bitmapY+this.$texture.$bitmapHeight),this.$texture.$bitmapWidth,this.$texture.$bitmapHeight,this.$texture.$rotated),this._size.width=this.$texture.$bitmapWidth,this._size.height=this.$texture.$bitmapHeight,this._bkSprite.size=this._size):(this.$bitmapData=null,this._bkSprite.setTexture({}))):(this.$bitmapData=null,this._bkSprite.setTexture({})))},r.prototype.$measureContentBounds=function(t){var e=this.$texture;if(e){var r=this.offsetPoint.x,i=this.offsetPoint.y,n=e.$getTextureWidth(),o=e.$getTextureHeight();t.setTo(r,i,n,o)}else t.setEmpty()},r.prototype.$onAddToStage=function(t,r){e.prototype.$onAddToStage.call(this,t,r),this.$isPlaying&&this.$totalFrames>1&&this.setIsStopped(!1)},r.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.setIsStopped(!0)},r.prototype.getFrameLabelByName=function(t,e){void 0===e&&(e=!1),e&&(t=t.toLowerCase());var r=this.frameLabels;if(r)for(var i=null,n=0;n<r.length;n++)if(i=r[n],e?i.name.toLowerCase()==t:i.name==t)return i;return null},r.prototype.getFrameStartEnd=function(t){var e=this.frameLabels;if(e)for(var r=null,i=0;i<e.length;i++)if(r=e[i],t==r.name){this.$frameLabelStart=r.frame,this.$frameLabelEnd=r.end;break}},r.prototype.getFrameLabelByFrame=function(t){var e=this.frameLabels;if(e)for(var r=null,i=0;i<e.length;i++)if(r=e[i],r.frame==t)return r;return null},r.prototype.getFrameLabelForFrame=function(t){var e=null,r=null,i=this.frameLabels;if(i)for(var n=0;n<i.length;n++){if(r=i[n],r.frame>t)return e;e=r}return e},r.prototype.play=function(t){void 0===t&&(t=0),this.$isPlaying=!0,this.setPlayTimes(t),this.$totalFrames>1&&this.$stage&&this.setIsStopped(!1)},r.prototype.stop=function(){this.$isPlaying=!1,this.setIsStopped(!0)},r.prototype.prevFrame=function(){this.gotoAndStop(this.$currentFrameNum-1)},r.prototype.nextFrame=function(){this.gotoAndStop(this.$currentFrameNum+1)},r.prototype.gotoAndPlay=function(e,r){void 0===r&&(r=0),(0==arguments.length||arguments.length>2)&&t.$error(1022,"MovieClip.gotoAndPlay()"),"string"==typeof e?this.getFrameStartEnd(e):(this.$frameLabelStart=0,this.$frameLabelEnd=0),this.play(r),this.gotoFrame(e)},r.prototype.gotoAndStop=function(e){1!=arguments.length&&t.$error(1022,"MovieClip.gotoAndStop()"),this.stop(),this.gotoFrame(e)},r.prototype.gotoFrame=function(e){var r;"string"==typeof e?r=this.getFrameLabelByName(e).frame:(r=parseInt(e+"",10),r!=e&&t.$error(1022,"Frame Label Not Found")),1>r?r=1:r>this.$totalFrames&&(r=this.$totalFrames),r!=this.$nextFrameNum&&(this.$nextFrameNum=r,this.advanceFrame(),this.constructFrame(),this.handlePendingEvent())},r.prototype.advanceTime=function(e){var r=this,i=e-r.lastTime;r.lastTime=e;var n=r.frameIntervalTime,o=r.passedTime+i;r.passedTime=o%n;var a=o/n;if(1>a)return!1;for(;a>=1;){if(a--,r.$nextFrameNum++,r.$nextFrameNum>r.$totalFrames||r.$frameLabelStart>0&&r.$nextFrameNum>r.$frameLabelEnd)if(-1==r.playTimes)r.$eventPool.push(t.Event.LOOP_COMPLETE),r.$nextFrameNum=1;else{if(r.playTimes--,!(r.playTimes>0)){r.$nextFrameNum=r.$totalFrames,r.$eventPool.push(t.Event.COMPLETE),r.stop();break}r.$eventPool.push(t.Event.LOOP_COMPLETE),r.$nextFrameNum=1}r.$currentFrameNum==r.$frameLabelEnd&&(r.$nextFrameNum=r.$frameLabelStart),r.advanceFrame()}return r.constructFrame(),r.handlePendingEvent(),!1},r.prototype.advanceFrame=function(){this.$currentFrameNum=this.$nextFrameNum;var e=this.frameEvents[this.$nextFrameNum];e&&""!=e&&t.MovieClipEvent.dispatchMovieClipEvent(this,t.MovieClipEvent.FRAME_LABEL,e)},r.prototype.constructFrame=function(){var t=this,e=t.$currentFrameNum;if(t.displayedKeyFrameNum!=e){var r=t.$movieClipData.getTextureByFrame(e);t.$texture=r,t.$movieClipData.$getOffsetByFrame(e,t.offsetPoint),t.displayedKeyFrameNum=e,t.$renderDirty=!0;var i=t.$parent;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp());var n=t.$maskedObject;n&&!n.$cacheDirty&&(n.$cacheDirty=!0,n.$cacheDirtyUp())}},r.prototype.$renderFrame=function(){var t=this;t.$texture=t.$movieClipData.getTextureByFrame(t.$currentFrameNum),t.$renderDirty=!0;var e=t.$parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());var r=t.$maskedObject;r&&!r.$cacheDirty&&(r.$cacheDirty=!0,r.$cacheDirtyUp())},r.prototype.handlePendingEvent=function(){if(0!=this.$eventPool.length){this.$eventPool.reverse();for(var e=this.$eventPool,r=e.length,i=!1,n=!1,o=0;r>o;o++){var a=e.pop();a==t.Event.LOOP_COMPLETE?n=!0:a==t.Event.COMPLETE?i=!0:this.dispatchEventWith(a)}n&&this.dispatchEventWith(t.Event.LOOP_COMPLETE),i&&this.dispatchEventWith(t.Event.COMPLETE)}},Object.defineProperty(r.prototype,"totalFrames",{get:function(){return this.$totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentFrame",{get:function(){return this.$currentFrameNum},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentFrameLabel",{get:function(){var t=this.getFrameLabelByFrame(this.$currentFrameNum);return t&&t.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentLabel",{get:function(){var t=this.getFrameLabelForFrame(this.$currentFrameNum);return t?t.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"frameRate",{get:function(){return this.$frameRate},set:function(t){t!=this.$frameRate&&(this.$frameRate=t,this.frameIntervalTime=1e3/this.$frameRate)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaying",{get:function(){return this.$isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"movieClipData",{get:function(){return this.$movieClipData},set:function(t){this.setMovieClipData(t)},enumerable:!0,configurable:!0}),r.prototype.setMovieClipData=function(t){this.$movieClipData!=t&&(this.$movieClipData=t,this.$init())},r.prototype.setPlayTimes=function(t){(0>t||t>=1)&&(this.playTimes=0>t?-1:Math.floor(t))},r.prototype.setIsStopped=function(e){this.isStopped!=e&&(this.isStopped=e,e?t.ticker.$stopTick(this.advanceTime,this):(this.playTimes=0==this.playTimes?1:this.playTimes,this.lastTime=t.getTimer(),t.ticker.$startTick(this.advanceTime,this)))},r}(t.BKDisplayObject);t.BKMovieClip=e,__reflect(e.prototype,"egret.BKMovieClip"),"webgl"!=window.renderMode&&(t.MovieClip=e)}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(i){var n=e.call(this)||this;n.stage=new t.Stage,n._mainTicker=BK.Director.ticker,n._viewRect=new t.Rectangle,n._touch=new t.sys.TouchHandler(n.stage),n._displayList=[],r.instance=n,n._options=i,BK.Director.root.addChild(n.stage._bkNode),t.lifecycle.stage=n.stage,t.sys.$TempStage=n.stage,n.stage.$screen=n,n.stage.maxTouches=10,n.stage.frameRate=n._options.frameRate,n.stage.orientation=n._options.orientation,n.stage.scaleMode=n._options.scaleMode,n._mainTicker.interval=1,n._mainTicker.add(function(){n._touchHandler(),t.ticker.update(),t.ticker.callLaters();for(var e=0,r=n._displayList;e<r.length;e++){var i=r[e];i.$getRenderNode()}},n),n.updateScreenSize(),n.updateMaxTouches();var o=new BK.Texture("GameRes://resource/pixel.png"),a=new BK.Sprite(0,0,o,0,1,1,1),s=i.background.toString(16),h=parseInt(s.substring(0,2),16)/255,l=parseInt(s.substring(2,4),16)/255,c=parseInt(s.substring(4,6),16)/255;a.vertexColor={r:h,g:l,b:c,a:1},a.size={width:n.stage.stageWidth,height:n.stage.stageHeight},a.position={x:0,y:-n.stage.stageHeight},BK.Director.root.addChild(a),a.zOrder=1;var d,u=n._options.entryClassName;if(u&&(d=t.getDefinitionByName(u)),d){var p=new d;p.addChild&&n.stage.addChild(p)}else if(d=global.Main){var p=new d;p.addChild&&n.stage.addChild(p)}return n}return __extends(r,e),r.prototype._touchHandler=function(){var t=BK.TouchEvent.getTouchEvent();if(t&&0!==t.length){for(var e=0,r=t;e<r.length;e++){var i=r[e],n=i.id,o=(BK.Director.screenPixelSize,BK.Director.root.convertToNodeSpace(i)),a=o.x,s=-o.y;1===i.status?this._touch.onTouchEnd(a,s,n):2===i.status?this._touch.onTouchBegin(a,s,n):3===i.status&&this._touch.onTouchMove(a,s,n)}BK.TouchEvent.updateTouchStatus()}},r.prototype.updateScreenSize=function(){var e=BK.Director.screenPixelSize,r=e.width,i=e.height;t.Capabilities.$boundingClientWidth=r,t.Capabilities.$boundingClientHeight=i;var n=t.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,r,i,this._options.contentWidth,this._options.contentHeight),o=n.stageWidth,a=n.stageHeight,s=n.displayWidth,h=n.displayHeight,l=(i-h)/2,c=(r-s)/2;this.stage.$stageWidth=o,this.stage.$stageHeight=a,BK.Director.root.position={x:c,y:BK.Director.screenPixelSize.height-l},BK.Director.root.scale={x:s/o,y:h/a},this._viewRect.setTo(c,l,o,a),this.stage.dispatchEventWith(t.Event.RESIZE)},r.prototype.setContentSize=function(t,e){var r=this._options;r.contentWidth=t,r.contentHeight=e,this.updateScreenSize()},r.prototype.updateMaxTouches=function(){this._touch.$initMaxTouches()},r}(t.HashObject);t.BKPlayer=e,__reflect(e.prototype,"egret.BKPlayer",["egret.sys.Screen"])}(egret||(egret={}));var egret;!function(t){var e=function(){function t(t,e){this.surface={},this.context={}}return Object.defineProperty(t.prototype,"width",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype.resize=function(t,e,r){},t.prototype.getPixels=function(t,e,r,i){return void 0===r&&(r=1),void 0===i&&(i=1),[]},t.prototype.toDataURL=function(t,e){return""},t.prototype.clear=function(){},t.prototype.destroy=function(){},t}();t.BKRenderBuffer=e,__reflect(e.prototype,"egret.BKRenderBuffer",["egret.sys.RenderBuffer"]),t.sys.RenderBuffer=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){return e.call(this)||this}return __extends(r,e),r.prototype.drawToTexture=function(e,r,i){if(void 0===i&&(i=1),r&&(0==r.width||0==r.height))return!1;var n=r||e.$getOriginalBounds();if(0==n.width||0==n.height)return!1;i/=t.$TextureScaleFactor;var o=(n.x+n.width)*i,a=(n.y+n.height)*i;r&&(o=n.width*i,a=n.height*i);var s,h=e._bkNode,l=(h.parent,BK.Texture.createTexture(o,a));e.invalidUpdate();var c=e.$getMatrix().clone(),d=t.Matrix.create();t.lifecycle.stage.stageHeight;if(d.translate(-n.x,-n.y-n.height),e.$setMatrix(d),e.$getRenderNode(),r){var u=new BK.ClipRectNode(0,0,n.width,n.height);u.position={x:0,y:0};var p=h.parent;p&&h.removeFromParent(),u.addChild(h);var f=BK.Texture.createTexture(n.width,n.height);BK.Render.renderToTexture(u,f),h.removeFromParent(),p&&p.addChild(h),e.$setMatrix(c),e.$getRenderNode(),s=new t.BKBitmapData(f,!0)}else BK.Render.renderToTexture(h,l),e.$setMatrix(c),e.$getRenderNode(),s=new t.BKBitmapData(l,!0);return this._setBitmapData(s),this.$bitmapData.width=o,this.$bitmapData.height=a,this.$initData(0,0,o,a,0,0,o,a,o,a),!0},r.prototype.getPixel32=function(t,e){var r;return r},r.prototype.dispose=function(){e.prototype.dispose.call(this),this.$renderBuffer=null},r}(t.Texture);t.BKRenderTexture=e,__reflect(e.prototype,"egret.BKRenderTexture"),"webgl"!=window.renderMode&&(t.RenderTexture=t.BKRenderTexture)}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var r=e.call(this)||this;return r.$graphics=new t.Graphics,r.$graphics.$setTarget(r),r}return __extends(r,e),Object.defineProperty(r.prototype,"graphics",{get:function(){return this.$graphics},enumerable:!0,configurable:!0}),r.prototype.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},r.prototype.$hitTest=function(t,r){var i=e.prototype.$hitTest.call(this,t,r);return i==this&&(i=this.$graphics.$hitTest(t,r)),i},r.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},r}(t.BKDisplayObject);t.BKShape=e,__reflect(e.prototype,"egret.BKShape"),"webgl"!=window.renderMode&&(t.Shape=t.BKShape)}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var r=e.call(this)||this;return r.type=t.Sound.EFFECT,r}return __extends(r,e),r.prototype.load=function(e){if(e.indexOf("http://")>=0||e.indexOf("https://")>=0){var r=t._sha1FromUrl(e),i="GameSandBox://webcache/sound"+r,n=BK.FileUtil.readFile(i);if(n&&n.length>0)this._loadFromBuffer.call(this,i);else{var o=new BK.HttpUtil(e);o.setHttpMethod("get"),o.requestAsync(function(r,n){200==n?(BK.FileUtil.writeBufferToFile(i,r),this._loadFromBuffer.call(this,i)):(console.log("BK http加载外部资源失败, url = "+e+", code = "+n),t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,this,t.IOErrorEvent.IO_ERROR))}.bind(this))}}else this.url=e,BK.FileUtil.isFileExist(this.url)?t.$callAsync(t.Event.dispatchEvent,t.Event,this,t.Event.COMPLETE):t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,this,t.IOErrorEvent.IO_ERROR)},r.prototype._loadFromBuffer=function(e){this.url=e,t.$callAsync(t.Event.dispatchEvent,t.Event,this,t.Event.COMPLETE)},r.prototype.play=function(e,r){if(void 0===e&&(e=0),void 0===r&&(r=0),!this._bKSoundChannel){var i=new t.BKSoundChannel;i.$loops=r,i.$startTime=e,i.$type=this.type,i.$url=this.url,this._bKSoundChannel=i}return this._bKSoundChannel.$play(),this._bKSoundChannel},r.prototype.close=function(){this._bKSoundChannel&&this._bKSoundChannel.stop()},r.MUSIC="music",r.EFFECT="effect",r}(t.EventDispatcher);t.BKSound=e,__reflect(e.prototype,"egret.BKSound",["egret.Sound"]),t.Sound=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){return e.call(this)||this}return __extends(r,e),r.prototype.$play=function(){if(!this._bkAudio){var e=void 0;switch(this.$type){case t.Sound.MUSIC:e=0;break;case t.Sound.EFFECT:e=1}var r=0===this.$loops?-1:this.$loops,i=void 0;i=this.$url.indexOf("GameRes://")>=0||this.$url.indexOf("GameSandBox://")>=0?this.$url:"GameRes://"+this.$url,this._bkAudio=new BK.Audio(e,i,r,0)}this._bkAudio.startMusic()},r.prototype.stop=function(){this._bkAudio&&this._bkAudio.stopMusic()},r}(t.EventDispatcher);t.BKSoundChannel=e,__reflect(e.prototype,"egret.BKSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var r=e.call(this)||this;return r.$graphics=new t.Graphics,r.$graphics.$setTarget(r),r}return __extends(r,e),Object.defineProperty(r.prototype,"graphics",{get:function(){return this.$graphics},enumerable:!0,configurable:!0}),r.prototype.$hitTest=function(e,r){if(!this.$visible)return null;var i=this.$getInvertedConcatenatedMatrix(),n=i.a*e+i.c*r+i.tx,o=i.b*e+i.d*r+i.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(n,o))return null;if(this.$mask&&!this.$mask.$hitTest(e,r))return null;for(var s=this.$children,h=!1,l=null,c=s.length-1;c>=0;c--){var d=s[c];if(!d.$maskedObject&&(l=d.$hitTest(e,r))){if(h=!0,l.$touchEnabled)break;l=null}}return l?this.$touchChildren?l:this:h?this:(l=t.DisplayObject.prototype.$hitTest.call(this,e,r),l&&(l=this.$graphics.$hitTest(e,r)),l)},r.prototype.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},r.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},r}(t.BKDisplayObjectContainer);t.BKSprite=e,__reflect(e.prototype,"egret.BKSprite"),"webgl"!=window.renderMode&&(t.Sprite=t.BKSprite)}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var r=e.call(this)||this;return r.$stageWidth=0,r.$stageHeight=0,r.$scaleMode=t.StageScaleMode.SHOW_ALL,r.$orientation=t.OrientationMode.AUTO,r.$maxTouches=99,r.$stage=r,r.$nestLevel=1,r}return __extends(r,e),Object.defineProperty(r.prototype,"frameRate",{get:function(){return t.ticker.$frameRate},set:function(e){t.ticker.$setFrameRate(e)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stageWidth",{get:function(){return this.$stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"stageHeight",{get:function(){return this.$stageHeight},enumerable:!0,configurable:!0}),r.prototype.invalidate=function(){t.sys.$invalidateRenderFlag=!0},r.prototype.registerImplementation=function(e,r){t.registerImplementation(e,r)},r.prototype.getImplementation=function(e){return t.getImplementation(e)},Object.defineProperty(r.prototype,"scaleMode",{get:function(){return this.$scaleMode},set:function(t){this.$scaleMode!=t&&(this.$scaleMode=t,this.$screen.updateScreenSize())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"orientation",{get:function(){return this.$orientation},set:function(t){this.$orientation!=t&&(this.$orientation=t,this.$screen.updateScreenSize())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"textureScaleFactor",{get:function(){return t.$TextureScaleFactor},set:function(e){t.$TextureScaleFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxTouches",{get:function(){return this.$maxTouches},set:function(t){this.$maxTouches!=t&&(this.$maxTouches=t,this.$screen.updateMaxTouches())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"dirtyRegionPolicy",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),r.prototype.setContentSize=function(t,e){this.$screen.setContentSize(t,e)},r}(t.BKDisplayObjectContainer);t.BKStage=e,__reflect(e.prototype,"egret.BKStage"),"webgl"!=window.renderMode&&(t.Stage=t.BKStage)}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}return t.prototype.render=function(t,e,r,i){return 0},t.prototype.drawNodeToBuffer=function(t,e,r,i){},t}();t.BKSystemRenderer=e,__reflect(e.prototype,"egret.BKSystemRenderer",["egret.sys.SystemRenderer"])}(egret||(egret={}));var egret;!function(t){function e(e,r,i){i=i||{};var n=null==i.italic?r[16]:i.italic,o=null==i.bold?r[15]:i.bold,a=null==i.size?r[0]:i.size,s=i.fontFamily||r[8]||t.TextField.default_fontFamily;return t.sys.measureText(e,s,a,o,n)}function r(t,e){if(c.length>0){var r=c.pop();return r.updateText(e,t),r}var i=new BK.TextNode(e,t);return i}function i(t,e,r,i,n){if(s||(s=new BK.Canvas(1,1)),s.measureText){if(s.textBaseLine="bottom",s.textAlign="left",s.setTextSize(r),e){var o=e.indexOf("GameRes://")>0?e:"GameRes://"+e;BK.FileUtil.isFileExist(o)?s.fontPath=o:s.size={width:1,height:1}}s.setTextBold(i),s.setTextItalic(n);var h=s.measureText(t,1024,1024);return h.width}a||(a=new BK.TextNode(l,"")),l.fontSize=r,l.bold=i?1:0,l.italic=n?1:0;var h=a.measureTextSize(l,t);return h.contentWidth+1}var n=new RegExp("(?=[\\u00BF-\\u1FFF\\u2C00-\\uD7FF]|\\b|\\s)(?![。，！、》…）)}”】\\.\\,\\!\\?\\]\\:])"),o=function(i){function o(){var e=i.call(this)||this;return e.$inputEnabled=!1,e.inputUtils=null,e.graphicsNode=null,e.isFlow=!1,e.textArr=[],e.linesArr=[],e.$isTyping=!1,e._bkNodes=[],e.$TextField={0:t.TextField.default_size,1:0,2:t.TextField.default_textColor,3:0/0,4:0/0,5:0,6:0,7:0,8:t.TextField.default_fontFamily,9:"left",10:"top",11:"#ffffff",12:"",13:"",14:[],15:!1,16:!1,17:!0,18:!1,19:!1,20:!1,21:0,22:0,23:0,24:t.TextFieldType.DYNAMIC,25:0,26:"#000000",27:0,28:-1,29:0,30:!1,31:!1,32:0,33:!1,34:16777215,35:null,36:null,37:t.TextFieldInputType.TEXT},e}return __extends(o,i),o.prototype.isInput=function(){return this.$TextField[24]==t.TextFieldType.INPUT},o.prototype.$setTouchEnabled=function(t){i.prototype.$setTouchEnabled.call(this,t),this.isInput()&&(this.$inputEnabled=!0)},Object.defineProperty(o.prototype,"fontFamily",{get:function(){return this.$TextField[8]},set:function(t){this.$setFontFamily(t)},enumerable:!0,configurable:!0}),o.prototype.$setFontFamily=function(t){var e=this.$TextField;return e[8]==t?!1:(e[8]=t,this.invalidateFontString(),!0)},Object.defineProperty(o.prototype,"size",{get:function(){return this.$TextField[0]},set:function(t){this.$setSize(t)},enumerable:!0,configurable:!0}),o.prototype.$setSize=function(t){t=+t||0;var e=this.$TextField;return e[0]==t?!1:(e[0]=t,this.invalidateFontString(),this._transformDirty=!0,!0)},Object.defineProperty(o.prototype,"bold",{get:function(){return this.$TextField[15]},set:function(t){this.$setBold(t)},enumerable:!0,configurable:!0}),o.prototype.$setBold=function(t){t=!!t;var e=this.$TextField;return t==e[15]?!1:(e[15]=t,this.invalidateFontString(),this._transformDirty=!0,!0)},Object.defineProperty(o.prototype,"italic",{get:function(){return this.$TextField[16]},set:function(t){this.$setItalic(t)},enumerable:!0,configurable:!0}),o.prototype.$setItalic=function(t){t=!!t;var e=this.$TextField;return t==e[16]?!1:(e[16]=t,this.invalidateFontString(),this._transformDirty=!0,!0)},o.prototype.invalidateFontString=function(){this.$TextField[17]=!0,this.$invalidateTextField()},Object.defineProperty(o.prototype,"textAlign",{get:function(){return this.$TextField[9]},set:function(t){this.$setTextAlign(t)},enumerable:!0,configurable:!0}),o.prototype.$setTextAlign=function(t){var e=this.$TextField;return e[9]==t?!1:(e[9]=t,this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"verticalAlign",{get:function(){return this.$TextField[10]},set:function(t){this.$setVerticalAlign(t)},enumerable:!0,configurable:!0}),o.prototype.$setVerticalAlign=function(t){var e=this.$TextField;return e[10]==t?!1:(e[10]=t,this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"lineSpacing",{get:function(){return this.$TextField[1]},set:function(t){this.$setLineSpacing(t)},enumerable:!0,configurable:!0}),o.prototype.$setLineSpacing=function(t){t=+t||0;var e=this.$TextField;return e[1]==t?!1:(e[1]=t,this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"textColor",{get:function(){return this.$TextField[2]},set:function(t){this.$setTextColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setTextColor=function(t){t=0|+t;var e=this.$TextField;return e[2]==t?!1:(e[2]=t,this.inputUtils&&this.inputUtils._setColor(this.$TextField[2]),this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"wordWrap",{get:function(){return this.$TextField[19]},set:function(t){this.$setWordWrap(t)},enumerable:!0,configurable:!0}),o.prototype.$setWordWrap=function(t){t=!!t;var e=this.$TextField;t!=e[19]&&(e[20]||(e[19]=t,this.$invalidateTextField()))},Object.defineProperty(o.prototype,"type",{get:function(){return this.$TextField[24]},set:function(t){this.$setType(t)},enumerable:!0,configurable:!0}),o.prototype.$setType=function(e){var r=this.$TextField;return r[24]!=e?(r[24]=e,e==t.TextFieldType.INPUT?(isNaN(r[3])&&this.$setWidth(100),isNaN(r[4])&&this.$setHeight(30),this.$setTouchEnabled(!0),null==this.inputUtils&&(this.inputUtils=new t.InputController),this.inputUtils.init(this),this.$invalidateTextField(),this.$stage&&this.inputUtils._addStageText()):(this.inputUtils&&(this.inputUtils._removeStageText(),this.inputUtils=null),this.$setTouchEnabled(!1)),!0):!1},Object.defineProperty(o.prototype,"inputType",{get:function(){return this.$TextField[37]},set:function(t){this.$TextField[37]=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"text",{get:function(){return this.$getText()},set:function(t){this.$setText(t)},enumerable:!0,configurable:!0}),o.prototype.$getText=function(){return this.$TextField[24]==t.TextFieldType.INPUT?this.inputUtils._getText():this.$TextField[13]},o.prototype.$setBaseText=function(t){null==t&&(t=""),t=t.toString(),this.isFlow=!1;var e=this.$TextField;if(e[13]!=t){this.$invalidateTextField(),e[13]=t;var r="";return r=e[20]?this.changeToPassText(t):t,this.setMiddleStyle([{text:r}]),this._transformDirty=!0,!0}return!1},o.prototype.$setText=function(t){null==t&&(t="");var e=this.$setBaseText(t);return this.inputUtils&&this.inputUtils._setText(this.$TextField[13]),e},Object.defineProperty(o.prototype,"displayAsPassword",{get:function(){return this.$TextField[20]},set:function(t){this.$setDisplayAsPassword(t)},enumerable:!0,configurable:!0}),o.prototype.$setDisplayAsPassword=function(t){var e=this.$TextField;if(e[20]!=t){e[20]=t,this.$invalidateTextField();var r="";return r=t?this.changeToPassText(e[13]):e[13],this.setMiddleStyle([{text:r}]),!0}return!1},Object.defineProperty(o.prototype,"strokeColor",{get:function(){return this.$TextField[25]},set:function(t){t=+t||0,this.$setStrokeColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setStrokeColor=function(e){var r=this.$TextField;return r[25]!=e?(this.$invalidateTextField(),r[25]=e,r[26]=t.toColorString(e),!0):!1},Object.defineProperty(o.prototype,"stroke",{get:function(){return this.$TextField[27]},set:function(t){this.$setStroke(t)},enumerable:!0,configurable:!0}),o.prototype.$setStroke=function(t){return this.$TextField[27]!=t?(this.$invalidateTextField(),this.$TextField[27]=t,this._transformDirty=!0,!0):!1},Object.defineProperty(o.prototype,"maxChars",{get:function(){return this.$TextField[21]},set:function(t){this.$setMaxChars(t)},enumerable:!0,configurable:!0}),o.prototype.$setMaxChars=function(t){return this.$TextField[21]!=t?(this.$TextField[21]=t,!0):!1},Object.defineProperty(o.prototype,"scrollV",{get:function(){return Math.min(Math.max(this.$TextField[28],1),this.maxScrollV)},set:function(t){this.$TextField[28]=Math.max(t,1),this.$invalidateTextField()
},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxScrollV",{get:function(){return this.$getLinesArr(),Math.max(this.$TextField[29]-t.TextFieldUtils.$getScrollNum(this)+1,1)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionBeginIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionEndIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"caretIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),o.prototype.$setSelection=function(t,e){return!1},o.prototype.$getLineHeight=function(){return this.$TextField[1]+this.$TextField[0]},Object.defineProperty(o.prototype,"numLines",{get:function(){return this.$getLinesArr(),this.$TextField[29]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"multiline",{get:function(){return this.$TextField[30]},set:function(t){this.$setMultiline(t)},enumerable:!0,configurable:!0}),o.prototype.$setMultiline=function(t){return this.$TextField[30]=t,this.$invalidateTextField(),!0},Object.defineProperty(o.prototype,"restrict",{get:function(){var t=this.$TextField,e=null;return null!=t[35]&&(e=t[35]),null!=t[36]&&(null==e&&(e=""),e+="^"+t[36]),e},set:function(t){var e=this.$TextField;if(null==t)e[35]=null,e[36]=null;else{for(var r=-1;r<t.length&&(r=t.indexOf("^",r),0!=r)&&r>0&&"\\"==t.charAt(r-1);)r++;0==r?(e[35]=null,e[36]=t.substring(r+1)):r>0?(e[35]=t.substring(0,r),e[36]=t.substring(r+1)):(e[35]=t,e[36]=null)}},enumerable:!0,configurable:!0}),o.prototype.$setWidth=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[3]))return!1;e[3]=0/0}else{if(e[3]==t)return!1;e[3]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),this._transformDirty=!0,!0)},o.prototype.$setHeight=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[4]))return!1;e[4]=0/0}else{if(e[4]==t)return!1;e[4]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),this._transformDirty=!0,!0)},o.prototype.$getWidth=function(){var t=this.$TextField;return isNaN(t[3])?this.$getContentBounds().width:t[3]},o.prototype.$getHeight=function(){var t=this.$TextField;return isNaN(t[4])?this.$getContentBounds().height:t[4]},Object.defineProperty(o.prototype,"border",{get:function(){return this.$TextField[31]},set:function(t){this.$setBorder(t)},enumerable:!0,configurable:!0}),o.prototype.$setBorder=function(t){this.$TextField[31]=!!t},Object.defineProperty(o.prototype,"borderColor",{get:function(){return this.$TextField[32]},set:function(t){this.$setBorderColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setBorderColor=function(t){this.$TextField[32]=+t||0},Object.defineProperty(o.prototype,"background",{get:function(){return this.$TextField[33]},set:function(t){this.$setBackground(t)},enumerable:!0,configurable:!0}),o.prototype.$setBackground=function(t){this.$TextField[33]=t},Object.defineProperty(o.prototype,"backgroundColor",{get:function(){return this.$TextField[34]},set:function(t){this.$setBackgroundColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setBackgroundColor=function(t){this.$TextField[34]=t},o.prototype.fillBackground=function(e){var r=this.graphicsNode;r&&r.clear();var i=this.$TextField;if(i[33]||i[31]||e&&e.length>0){if(!r){r=this.graphicsNode=new t.sys.GraphicsNode;var n=new t.sys.GroupNode;n.addNode(r),n.addNode(this.textNode),this.$renderNode=n}var o=void 0,a=void 0;if(i[33]&&(o=r.beginFill(i[34]),o.drawRect(0,0,this.$getWidth(),this.$getHeight())),i[31]&&(a=r.lineStyle(1,i[32]),a.drawRect(0,0,this.$getWidth()-1,this.$getHeight()-1)),e&&e.length>0)for(var s=i[2],h=-1,l=e.length,c=0;l>c;c+=4){var d=e[c],u=e[c+1],p=e[c+2],f=e[c+3]||s;(0>h||h!=f)&&(h=f,a=r.lineStyle(2,f,1,t.CapsStyle.NONE)),a.moveTo(d,u),a.lineTo(d+p,u)}}if(r){var g=this.$getRenderBounds();r.x=g.x,r.y=g.y,r.width=g.width,r.height=g.height,t.Rectangle.release(g)}},o.prototype.setFocus=function(){this.type==t.TextFieldType.INPUT&&this.$stage&&this.inputUtils.$onFocus()},o.prototype.$onRemoveFromStage=function(){i.prototype.$onRemoveFromStage.call(this),this.removeEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._removeStageText(),this.textNode&&this.textNode.clean()},o.prototype.$onAddToStage=function(e,r){i.prototype.$onAddToStage.call(this,e,r),this.addEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._addStageText()},o.prototype.$invalidateTextField=function(){var t=this;t.$renderDirty=!0,t.$TextField[18]=!0;var e=t.$parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());var r=t.$maskedObject;r&&!r.$cacheDirty&&(r.$cacheDirty=!0,r.$cacheDirtyUp())},o.prototype.$getRenderBounds=function(){var e=this.$getContentBounds(),r=t.Rectangle.create();r.copyFrom(e),this.$TextField[31]&&(r.width+=2,r.height+=2);var i=2*this.$TextField[27];return i>0&&(r.width+=2*i,r.height+=2*i),r.x-=i+2,r.y-=i+2,r.width=Math.ceil(r.width)+4,r.height=Math.ceil(r.height)+4,r},o.prototype.$measureContentBounds=function(e){this.$getLinesArr();var r=isNaN(this.$TextField[3])?this.$TextField[5]:this.$TextField[3],i=isNaN(this.$TextField[4])?t.TextFieldUtils.$getTextHeight(this):this.$TextField[4];e.setTo(0,0,r,i)},o.prototype.$updateRenderNode=function(){if(this.$TextField[24]==t.TextFieldType.INPUT){if(this.inputUtils._updateProperties(),this.$isTyping)return void this.fillBackground()}else if(0==this.$TextField[3])return;this.drawText()},Object.defineProperty(o.prototype,"textFlow",{get:function(){return this.textArr},set:function(t){this.isFlow=!0;var e="";null==t&&(t=[]);for(var r=0;r<t.length;r++){var i=t[r];e+=i.text}this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.setMiddleStyle(t))},enumerable:!0,configurable:!0}),o.prototype.changeToPassText=function(t){if(this.$TextField[20]){for(var e="",r=0,i=t.length;i>r;r++)switch(t.charAt(r)){case"\n":e+="\n";break;case"\r":break;default:e+="*"}return e}return t},o.prototype.setMiddleStyle=function(t){this.$TextField[18]=!0,this.textArr=t,this.$invalidateTextField()},Object.defineProperty(o.prototype,"textWidth",{get:function(){return this.$getLinesArr(),this.$TextField[5]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textHeight",{get:function(){return this.$getLinesArr(),t.TextFieldUtils.$getTextHeight(this)},enumerable:!0,configurable:!0}),o.prototype.appendText=function(t){this.appendElement({text:t})},o.prototype.appendElement=function(t){var e=this.$TextField[13]+t.text;this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.textArr.push(t),this.setMiddleStyle(this.textArr))},o.prototype.$getLinesArr=function(){var r=this.$TextField;if(!r[18])return this.linesArr;r[18]=!1;var i=this.textArr;this.linesArr.length=0,r[6]=0,r[5]=0;var o=r[3];if(!isNaN(o)&&0==o)return r[29]=0,[{width:0,height:0,charNum:0,elements:[],hasNextLine:!1}];for(var a,s=this.linesArr,h=0,l=0,c=0,d=0,u=0,p=i.length;p>u;u++){var f=i[u];if(f.text){f.style=f.style||{};for(var g=f.text.toString(),v=g.split(/(?:\r\n|\r|\n)/),x=0,y=v.length;y>x;x++){null==s[d]&&(a={width:0,height:0,elements:[],charNum:0,hasNextLine:!1},s[d]=a,h=0,c=0,l=0),c=r[24]==t.TextFieldType.INPUT?r[0]:Math.max(c,f.style.size||r[0]);var b=!0;if(""==v[x])x==y-1&&(b=!1);else{var $=e(v[x],r,f.style);if(isNaN(o))h+=$,l+=v[x].length,a.elements.push({width:$,text:v[x],style:f.style}),x==y-1&&(b=!1);else if(o>=h+$)a.elements.push({width:$,text:v[x],style:f.style}),h+=$,l+=v[x].length,x==y-1&&(b=!1);else{var m=0,T=0,_=v[x],w=void 0;w=r[19]?_.split(n):_.match(/./g);for(var S=w.length,B=0;S>m;m++){var E=w[m].length,C=!1;if(1==E&&S-1>m){var R=w[m].charCodeAt(0),F=w[m+1].charCodeAt(0);if(R>=55296&&56319>=R&&56320==(64512&F)){var D=w[m]+w[m+1];E=2,C=!0,$=e(D,r,f.style)}else $=e(w[m],r,f.style)}else $=e(w[m],r,f.style);if(0!=h&&h+$>o&&h+m!=0)break;if(T+$>o)for(var L=w[m].match(/./g),O=0,A=L.length;A>O;O++){var E=L[O].length,N=!1;if(1==E&&A-1>O){var R=L[O].charCodeAt(0),F=L[O+1].charCodeAt(0);if(R>=55296&&56319>=R&&56320==(64512&F)){var D=L[O]+L[O+1];E=2,N=!0,$=e(D,r,f.style)}else $=e(L[O],r,f.style)}else $=e(L[O],r,f.style);if(O>0&&h+$>o)break;B+=E,T+=$,h+=$,l+=B,N&&O++}else B+=E,T+=$,h+=$,l+=B;C&&m++}if(m>0){a.elements.push({width:T,text:_.substring(0,B),style:f.style});var M=_.substring(B),k=void 0,P=M.length;for(k=0;P>k&&" "==M.charAt(k);k++);v[x]=M.substring(k)}""!=v[x]&&(x--,b=!1)}}b&&(l++,a.hasNextLine=!0),x<v.length-1&&(a.width=h,a.height=c,a.charNum=l,r[5]=Math.max(r[5],h),r[6]+=c,d++)}u==i.length-1&&a&&(a.width=h,a.height=c,a.charNum=l,r[5]=Math.max(r[5],h),r[6]+=c)}else a&&(a.width=h,a.height=c,a.charNum=l,r[5]=Math.max(r[5],h),r[6]+=c)}return r[29]=s.length,s},o.prototype.drawText=function(){var e=this.$TextField,i=this.$getLinesArr();if(0==e[5])return[];var n=isNaN(e[3])?e[5]:e[3],o=t.TextFieldUtils.$getTextHeight(this),a=0,s=t.TextFieldUtils.$getStartLine(this),l=e[4];if(!isNaN(l)&&l>o){var d=t.TextFieldUtils.$getValign(this);a+=d*(l-o)}a=Math.round(a);for(var u=t.TextFieldUtils.$getHalign(this),p=0,f=0,g=[],v=s,x=e[29];x>v;v++){var y=i[v],b=y.height;if(a+=b,v!=s){if(e[24]==t.TextFieldType.INPUT&&!e[30])break;if(!isNaN(l)&&a>l)break}f=Math.round((n-y.width)*u);for(var $=0,m=y.elements.length;m>$;$++){var T=y.elements[$],_=T.style.size||e[0];h.italic=T.style.italic?1:e[16],h.bold=T.style.bold?1:e[15],h.fontSize=_,h.strokeSize=isNaN(Number(T.style.stroke))?e[27]:T.style.stroke,h.strokeColor=4278190080+(isNaN(Number(T.style.strokeColor))?e[25]:T.style.strokeColor),h.textColor=4278190080+(isNaN(Number(T.style.textColor))?e[2]:T.style.textColor),h.width=h.maxWidth=T.width,h.height=h.maxHeight=1.15*_;var w=void 0;p<this._bkNodes.length?(w=this._bkNodes[p],w.updateText(h,T.text)):(w=r(T.text,h),this._bkNodes[p]=w,this._bkNode.addChild(w)),w.position={x:f,y:-a},p++,T.style.underline&&g.push(f,a,T.width,T.style.textColor),f+=T.width}a+=e[1]}for(var v=p;v<this._bkNodes.length;++v){var w=this._bkNodes[v];c.push(w),this._bkNode.removeChild(w)}return this._bkNodes.length=p,g},o.prototype.addEvent=function(){this.addEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.prototype.removeEvent=function(){this.removeEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.prototype.onTapHandler=function(e){if(this.$TextField[24]!=t.TextFieldType.INPUT){var r=t.TextFieldUtils.$getTextElement(this,e.localX,e.localY);if(null!=r){var i=r.style;if(i&&i.href)if(i.href.match(/^event:/)){var n=i.href.match(/^event:/)[0];t.TextEvent.dispatchTextEvent(this,t.TextEvent.LINK,i.href.substring(n.length))}else open(i.href,i.target||"_blank")}}},o.prototype._updateSelfColor=function(){for(var t=0,e=this._bkNodes;t<e.length;t++){var r=e[t];r.vertexColor=this._color}},o.default_fontFamily="Arial",o.default_size=30,o.default_textColor=16777215,o}(t.BKDisplayObject);t.BKTextField=o,__reflect(o.prototype,"egret.BKTextField");var a,s,h={fontSize:t.TextField.default_size,textColor:t.TextField.default_textColor+4278190080,maxWidth:64,maxHeight:64,width:64,height:64,textAlign:0,bold:0,italic:0,strokeColor:4278190080,strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:4278190080},l={fontSize:t.TextField.default_size,textColor:t.TextField.default_textColor+4278190080,maxWidth:1280,maxHeight:512,width:1280,height:512,textAlign:0,bold:0,italic:0,strokeColor:4278190080,strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:4278190080},c=[];t.sys.measureText=i,"webgl"!=window.renderMode&&(t.TextField=t.BKTextField)}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(){}return t.blur_frag="precision mediump float;\nuniform vec2 blur;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 uTextureSize;\nvoid main()\n{\n    const int sampleRadius = 5;\n    const int samples = sampleRadius * 2 + 1;\n    vec2 blurUv = blur / uTextureSize;\n    vec4 color = vec4(0, 0, 0, 0);\n    vec2 uv = vec2(0.0, 0.0);\n    blurUv /= float(sampleRadius);\n    for (int i = -sampleRadius; i <= sampleRadius; i++) {\n        uv.x = vTextureCoord.x + float(i) * blurUv.x;\n        uv.y = vTextureCoord.y + float(i) * blurUv.y;\n        color += texture2D(uSampler, uv);\n    }\n    color /= float(samples);\n    gl_FragColor = color;\n}",t.colorTransform_frag="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\n    vec4 texColor = texture2D(uSampler, vTextureCoord);\n    if(texColor.a > 0.) {\n        texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n    }\n    vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\n    gl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",t.default_vert="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",t.glow_frag="precision highp float;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float dist;\nuniform float angle;\nuniform vec4 color;\nuniform float alpha;\nuniform float blurX;\nuniform float blurY;\nuniform float strength;\nuniform float inner;\nuniform float knockout;\nuniform float hideObject;\nuniform vec2 uTextureSize;\nfloat random()\n{\n    return fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvoid main(void) {\n    vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);\n    const float linearSamplingTimes = 7.0;\n    const float circleSamplingTimes = 12.0;\n    vec4 ownColor = texture2D(uSampler, vTextureCoord);\n    vec4 curColor;\n    float totalAlpha = 0.0;\n    float maxTotalAlpha = 0.0;\n    float curDistanceX = 0.0;\n    float curDistanceY = 0.0;\n    float offsetX = dist * cos(angle) * px.x;\n    float offsetY = dist * sin(angle) * px.y;\n    const float PI = 3.14159265358979323846264;\n    float cosAngle;\n    float sinAngle;\n    float offset = PI * 2.0 / circleSamplingTimes * random();\n    float stepX = blurX * px.x / linearSamplingTimes;\n    float stepY = blurY * px.y / linearSamplingTimes;\n    for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {\n        cosAngle = cos(a + offset);\n        sinAngle = sin(a + offset);\n        for (float i = 1.0; i <= linearSamplingTimes; i++) {\n            curDistanceX = i * stepX * cosAngle;\n            curDistanceY = i * stepY * sinAngle;\n            \n            curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));\n            totalAlpha += (linearSamplingTimes - i) * curColor.a;\n            maxTotalAlpha += (linearSamplingTimes - i);\n        }\n    }\n    ownColor.a = max(ownColor.a, 0.0001);\n    ownColor.rgb = ownColor.rgb / ownColor.a;\n    float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);\n    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;\n    ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);\n    vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));\n    vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));\n    float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);\n    gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);\n}",t.primitive_frag="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\n    gl_FragColor = vColor;\n}",t.texture_frag="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}",t}();t.EgretShaderLib=e,__reflect(e.prototype,"egret.web.EgretShaderLib")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){function e(t,e){for(var r=Object.getOwnPropertyNames(t),i=function(r){Object.defineProperty(e,r,{get:function(){return t[r]},set:function(e){t[r]=e}})},n=0,o=r;n<o.length;n++){var a=o[n];i(a)}}function r(t){for(var e=new ArrayBuffer(t.bufferLength()),r=new Uint8Array(e),i=0;i<t.bufferLength();)r[i++]=t.readUint8Buffer();return e}function i(t){for(var e=new BK.Buffer(t.byteLength),r=new Uint8Array(t),i=0;i<t.byteLength;)e.writeUint8Buffer(r[i++]);return e}function n(t){for(var e=BK.Misc.sha1(t),r="",i=0;i<e.length;i++){var n=e.readUint8Buffer();r+=n.toString(16)}return r}t.emptyTexture=BK.Texture.createTexture(1,1),t.defineProxyProperties=e,t.bricksBufferToArrayBuffer=r,t.arrayBufferToBricksBuffer=i,t._sha1FromUrl=n}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._url="",t._method="",t.urlData={},t.responseHeader="",t}return __extends(r,e),Object.defineProperty(r.prototype,"responseType",{get:function(){return this._responseType},set:function(t){this._responseType=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"response",{get:function(){return this._response},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"withCredentials",{get:function(){return this._withCredentials},set:function(t){this._withCredentials=t},enumerable:!0,configurable:!0}),r.prototype.open=function(t,e){void 0===e&&(e="GET"),this._url=t,this._method=e},r.prototype.send=function(e){var r=this;if(r.isNetUrl(r._url)){var i=r._url,n=this.encodeURL(i);this._bkHttpRequest=new BK.HttpUtil(n);var o=void 0;if(o=this._method===t.HttpMethod.POST?"post":"get",this._bkHttpRequest.setHttpMethod(o),this._method===t.HttpMethod.POST)if("string"==typeof e)this._bkHttpRequest.setHttpPostData(e);else{var a=t.arrayBufferToBricksBuffer(e);this._bkHttpRequest.setHttpRawBody(a)}this._bkHttpRequest.setHttpCookie(e),this._bkHttpRequest.requestAsync(function(e,i){if(200===Number(i)){if(r._responseType===t.HttpResponseType.ARRAY_BUFFER)r._response=t.bricksBufferToArrayBuffer(e);else{var n=new t.ByteArray(t.bricksBufferToArrayBuffer(e));r._response=n.readUTFBytes(n.length)}t.$callAsync(t.Event.dispatchEvent,t.Event,r,t.Event.COMPLETE)}else t.$warn(1019,i),t.Event.dispatchEvent(r,t.IOErrorEvent.IO_ERROR)})}else if(BK.FileUtil.isFileExist(r._url)){var a=BK.FileUtil.readFile(r._url);r._responseType===t.HttpResponseType.ARRAY_BUFFER?r._response=t.bricksBufferToArrayBuffer(a):r._response=a.readAsString()||"",t.$callAsync(t.Event.dispatchEvent,t.Event,r,t.Event.COMPLETE)}else t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,r,t.IOErrorEvent.IO_ERROR)},r.prototype.encodeURL=function(t){if(!t||""===t)return"";var e=t.indexOf("?");if(0>e)return t;for(var r=t.slice(0,e),i=t.slice(e+1),n=i.split("&"),o="",a=0;a<n.length;a++){var s=n[a],h=s.split("="),l=h[0],c=h[1]?h[1]:"";o+=l+"="+encodeURIComponent(c),a<n.length-1&&(o+="&")}return r+"?"+o},r.prototype.isNetUrl=function(t){return-1!=t.indexOf("http://")||-1!=t.indexOf("HTTP://")||-1!=t.indexOf("https://")||-1!=t.indexOf("HTTPS://")},r.prototype.abort=function(){},r.prototype.onResponseHeader=function(t){this.responseHeader="";var e=JSON.parse(t);for(var r in e)this.responseHeader+=r+": "+e[r]+"\r\n"},r.prototype.getAllResponseHeaders=function(){return this.responseHeader},r.prototype.setRequestHeader=function(t,e){this.headerObj||(this.headerObj={}),this.headerObj[t]=e},r.prototype.getResponseHeader=function(t){return""},r}(t.EventDispatcher);t.BKHttpRequest=e,__reflect(e.prototype,"egret.BKHttpRequest",["egret.HttpRequest"]),t.HttpRequest=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=null,t._crossOrigin=null,t._hasCrossOriginSet=!1,t}return __extends(r,e),Object.defineProperty(r.prototype,"crossOrigin",{get:function(){return this._crossOrigin},set:function(t){this._hasCrossOriginSet=!0,this._crossOrigin=t},enumerable:!0,configurable:!0}),r.prototype.load=function(e){if(e.indexOf("http://")>=0||e.indexOf("https://")>=0){var r=t._sha1FromUrl(e),i="GameSandBox://webcache/image"+r,n=BK.FileUtil.readFile(i);if(n&&n.length>0)this._loadFromBuffer.call(this,i);else{var o=new BK.HttpUtil(e);o.setHttpMethod("get"),o.requestAsync(function(r,n){200==n?(BK.FileUtil.writeBufferToFile(i,r),this._loadFromBuffer.call(this,i)):(console.log("BK http加载外部资源失败, url = "+e+", code = "+n),t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,this,t.IOErrorEvent.IO_ERROR))}.bind(this))}}else{var a=e.indexOf("GameRes://")>=0?e:"GameRes://"+e;BK.FileUtil.isFileExist(a)?(this.data=new t.BitmapData(a),t.$callAsync(t.Event.dispatchEvent,t.Event,this,t.Event.COMPLETE)):t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,this,t.IOErrorEvent.IO_ERROR)}},r.prototype._loadFromBuffer=function(e){var r=new t.BitmapData(e);this.data=r,t.$callAsync(t.Event.dispatchEvent,t.Event,this,t.Event.COMPLETE)},r.crossOrigin=null,r}(t.EventDispatcher);t.BKImageLoader=e,__reflect(e.prototype,"egret.BKImageLoader",["egret.ImageLoader"]),t.ImageLoader=e}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}return e.prototype.addCallBacks=function(t,e,r,i,n){this.onConnect=t,this.onClose=e,this.onSocketData=r,this.onError=i,this.thisObject=n},e.prototype.connect=function(t,e){var r=t+":"+e;this.connectByUrl(r)},e.prototype.connectByUrl=function(t){this.$websocket=new BK.WebSocket(t),this.$websocket.connect(),this._bindEvent()},e.prototype.BKSocketConnect=function(t){this.$websocket=t,this.$websocket.connect(),this._bindEvent()},e.prototype._bindEvent=function(){var e=this,r=this.$websocket;r.onOpen=function(t){e.onConnect&&e.onConnect.call(e.thisObject)},r.onClose=function(t){e.onClose&&e.onClose.call(e.thisObject)},r.onError=function(t){e.onError&&e.onError.call(e.thisObject)},r.onMessage=function(r,i){if(e.onSocketData){var n=void 0,o=i.data;if(i.isBinary)n=t.bricksBufferToArrayBuffer(o);else{var a=new t.ByteArray(t.bricksBufferToArrayBuffer(o));n=a.readUTFBytes(a.length)}e.onSocketData.call(e.thisObject,n)}}},e.prototype.send=function(e){if("string"==typeof e)this.$websocket.send(e);else if(e instanceof ArrayBuffer){var r=t.arrayBufferToBricksBuffer(e);this.$websocket.send(r)}},e.prototype.resHandler=function(e){switch(e.type){case t.Event.COMPLETE:var r=e.currentTarget;r.response;console.log()}},e.prototype.close=function(){this.$websocket.close()},e.prototype.disconnect=function(){},e}();t.BKSocket=e,__reflect(e.prototype,"egret.BKSocket",["egret.ISocket"]),t.ISocket=e}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r=function(r){function i(i){var n=r.call(this)||this;return n.isStage=!1,n.$renderNode=new e.BitmapNode,n.renderBuffer=null,n.offsetX=0,n.offsetY=0,n.offsetMatrix=new t.Matrix,n.$canvasScaleX=1,n.$canvasScaleY=1,n.root=i,n.isStage=i instanceof t.Stage,n}return __extends(i,r),i.create=function(r){var i=new t.sys.DisplayList(r);try{var n=new e.RenderBuffer;i.renderBuffer=n}catch(o){return null}return i.root=r,i},i.prototype.$getRenderNode=function(){return this.$renderNode},i.prototype.setClipRect=function(t,r){t*=e.DisplayList.$canvasScaleX,r*=e.DisplayList.$canvasScaleY,this.renderBuffer.resize(t,r)},i.prototype.drawToSurface=function(){var r=0;this.$canvasScaleX=this.offsetMatrix.a=e.DisplayList.$canvasScaleX,this.$canvasScaleY=this.offsetMatrix.d=e.DisplayList.$canvasScaleY,this.isStage||this.changeSurfaceSize();var i=this.renderBuffer;if(i.clear(),r=e.systemRenderer.render(this.root,i,this.offsetMatrix),!this.isStage){var n=i.surface,o=this.$renderNode;o.drawData.length=0;var a=n.width,s=n.height;this.bitmapData?(this.bitmapData.source=n,this.bitmapData.width=a,this.bitmapData.height=s):this.bitmapData=new t.BitmapData(n),o.image=this.bitmapData,o.imageWidth=a,o.imageHeight=s,o.drawImage(0,0,a,s,-this.offsetX,-this.offsetY,a/this.$canvasScaleX,s/this.$canvasScaleY)}return r},i.prototype.changeSurfaceSize=function(){var t=(this.root,this.offsetX),e=this.offsetY,r=this.root.$getOriginalBounds(),i=this.$canvasScaleX,n=this.$canvasScaleY;this.offsetX=-r.x,this.offsetY=-r.y,this.offsetMatrix.setTo(this.offsetMatrix.a,0,0,this.offsetMatrix.d,this.offsetX,this.offsetY);var o=this.renderBuffer;o.cacheAsBitmap=!0;var a=Math.max(257,r.width*i),s=Math.max(257,r.height*n);(this.offsetX!=t||this.offsetY!=e||o.surface.width!=a||o.surface.height!=s)&&o.resize(a,s)},i.$setCanvasScale=function(t,r){e.DisplayList.$canvasScaleX=t,e.DisplayList.$canvasScaleY=r},i.$canvasScaleFactor=1,i.$canvasScaleX=1,i.$canvasScaleY=1,i}(t.HashObject);e.BKDisplayList=r,__reflect(r.prototype,"egret.sys.BKDisplayList"),t.sys.DisplayList=r}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r=function(){function e(t,e,r){this.surface={width:t,height:e},this.context=new BK.Canvas(t,e),this.context&&(this.context.$offsetX=0,this.context.$offsetY=0)}return Object.defineProperty(e.prototype,"width",{get:function(){return this.surface.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.surface.height},enumerable:!0,configurable:!0}),e.prototype.resize=function(t,e,r){var i=this.surface;if(r){var n=!1;i.width<t&&(i.width=t,n=!0),i.height<e&&(i.height=e,n=!0),n?this.context.size={width:i.width,height:i.height}:(this.context.globalCompositeOperation="source-over",this.context_setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else i.width!=t&&(i.width=t),i.height!=e&&(i.height=e),this.context.size={width:i.width,height:i.height};this.clear()},e.prototype.context_setTransform=function(e,r,i,n,o,a){var s=this.inversMatrix,h=t.Matrix.create().setTo(e,r,i,n,o,a),l=t.Matrix.create().setTo(1,0,0,1,0,0);s?l.concat(s):s=t.Matrix.create(),s.setTo(e,r,i,n,o,a),s.invert(),this.inversMatrix=s,l.concat(h),this.context.transforms(l.a,l.b,l.c,l.d,l.tx,l.ty),t.Matrix.release(h),t.Matrix.release(l)},e.prototype.getPixels=function(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=1)},e.prototype.toDataURL=function(t,e){return this.surface.toDataURL(t,e)},e.prototype.clear=function(){this.inversMatrix&&this.inversMatrix.setTo(1,0,0,1,0,0),this.context_setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},e.prototype.destroy=function(){this.surface.width=this.surface.height=0},e}();e.CanvasRenderBuffer=r,__reflect(r.prototype,"egret.web.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){function e(t,e){var r=t.toString(16),i="00000000";return i.substr(0,e-r.length)+r}var r={none:"butt",square:"square",round:"round"},i=function(i){function n(){var t=i.call(this)||this;return t._renderingMask=!1,t}return __extends(n,i),n.prototype.renderText=function(t,r){r.textAlign="left",r.textBaseLine="middle",r.lineJoin="round";for(var i=t.drawData,n=i.length,o=0;n>o;){var a=i[o++],s=i[o++],h=i[o++],l=i[o++],c=null==l.size?t.size:l.size;r.setTextSize(c);var d=null==l.textColor?t.textColor:l.textColor,u=null==l.strokeColor?t.strokeColor:l.strokeColor,p=null==l.stroke?t.stroke:l.stroke,f=e(d,6),g=parseInt(f.substring(0,2),16)/255,v=parseInt(f.substring(2,4),16)/255,x=parseInt(f.substring(4,6),16)/255,y=e(u,6),b=parseInt(y.substring(0,2),16)/255,$=parseInt(y.substring(2,4),16)/255,m=parseInt(y.substring(4,6),16)/255;r.fillColor={r:g,g:v,b:x,a:1},r.strokeColor={r:b,g:$,b:m,a:1};var T=null==l.fontFamily?t.fontFamily:l.fontFamily;if(T&&"Arial"!==T){var _=T.indexOf("GameRes://")>=0?T:"GameRes://"+T;BK.FileUtil.isFileExist(_)?r.fontPath=_:console.log("字体"+_+"不存在，请确保fontFamily传入字体地址正确")}p?r.lineWidth=2*p:r.lineWidth=0;var w=null==l.bold?t.bold:l.bold,S=null==l.italic?t.italic:l.italic;r.setTextBold(w),r.setTextItalic(S),r.fillText(h,a+r.$offsetX,-s+r.$offsetY+t.height-c/2-4)}},n.prototype.renderGraphics=function(t,i,n){var o=t.drawData,a=o.length;n=!!n;for(var s=0;a>s;s++){var h=o[s];switch(h.type){case 1:var l=h,c=e(l.fillColor,6),d=parseInt(c.substring(0,2),16)/255,u=parseInt(c.substring(2,4),16)/255,p=parseInt(c.substring(4,6),16)/255;i.fillColor={r:d,g:u,b:p,a:l.fillAlpha},i.drawStyle=0,this._renderPath(h,i),this._renderingMask?i.clip():i.fill();break;case 2:var f=h;i.save();var g=f.matrix;i.drawStyle=0,this._renderPath(h,i),i.transform(g.a,g.b,g.c,g.d,g.tx,g.ty),i.fill(),i.restore();break;case 3:var v=h,x=v.lineWidth;i.lineWidth=x;var y=e(v.lineColor,6),b=parseInt(y.substring(0,2),16)/255,$=parseInt(y.substring(2,4),16)/255,m=parseInt(y.substring(4,6),16)/255;i.strokeColor={r:b,g:$,b:m,a:v.lineAlpha},i.drawStyle=1,i.lineCap=r[v.caps],i.lineJoin=v.joints,i.miterLimit=v.miterLimit,i.setLineDash&&i.setLineDash(v.lineDash);var T=1===x||3===x;T&&i.translate(.5,.5),i.drawStyle=1,this._renderPath(h,i),i.stroke(),T&&i.translate(-.5,-.5)}}return 0==a?0:1},n.prototype._renderPath=function(t,e){e.beginPath();for(var r=t.$data,i=t.$commands,n=i.length,o=0,a=0;n>a;a++){var s=i[a];switch(s){case 4:e.bezierCurveTo(r[o++]+e.$offsetX,r[o++]+e.$offsetY,r[o++]+e.$offsetX,r[o++]+e.$offsetY,r[o++]+e.$offsetX,r[o++]+e.$offsetY);break;case 3:e.quadraticCurveTo(r[o++]+e.$offsetX,r[o++]+e.$offsetY,r[o++]+e.$offsetX,r[o++]+e.$offsetY);break;case 2:e.lineTo(r[o++]+e.$offsetX,r[o++]+e.$offsetY);break;case 1:e.moveTo(r[o++]+e.$offsetX,r[o++]+e.$offsetY)}}},n.prototype.drawNodeToBuffer=function(t,e,r,i){var n=e.context;n.transforms(r.a,r.b,r.c,r.d,r.tx,r.ty),this.renderNode(t,n,i)},n.prototype.renderNode=function(e,r,i){var n=0;if(3!=e.type)throw t.error("CanvasRenderer  renderNode 使用了未知的node类型");return n=this.renderGraphics(e,r,i)},n}(t.CanvasRenderer);t.BKCanvasRenderer=i,__reflect(i.prototype,"egret.BKCanvasRenderer"),t.refitColorString=e,"webgl"==window.renderMode&&(t.CanvasRenderer=i)}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(t){t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.FLOAT=5126]="FLOAT",t[t.BYTE=65535]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT"}(e=t.WEBGL_ATTRIBUTE_TYPE||(t.WEBGL_ATTRIBUTE_TYPE={}));var r=function(){function t(t,e,r){this.gl=t,this.name=r.name,this.type=r.type,this.size=r.size,this.location=t.getAttribLocation(e,this.name),this.count=0,this.initCount(t),this.format=t.FLOAT,this.initFormat(t)}return t.prototype.initCount=function(t){var r=this.type;switch(r){case e.FLOAT:case e.BYTE:case e.UNSIGNED_BYTE:case e.UNSIGNED_SHORT:this.count=1;break;case e.FLOAT_VEC2:this.count=2;break;case e.FLOAT_VEC3:this.count=3;break;case e.FLOAT_VEC4:this.count=4}},t.prototype.initFormat=function(t){var r=this.type;switch(r){case e.FLOAT:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:this.format=t.FLOAT;break;case e.UNSIGNED_BYTE:this.format=t.UNSIGNED_BYTE;break;case e.UNSIGNED_SHORT:this.format=t.UNSIGNED_SHORT;break;case e.BYTE:this.format=t.BYTE}},t}();t.EgretWebGLAttribute=r,__reflect(r.prototype,"egret.web.EgretWebGLAttribute")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t,e,r){var i=t.createShader(e);t.shaderSource(i,r),t.compileShader(i);var n=t.getShaderParameter(i,t.COMPILE_STATUS);return n||(console.log("shader not compiled!"),console.log(t.getShaderInfoLog(i))),i}function r(t,e,r){var i=t.createProgram();return t.attachShader(i,e),t.attachShader(i,r),t.linkProgram(i),i}function i(e,r){for(var i={},n=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),o=0;n>o;o++){var a=e.getActiveAttrib(r,o),s=a.name,h=new t.EgretWebGLAttribute(e,r,a);i[s]=h}return i}function n(e,r){for(var i={},n=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),o=0;n>o;o++){var a=e.getActiveUniform(r,o),s=a.name,h=new t.EgretWebGLUniform(e,r,a);i[s]=h}return i}var o=function(){function t(t,o,a){this.vshaderSource=o,this.fshaderSource=a,this.vertexShader=e(t,t.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=e(t,t.FRAGMENT_SHADER,this.fshaderSource),this.id=r(t,this.vertexShader,this.fragmentShader),this.uniforms=n(t,this.id),this.attributes=i(t,this.id)
}return t.getProgram=function(e,r,i,n){return this.programCache[n]||(this.programCache[n]=new t(e,r,i)),this.programCache[n]},t.deleteProgram=function(t,e,r,i){},t.programCache={},t}();t.EgretWebGLProgram=o,__reflect(o.prototype,"egret.web.EgretWebGLProgram")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(t){t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.BYTE=65535]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(e=t.WEBGL_UNIFORM_TYPE||(t.WEBGL_UNIFORM_TYPE={}));var r=function(){function t(t,e,r){this.gl=t,this.name=r.name,this.type=r.type,this.size=r.size,this.location=t.getUniformLocation(e,this.name),this.setDefaultValue(),this.generateSetValue(),this.generateUpload()}return t.prototype.setDefaultValue=function(){var t=this.type;switch(t){case e.FLOAT:case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.value=0;break;case e.FLOAT_VEC2:case e.BOOL_VEC2:case e.INT_VEC2:this.value=[0,0];break;case e.FLOAT_VEC3:case e.BOOL_VEC3:case e.INT_VEC3:this.value=[0,0,0];break;case e.FLOAT_VEC4:case e.BOOL_VEC4:case e.INT_VEC4:this.value=[0,0,0,0];break;case e.FLOAT_MAT2:this.value=new Float32Array([1,0,0,1]);break;case e.FLOAT_MAT3:this.value=new Float32Array([1,0,0,0,1,0,0,0,1]);break;case e.FLOAT_MAT4:this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},t.prototype.generateSetValue=function(){var t=this.type;switch(t){case e.FLOAT:case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.setValue=function(t){var e=this.value!==t;this.value=t,e&&this.upload()};break;case e.FLOAT_VEC2:case e.BOOL_VEC2:case e.INT_VEC2:this.setValue=function(t){var e=this.value[0]!==t.x||this.value[1]!==t.y;this.value[0]=t.x,this.value[1]=t.y,e&&this.upload()};break;case e.FLOAT_VEC3:case e.BOOL_VEC3:case e.INT_VEC3:this.setValue=function(t){this.value[0]=t.x,this.value[1]=t.y,this.value[2]=t.z,this.upload()};break;case e.FLOAT_VEC4:case e.BOOL_VEC4:case e.INT_VEC4:this.setValue=function(t){this.value[0]=t.x,this.value[1]=t.y,this.value[2]=t.z,this.value[3]=t.w,this.upload()};break;case e.FLOAT_MAT2:case e.FLOAT_MAT3:case e.FLOAT_MAT4:this.setValue=function(t){this.value.set(t),this.upload()}}},t.prototype.generateUpload=function(){var t=this.gl,r=this.type,i=this.location;switch(r){case e.FLOAT:this.upload=function(){var e=this.value;t.uniform1f(i,e)};break;case e.FLOAT_VEC2:this.upload=function(){var e=this.value;t.uniform2f(i,e[0],e[1])};break;case e.FLOAT_VEC3:this.upload=function(){var e=this.value;t.uniform3f(i,e[0],e[1],e[2])};break;case e.FLOAT_VEC4:this.upload=function(){var e=this.value;t.uniform4f(i,e[0],e[1],e[2],e[3])};break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.upload=function(){var e=this.value;t.uniform1i(i,e)};break;case e.BOOL_VEC2:case e.INT_VEC2:this.upload=function(){var e=this.value;t.uniform2i(i,e[0],e[1])};break;case e.BOOL_VEC3:case e.INT_VEC3:this.upload=function(){var e=this.value;t.uniform3i(i,e[0],e[1],e[2])};break;case e.BOOL_VEC4:case e.INT_VEC4:this.upload=function(){var e=this.value;t.uniform4i(i,e[0],e[1],e[2],e[3])};break;case e.FLOAT_MAT2:this.upload=function(){var e=this.value;t.uniformMatrix2fv(i,!1,e)};break;case e.FLOAT_MAT3:this.upload=function(){var e=this.value;t.uniformMatrix3fv(i,!1,e)};break;case e.FLOAT_MAT4:this.upload=function(){var e=this.value;t.uniformMatrix4fv(i,!1,e)}}},t}();t.EgretWebGLUniform=r,__reflect(r.prototype,"egret.web.EgretWebGLUniform")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(t){var r=e.call(this)||this;if(r.format="image",r.$deleteSource=!0,"string"==typeof t){var i=BK.Image.loadImage(t,6);r.source=i,r.width=i.width,r.height=i.height,r.BK_format=i.format}else r.source=t,r.width=t.width,r.height=t.height;return r}return __extends(r,e),r.create=function(e,r,i){var n="";n="arraybuffer"===e?t.Base64Util.encode(r):r;var o="image/png";"/"===n.charAt(0)?o="image/jpeg":"R"===n.charAt(0)?o="image/gif":"i"===n.charAt(0)&&(o="image/png");var a=new Image;a.src="data:"+o+";base64,"+n,a.crossOrigin="*";var s=new t.BitmapData(a);return a.onload=function(){a.onload=void 0,s.source=a,s.height=a.height,s.width=a.width,i&&i(s)},s},r.prototype.$dispose=function(){this.webGLTexture&&(t.WebGLUtils.deleteWebGLTexture(this.webGLTexture),this.webGLTexture=null),this.source&&this.source.dispose&&this.source.dispose(),this.source=null,t.BitmapData.$dispose(this)},r.$addDisplayObject=function(t,e){if(e){var r=e.hashCode;if(r){if(!this._displayList[r])return void(this._displayList[r]=[t]);var i=this._displayList[r];i.indexOf(t)<0&&i.push(t)}}},r.$removeDisplayObject=function(t,e){if(e){var r=e.hashCode;if(r&&this._displayList[r]){var i=this._displayList[r],n=i.indexOf(t);n>=0&&i.splice(n,1)}}},r.$invalidate=function(e){if(e){var r=e.hashCode;if(r&&this._displayList[r])for(var i=this._displayList[r],n=0;n<i.length;n++){i[n]instanceof t.Bitmap&&i[n].$refreshImageData();var o=i[n];o.$renderDirty=!0;var a=o.$parent;a&&!a.$cacheDirty&&(a.$cacheDirty=!0,a.$cacheDirtyUp());var s=o.$maskedObject;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp())}}},r.$dispose=function(e){if(e){var r=e.hashCode;if(r&&this._displayList[r]){for(var i=this._displayList[r],n=0,o=i;n<o.length;n++){var a=o[n];a instanceof t.Bitmap&&(a.$bitmapData=null),a.$renderDirty=!0;var s=a.$parent;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp());var h=a.$maskedObject;h&&!h.$cacheDirty&&(h.$cacheDirty=!0,h.$cacheDirtyUp())}delete this._displayList[r]}}},r._displayList=t.createMap(),r}(t.HashObject);t.WebGLBitmapData=e,__reflect(e.prototype,"egret.WebGLBitmapData"),"webgl"==window.renderMode&&(t.BitmapData=t.WebGLBitmapData)}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(){this.drawData=[],this.drawDataLen=0}return t.prototype.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var t=this.drawData[this.drawDataLen]||{};t.type=1,t.count=0,this.drawData[this.drawDataLen]=t,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},t.prototype.pushDrawTexture=function(t,e,r,i,n){if(void 0===e&&(e=2),r){var o=this.drawData[this.drawDataLen]||{};o.type=0,o.texture=t,o.filter=r,o.count=e,o.textureWidth=i,o.textureHeight=n,this.drawData[this.drawDataLen]=o,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||t!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var o=this.drawData[this.drawDataLen]||{};o.type=0,o.texture=t,o.count=0,this.drawData[this.drawDataLen]=o,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=e}},t.prototype.pushChangeSmoothing=function(t,e){t.smoothing=e;var r=this.drawData[this.drawDataLen]||{};r.type=10,r.texture=t,r.smoothing=e,this.drawData[this.drawDataLen]=r,this.drawDataLen++},t.prototype.pushPushMask=function(t){void 0===t&&(t=1);var e=this.drawData[this.drawDataLen]||{};e.type=2,e.count=2*t,this.drawData[this.drawDataLen]=e,this.drawDataLen++},t.prototype.pushPopMask=function(t){void 0===t&&(t=1);var e=this.drawData[this.drawDataLen]||{};e.type=3,e.count=2*t,this.drawData[this.drawDataLen]=e,this.drawDataLen++},t.prototype.pushSetBlend=function(t){for(var e=this.drawDataLen,r=!1,i=e-1;i>=0;i--){var n=this.drawData[i];if(n){if((0==n.type||1==n.type)&&(r=!0),!r&&4==n.type){this.drawData.splice(i,1),this.drawDataLen--;continue}if(4==n.type){if(n.value==t)return;break}}}var o=this.drawData[this.drawDataLen]||{};o.type=4,o.value=t,this.drawData[this.drawDataLen]=o,this.drawDataLen++},t.prototype.pushResize=function(t,e,r){var i=this.drawData[this.drawDataLen]||{};i.type=5,i.buffer=t,i.width=e,i.height=r,this.drawData[this.drawDataLen]=i,this.drawDataLen++},t.prototype.pushClearColor=function(){var t=this.drawData[this.drawDataLen]||{};t.type=6,this.drawData[this.drawDataLen]=t,this.drawDataLen++},t.prototype.pushActivateBuffer=function(t){for(var e=this.drawDataLen,r=!1,i=e-1;i>=0;i--){var n=this.drawData[i];!n||(4!=n.type&&7!=n.type&&(r=!0),r||7!=n.type)||(this.drawData.splice(i,1),this.drawDataLen--)}var o=this.drawData[this.drawDataLen]||{};o.type=7,o.buffer=t,o.width=t.rootRenderTarget.width,o.height=t.rootRenderTarget.height,this.drawData[this.drawDataLen]=o,this.drawDataLen++},t.prototype.pushEnableScissor=function(t,e,r,i){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=t,n.y=e,n.width=r,n.height=i,this.drawData[this.drawDataLen]=n,this.drawDataLen++},t.prototype.pushDisableScissor=function(){var t=this.drawData[this.drawDataLen]||{};t.type=9,this.drawData[this.drawDataLen]=t,this.drawDataLen++},t.prototype.clear=function(){for(var t=0;t<this.drawDataLen;t++){var e=this.drawData[t];e.type=0,e.count=0,e.texture=null,e.filter=null,e.uv=null,e.value="",e.buffer=null,e.width=0,e.height=0}this.drawDataLen=0},t}();t.WebGLDrawCmdManager=e,__reflect(e.prototype,"egret.web.WebGLDrawCmdManager")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(){return e.call(this)||this}return __extends(r,e),r.prototype.$hitTest=function(e,r){var i=this.$targetDisplay,n=t.Rectangle.create();i.$measureContentBounds(n);var o=t.Point.create(0,0);return this.$targetDisplay.globalToLocal(e,r,o),o.x>=n.x&&o.x<=n.x+n.width&&o.y>=n.y&&o.y<=n.y+n.height?i:null},r}(t.Graphics);t.WebGlGraphics=e,__reflect(e.prototype,"egret.WebGlGraphics"),"webgl"==window.renderMode&&(t.Graphics=t.WebGlGraphics)}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r=function(r){function n(i,n,o){var a=r.call(this)||this;if(a.globalAlpha=1,a.stencilState=!1,a.$stencilList=[],a.stencilHandleCount=0,a.$scissorState=!1,a.scissorRect=new t.Rectangle,a.$hasScissor=!1,a.$drawCalls=0,a.$computeDrawCall=!1,a.globalMatrix=new t.Matrix,a.savedGlobalMatrix=new t.Matrix,a.$offsetX=0,a.$offsetY=0,a.context=e.WebGLRenderContext.getInstance(i,n),a.rootRenderTarget=new e.WebGLRenderTarget(a.context.context,3,3),i&&n&&a.resize(i,n),a.root=o,a.root)a.context.pushBuffer(a),a.surface=a.context.surface,a.$computeDrawCall=!0;else{var s=a.context.activatedBuffer;s&&s.rootRenderTarget.activate(),a.rootRenderTarget.initFrameBuffer(),a.surface=a.rootRenderTarget}return a}return __extends(n,r),n.prototype.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},n.prototype.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},n.prototype.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},n.prototype.enableScissor=function(t,e,r,i){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(t,e,r,i),this.context.enableScissorTest(this.scissorRect))},n.prototype.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},n.prototype.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},Object.defineProperty(n.prototype,"width",{get:function(){return this.rootRenderTarget.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.rootRenderTarget.height},enumerable:!0,configurable:!0}),n.prototype.resize=function(t,e,r){t=t||1,e=e||1,this.context.pushBuffer(this),(t!=this.rootRenderTarget.width||e!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,t,e),this.rootRenderTarget.width=t,this.rootRenderTarget.height=e),this.root&&this.context.resize(t,e,r),this.context.clear(),this.context.popBuffer()},n.prototype.getPixels=function(t,e,r,i){void 0===r&&(r=1),void 0===i&&(i=1);var n=new Uint8Array(4*r*i),o=this.rootRenderTarget.useFrameBuffer;this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(t,e,r,i,n),this.rootRenderTarget.useFrameBuffer=o,this.rootRenderTarget.activate();for(var a=new Uint8Array(4*r*i),s=0;i>s;s++)for(var h=0;r>h;h++){var l=4*(r*(i-s-1)+h),c=4*(r*s+h),d=n[c+3];a[l]=Math.round(n[c]/d*255),a[l+1]=Math.round(n[c+1]/d*255),a[l+2]=Math.round(n[c+2]/d*255),a[l+3]=n[c+3]}return a},n.prototype.toDataURL=function(t,e){return""},n.prototype.destroy=function(){this.context.destroy()},n.prototype.onRenderFinish=function(){this.$drawCalls=0},n.prototype.drawFrameBufferToSurface=function(t,e,r,i,n,o,a,s,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,t,e,r,i,n,o,a,s,r,i,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.drawSurfaceToFrameBuffer=function(t,e,r,i,n,o,a,s,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.context.surface,t,e,r,i,n,o,a,s,r,i,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.clear=function(){this.context.pushBuffer(this),this.context.clear(),this.context.popBuffer()},n.prototype.setTransform=function(t,e,r,i,n,o){var a=this.globalMatrix;a.a=t,a.b=e,a.c=r,a.d=i,a.tx=n,a.ty=o},n.prototype.transform=function(t,e,r,i,n,o){var a=this.globalMatrix,s=a.a,h=a.b,l=a.c,c=a.d;(1!=t||0!=e||0!=r||1!=i)&&(a.a=t*s+e*l,a.b=t*h+e*c,a.c=r*s+i*l,a.d=r*h+i*c),a.tx=n*s+o*l+a.tx,a.ty=n*h+o*c+a.ty},n.prototype.useOffset=function(){var t=this;(0!=t.$offsetX||0!=t.$offsetY)&&(t.globalMatrix.append(1,0,0,1,t.$offsetX,t.$offsetY),t.$offsetX=t.$offsetY=0)},n.prototype.saveTransform=function(){var t=this.globalMatrix,e=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},n.prototype.restoreTransform=function(){var t=this.globalMatrix,e=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},n.create=function(t,e){var r=i.pop();if(r){r.resize(t,e);var o=r.globalMatrix;o.a=1,o.b=0,o.c=0,o.d=1,o.tx=0,o.ty=0,r.globalAlpha=1,r.$offsetX=0,r.$offsetY=0}else r=new n(t,e),r.$computeDrawCall=!1;return r},n.release=function(t){i.push(t)},n.autoClear=!0,n}(t.HashObject);e.WebGLRenderBuffer=r,__reflect(r.prototype,"egret.web.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var i=[]}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r=function(){function r(t,r){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.surface={width:t,height:r},this.initWebGL(),this.$bufferStack=[];var i=this.context;this.vertexBuffer=i.createBuffer(),this.indexBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new e.WebGLDrawCmdManager,this.vao=new e.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}return r.getInstance=function(t,e){return this.instance?this.instance:(this.instance=new r(t,e),this.instance)},r.prototype.pushBuffer=function(t){this.$bufferStack.push(t),t!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(t)),this.currentBuffer=t},r.prototype.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var t=this.$bufferStack.pop(),e=this.$bufferStack[this.$bufferStack.length-1];t!=e&&this.drawCmdManager.pushActivateBuffer(e),this.currentBuffer=e}},r.prototype.activateBuffer=function(t){t.rootRenderTarget.activate(),this.bindIndices||this.uploadIndicesArray(this.vao.getIndices()),t.restoreStencil(),t.restoreScissor(),this.onResize(t.width,t.height,t.cacheAsBitmap)},r.prototype.uploadVerticesArray=function(t){var e=this.context;e.bufferData(e.ARRAY_BUFFER,t,e.STREAM_DRAW)},r.prototype.uploadIndicesArray=function(t){var e=this.context;e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this.bindIndices=!0},r.prototype.destroy=function(){this.surface.width=this.surface.height=0},r.prototype.onResize=function(t,r,i){if(void 0===i&&(i=!1),t=t||this.surface.width,r=r||this.surface.height,this.projectionX=t/2,this.projectionY=-r/2,this.context)if(i)this.context.viewport(0,0,t,r);else{var n=e.BKWebPlayer._viewRect.x,o=e.BKWebPlayer._viewRect.y;this.context.viewport(n,o,t,r)}},r.prototype.resize=function(t,e,r){var i=this.surface;r?(i.width<t&&(i.width=t),i.height<e&&(i.height=e)):(i.width!=t&&(i.width=t),i.height!=e&&(i.height=e)),this.onResize()},r.prototype.initWebGL=function(){this.onResize(),this.getWebGLContext();var t=this.context;this.$maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)},r.prototype.handleContextLost=function(){this.contextLost=!0},r.prototype.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},r.prototype.getWebGLContext=function(){var e;({antialias:r.antialias,stencil:!0});e=bkWebGLGetInstance(),e||t.$error(1021),this.setContext(e)},r.prototype.setContext=function(t){this.context=t,t.id=r.glContextId++,this.glID=t.id,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.colorMask(!0,!0,!0,!0),t.activeTexture(t.TEXTURE0)},r.prototype.enableStencilTest=function(){var t=this.context;t.enable(t.STENCIL_TEST)},r.prototype.disableStencilTest=function(){var t=this.context;t.disable(t.STENCIL_TEST)},r.prototype.enableScissorTest=function(t){var e=this.context;e.enable(e.SCISSOR_TEST),e.scissor(t.x,t.y,t.width,t.height)},r.prototype.disableScissorTest=function(){var t=this.context;t.disable(t.SCISSOR_TEST)},r.prototype.getPixels=function(t,e,r,i,n){var o=this.context;o.readPixels(t,e,r,i,o.RGBA,o.UNSIGNED_BYTE,n)},r.prototype.createTexture=function(t){var e=this.context,r=e.createTexture();if(!r)return void(this.contextLost=!0);r.glContext=e,e.bindTexture(e.TEXTURE_2D,r),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var i=t.source;return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),t.source.dispose(),t.source=null,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r},r.prototype.createTextureByCanvas=function(t){var e=this.context,r=e.createTexture();return r.glContext=e,e.bindTexture(e.TEXTURE_2D,r),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r},r.prototype.createTextureFromCompressedData=function(t,e,r,i,n){return null},r.prototype.updateTexture=function(t,e){var r=this.context;r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)},r.prototype.getWebGLTexture=function(t){return t.webGLTexture||("image"==t.format?t.webGLTexture=this.createTexture(t):"pvr"==t.format&&(t.webGLTexture=this.createTextureFromCompressedData(t.source.pvrtcData,t.width,t.height,t.source.mipmapsCount,t.source.format)),t.$deleteSource&&t.webGLTexture&&(t.source=null),t.webGLTexture.smoothing=!0),t.webGLTexture},r.prototype.clearRect=function(t,e,r,i){if(0!=t||0!=e||r!=this.surface.width||i!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(t,e,r,i),this.setGlobalCompositeOperation("source-over");else{var o=n.globalMatrix;0==o.b&&0==o.c?(t=t*o.a+o.tx,e=e*o.d+o.ty,r*=o.a,i*=o.d,this.enableScissor(t,-e-i+n.height,r,i),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(t,e,r,i),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},r.prototype.setGlobalCompositeOperation=function(t){this.drawCmdManager.pushSetBlend(t)},r.prototype.drawImage=function(t,e,r,i,n,o,a,s,h,l,c,d,u){var p=this.currentBuffer;if(!this.contextLost&&t&&p){var f,g,v;if(t.texture||t.source&&t.source.texture)f=t.texture||t.source.texture,p.saveTransform(),g=p.$offsetX,v=p.$offsetY,p.useOffset(),p.transform(1,0,0,-1,0,h+2*a);else{if(!t.source&&!t.webGLTexture)return;f=this.getWebGLTexture(t)}f&&(this.drawTexture(f,e,r,i,n,o,a,s,h,l,c,void 0,void 0,void 0,void 0,d,u),t.source&&t.source.texture&&(p.$offsetX=g,p.$offsetY=v,p.restoreTransform()))}},r.prototype.drawMesh=function(t,e,r,i,n,o,a,s,h,l,c,d,u,p,f,g,v){var x=this.currentBuffer;if(!this.contextLost&&t&&x){var y,b,$;if(t.texture||t.source&&t.source.texture)y=t.texture||t.source.texture,x.saveTransform(),b=x.$offsetX,$=x.$offsetY,x.useOffset(),x.transform(1,0,0,-1,0,h+2*a);else{if(!t.source&&!t.webGLTexture)return;y=this.getWebGLTexture(t)}y&&(this.drawTexture(y,e,r,i,n,o,a,s,h,l,c,d,u,p,f,g,v),(t.texture||t.source&&t.source.texture)&&(x.$offsetX=b,x.$offsetY=$,x.restoreTransform()))}},r.prototype.drawTexture=function(t,e,r,i,n,o,a,s,h,l,c,d,u,p,f,g,v,x){var y=this.currentBuffer;if(!this.contextLost&&t&&y){var b,$;x&&(y.saveTransform(),b=y.$offsetX,$=y.$offsetY,y.useOffset(),y.transform(1,0,0,-1,0,h+2*a)),u&&p?this.vao.reachMaxSize(u.length/2,p.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),void 0!=v&&t.smoothing!=v&&this.drawCmdManager.pushChangeSmoothing(t,v),d&&this.vao.changeToMeshIndices();var m=p?p.length/3:2;this.drawCmdManager.pushDrawTexture(t,m,this.$filter,l,c),this.vao.cacheArrays(y,e,r,i,n,o,a,s,h,l,c,d,u,p,g),x&&(y.$offsetX=b,y.$offsetY=$,y.restoreTransform())}},r.prototype.drawRect=function(t,e,r,i){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n,0,0,r,i,t,e,r,i,r,i))},r.prototype.pushMask=function(t,e,r,i){var n=this.currentBuffer;!this.contextLost&&n&&(n.$stencilList.push({x:t,y:e,width:r,height:i}),this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(n,0,0,r,i,t,e,r,i,r,i))},r.prototype.popMask=function(){var t=this.currentBuffer;if(!this.contextLost&&t){var e=t.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(t,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},r.prototype.clear=function(){this.drawCmdManager.pushClearColor()},r.prototype.enableScissor=function(t,e,r,i){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(t,e,r,i),n.$hasScissor=!0},r.prototype.disableScissor=function(){var t=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),t.$hasScissor=!1},r.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var t=this.drawCmdManager.drawDataLen,e=0,r=0;t>r;r++){var i=this.drawCmdManager.drawData[r];e=this.drawData(i,e),7==i.type&&(this.activatedBuffer=i.buffer),(0==i.type||1==i.type||2==i.type||3==i.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},r.prototype.drawData=function(t,r){if(t){var i,n=this.context,o=t.filter;switch(t.type){case 0:o?"custom"===o.type?i=e.EgretWebGLProgram.getProgram(n,o.$vertexSrc,o.$fragmentSrc,o.$shaderKey):"colorTransform"===o.type?i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.colorTransform_frag,"colorTransform"):"blurX"===o.type?i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"blurY"===o.type?i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"glow"===o.type&&(i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.glow_frag,"glow")):i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.texture_frag,"texture"),this.activeProgram(n,i),this.syncUniforms(i,o,t.textureWidth,t.textureHeight),r+=this.drawTextureElements(t,r);break;case 1:i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(n,i),this.syncUniforms(i,o,t.textureWidth,t.textureHeight),r+=this.drawRectElements(t,r);break;case 2:i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(n,i),this.syncUniforms(i,o,t.textureWidth,t.textureHeight),r+=this.drawPushMaskElements(t,r);break;case 3:i=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(n,i),this.syncUniforms(i,o,t.textureWidth,t.textureHeight),r+=this.drawPopMaskElements(t,r);break;case 4:this.setBlendMode(t.value);break;case 5:t.buffer.rootRenderTarget.resize(t.width,t.height),this.onResize(t.width,t.height,t.buffer.cacheAsBitmap);break;case 6:if(this.activatedBuffer){var a=this.activatedBuffer.rootRenderTarget;(0!=a.width||0!=a.height)&&a.clear(!0)}break;case 7:this.activateBuffer(t.buffer);break;case 8:var s=this.activatedBuffer;s&&(s.rootRenderTarget&&s.rootRenderTarget.enabledStencil(),s.enableScissor(t.x,t.y,t.width,t.height));break;case 9:s=this.activatedBuffer,s&&s.disableScissor();break;case 10:t.texture.texture?n.bindTexture(n.TEXTURE_2D,t.texture.texture):n.bindTexture(n.TEXTURE_2D,t.texture),t.smoothing?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST))}return r}},r.prototype.activeProgram=function(t,e){if(e!=this.currentProgram){t.useProgram(e.id);var r=e.attributes;for(var i in r)"aVertexPosition"===i?(t.vertexAttribPointer(r.aVertexPosition.location,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(r.aVertexPosition.location)):"aTextureCoord"===i?(t.vertexAttribPointer(r.aTextureCoord.location,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(r.aTextureCoord.location)):"aColor"===i&&(t.vertexAttribPointer(r.aColor.location,1,t.FLOAT,!1,20,16),t.enableVertexAttribArray(r.aColor.location));this.currentProgram=e}},r.prototype.syncUniforms=function(t,e,r,i){var n=t.uniforms;e&&"custom"===e.type;for(var o in n)if("projectionVector"===o)n[o].setValue({x:this.projectionX,y:this.projectionY});else if("uTextureSize"===o)n[o].setValue({x:r,y:i});else if("uSampler"===o);else{var a=e.$uniforms[o];void 0!==a&&n[o].setValue(a)}},r.prototype.drawTextureElements=function(t,e){var r=this.context;r.bindTexture(r.TEXTURE_2D,t.texture);var i=3*t.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*e),i},r.prototype.drawRectElements=function(t,e){var r=this.context,i=3*t.count;return r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*e),i},r.prototype.drawPushMaskElements=function(t,e){var r=this.context,i=3*t.count,n=this.activatedBuffer;if(n){n.rootRenderTarget&&n.rootRenderTarget.enabledStencil(),0==n.stencilHandleCount&&(n.enableStencil(),r.clear(r.STENCIL_BUFFER_BIT));var o=n.stencilHandleCount;n.stencilHandleCount++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*e),r.stencilFunc(r.EQUAL,o+1,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},r.prototype.drawPopMaskElements=function(t,e){var r=this.context,i=3*t.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var o=n.stencilHandleCount;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR),r.drawElements(r.TRIANGLES,i,r.UNSIGNED_SHORT,2*e),r.stencilFunc(r.EQUAL,o,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return i},r.prototype.setBlendMode=function(t){var e=this.context,i=r.blendModesForGL[t];i&&e.blendFunc(i[0],i[1])},r.prototype.drawTargetWidthFilters=function(t,r){var i,n=r,o=t.length;if(o>1)for(var a=0;o-1>a;a++){var s=t[a],h=r.rootRenderTarget.width,l=r.rootRenderTarget.height;i=e.WebGLRenderBuffer.create(h,l),i.setTransform(1,0,0,1,0,0),i.globalAlpha=1,this.drawToRenderTarget(s,r,i),r!=n&&e.WebGLRenderBuffer.release(r),r=i}var c=t[o-1];this.drawToRenderTarget(c,r,this.currentBuffer),r!=n&&e.WebGLRenderBuffer.release(r)},r.prototype.drawToRenderTarget=function(t,r,i){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(i);var n,o=r,a=r.rootRenderTarget.width,s=r.rootRenderTarget.height;if("blur"==t.type){var h=t.blurXFilter,l=t.blurYFilter;0!=h.blurX&&0!=l.blurY?(n=e.WebGLRenderBuffer.create(a,s),n.setTransform(1,0,0,1,0,0),n.globalAlpha=1,this.drawToRenderTarget(t.blurXFilter,r,n),r!=o&&e.WebGLRenderBuffer.release(r),r=n,t=l):t=0===h.blurX?l:h}i.saveTransform(),i.transform(1,0,0,-1,0,s),this.vao.cacheArrays(i,0,0,a,s,0,0,a,s,a,s),i.restoreTransform(),this.drawCmdManager.pushDrawTexture(r.rootRenderTarget.texture,2,t,a,s),r!=o&&e.WebGLRenderBuffer.release(r),this.popBuffer()}},r.initBlendMode=function(){r.blendModesForGL={},r.blendModesForGL["source-over"]=[1,771],r.blendModesForGL.lighter=[1,1],r.blendModesForGL["lighter-in"]=[770,771],r.blendModesForGL["destination-out"]=[0,771],r.blendModesForGL["destination-in"]=[0,770]},r.glContextId=0,r.blendModesForGL=null,r}();e.WebGLRenderContext=r,__reflect(r.prototype,"egret.web.WebGLRenderContext"),r.initBlendMode()}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r=["source-over","lighter","destination-out"],i="source-over",n=[],o=function(){function o(){this.nestLevel=0}return o.prototype.render=function(e,r,i,o){this.nestLevel++;var a=r,s=a.context;if(s.pushBuffer(a),a.transform(i.a,i.b,i.c,i.d,0,0),this.drawDisplayObject(e,a,i.tx,i.ty,!0),s.$drawWebGL(),e instanceof t.Stage){var h=s.context;h.glCommit()}var l=a.$drawCalls;a.onRenderFinish(),s.popBuffer();var c=t.Matrix.create();if(i.$invertInto(c),a.transform(c.a,c.b,c.c,c.d,0,0),t.Matrix.release(c),this.nestLevel--,0===this.nestLevel){n.length>6&&(n.length=6);for(var d=n.length,u=0;d>u;u++)n[u].resize(0,0)}return l},o.prototype.drawDisplayObject=function(e,r,i,n,o){var a,s=0,h=e.$displayList;if(h&&!o?((e.$cacheDirty||e.$renderDirty||h.$canvasScaleX!=t.sys.DisplayList.$canvasScaleX||h.$canvasScaleY!=t.sys.DisplayList.$canvasScaleY)&&(s+=h.drawToSurface()),a=h.$renderNode):a=e.$renderDirty?e.$getRenderNode():e.$renderNode,e.$cacheDirty=!1,a){switch(s++,r.$offsetX=i,r.$offsetY=n,a.type){case 1:this.renderBitmap(a,r);break;case 2:this.renderText(a,r);break;case 3:this.renderGraphics(a,r);break;case 4:this.renderGroup(a,r);break;case 5:this.renderMesh(a,r);break;case 6:this.renderNormalBitmap(a,r)}r.$offsetX=0,r.$offsetY=0}if(h&&!o)return s;var l=e.$children;if(l)for(var c=l.length,d=0;c>d;d++){var u=l[d],p=void 0,f=void 0,g=void 0;1!=u.$alpha&&(g=r.globalAlpha,r.globalAlpha*=u.$alpha);var v=void 0;if(u.$useTranslate){var x=u.$getMatrix();
p=i+u.$x,f=n+u.$y;var y=r.globalMatrix;v=t.Matrix.create(),v.a=y.a,v.b=y.b,v.c=y.c,v.d=y.d,v.tx=y.tx,v.ty=y.ty,r.transform(x.a,x.b,x.c,x.d,p,f),p=-u.$anchorOffsetX,f=-u.$anchorOffsetY}else p=i+u.$x-u.$anchorOffsetX,f=n+u.$y-u.$anchorOffsetY;switch(u.$renderMode){case 1:break;case 2:s+=this.drawWithFilter(u,r,p,f);break;case 3:s+=this.drawWithClip(u,r,p,f);break;case 4:s+=this.drawWithScrollRect(u,r,p,f);break;default:s+=this.drawDisplayObject(u,r,p,f)}if(g&&(r.globalAlpha=g),v){var x=r.globalMatrix;x.a=v.a,x.b=v.b,x.c=v.c,x.d=v.d,x.tx=v.tx,x.ty=v.ty,t.Matrix.release(v)}}return s},o.prototype.drawWithFilter=function(e,o,a,s){var h=0;if(e.$children&&0==e.$children.length&&(!e.$renderNode||0==e.$renderNode.$getRenderCount()))return h;var l,c=e.$filters,d=0!==e.$blendMode;d&&(l=r[e.$blendMode],l||(l=i));var u=e.$getOriginalBounds(),p=u.x,f=u.y,g=u.width,v=u.height;if(0>=g||0>=v)return h;if(!e.mask&&1==c.length&&("colorTransform"==c[0].type||"custom"===c[0].type&&0===c[0].padding)){var x=this.getRenderCount(e);if(!e.$children||1==x)return d&&o.context.setGlobalCompositeOperation(l),o.context.$filter=c[0],h+=e.$mask?this.drawWithClip(e,o,a,s):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,o,a,s):this.drawDisplayObject(e,o,a,s),o.context.$filter=null,d&&o.context.setGlobalCompositeOperation(i),h}var y=this.createRenderBuffer(g,v);if(y.context.pushBuffer(y),h+=e.$mask?this.drawWithClip(e,y,-p,-f):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,y,-p,-f):this.drawDisplayObject(e,y,-p,-f),y.context.popBuffer(),h>0){d&&o.context.setGlobalCompositeOperation(l),h++,o.$offsetX=a+p,o.$offsetY=s+f;var b=t.Matrix.create(),$=o.globalMatrix;b.a=$.a,b.b=$.b,b.c=$.c,b.d=$.d,b.tx=$.tx,b.ty=$.ty,o.useOffset(),o.context.drawTargetWidthFilters(c,y),$.a=b.a,$.b=b.b,$.c=b.c,$.d=b.d,$.tx=b.tx,$.ty=b.ty,t.Matrix.release(b),d&&o.context.setGlobalCompositeOperation(i)}return n.push(y),h},o.prototype.getRenderCount=function(t){var e=0;if(t.$children)for(var r=0,i=t.$children;r<i.length;r++){var n=i[r],o=n.$getRenderNode();o&&(e+=o.$getRenderCount()),n.$children&&(e+=this.getRenderCount(n))}return e},o.prototype.drawWithClip=function(e,o,a,s){var h,l=0,c=0!==e.$blendMode;c&&(h=r[e.$blendMode],h||(h=i));var d=e.$scrollRect?e.$scrollRect:e.$maskRect,u=e.$mask;if(u){var p=u.$getMatrix();if(0==p.a&&0==p.b||0==p.c&&0==p.d)return l}if(u||e.$children&&0!=e.$children.length){var f=e.$getOriginalBounds(),g=f.x,v=f.y,x=f.width,y=f.height,b=this.createRenderBuffer(x,y);if(b.context.pushBuffer(b),l+=this.drawDisplayObject(e,b,-g,-v),u){var $=this.createRenderBuffer(x,y);$.context.pushBuffer($);var m=t.Matrix.create();m.copyFrom(u.$getConcatenatedMatrix()),u.$getConcatenatedMatrixAt(e,m),m.translate(-g,-v),$.setTransform(m.a,m.b,m.c,m.d,m.tx,m.ty),t.Matrix.release(m),l+=this.drawDisplayObject(u,$,0,0),$.context.popBuffer(),b.context.setGlobalCompositeOperation("destination-in"),b.setTransform(1,0,0,-1,0,$.height),b.globalAlpha=1;var T=$.rootRenderTarget.width,_=$.rootRenderTarget.height;b.context.drawTexture($.rootRenderTarget.texture,0,0,T,_,0,0,T,_,T,_),b.setTransform(1,0,0,1,0,0),b.context.setGlobalCompositeOperation("source-over"),n.push($)}if(b.context.setGlobalCompositeOperation(i),b.context.popBuffer(),l>0){l++,c&&o.context.setGlobalCompositeOperation(h),d&&o.context.pushMask(d.x+a,d.y+s,d.width,d.height),o.globalAlpha=1;var w=t.Matrix.create(),S=o.globalMatrix;w.a=S.a,w.b=S.b,w.c=S.c,w.d=S.d,w.tx=S.tx,w.ty=S.ty,S.append(1,0,0,-1,a+g,s+v+b.height);var B=b.rootRenderTarget.width,E=b.rootRenderTarget.height;o.context.drawTexture(b.rootRenderTarget.texture,0,0,B,E,0,0,B,E,B,E),d&&b.context.popMask(),c&&o.context.setGlobalCompositeOperation(i);var C=o.globalMatrix;C.a=w.a,C.b=w.b,C.c=w.c,C.d=w.d,C.tx=w.tx,C.ty=w.ty,t.Matrix.release(w)}return n.push(b),l}return d&&o.context.pushMask(d.x+a,d.y+s,d.width,d.height),c&&o.context.setGlobalCompositeOperation(h),l+=this.drawDisplayObject(e,o,a,s),c&&o.context.setGlobalCompositeOperation(i),d&&o.context.popMask(),l},o.prototype.drawWithScrollRect=function(e,r,i,n){var o=0,a=e.$scrollRect?e.$scrollRect:e.$maskRect;if(a.isEmpty())return o;e.$scrollRect&&(i-=a.x,n-=a.y);var s=r.globalMatrix,h=r.context,l=!1;if(r.$hasScissor||0!=s.b||0!=s.c)r.context.pushMask(a.x+i,a.y+n,a.width,a.height);else{var c=s.a,d=s.d,u=s.tx,p=s.ty,f=a.x+i,g=a.y+n,v=f+a.width,x=g+a.height,y=void 0,b=void 0,$=void 0,m=void 0;if(1==c&&1==d)y=f+u,b=g+p,$=v+u,m=x+p;else{var T=c*f+u,_=d*g+p,w=c*v+u,S=d*g+p,B=c*v+u,E=d*x+p,C=c*f+u,R=d*x+p,F=0;T>w&&(F=T,T=w,w=F),B>C&&(F=B,B=C,C=F),y=B>T?T:B,$=w>C?w:C,_>S&&(F=_,_=S,S=F),E>R&&(F=E,E=R,R=F),b=E>_?_:E,m=S>R?S:R}h.enableScissor(y,-m+r.height+t.web.BKWebPlayer._viewRect.y,$-y,m-b),l=!0}return o+=this.drawDisplayObject(e,r,i,n),l?h.disableScissor():h.popMask(),o},o.prototype.drawNodeToBuffer=function(t,e,r,i){var n=e;n.context.pushBuffer(n),n.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty),this.renderNode(t,e,0,0,i),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},o.prototype.drawDisplayToBuffer=function(t,e,r){e.context.pushBuffer(e),r&&e.setTransform(r.a,r.b,r.c,r.d,r.tx,r.ty);var i;i=t.$renderDirty?t.$getRenderNode():t.$renderNode;var n=0;if(i)switch(n++,i.type){case 1:this.renderBitmap(i,e);break;case 2:this.renderText(i,e);break;case 3:this.renderGraphics(i,e);break;case 4:this.renderGroup(i,e);break;case 5:this.renderMesh(i,e);break;case 6:this.renderNormalBitmap(i,e)}var o=t.$children;if(o)for(var a=o.length,s=0;a>s;s++){var h=o[s];switch(h.$renderMode){case 1:break;case 2:n+=this.drawWithFilter(h,e,0,0);break;case 3:n+=this.drawWithClip(h,e,0,0);break;case 4:n+=this.drawWithScrollRect(h,e,0,0);break;default:n+=this.drawDisplayObject(h,e,0,0)}}return e.context.$drawWebGL(),e.onRenderFinish(),e.context.popBuffer(),n},o.prototype.renderNode=function(t,e,r,i,n){switch(e.$offsetX=r,e.$offsetY=i,t.type){case 1:this.renderBitmap(t,e);break;case 2:this.renderText(t,e);break;case 3:this.renderGraphics(t,e,n);break;case 4:this.renderGroup(t,e);break;case 5:this.renderMesh(t,e);break;case 6:this.renderNormalBitmap(t,e)}},o.prototype.renderNormalBitmap=function(t,e){var r=t.image;r&&e.context.drawImage(r,t.sourceX,t.sourceY,t.sourceW,t.sourceH,t.drawX,t.drawY,t.drawW,t.drawH,t.imageWidth,t.imageHeight,t.rotated,t.smoothing)},o.prototype.renderBitmap=function(e,n){var o=e.image;if(o){var a,s,h,l=e.drawData,c=l.length,d=0,u=e.matrix,p=e.blendMode,f=e.alpha;if(u){a=t.Matrix.create();var g=n.globalMatrix;a.a=g.a,a.b=g.b,a.c=g.c,a.d=g.d,a.tx=g.tx,a.ty=g.ty,s=n.$offsetX,h=n.$offsetY,n.useOffset(),n.transform(u.a,u.b,u.c,u.d,u.tx,u.ty)}p&&n.context.setGlobalCompositeOperation(r[p]);var v;if(f==f&&(v=n.globalAlpha,n.globalAlpha*=f),e.filter){for(n.context.$filter=e.filter;c>d;)n.context.drawImage(o,l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);n.context.$filter=null}else for(;c>d;)n.context.drawImage(o,l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);if(p&&n.context.setGlobalCompositeOperation(i),f==f&&(n.globalAlpha=v),u){var x=n.globalMatrix;x.a=a.a,x.b=a.b,x.c=a.c,x.d=a.d,x.tx=a.tx,x.ty=a.ty,n.$offsetX=s,n.$offsetY=h,t.Matrix.release(a)}}},o.prototype.renderMesh=function(e,n){var o,a,s,h=e.image,l=e.drawData,c=l.length,d=0,u=e.matrix,p=e.blendMode,f=e.alpha;if(u){o=t.Matrix.create();var g=n.globalMatrix;o.a=g.a,o.b=g.b,o.c=g.c,o.d=g.d,o.tx=g.tx,o.ty=g.ty,a=n.$offsetX,s=n.$offsetY,n.useOffset(),n.transform(u.a,u.b,u.c,u.d,u.tx,u.ty)}p&&n.context.setGlobalCompositeOperation(r[p]);var v;if(f==f&&(v=n.globalAlpha,n.globalAlpha*=f),e.filter){for(n.context.$filter=e.filter;c>d;)n.context.drawMesh(h,l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds,e.rotated,e.smoothing);n.context.$filter=null}else for(;c>d;)n.context.drawMesh(h,l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],l[d++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds,e.rotated,e.smoothing);if(p&&n.context.setGlobalCompositeOperation(i),f==f&&(n.globalAlpha=v),u){var x=n.globalMatrix;x.a=o.a,x.b=o.b,x.c=o.c,x.d=o.d,x.tx=o.tx,x.ty=o.ty,n.$offsetX=a,n.$offsetY=s,t.Matrix.release(o)}},o.prototype.renderText=function(r,i){var n=r.width-r.x,o=r.height-r.y;if(!(0>=n||0>=o)&&n&&o&&0!=r.drawData.length){var a=t.sys.DisplayList.$canvasScaleX,s=t.sys.DisplayList.$canvasScaleY,h=i.context.$maxTextureSize;n*a>h&&(a*=h/(n*a)),o*s>h&&(s*=h/(o*s)),n*=a,o*=s;var l=r.x*a,c=r.y*s;(r.$canvasScaleX!=a||r.$canvasScaleY!=s)&&(r.$canvasScaleX=a,r.$canvasScaleY=s,r.dirtyRender=!0),this.canvasRenderBuffer&&this.canvasRenderBuffer.context?r.dirtyRender&&this.canvasRenderBuffer.resize(n,o):(this.canvasRenderer=new t.CanvasRenderer,this.canvasRenderBuffer=new e.CanvasRenderBuffer(n,o));var d=1,u=1,p=0,f=0;if((1!=a||1!=s)&&(d=a,u=s),l||c?(p=-l,f=-c,i.transform(1,0,0,1,l/a,c/s)):(1!=a||1!=s)&&(p=0,f=0),this.canvasRenderBuffer&&this.canvasRenderBuffer.context_setTransform(d,0,0,u,p,f),r.dirtyRender){var g=this.canvasRenderBuffer.surface,v=this.canvasRenderBuffer.context;this.canvasRenderer.renderText(r,this.canvasRenderBuffer.context);var x=r.$texture;x?i.context.updateTexture(x,v):(x=i.context.createTextureByCanvas(v),r.$texture=x),r.$textureWidth=g.width,r.$textureHeight=g.height}var y=r.$textureWidth,b=r.$textureHeight;i.context.drawTexture(r.$texture,0,0,y,b,0,0,y/a,b/s,y,b),(l||c)&&(r.dirtyRender&&this.canvasRenderBuffer.context_setTransform(a,0,0,s,0,0),i.transform(1,0,0,1,-l/a,-c/s)),r.dirtyRender=!1}},o.prototype.renderGraphics=function(r,i,n){var o=r.width,a=r.height;if(!(0>=o||0>=a)&&o&&a&&0!=r.drawData.length){var s=t.sys.DisplayList.$canvasScaleX,h=t.sys.DisplayList.$canvasScaleY;(1>o*s||1>a*h)&&(s=h=1),(r.$canvasScaleX!=s||r.$canvasScaleY!=h)&&(r.$canvasScaleX=s,r.$canvasScaleY=h,r.dirtyRender=!0),o*=s,a*=h;var l=Math.ceil(o),c=Math.ceil(a);s*=l/o,h*=c/a,o=l,a=c,this.canvasRenderBuffer&&this.canvasRenderBuffer.context?(r.dirtyRender||n)&&this.canvasRenderBuffer.resize(o,a):(this.canvasRenderer=new t.CanvasRenderer,this.canvasRenderBuffer=new e.CanvasRenderBuffer(o,a)),(1!=s||1!=h)&&this.canvasRenderBuffer.context_setTransform(s,0,0,h,0,0),(r.x||r.y)&&((r.dirtyRender||n)&&this.canvasRenderBuffer.context.translate(-r.x,-r.y),i.transform(1,0,0,1,r.x,r.y));var d=this.canvasRenderBuffer.surface,u=this.canvasRenderBuffer.context;if(n){this.canvasRenderer.renderGraphics(r,this.canvasRenderBuffer.context,!0),t.WebGLUtils.deleteWebGLTexture(d);var p=i.context.getWebGLTexture(d);i.context.drawTexture(p,0,0,o,a,0,0,o,a,d.width,d.height,void 0,void 0,void 0,void 0,void 0,void 0,!0)}else{if(r.dirtyRender){this.canvasRenderer.renderGraphics(r,this.canvasRenderBuffer.context);var p=r.$texture;p?i.context.updateTexture(p,u):(p=i.context.createTextureByCanvas(u),r.$texture=p),r.$textureWidth=d.width,r.$textureHeight=d.height}var f=r.$textureWidth,g=r.$textureHeight;i.context.drawTexture(r.$texture,0,0,f,g,0,0,f/s,g/h,f,g,void 0,void 0,void 0,void 0,void 0,void 0,!0)}(r.x||r.y)&&((r.dirtyRender||n)&&this.canvasRenderBuffer.context.translate(r.x,r.y),i.transform(1,0,0,1,-r.x,-r.y)),n||(r.dirtyRender=!1)}},o.prototype.renderGroup=function(e,r){var i,n,o,a=e.matrix;if(a){i=t.Matrix.create();var s=r.globalMatrix;i.a=s.a,i.b=s.b,i.c=s.c,i.d=s.d,i.tx=s.tx,i.ty=s.ty,n=r.$offsetX,o=r.$offsetY,r.useOffset(),r.transform(a.a,a.b,a.c,a.d,a.tx,a.ty)}for(var h=e.drawData,l=h.length,c=0;l>c;c++){var d=h[c];this.renderNode(d,r,r.$offsetX,r.$offsetY)}if(a){var u=r.globalMatrix;u.a=i.a,u.b=i.b,u.c=i.c,u.d=i.d,u.tx=i.tx,u.ty=i.ty,r.$offsetX=n,r.$offsetY=o,t.Matrix.release(i)}},o.prototype.createRenderBuffer=function(t,r){var i=n.pop();return i?i.resize(t,r):(i=new e.WebGLRenderBuffer(t,r),i.$computeDrawCall=!1),i},o}();e.WebGLRenderer=o,__reflect(o.prototype,"egret.web.WebGLRenderer",["egret.sys.SystemRenderer"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r=function(e){function r(t,r,i){var n=e.call(this)||this;return n.clearColor=[0,0,0,0],n.useFrameBuffer=!0,n.gl=t,n.width=r||1,n.height=i||1,n}return __extends(r,e),r.prototype.resize=function(t,e){var r=this.gl;this.width=t,this.height=e,this.frameBuffer&&(r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,null)),this.stencilBuffer&&(r.deleteRenderbuffer(this.stencilBuffer),this.stencilBuffer=null)},r.prototype.activate=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer())},r.prototype.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},r.prototype.initFrameBuffer=function(){if(!this.frameBuffer){var t=this.gl;this.texture=this.createTexture(),this.frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},r.prototype.createTexture=function(){var t=this.gl,e=t.createTexture();return e.glContext=t,t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},r.prototype.clear=function(t){var e=this.gl;t&&this.activate(),e.colorMask(!0,!0,!0,!0),e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e.clear(e.COLOR_BUFFER_BIT)},r.prototype.enabledStencil=function(){if(this.frameBuffer&&!this.stencilBuffer){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),this.stencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencilBuffer)}},r.prototype.dispose=function(){t.WebGLUtils.deleteWebGLTexture(this.texture)},r}(t.HashObject);e.WebGLRenderTarget=r,__reflect(r.prototype,"egret.web.WebGLRenderTarget")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}return e.compileProgram=function(e,r,i){var n=t.WebGLUtils.compileFragmentShader(e,i),o=t.WebGLUtils.compileVertexShader(e,r),a=e.createProgram();return e.attachShader(a,o),e.attachShader(a,n),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||t.$warn(1020),a},e.compileFragmentShader=function(t,e){return this._compileShader(t,e,t.FRAGMENT_SHADER)},e.compileVertexShader=function(t,e){return this._compileShader(t,e,t.VERTEX_SHADER)},e._compileShader=function(t,e,r){var i=t.createShader(r);return t.shaderSource(i,e),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:null},e.checkCanUseWebGL=function(){return!0},e.deleteWebGLTexture=function(t){if(t){var e=t.glContext;e?e.deleteTexture(t):(e=bkWebGLGetInstance(),e.deleteTexture(t))}},e}();t.BKWebGLUtils=e,__reflect(e.prototype,"egret.BKWebGLUtils"),t.WebGLUtils=e}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var t=this.vertexMaxSize*this.vertSize,e=this.indicesMaxSize;this.vertices=new Float32Array(t),this.indices=new Uint16Array(e),this.indicesForMesh=new Uint16Array(e);for(var r=0,i=0;e>r;r+=6,i+=4)this.indices[r+0]=i+0,this.indices[r+1]=i+1,this.indices[r+2]=i+2,this.indices[r+3]=i+0,this.indices[r+4]=i+2,this.indices[r+5]=i+3}return t.prototype.reachMaxSize=function(t,e){return void 0===t&&(t=4),void 0===e&&(e=6),this.vertexIndex>this.vertexMaxSize-t||this.indexIndex>this.indicesMaxSize-e},t.prototype.getVertices=function(){var t=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return t},t.prototype.getIndices=function(){return this.indices},t.prototype.getMeshIndices=function(){return this.indicesForMesh},t.prototype.changeToMeshIndices=function(){if(!this.hasMesh){for(var t=0,e=this.indexIndex;e>t;++t)this.indicesForMesh[t]=this.indices[t];this.hasMesh=!0}},t.prototype.isMesh=function(){return this.hasMesh},t.prototype.cacheArrays=function(t,e,r,i,n,o,a,s,h,l,c,d,u,p,f){var g=t.globalAlpha,v=t.globalMatrix,x=v.a,y=v.b,b=v.c,$=v.d,m=v.tx,T=v.ty,_=t.$offsetX,w=t.$offsetY;if((0!=_||0!=w)&&(m=_*x+w*b+m,T=_*y+w*$+T),!u){(0!=o||0!=a)&&(m=o*x+a*b+m,T=o*y+a*$+T);var S=s/i;1!=S&&(x=S*x,y=S*y);var B=h/n;1!=B&&(b=B*b,$=B*$)}if(u){var E=this.vertices,C=this.vertexIndex*this.vertSize,R=0,F=0,D=0,L=0,O=0,A=0,N=0;for(R=0,D=d.length;D>R;R+=2)F=C+5*R/2,A=u[R],N=u[R+1],L=d[R],O=d[R+1],E[F+0]=x*A+b*N+m,E[F+1]=y*A+$*N+T,f?(E[F+2]=(e+(1-O)*n)/l,E[F+3]=(r+L*i)/c):(E[F+2]=(e+L*i)/l,E[F+3]=(r+O*n)/c),E[F+4]=g;if(this.hasMesh)for(var M=0,k=p.length;k>M;++M)this.indicesForMesh[this.indexIndex+M]=p[M]+this.vertexIndex;this.vertexIndex+=d.length/2,this.indexIndex+=p.length}else{var P=l,G=c,I=i,W=n;e/=P,r/=G;var E=this.vertices,C=this.vertexIndex*this.vertSize;if(f){var U=i;i=n/P,n=U/G,E[C++]=m,E[C++]=T,E[C++]=i+e,E[C++]=r,E[C++]=g,E[C++]=x*I+m,E[C++]=y*I+T,E[C++]=i+e,E[C++]=n+r,E[C++]=g,E[C++]=x*I+b*W+m,E[C++]=$*W+y*I+T,E[C++]=e,E[C++]=n+r,E[C++]=g,E[C++]=b*W+m,E[C++]=$*W+T,E[C++]=e,E[C++]=r,E[C++]=g}else i/=P,n/=G,E[C++]=m,E[C++]=T,E[C++]=e,E[C++]=r,E[C++]=g,E[C++]=x*I+m,E[C++]=y*I+T,E[C++]=i+e,E[C++]=r,E[C++]=g,E[C++]=x*I+b*W+m,E[C++]=$*W+y*I+T,E[C++]=i+e,E[C++]=n+r,E[C++]=g,E[C++]=b*W+m,E[C++]=$*W+T,E[C++]=e,E[C++]=n+r,E[C++]=g;if(this.hasMesh){var K=this.indicesForMesh;K[this.indexIndex+0]=0+this.vertexIndex,K[this.indexIndex+1]=1+this.vertexIndex,K[this.indexIndex+2]=2+this.vertexIndex,K[this.indexIndex+3]=0+this.vertexIndex,K[this.indexIndex+4]=2+this.vertexIndex,K[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},t.prototype.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},t}();t.WebGLVertexArrayObject=e,__reflect(e.prototype,"egret.web.WebGLVertexArrayObject")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var r=function(e){function r(t){var r=e.call(this)||this;return r._mainTicker=BK.Director.ticker,r.init(t),r}return __extends(r,e),r.prototype.init=function(e){var r=this,i=this.readOption(e),n=new t.Stage;n.$screen=this,n.$scaleMode=i.scaleMode,n.$orientation=i.orientation,n.$maxTouches=i.maxTouches,n.frameRate=i.frameRate,n.textureScaleFactor=i.textureScaleFactor;var o=new t.sys.RenderBuffer(void 0,void 0,!0);t.lifecycle.stage=n,this.playerOption=i,this.stage=n,t.sys.$TempStage=this.stage,this._touches=new t.sys.TouchHandler(this.stage),BK.Director.ticker.add(function(t,e){r._touchHandler()}),this._entryClassName=i.entryClassName,this.screenDisplayList=this.createDisplayList(n,o),this.updateScreenSize(),this.updateMaxTouches(),this.start()},r.prototype._touchHandler=function(){var e=BK.TouchEvent.getTouchEvent();if(e&&0!==e.length){for(var i=BK.Director.screenPixelSize.height,n=t.sys.DisplayList.$canvasScaleX,o=t.sys.DisplayList.$canvasScaleY,a=0,s=e;a<s.length;a++){var h=s[a],l=h.id,c=(BK.Director.screenPixelSize,BK.Director.root.convertToNodeSpace(h)),d=c.x/n,u=(i-c.y-r._viewRect.y)/o;1===h.status?this._touches.onTouchEnd(d,u,l):2===h.status?this._touches.onTouchBegin(d,u,l):3===h.status&&this._touches.onTouchMove(d,u,l)}BK.TouchEvent.updateTouchStatus()}},r.prototype.readOption=function(e){var r={};return r.entryClassName=e.entryClassName,r.scaleMode=e.scaleMode||t.StageScaleMode.NO_SCALE,r.frameRate=+e.frameRate||30,r.contentWidth=+e.contentWidth||480,r.contentHeight=+e.contentHeight||800,r.orientation=e.orientation||t.OrientationMode.AUTO,r.maxTouches=10,r.textureScaleFactor=1,r},r.prototype.createDisplayList=function(e,r){var i=new t.sys.BKDisplayList(e);return i.renderBuffer=r,e.$displayList=i,i},r.prototype.updateScreenSize=function(){var e=BK.Director.screenPixelSize,i=e.width,n=e.height;t.Capabilities.$boundingClientWidth=i,t.Capabilities.$boundingClientHeight=n;var o=t.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,i,n,this.playerOption.contentWidth,this.playerOption.contentHeight),a=o.stageWidth,s=o.stageHeight,h=o.displayWidth,l=o.displayHeight,c=(n-l)/2,d=(i-h)/2;this.stage.$stageWidth=a,this.stage.$stageHeight=s;var u=h/a,p=l/s;r._viewRect.setTo(d,c,a,s);var f=u*t.sys.DisplayList.$canvasScaleFactor,g=p*t.sys.DisplayList.$canvasScaleFactor;t.sys.DisplayList.$setCanvasScale(f,g),this.updateStageSize(a,s)},r.prototype.updateStageSize=function(e,r){var i=this.stage;i.$stageWidth=e,i.$stageHeight=r,this.screenDisplayList.setClipRect(e,r),i.dispatchEventWith(t.Event.RESIZE)},r.prototype.setContentSize=function(t,e){var r=this.playerOption;r.contentWidth=t,r.contentHeight=e,this.updateScreenSize()},r.prototype.updateMaxTouches=function(){this._touches.$initMaxTouches()},r.prototype.start=function(){var e,r=this._entryClassName;if(r&&(e=t.getDefinitionByName(r)),e){var i=new e;i instanceof t.DisplayObject&&this.stage.addChild(i)}else if(e=global.Main){var i=new e;i.addChild&&this.stage.addChild(i)}t.ticker.$addPlayer(this)},r.prototype.$render=function(t,e){var r=this.stage;r.$displayList.drawToSurface()},r._viewRect=new t.Rectangle,r}(t.HashObject);e.BKWebPlayer=r,__reflect(r.prototype,"egret.web.BKWebPlayer",["egret.sys.Screen"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function r(t){void 0===t&&(t=null);var r=e.call(this,new BK.Sprite(0,0,{},0,1,1,1))||this;return r.$explicitBitmapWidth=0/0,r.$explicitBitmapHeight=0/0,r._size={width:0,height:0},r.hasScale9Grid=!1,r.$bitmapData=null,r.$texture=null,r.$scale9Grid=null,r._bkSprite=r._bkNode,r.texture=t,r}return __extends(r,e),r.prototype._updateBKNodeMatrix=function(){if(this.$texture){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,r=t.tx,i=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY-this._size.height;(0!==n||0!==o)&&(r-=t.a*n+t.c*o,i-=t.b*n+t.d*o),e.set(t.a,-t.b,-t.c,t.d,r,-i)}},Object.defineProperty(r.prototype,"texture",{get:function(){return this.$texture},set:function(t){this.$texture!==t&&this.$setTexture(t)},enumerable:!0,configurable:!0}),r.prototype.$setTexture=function(e){if(this.$texture=e,this.$texture)if(this._transformDirty=!0,this.$bitmapData=this.$texture.bitmapData,this.$bitmapData.bkTexture){if(this._bkSprite.setTexture(this.$bitmapData.bkTexture),this.$bitmapData.isFlip&&this._bkSprite.setUVFlip(0,0),this._bkSprite.adjustTexturePosition(this.$texture.$bitmapX,this.$texture.$sourceHeight-(this.$texture.$bitmapY+this.$texture.$bitmapHeight),this.$texture.$bitmapWidth,this.$texture.$bitmapHeight,this.$texture.$rotated),this._size.width=this.$getWidth(),this._size.height=this.$getHeight(),this._bkSprite.contentSize=this._size,this.$texture.scale9Grid&&!this.hasScale9Grid){var r=new t.Rectangle;r.setTo(this.$texture.scale9Grid.x,this.$texture.scale9Grid.y,this.$texture.scale9Grid.width,this.$texture.scale9Grid.height),this.$setScale9Grid(r)}}else this.$bitmapData=null,this._bkSprite.setTexture({});else this.$bitmapData=null,this._bkSprite.setTexture({})},Object.defineProperty(r.prototype,"scale9Grid",{get:function(){return this.$scale9Grid},set:function(t){this.$setScale9Grid(t)},enumerable:!0,configurable:!0}),r.prototype.$setScale9Grid=function(e){var r=this;r.$scale9Grid!=e&&(r.$scale9Grid?e?this._bkSprite.setScale9Grid(e):(this._bkSprite=new BK.Sprite(0,0,{},0,1,1,1),this._replaceNode(this._bkSprite),this.$setTexture(this.$texture)):e&&(this._bkSprite=new t.BKSprite9,this._replaceNode(this._bkSprite),this._bkSprite.setScale9Grid(e),this.hasScale9Grid=!0,this.$setTexture(this.$texture)),this._bkSprite.contentSize=this._size,r.$scale9Grid=e,r.$renderDirty=!0)},r.prototype.$setWidth=function(t){var e=this;return 0>t||t==e.$explicitBitmapWidth?!1:(e.$explicitBitmapWidth=t,this._transformDirty=!0,this._size.width=t,this._bkSprite.contentSize=this._size,!0)},r.prototype.$setHeight=function(t){var e=this;return 0>t||t==e.$explicitBitmapHeight?!1:(e.$explicitBitmapHeight=t,this._transformDirty=!0,this._size.height=t,this._bkSprite.contentSize=this._size,!0)},r.prototype.$getWidth=function(){return isNaN(this.$explicitBitmapWidth)?this.$getContentBounds().width:this.$explicitBitmapWidth},r.prototype.$getHeight=function(){return isNaN(this.$explicitBitmapHeight)?this.$getContentBounds().height:this.$explicitBitmapHeight},r.prototype.$measureContentBounds=function(t){if(this.$texture){var e=isNaN(this.$explicitBitmapWidth)?this.$texture.$getTextureWidth():this.$explicitBitmapWidth,r=isNaN(this.$explicitBitmapHeight)?this.$texture.$getTextureHeight():this.$explicitBitmapHeight;t.setTo(0,0,e,r)}else{var e=isNaN(this.$explicitBitmapWidth)?0:this.$explicitBitmapWidth,r=isNaN(this.$explicitBitmapHeight)?0:this.$explicitBitmapHeight;t.setTo(0,0,e,r)}},r}(t.BKDisplayObject);t.BKBitmap=e,__reflect(e.prototype,"egret.BKBitmap"),"webgl"!=window.renderMode&&(t.Bitmap=t.BKBitmap)}(egret||(egret={}));