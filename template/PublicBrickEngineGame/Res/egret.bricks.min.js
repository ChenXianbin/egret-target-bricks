var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},egret;!function(t){var e=function(e){function i(t){void 0===t&&(t=null);var i=e.call(this)||this;return i._transformDirty=!0,i._colorDirty=0,i._color={r:1,g:1,b:1,a:1},i.scrollRectNode=null,i._bkNode=t||new BK.Node,i}return __extends(i,e),i.prototype._replaceNode=function(t){this._transformDirty=!0,t.vertexColor=this._bkNode.vertexColor,t.hidden=this._bkNode.hidden,t.blendMode=this._bkNode.blendMode,t.zOrder=this._bkNode.zOrder,this._bkNode.parent&&(this._bkNode.parent.addChild(t,this.parent.getChildIndex(this)),this._bkNode.parent.removeChild(this._bkNode)),this._bkNode=t},i.prototype._updateSelfColor=function(){this._bkNode.vertexColor=this._color},i.prototype._updateBKNodeMatrix=function(){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,i=t.tx,r=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY;(0!==n||0!==o)&&(i-=t.a*n+t.c*o,r-=t.b*n+t.d*o),e.set(t.a,-t.b,-t.c,t.d,i,-r)},i.prototype._updateColor=function(){var t=this.$parent;t?2===this._colorDirty||0!==t._colorDirty?(this._colorDirty=1,this._color.a=t._color.a*this.$alpha,this._updateSelfColor()):1===this._colorDirty&&(this._colorDirty=0):2===this._colorDirty?(this._colorDirty=1,this._color.a=this.$alpha,this._updateSelfColor()):1===this._colorDirty&&(this._colorDirty=0)},i.prototype.$setVisible=function(t){e.prototype.$setVisible.call(this,t),this._bkNode.hidden=!t},i.prototype.$setAlpha=function(t){e.prototype.$setAlpha.call(this,t),this._colorDirty=2},Object.defineProperty(i.prototype,"blendMode",{set:function(e){var i=this,r=t.sys.blendModeToNumber(e);i.$blendMode=r,i.updateRenderMode();var n=i.$parent;n&&!n.$cacheDirty&&(n.$cacheDirty=!0,n.$cacheDirtyUp());var o=i.$maskedObject;switch(o&&!o.$cacheDirty&&(o.$cacheDirty=!0,o.$cacheDirtyUp()),e){case t.BlendMode.NORMAL:this._bkNode.blendMode=1;break;case t.BlendMode.ADD:this._bkNode.blendMode=0;break;case t.BlendMode.ERASE:}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mask",{set:function(e){var i=this;if(e!==i){if(!(this instanceof t.BKBitmap))return void console.log("QQ 玩一玩不支持该种类型的影片剪辑被遮罩，只有 Bitmap 类型可以被遮罩，或不使用遮罩。");if(e)if(e instanceof t.BKBitmap){if(e==i.$mask)return;e.$maskedObject&&(e.$maskedObject.mask=null),e.$maskedObject=i,e._updateBKNodeMatrix(),i.$mask=e;var r=new BK.ClipNode(e._bkNode);r.zOrder=this._bkNode.zOrder,r.alphaThreshold=.5,r.inverted=!1,this._bkNode.parent&&(this._bkNode.parent.addChild(r,this.parent.getChildIndex(this)),this._bkNode.parent.removeChild(this._bkNode)),r.addChild(this._bkNode)}else console.log("QQ 玩一玩不支持该种类型的遮罩，请使用 Bitmap 遮罩，或不使用遮罩。");else{if(i.$mask,i.mask){var r=this._bkNode.parent;r&&r.parent&&(this._bkNode.zOrder=r.zOrder,r.parent.addChild(this._bkNode,this.parent.getChildIndex(this)),r.parent.removeChild(r)),i.$mask=null}i.$maskRect&&(i.$maskRect=null)}i.updateRenderMode()}},enumerable:!0,configurable:!0}),i.prototype.$setX=function(t){var e=this;return e.$x==t?!1:(e.$x=t,this._transformDirty=!0,!0)},i.prototype.$setY=function(t){var e=this;return e.$y==t?!1:(e.$y=t,this._transformDirty=!0,!0)},i.prototype.$setScaleX=function(t){e.prototype.$setScaleX.call(this,t),this._transformDirty=!0},i.prototype.$setScaleY=function(t){e.prototype.$setScaleY.call(this,t),this._transformDirty=!0},i.prototype.$setRotation=function(t){e.prototype.$setRotation.call(this,t),this._transformDirty=!0},i.prototype.$setSkewX=function(t){e.prototype.$setSkewX.call(this,t),this._transformDirty=!0},i.prototype.$setSkewY=function(t){e.prototype.$setSkewY.call(this,t),this._transformDirty=!0},i.prototype.$setMatrix=function(t,i){void 0===i&&(i=!0),e.prototype.$setMatrix.call(this,t,i),this._transformDirty=!0},Object.defineProperty(i.prototype,"scrollRect",{get:function(){return this.$scrollRect},set:function(t){this.setScrollRect(t)},enumerable:!0,configurable:!0}),i.prototype.setScrollRect=function(t){if(t){e.prototype.$setScrollRect.call(this,t);var i=this.$scrollRect;if(this.scrollRectNode){var r=this._bkNode;r.clipRegion={x:0,y:this.height+1,width:i.width,height:-i.height-1},this.scrollRectNode.position={x:i.x,y:i.y},this._transformDirty=!0}else{var n=this._bkNode.parent;this.scrollRectNode=this._bkNode,this._bkNode.removeFromParent();var r=new BK.ClipRectNode(0,this.height+1,i.width,-i.height-1);n&&n.addChild(r),r.addChild(this.scrollRectNode),this._bkNode=r,this.scrollRectNode.position={x:i.x,y:i.y},this._transformDirty=!0}}else if(this.scrollRectNode){var o=this.scrollRectNode,a=this._bkNode.parent;o.removeFromParent(),this._bkNode.removeFromParent(),o.position={x:this._bkNode.position.x,y:this._bkNode.position.y},a.addChild(o),this._bkNode=o,this.scrollRectNode=null,this._transformDirty=!0}},i.prototype.$hitTest=function(t,e){var i=this;if(!i.$visible)return null;var r=i.$getInvertedConcatenatedMatrix();if(0==r.a&&0==r.b&&0==r.c&&0==r.d)return null;var n=i.$getContentBounds(),o=r.a*t+r.c*e+r.tx,a=r.b*t+r.d*e+r.ty;if(n.contains(o,a)){if(!i.$children){var s=i.$scrollRect?i.$scrollRect:i.$maskRect;if(s&&!s.contains(o,a))return null;if(i.$mask&&!i.$mask.$hitTest(t,e))return null}return i}return null},i.prototype.$getRenderNode=function(){var t=this,e=t._bkNode;return e?(t._updateColor(),t.$renderDirty&&(t.$updateRenderNode(),t.$renderDirty=!1,e=t._bkNode),t._transformDirty&&(t._transformDirty=!1,this._updateBKNodeMatrix()),e):null},i.prototype.$onAddToStage=function(i,r){e.prototype.$onAddToStage.call(this,i,r);var n=t.BKPlayer.instance._displayList.indexOf(this);0>n&&t.BKPlayer.instance._displayList.push(this)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);var i=t.BKPlayer.instance._displayList.indexOf(this);i>=0&&t.BKPlayer.instance._displayList.splice(i,1)},i.prototype.invalidUpdate=function(){this.$getRenderNode()},i}(t.DisplayObject);t.BKDisplayObject=e,__reflect(e.prototype,"egret.BKDisplayObject"),"webgl"!=window.renderMode&&(t.DisplayObject=t.BKDisplayObject)}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var t=e.call(this,new BK.ClipRectNode(0,0,2048,-2048))||this;return t.$touchChildren=!0,t._bkClipRectNode=t._bkNode,t._bkClipRectNode.enableClip=!1,t.$children=[],t}return __extends(i,e),i.prototype._updateBKNodeMatrix=function(){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,i=t.tx,r=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY;(0!==n||0!==o)&&(i-=t.a*n+t.c*o,r-=t.b*n+t.d*o),this.$scrollRect&&(i-=this.$scrollRect.x,r-=this.$scrollRect.y),e.set(t.a,-t.b,-t.c,t.d,i,-r)},Object.defineProperty(i.prototype,"numChildren",{get:function(){return this.$children.length},enumerable:!0,configurable:!0}),i.prototype.addChild=function(t){var e=this.$children.length;return t.$parent==this&&e--,this.$doAddChild(t,e)},i.prototype.addChildAt=function(t,e){return e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length,t.$parent==this&&e--),this.$doAddChild(t,e)},i.prototype.$doAddChild=function(e,i,r){void 0===r&&(r=!0);var n=this,o=e.$parent;if(o==n)return n.doSetChildIndex(e,i),e;o&&o.removeChild(e),n.$children.splice(i,0,e),e.$setParent(n);var a=n.$stage;if(a&&e.$onAddToStage(a,n.$nestLevel+1),r&&e.dispatchEventWith(t.Event.ADDED,!0),a)for(var s=t.DisplayObjectContainer.$EVENT_ADD_TO_STAGE_LIST;s.length;){var h=s.shift();h.$stage&&r&&h.dispatchEventWith(t.Event.ADDED_TO_STAGE)}var c=e._bkNode;c.parent?this._bkNode.addChild(c.parent,i):this._bkNode.addChild(c,i);for(var l=0,u=this.$children.length;u>l;l++){var d=this.$children[l]._bkNode,p=d.parent;p&&p.parent===this._bkNode?p.zOrder=-l:d.zOrder=-l}return this.$childAdded(e,i),e},i.prototype.contains=function(t){for(;t;){if(t==this)return!0;t=t.$parent}return!1},i.prototype.getChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$children[t]:null},i.prototype.getChildIndex=function(t){return this.$children.indexOf(t)},i.prototype.getChildByName=function(t){for(var e,i=this.$children,r=i.length,n=0;r>n;n++)if(e=i[n],e.name==t)return e;return null},i.prototype.removeChild=function(t){var e=this.$children.indexOf(t);return e>=0?this.$doRemoveChild(e):null},i.prototype.removeChildAt=function(t){return t=0|+t,t>=0&&t<this.$children.length?this.$doRemoveChild(t):null},i.prototype.$doRemoveChild=function(e,i){void 0===i&&(i=!0),e=0|+e;var r=this.$children,n=r[e];if(this.$childRemoved(n,e),i&&n.dispatchEventWith(t.Event.REMOVED,!0),this.$stage){n.$onRemoveFromStage();for(var o=t.DisplayObjectContainer.$EVENT_REMOVE_FROM_STAGE_LIST;o.length>0;){var a=o.shift();i&&a.$hasAddToStage&&(a.$hasAddToStage=!1,a.dispatchEventWith(t.Event.REMOVED_FROM_STAGE)),a.$hasAddToStage=!1,a.$stage=null}}this.$displayList||this.$parentDisplayList;n.$setParent(null);var s=r.indexOf(n);-1!=s&&r.splice(s,1);var h=n._bkNode;return h.parent&&h.parent.removeChild(h),n},i.prototype.setChildIndex=function(t,e){e=0|+e,(0>e||e>=this.$children.length)&&(e=this.$children.length-1),this.doSetChildIndex(t,e)},i.prototype.doSetChildIndex=function(t,e){var i=this.$children.indexOf(t);if(i!=e){this.$childRemoved(t,i),this.$children.splice(i,1),this.$children.splice(e,0,t),this.$childAdded(t,e);var r=t._bkNode,n=r.parent;n&&(n.removeChild(r),n.addChild(r,e));for(var o=0,a=this.$children.length;a>o;o++){var s=this.$children[o]._bkNode,h=s.parent;h&&h.parent===this._bkNode?h.zOrder=-o:s.zOrder=-o}}},i.prototype.swapChildrenAt=function(t,e){t=0|+t,e=0|+e,t>=0&&t<this.$children.length&&e>=0&&e<this.$children.length&&this.doSwapChildrenAt(t,e)},i.prototype.swapChildren=function(t,e){var i=this.$children.indexOf(t),r=this.$children.indexOf(e);-1==i||-1==r||this.doSwapChildrenAt(i,r)},i.prototype.doSwapChildrenAt=function(t,e){if(t>e){var i=e;e=t,t=i}else if(t==e)return;var r=this.$children,n=r[t],o=r[e];this.$childRemoved(n,t),this.$childRemoved(o,e),r[t]=o,r[e]=n,this.$childAdded(o,t),this.$childAdded(n,e);var a=n._bkNode,s=o._bkNode;a.parent===this._bkNode?a.zOrder=-e:a.parent.zOrder=-e,s.parent===this._bkNode?s.zOrder=-t:s.parent.zOrder=-t},i.prototype.removeChildren=function(){for(var t=this.$children,e=t.length-1;e>=0;e--)this.$doRemoveChild(e)},i.prototype.$childAdded=function(t,e){},i.prototype.$childRemoved=function(t,e){},i.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i);var r=this.$children,n=r.length;i++;for(var o=0;n>o;o++){var a=this.$children[o];a.$onAddToStage(t,i)}},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this);for(var t=this.$children,i=t.length,r=0;i>r;r++){var n=t[r];n.$onRemoveFromStage()}},i.prototype.$measureChildBounds=function(e){var i=this.$children,r=i.length;if(0!=r){for(var n=0,o=0,a=0,s=0,h=!1,c=-1;r>c;c++){var l=-1==c?e:i[c].$getTransformedBounds(this,t.$TempRectangle);l.isEmpty()||(h?(n=Math.min(n,l.x),o=Math.max(o,l.x+l.width),a=Math.min(a,l.y),s=Math.max(s,l.y+l.height)):(h=!0,n=l.x,o=n+l.width,a=l.y,s=a+l.height))}e.setTo(n,a,o-n,s-a)}},Object.defineProperty(i.prototype,"touchChildren",{get:function(){return this.$getTouchChildren()},set:function(t){this.$setTouchChildren(!!t)},enumerable:!0,configurable:!0}),i.prototype.$getTouchChildren=function(){return this.$touchChildren},i.prototype.$setTouchChildren=function(t){return this.$touchChildren==t?!1:(this.$touchChildren=t,!0)},i.prototype.$hitTest=function(t,i){if(!this.$visible)return null;var r=this.$getInvertedConcatenatedMatrix(),n=r.a*t+r.c*i+r.tx,o=r.b*t+r.d*i+r.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(n,o))return null;if(this.$mask&&!this.$mask.$hitTest(t,i))return null;for(var s=this.$children,h=!1,c=null,l=s.length-1;l>=0;l--){var u=s[l];if(!u.$maskedObject&&(c=u.$hitTest(t,i))){if(h=!0,c.$touchEnabled)break;c=null}}return c?this.$touchChildren?c:this:h?this:e.prototype.$hitTest.call(this,t,i)},i.prototype.invalidUpdate=function(){for(var t=0,e=this.$children;t<e.length;t++){var i=e[t];i.invalidUpdate()}this.$getRenderNode()},Object.defineProperty(i.prototype,"scrollRect",{set:function(e){var i=this;(e||i.$scrollRect)&&(this._transformDirty=!0,e?(i.$scrollRect||(i.$scrollRect=new t.Rectangle,this._bkClipRectNode.enableClip=!0),i.$scrollRect.copyFrom(e),this._bkClipRectNode.clipRegion={x:i.$scrollRect.x,y:-i.$scrollRect.y-i.$scrollRect.height,width:i.$scrollRect.width,height:i.$scrollRect.height}):(i.$scrollRect=null,this._bkClipRectNode.enableClip=!1))},enumerable:!0,configurable:!0}),i.$EVENT_ADD_TO_STAGE_LIST=[],i.$EVENT_REMOVE_FROM_STAGE_LIST=[],i}(t.BKDisplayObject);t.BKDisplayObjectContainer=e,__reflect(e.prototype,"egret.BKDisplayObjectContainer"),"webgl"!=window.renderMode&&(t.DisplayObjectContainer=t.BKDisplayObjectContainer)}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this._contentWidth=0,this._contentHeight=0,this._size={width:0,height:0},this._rawGrid=new t.Rectangle,this._grid=new t.Rectangle,this._leftTop=new BK.Sprite(0,0,{},0,1,1,1),this._centerTop=new BK.Sprite(0,0,{},0,1,1,1),this._rightTop=new BK.Sprite(0,0,{},0,1,1,1),this._leftCenter=new BK.Sprite(0,0,{},0,1,1,1),this._centerCenter=new BK.Sprite(0,0,{},0,1,1,1),this._rightCenter=new BK.Sprite(0,0,{},0,1,1,1),this._leftBottom=new BK.Sprite(0,0,{},0,1,1,1),this._centerBottom=new BK.Sprite(0,0,{},0,1,1,1),this._rightBottom=new BK.Sprite(0,0,{},0,1,1,1),this.__nativeObj=new BK.Node,t.defineProxyProperties(this.__nativeObj,this),this.__nativeObj.addChild(this._leftTop),this.__nativeObj.addChild(this._centerTop),this.__nativeObj.addChild(this._rightTop),this.__nativeObj.addChild(this._leftCenter),this.__nativeObj.addChild(this._centerCenter),this.__nativeObj.addChild(this._rightCenter),this.__nativeObj.addChild(this._leftBottom),this.__nativeObj.addChild(this._centerBottom),this.__nativeObj.addChild(this._rightBottom)}return e.prototype._updateGrid=function(){this._grid.x=this._rawGrid.x,this._grid.y=this._rawGrid.y,this._grid.width=this._contentWidth-this._rawGrid.x-this._rawGrid.width,this._grid.height=this._contentHeight-this._rawGrid.y-this._rawGrid.height},e.prototype.dispose=function(){this.__nativeObj.dispose()},e.prototype.setTexture=function(t){this._leftTop.setTexture(t),this._centerTop.setTexture(t),this._rightTop.setTexture(t),this._leftCenter.setTexture(t),this._centerCenter.setTexture(t),this._rightCenter.setTexture(t),this._leftBottom.setTexture(t),this._centerBottom.setTexture(t),this._rightBottom.setTexture(t)},e.prototype.setScale9Grid=function(t){this._rawGrid.setTo(t.x,t.y,t.width,t.height),this._updateGrid()},e.prototype.adjustTexturePosition=function(t,e,i,r,n){this._contentWidth=i,this._contentHeight=r,this.offsetX=t,this.offsetY=e,this.rotated=n,this._updateGrid();var o=this._grid.x,a=this._grid.y,s=this._grid.width,h=this._grid.height,c=this._contentWidth-o-s,l=this._contentHeight-a-h;if(n===!0);else{var u=t,d=t+o,p=t+(i-s),f=e,g=e+h,v=e+(r-a);this._leftTop.adjustTexturePosition(u,v,o,a),this._centerTop.adjustTexturePosition(d,v,c,a),this._rightTop.adjustTexturePosition(p,v,s,a),this._leftCenter.adjustTexturePosition(u,g,o,l),this._centerCenter.adjustTexturePosition(d,g,c,l),this._rightCenter.adjustTexturePosition(p,g,s,l),this._leftBottom.adjustTexturePosition(u,f,o,h),this._centerBottom.adjustTexturePosition(d,f,c,h),this._rightBottom.adjustTexturePosition(p,f,s,h)}},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(t){this._size.width=t.width,this._size.height=t.height,this._updateGrid();var e=this._grid.x,i=this._grid.y,r=this._grid.width,n=this._grid.height;this._size.width<e+r&&0!==this._size.width&&(e=this._size.width*e/this._contentWidth,r=this._size.width*r/this._contentWidth),this._size.height<i+n&&0!==this._size.height&&(i=this._size.height*i/this._contentHeight,n=this._size.height*n/this._contentHeight);var o=1,a=1,s=this._size.width-e-r,h=this._size.height-i-n;this._leftTop.position={x:0,y:n+h},this._centerTop.position={x:e,y:n+h},this._rightTop.position={x:e+s,y:n+h},this._leftCenter.position={x:0,y:n},this._centerCenter.position={x:e,y:n},this._rightCenter.position={x:e+s,y:n},this._leftBottom.position={x:0,y:0},this._centerBottom.position={x:e,y:0},this._rightBottom.position={x:e+s,y:0},this._leftTop.size={width:e+o,height:i},this._centerTop.size={width:s+o,height:i},this._rightTop.size={width:r,height:i},this._leftCenter.size={width:e+o,height:h+a},this._centerCenter.size={width:s+o,height:h+a},this._rightCenter.size={width:r,height:h+a},this._leftBottom.size={width:e+o,height:n+a},this._centerBottom.size={width:s+o,height:n+a},this._rightBottom.size={width:r,height:n+a}},enumerable:!0,configurable:!0}),e}();t.BKSprite9=e,__reflect(e.prototype,"egret.BKSprite9")}(egret||(egret={}));var egret;!function(t){var e=function(t){function e(e,i){void 0===i&&(i=!1);var r=t.call(this)||this;return r.width=0,r.height=0,r.source="",r.bkTexture=null,r.source=e,r.isFlip=i,"string"==typeof r.source?r.bkTexture=new BK.Texture(r.source):r.bkTexture=r.source,r.width=r.bkTexture.size.width,r.height=r.bkTexture.size.height,r}return __extends(e,t),e.$invalidate=function(){},e}(t.HashObject);t.BKBitmapData=e,__reflect(e.prototype,"egret.BKBitmapData"),"webgl"!=window.renderMode&&(t.BitmapData=t.BKBitmapData)}(egret||(egret={})),console=console||{},console.warn=console.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i="";if(t)for(var r=0,n=t;r<n.length;r++){var o=n[r];i+=" "+o}BK.Script.log(1,0,i)},console.assert=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];t||console.log.apply(null,e)};var egret;!function(t){function e(t,e,i){BK.Director.ticker.setTimeout(t,i,e)}function i(t){BK.Director.ticker.removeTimeout(t)}function r(t){if(!u){u=!0,t||(t={}),n();var e=t.renderMode;"webgl"==e?a(t):o(t)}}function n(){}function o(e){"undefined"!=typeof eui&&(Object.defineProperty(eui.Image.prototype,"scale9Grid",{set:function(t){this.$setScale9Grid(t),this.invalidateDisplayList()},enumerable:!0,configurable:!0}),eui.Image.prototype.$updateRenderNode=function(){var t=this.$bitmapData;if(!t)return null;var e=this.$UIComponent,i=e[10],r=e[11];return 0===i||0===r?null:(this._size.width=this.$getWidth(),this._size.height=this.$getHeight(),void(this._bkSprite.size=this._size))}),void 0!==typeof t.WebSocket&&(t.ISocket=t.BKSocket),e.screenAdapter?t.sys.screenAdapter=e.screenAdapter:t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.DefaultScreenAdapter),t.sys.systemRenderer=new t.BKSystemRenderer,t.sys.canvasRenderer=new t.BKSystemRenderer,c=new t.BKPlayer(e)}function a(e){if("webgl"==e.renderMode){var i=e.antialias;t.web.WebGLRenderContext.antialias=!!i}t.sys.CanvasRenderBuffer=t.web.CanvasRenderBuffer,s(e.renderMode);var r;if(e.canvasScaleFactor)r=e.canvasScaleFactor;else if(e.calculateCanvasScaleFactor)r=e.calculateCanvasScaleFactor(t.sys.canvasHitTestBuffer.context);else{var n=t.sys.canvasHitTestBuffer.context,o=n.backingStorePixelRatio||n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;r=(window.devicePixelRatio||1)/o}t.sys.DisplayList.$canvasScaleFactor=r;var a=t.ticker;h(a),e.screenAdapter?t.sys.screenAdapter=e.screenAdapter:t.sys.screenAdapter||(t.sys.screenAdapter=new t.sys.DefaultScreenAdapter),l=new t.web.BKWebPlayer(e)}function s(e){"webgl"==e&&(t.sys.RenderBuffer=t.web.WebGLRenderBuffer,t.sys.systemRenderer=new t.web.WebGLRenderer,t.sys.canvasRenderer=new t.CanvasRenderer,t.sys.customHitTestBuffer=new t.web.WebGLRenderBuffer(3,3),t.sys.canvasHitTestBuffer=new t.web.CanvasRenderBuffer(3,3),t.Capabilities.renderMode="webgl")}function h(t){BK.Director.ticker.interval=1,BK.Director.ticker.add(function(e,i){t.update()})}t.getTimer=function(){return Math.round(1e3*BK.Time.timestamp)},t.setTimeout=e,t.clearTimeout=i;var c,l,u=!1;t.runEgret=r}(egret||(egret={}));var egret;!function(t){function e(){if(r.length>0){var t=r.pop();return t}var e=new BK.Sprite(0,0,{},0,1,1,1);return e}var i=function(i){function n(){var e=i.call(this)||this;return e.$smoothing=t.Bitmap.defaultSmoothing,e.$text="",e.$textFieldWidth=0/0,e.$textLinesChanged=!1,e.$textFieldHeight=0/0,e.$font=null,e.$fontStringChanged=!1,e.$lineSpacing=0,e.$letterSpacing=0,e.$textAlign=t.HorizontalAlign.LEFT,e.$verticalAlign=t.VerticalAlign.TOP,e.$textWidth=0/0,e.$textHeight=0/0,e.$textOffsetX=0,e.$textOffsetY=0,e.$textStartX=0,e.$textStartY=0,e.$lineHeights=[],e._bkNodes=[],e}return __extends(n,i),n.prototype.createNativeDisplayObject=function(){},Object.defineProperty(n.prototype,"smoothing",{get:function(){return this.$smoothing},set:function(t){var e=this;t!=e.$smoothing&&(e.$smoothing=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"text",{get:function(){return this.$text},set:function(t){this.$setText(t)},enumerable:!0,configurable:!0}),n.prototype.$setText=function(t){null==t&&(t="");var e=this;return t==e.$text?!1:(e.$text=t,e.$invalidateContentBounds(),!0)},n.prototype.$getWidth=function(){var t=this,e=t.$textFieldWidth;return isNaN(e)?t.$getContentBounds().width:e},n.prototype.$setWidth=function(t){var e=this;return 0>t||t==e.$textFieldWidth?!1:(e.$textFieldWidth=t,e.$invalidateContentBounds(),!0)},n.prototype.$invalidateContentBounds=function(){this.$renderDirty=!0,this.$textLinesChanged=!0,this.$updateRenderNode()},n.prototype.$getHeight=function(){var t=this,e=t.$textFieldHeight;return isNaN(e)?t.$getContentBounds().height:e},n.prototype.$setHeight=function(t){var e=this;return 0>t||t==e.$textFieldHeight?!1:(e.$textFieldHeight=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"font",{get:function(){return this.$font},set:function(t){this.$setFont(t)},enumerable:!0,configurable:!0}),n.prototype.$setFont=function(t){var e=this;return e.$font==t?!1:(e.$font=t,e.$fontStringChanged=!0,this.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"lineSpacing",{get:function(){return this.$lineSpacing},set:function(t){this.$setLineSpacing(t)},enumerable:!0,configurable:!0}),n.prototype.$setLineSpacing=function(t){var e=this;return e.$lineSpacing==t?!1:(e.$lineSpacing=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"letterSpacing",{get:function(){return this.$letterSpacing},set:function(t){this.$setLetterSpacing(t)},enumerable:!0,configurable:!0}),n.prototype.$setLetterSpacing=function(t){var e=this;return e.$letterSpacing==t?!1:(e.$letterSpacing=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"textAlign",{get:function(){return this.$textAlign},set:function(t){this.$setTextAlign(t)},enumerable:!0,configurable:!0}),n.prototype.$setTextAlign=function(t){var e=this;return e.$textAlign==t?!1:(e.$textAlign=t,e.$invalidateContentBounds(),!0)},Object.defineProperty(n.prototype,"verticalAlign",{get:function(){return this.$verticalAlign},set:function(t){this.$setVerticalAlign(t)},enumerable:!0,configurable:!0}),n.prototype.$setVerticalAlign=function(t){var e=this;return e.$verticalAlign==t?!1:(e.$verticalAlign=t,e.$invalidateContentBounds(),!0)},n.prototype.$updateRenderNode=function(){var i=this,n=this.$getTextLines(),o=n.length;if(0!=o){for(var a=this.$textLinesWidth,s=i.$font,h=0,c=s._getFirstCharHeight(),l=Math.ceil(c*t.BitmapText.EMPTY_FACTOR),u=!isNaN(i.$textFieldHeight),d=i.$textWidth,p=i.$textFieldWidth,f=i.$textFieldHeight,g=i.$textAlign,v=this.$textOffsetY+this.$textStartY,y=this.$lineHeights,x=0;o>x;x++){var b=y[x];if(u&&x>0&&v+b>f)break;var $=n[x],m=$.length,T=this.$textOffsetX;if(g!=t.HorizontalAlign.LEFT){var _=p>d?p:d;g==t.HorizontalAlign.RIGHT?T+=_-a[x]:g==t.HorizontalAlign.CENTER&&(T+=Math.floor((_-a[x])/2))}for(var w=0;m>w;w++){var S=$.charAt(w),B=s.getTexture(S);if(B){var E=(B.$bitmapWidth,B.$bitmapHeight),C=void 0;h<this._bkNodes.length?C=this._bkNodes[h]:(C=e(),this._bkNodes[h]=C,this._bkNode.addChild(C)),C.setTexture(B.$bitmapData.bkTexture),C.adjustTexturePosition(B.$bitmapX,B.$sourceHeight-(B.$bitmapY+B.$bitmapHeight),B.$bitmapWidth,B.$bitmapHeight,B.$rotated),C.size={width:B.$bitmapWidth,height:B.$bitmapHeight},C.position={x:T,y:-v-E},h++,T+=(s.getConfig(S,"xadvance")||B.$getTextureWidth())+i.$letterSpacing}else" "==S?T+=l:t.$warn(1046,S)}v+=b+i.$lineSpacing}for(var x=h;x<this._bkNodes.length;++x){var C=this._bkNodes[x];r.push(C),this._bkNode.removeChild(C)}this._bkNodes.length=h}},n.prototype.$measureContentBounds=function(t){var e=this.$getTextLines();0==e.length?t.setEmpty():t.setTo(this.$textOffsetX+this.$textStartX,this.$textOffsetY+this.$textStartY,this.$textWidth-this.$textOffsetX,this.$textHeight-this.$textOffsetY)},Object.defineProperty(n.prototype,"textWidth",{get:function(){return this.$getTextLines(),this.$textWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"textHeight",{get:function(){return this.$getTextLines(),this.$textHeight},enumerable:!0,configurable:!0}),n.prototype.$getTextLines=function(){function e(t){return x&&r.length>0&&p>x?!1:(p+=h+l,a||s||(c-=u),r.push(t),o.push(h),n.push(c),d=Math.max(c,d),!0)}var i=this;if(!i.$textLinesChanged)return i.textLines;var r=[];i.textLines=r;var n=[];i.$textLinesWidth=n,i.$textLinesChanged=!1;var o=[];if(i.$lineHeights=o,!i.$text||!i.$font)return i.$textWidth=0,i.$textHeight=0,r;for(var a,s,h,c,l=i.$lineSpacing,u=i.$letterSpacing,d=0,p=0,f=0,g=0,v=!isNaN(i.$textFieldWidth),y=i.$textFieldWidth,x=i.$textFieldHeight,b=i.$font,$=b._getFirstCharHeight(),m=Math.ceil($*t.BitmapText.EMPTY_FACTOR),T=i.$text,_=T.split(/(?:\r\n|\r|\n)/),w=_.length,S=!0,B=0;w>B;B++){var E=_[B],C=E.length;h=0,c=0,a=!0,s=!1;for(var R=0;C>R;R++){a||(c+=u);var F=E.charAt(R),L=void 0,D=void 0,O=0,A=0,M=b.getTexture(F);if(M)L=M.$getTextureWidth(),D=M.$getTextureHeight(),O=M.$offsetX,A=M.$offsetY;else{if(" "!=F){t.$warn(1046,F),a&&(a=!1);continue}L=m,D=$}if(a&&(a=!1,f=Math.min(O,f)),S&&(S=!1,g=Math.min(A,g)),v&&R>0&&c+L>y){if(!e(E.substring(0,R)))break;E=E.substring(R),C=E.length,R=0,c=R==C-1?L:b.getConfig(F,"xadvance")||L,h=D}else c+=R==C-1?L:b.getConfig(F,"xadvance")||L,h=Math.max(D,h)}if(x&&B>0&&p>x)break;if(s=!0,!e(E))break}p-=l,i.$textWidth=d,i.$textHeight=p,this.$textOffsetX=f,this.$textOffsetY=g,this.$textStartX=0,this.$textStartY=0;var N;return y>d&&(N=i.$textAlign,N==t.HorizontalAlign.RIGHT?this.$textStartX=y-d:N==t.HorizontalAlign.CENTER&&(this.$textStartX=Math.floor((y-d)/2))),x>p&&(N=i.$verticalAlign,N==t.VerticalAlign.BOTTOM?this.$textStartY=x-p:N==t.VerticalAlign.MIDDLE&&(this.$textStartY=Math.floor((x-p)/2))),r},n.prototype._updateSelfColor=function(){for(var t=0,e=this._bkNodes;t<e.length;t++){var i=e[t];i.vertexColor=this._color}},n.EMPTY_FACTOR=.33,n}(t.BKDisplayObject);t.BKBitmapText=i,__reflect(i.prototype,"egret.BKBitmapText");var r=[];"webgl"!=window.renderMode&&(t.BitmapText=t.BKBitmapText)}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=0,this.lineWidth=0,this.strokeColor={r:0,g:0,b:0,a:0},this.fillColor={r:0,g:0,b:0,a:0},this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0),this.includeLastPosition=!0;var e=t.lifecycle.stage;this.stageW=e.stageWidth,this.stageH=e.stageHeight}return e.prototype.$setTarget=function(t){this.targetDisplay&&(this.targetDisplay.$renderNode=null),this.targetDisplay=t},e.prototype.setStrokeWidth=function(t){switch(t){case 1:this.topLeftStrokeWidth=0,this.bottomRightStrokeWidth=1;break;case 3:this.topLeftStrokeWidth=1,this.bottomRightStrokeWidth=2;break;default:var e=0|Math.ceil(.5*t);this.topLeftStrokeWidth=e,this.bottomRightStrokeWidth=e}},e.prototype.beginFill=function(t,e){void 0===e&&(e=1),t=+t||0,e=+e||0,this.isFillPath=!0;var i=this._refitString(t,6),r=parseInt(i.substring(0,2),16)/255,n=parseInt(i.substring(2,4),16)/255,o=parseInt(i.substring(4,6),16)/255;this.fillColor={r:r,g:n,b:o,a:e}},e.prototype._refitString=function(t,e){var i=t.toString(16),r="00000000";return r.substr(0,e-i.length)+i},e.prototype.beginGradientFill=function(t,e,i,r,n){void 0===n&&(n=null)},e.prototype.endFill=function(){this.isFillPath&&(this.isFillPath=!1),this.isStrokePath&&(this.isStrokePath=!1)},e.prototype.lineStyle=function(t,e,i,r,n,o,a,s,h){if(void 0===t&&(t=0/0),void 0===e&&(e=0),void 0===i&&(i=1),void 0===r&&(r=!1),void 0===n&&(n="normal"),void 0===o&&(o=null),void 0===a&&(a=null),void 0===s&&(s=3),0>=t)this.isStrokePath=!1,this.lineWidth=0,this.setStrokeWidth(0);else{e=+e||0,i=+i||0,this.setStrokeWidth(t),this.lineWidth=t,this.isStrokePath=!0;var c=this._refitString(e,6),l=parseInt(c.substring(0,2),16)/255,u=parseInt(c.substring(2,4),16)/255,d=parseInt(c.substring(4,6),16)/255;this.strokeColor={r:l,g:u,b:d,a:i}}},e.prototype.drawRect=function(t,i,r,n){var o=+t||0,a=-i||0;if(r=+r||0,n=+n||0,this.isFillPath){var s=new BK.Texture(e.pixelPath);this.addSprite(s,o,a,r,n),this.extendBoundsByPoint(t+r,i+n),this.updatePosition(t,i)}},e.prototype.drawRoundRect=function(t,e,i,r,n,o){},e.prototype.roundRect=function(t,e,i,r,n,o){},e.prototype.drawCircle=function(t,i,r){var n=+t||0,o=-i||0;if(r=+r||0,this.isFillPath){var a=new BK.Texture(e.circlePath);this.addSprite(a,n,o,2*r,2*r,!0),this.extendBoundsByPoint(t-r-1,i-r-1),this.extendBoundsByPoint(t+r+2,i+r+2),this.updatePosition(t+r,i)}},e.prototype.addSprite=function(t,e,i,r,n,o){void 0===o&&(o=!1);var a=new BK.Sprite(r,n,t,0,1,1,1);a.position={x:e,y:i},a.vertexColor=this.fillColor,o?a.anchor={x:.5,y:.5}:a.anchor={x:0,y:1};var s=this.targetDisplay._bkNode;s.addChild(a)},e.prototype.drawEllipse=function(t,i,r,n){var o=+t||0,a=-i||0;if(r=+r||0,n=+n||0,this.isFillPath){var s=new BK.Texture(e.circlePath),h=new BK.Sprite(r,n,s,0,1,1,1);h.position={x:o,y:a-n},h.vertexColor=this.fillColor;var c=this.targetDisplay._bkNode;c.addChild(h),this.extendBoundsByPoint(t-1,i-1),this.extendBoundsByPoint(t+r+2,i+n+2),this.updatePosition(t+r,i+.5*n)}},e.prototype.moveTo=function(t,e){this.lastX=t,this.lastY=e,this.includeLastPosition=!1,this.lastX=t,this.lastY=e},e.prototype.lineTo=function(t,i){if(this.isStrokePath){var r=t||0,n=-i||0,o=void 0!==this.lastX?this.lastX:r,a=void 0!==this.lastY?-this.lastY:n,s=Math.sqrt(Math.pow(r-o,2)+Math.pow(n-a,2)),h=void 0;h=Math.atan2(n-a,r-o)/Math.PI*180;var c=new BK.Texture(e.pixelPath,6,0,0,1,1),l=new BK.Sprite(s,this.lineWidth,c,0,1,1,1);l.position={x:o,y:a},l.rotation={x:0,y:0,z:h},l.vertexColor=this.strokeColor;var u=this.targetDisplay._bkNode;u.addChild(l),this.updatePosition(t,i)}},e.prototype.curveTo=function(t,e,i,r){},e.prototype.cubicCurveTo=function(t,e,i,r,n,o){},e.prototype.drawArc=function(t,e,i,r,n,o){},e.prototype.clear=function(){this.updatePosition(0,0),this.minX=1/0,this.minY=1/0,this.maxX=-(1/0),this.maxY=-(1/0);for(var t=this.targetDisplay._bkNode;t.children.length>0;)t.removeChild(t.children[0]);this.isFillPath=!1,this.isStrokePath=!1},e.prototype.extendBoundsByPoint=function(t,e){this.extendBoundsByX(t),this.extendBoundsByY(e)},e.prototype.extendBoundsByX=function(t){this.minX=Math.min(this.minX,t-this.topLeftStrokeWidth),this.maxX=Math.max(this.maxX,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},e.prototype.extendBoundsByY=function(t){this.minY=Math.min(this.minY,t-this.topLeftStrokeWidth),this.maxY=Math.max(this.maxY,t+this.bottomRightStrokeWidth),this.updateNodeBounds()},e.prototype.updateNodeBounds=function(){},e.prototype.updatePosition=function(t,e){this.includeLastPosition||(this.extendBoundsByPoint(this.lastX,this.lastY),this.includeLastPosition=!0),this.lastX=t,this.lastY=e,this.extendBoundsByPoint(t,e)},e.prototype.$measureContentBounds=function(t){this.minX===1/0?t.setEmpty():t.setTo(this.minX,this.minY,this.maxX-this.minX,this.maxY-this.minY)},e.prototype.$hitTest=function(t,e){for(var i=this.targetDisplay._bkNode,r=BK.Director.root.convertToWorldSpace({x:t,y:-e}),n=0;n<i.children.length;n++)if(i.children[n].hittest(r))return this.targetDisplay;return null},e.prototype.$onRemoveFromStage=function(){},e.pixelPath="GameRes://resource/pixel.png",e.circlePath="GameRes://resource/circle.png",e
}();t.BKGraphics=e,__reflect(e.prototype,"egret.BKGraphics"),"webgl"!=window.renderMode&&(t.Graphics=t.BKGraphics)}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.textValue="",t.onKeyboardComplete=t.onKeyboardComplete.bind(t),t.onKeyboardInput=t.onKeyboardInput.bind(t),t}return __extends(i,e),i.prototype.$setTextField=function(t){return this.$textfield=t,!0},i.prototype.$addToStage=function(){},i.prototype.$show=function(){BK.Editor.showKeyBoard(this.onKeyboardComplete,this.onKeyboardInput),this.dispatchEvent(new t.Event("focus"))},i.prototype.onKeyboardInput=function(e){this.textValue=e,t.Event.dispatchEvent(this,"updateText",!1)},i.prototype.onKeyboardComplete=function(t){this.$textfield.text=t,this.$hide()},i.prototype.$hide=function(){this.dispatchEvent(new t.Event("blur"))},i.prototype.$getText=function(){return this.textValue||(this.textValue=""),this.textValue},i.prototype.$setText=function(t){return this.textValue=t,!0},i.prototype.$setColor=function(t){return!0},i.prototype.$onBlur=function(){},i.prototype.$removeFromStage=function(){},i.prototype.$resetStageText=function(){},i}(t.EventDispatcher);t.BKHTML5StageText=e,__reflect(e.prototype,"egret.BKHTML5StageText",["egret.StageText"]),t.StageText=e}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i;!function(e){function i(t){if(BK.FileUtil.isFileExist(a)){var e=BK.FileUtil.readFile(a).readAsString();if(e){var i=JSON.parse(e);return i?i[t]:void 0}}}function r(t,e){var i=BK.FileUtil.readFile(a).readAsString(),r={};if(i){var n=JSON.parse(i);n&&(r=n)}r[t]=e;var o=JSON.stringify(r);return BK.FileUtil.writeFile(a,o),!0}function n(t){var e=BK.FileUtil.readFile(a).readAsString();if(e){var i=JSON.parse(e);if(i&&i[t]){delete i[t];var r=JSON.stringify(i);BK.FileUtil.writeFile(a,r)}}}function o(){if(BK.FileUtil.isFileExist(a)){var t={},e=JSON.stringify(t);BK.FileUtil.writeFile(a,e)}}var a="GameSandBox://resource/localStorage";t.localStorage.setItem=r,t.localStorage.getItem=i,t.localStorage.removeItem=n,t.localStorage.clear=o}(i=e.BKlocalStorage||(e.BKlocalStorage={}))}(e=t.localStorage||(t.localStorage={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var i=e.call(this,new BK.Mesh(t.emptyTexture,[{x:0,y:0,z:0,r:1,g:1,b:1,a:1,u:0,v:1},{x:0,y:0,z:0,r:1,g:1,b:1,a:1,u:1,v:1},{x:0,y:-0,z:0,r:1,g:1,b:1,a:1,u:0,v:0}],[0,1,2]))||this;return i._textureDirty=!0,i._boundsDirty=!0,i._bounds=new t.Rectangle,i.$bitmapData=null,i.$texture=null,i.$renderNode=new t.sys.MeshNode,i._bkMesh=i._bkNode,i}return __extends(i,e),Object.defineProperty(i.prototype,"texture",{get:function(){return this.$texture},set:function(t){this.$texture!==t&&this.$setTexture(t)},enumerable:!0,configurable:!0}),i.prototype.$setTexture=function(t){this.$texture=t,this._transformDirty=!0,this.$texture?(this.$bitmapData=this.$texture.bitmapData,this.$bitmapData.bkTexture?this._bkMesh.setTexture(this.$bitmapData.bkTexture):(this.$bitmapData=null,this._bkMesh.setTexture({}))):(this.$bitmapData=null,this._bkMesh.setTexture({}))},i.prototype.$updateVertices=function(){this._boundsDirty=!0,this.$renderDirty=!0,this.$renderNode=new t.sys.MeshNode},i.prototype.$measureContentBounds=function(t){if(this._boundsDirty){this._boundsDirty=!1;var e=this.$renderNode,i=e.vertices;if(i.length){this._bounds.setTo(Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var r=0,n=i.length;n>r;r+=2){var o=i[r],a=i[r+1];this._bounds.x>o&&(this._bounds.x=o),this._bounds.width<o&&(this._bounds.width=o),this._bounds.y>a&&(this._bounds.y=a),this._bounds.height<a&&(this._bounds.height=a)}this._bounds.width-=this._bounds.x,this._bounds.height-=this._bounds.y}else this._bounds.setTo(0,0,0,0);e.bounds.copyFrom(this._bounds)}t.copyFrom(this._bounds)},i.prototype.$updateRenderNode=function(){var t=this.$renderNode,e=t.vertices,i=t.uvs,r=this._bkMesh.getVertices();if(r||(r=[]),r.length!==e.length/2){for(var n=r.length,o=e.length/2;o>n;++n)r[n]={};for(var a=this.$texture.$rotated,s=this.$texture.$bitmapX,h=this.$texture.$bitmapY,c=this.$texture.$bitmapWidth,l=this.$texture.$bitmapHeight,u=this.$texture.$sourceWidth,d=this.$texture.$sourceHeight,p=s/u,f=a?l/u:c/u,g=h/d,v=a?c/d:l/d,n=0,y=0,o=r.length;o>n;++n,y+=2){var x=r[n],b=i[y],$=i[y+1];x.x=e[y],x.y=-e[y+1],x.z=this._bkNode.zOrder,x.r=1,x.g=1,x.b=1,x.a=1,a?(x.u=p+(1-$)*f,x.v=1-(g+b*v)):(x.u=p+b*f,x.v=1-(g+$*v))}}else for(var n=0,y=0,o=r.length;o>n;++n,y+=2){var x=r[n];x.x=e[y],x.y=-e[y+1]}this._bkMesh.setVerticesAndIndices(r,t.indices)},i}(t.BKDisplayObject);t.BKMesh=e,__reflect(e.prototype,"egret.BKMesh"),"webgl"!=window.renderMode&&(t.Mesh=t.BKMesh)}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(i){var r=e.call(this,new BK.Sprite(0,0,{},0,1,1,1))||this;return r._size={width:0,height:0},r.$texture=null,r.offsetPoint=t.Point.create(0,0),r.$movieClipData=null,r.frames=null,r.$totalFrames=0,r.frameLabels=null,r.$frameLabelStart=0,r.$frameLabelEnd=0,r.frameEvents=null,r.frameIntervalTime=0,r.$eventPool=null,r.$isPlaying=!1,r.isStopped=!0,r.playTimes=0,r.$currentFrameNum=0,r.$nextFrameNum=1,r.displayedKeyFrameNum=0,r.passedTime=0,r.$frameRate=0/0,r.$bitmapData=null,r.$scale9Grid=null,r.lastTime=0,r._bkSprite=r._bkNode,r.$smoothing=t.Bitmap.defaultSmoothing,r.setMovieClipData(i),r}return __extends(i,e),i.prototype._updateBKNodeMatrix=function(){if(this.$texture){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,i=t.tx,r=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY-this._size.height;(0!==n||0!==o)&&(i-=t.a*n+t.c*o,r-=t.b*n+t.d*o);var a=this.frames[this.$currentFrameNum-1];e.set(t.a,-t.b,-t.c,t.d,i+a.x,-r-a.y)}},Object.defineProperty(i.prototype,"smoothing",{get:function(){return this.$smoothing},set:function(t){t!=this.$smoothing&&(this.$smoothing=t)},enumerable:!0,configurable:!0}),i.prototype.$init=function(){this.$reset();var t=this.$movieClipData;t&&t.$isDataValid()&&(this.frames=t.frames,this.$totalFrames=t.numFrames,this.frameLabels=t.labels,this.frameEvents=t.events,this.$frameRate=t.frameRate,this.frameIntervalTime=1e3/this.$frameRate,this._initFrame())},i.prototype.$reset=function(){this.frames=null,this.playTimes=0,this.$isPlaying=!1,this.setIsStopped(!0),this.$currentFrameNum=0,this.$nextFrameNum=1,this.displayedKeyFrameNum=0,this.passedTime=0,this.$eventPool=[]},i.prototype._initFrame=function(){this.$movieClipData.$isTextureValid()&&(this.advanceFrame(),this.constructFrame())},i.prototype.$updateRenderNode=function(){this.frames[this.$currentFrameNum-1].res&&(this.$texture?(this._transformDirty=!0,this.$bitmapData=this.$texture.bitmapData,this.$bitmapData.bkTexture?(this._bkSprite.setTexture(this.$bitmapData.bkTexture),this._bkSprite.adjustTexturePosition(this.$texture.$bitmapX,this.$texture.$sourceHeight-(this.$texture.$bitmapY+this.$texture.$bitmapHeight),this.$texture.$bitmapWidth,this.$texture.$bitmapHeight,this.$texture.$rotated),this._size.width=this.$texture.$bitmapWidth,this._size.height=this.$texture.$bitmapHeight,this._bkSprite.size=this._size):(this.$bitmapData=null,this._bkSprite.setTexture({}))):(this.$bitmapData=null,this._bkSprite.setTexture({})))},i.prototype.$measureContentBounds=function(t){var e=this.$texture;if(e){var i=this.offsetPoint.x,r=this.offsetPoint.y,n=e.$getTextureWidth(),o=e.$getTextureHeight();t.setTo(i,r,n,o)}else t.setEmpty()},i.prototype.$onAddToStage=function(t,i){e.prototype.$onAddToStage.call(this,t,i),this.$isPlaying&&this.$totalFrames>1&&this.setIsStopped(!1)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.setIsStopped(!0)},i.prototype.getFrameLabelByName=function(t,e){void 0===e&&(e=!1),e&&(t=t.toLowerCase());var i=this.frameLabels;if(i)for(var r=null,n=0;n<i.length;n++)if(r=i[n],e?r.name.toLowerCase()==t:r.name==t)return r;return null},i.prototype.getFrameStartEnd=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if(i=e[r],t==i.name){this.$frameLabelStart=i.frame,this.$frameLabelEnd=i.end;break}},i.prototype.getFrameLabelByFrame=function(t){var e=this.frameLabels;if(e)for(var i=null,r=0;r<e.length;r++)if(i=e[r],i.frame==t)return i;return null},i.prototype.getFrameLabelForFrame=function(t){var e=null,i=null,r=this.frameLabels;if(r)for(var n=0;n<r.length;n++){if(i=r[n],i.frame>t)return e;e=i}return e},i.prototype.play=function(t){void 0===t&&(t=0),this.$isPlaying=!0,this.setPlayTimes(t),this.$totalFrames>1&&this.$stage&&this.setIsStopped(!1)},i.prototype.stop=function(){this.$isPlaying=!1,this.setIsStopped(!0)},i.prototype.prevFrame=function(){this.gotoAndStop(this.$currentFrameNum-1)},i.prototype.nextFrame=function(){this.gotoAndStop(this.$currentFrameNum+1)},i.prototype.gotoAndPlay=function(e,i){void 0===i&&(i=0),(0==arguments.length||arguments.length>2)&&t.$error(1022,"MovieClip.gotoAndPlay()"),"string"==typeof e?this.getFrameStartEnd(e):(this.$frameLabelStart=0,this.$frameLabelEnd=0),this.play(i),this.gotoFrame(e)},i.prototype.gotoAndStop=function(e){1!=arguments.length&&t.$error(1022,"MovieClip.gotoAndStop()"),this.stop(),this.gotoFrame(e)},i.prototype.gotoFrame=function(e){var i;"string"==typeof e?i=this.getFrameLabelByName(e).frame:(i=parseInt(e+"",10),i!=e&&t.$error(1022,"Frame Label Not Found")),1>i?i=1:i>this.$totalFrames&&(i=this.$totalFrames),i!=this.$nextFrameNum&&(this.$nextFrameNum=i,this.advanceFrame(),this.constructFrame(),this.handlePendingEvent())},i.prototype.advanceTime=function(e){var i=this,r=e-i.lastTime;i.lastTime=e;var n=i.frameIntervalTime,o=i.passedTime+r;i.passedTime=o%n;var a=o/n;if(1>a)return!1;for(;a>=1;){if(a--,i.$nextFrameNum++,i.$nextFrameNum>i.$totalFrames||i.$frameLabelStart>0&&i.$nextFrameNum>i.$frameLabelEnd)if(-1==i.playTimes)i.$eventPool.push(t.Event.LOOP_COMPLETE),i.$nextFrameNum=1;else{if(i.playTimes--,!(i.playTimes>0)){i.$nextFrameNum=i.$totalFrames,i.$eventPool.push(t.Event.COMPLETE),i.stop();break}i.$eventPool.push(t.Event.LOOP_COMPLETE),i.$nextFrameNum=1}i.$currentFrameNum==i.$frameLabelEnd&&(i.$nextFrameNum=i.$frameLabelStart),i.advanceFrame()}return i.constructFrame(),i.handlePendingEvent(),!1},i.prototype.advanceFrame=function(){this.$currentFrameNum=this.$nextFrameNum;var e=this.frameEvents[this.$nextFrameNum];e&&""!=e&&t.MovieClipEvent.dispatchMovieClipEvent(this,t.MovieClipEvent.FRAME_LABEL,e)},i.prototype.constructFrame=function(){var t=this,e=t.$currentFrameNum;if(t.displayedKeyFrameNum!=e){var i=t.$movieClipData.getTextureByFrame(e);t.$texture=i,t.$movieClipData.$getOffsetByFrame(e,t.offsetPoint),t.displayedKeyFrameNum=e,t.$renderDirty=!0;var r=t.$parent;r&&!r.$cacheDirty&&(r.$cacheDirty=!0,r.$cacheDirtyUp());var n=t.$maskedObject;n&&!n.$cacheDirty&&(n.$cacheDirty=!0,n.$cacheDirtyUp())}},i.prototype.$renderFrame=function(){var t=this;t.$texture=t.$movieClipData.getTextureByFrame(t.$currentFrameNum),t.$renderDirty=!0;var e=t.$parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());var i=t.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())},i.prototype.handlePendingEvent=function(){if(0!=this.$eventPool.length){this.$eventPool.reverse();for(var e=this.$eventPool,i=e.length,r=!1,n=!1,o=0;i>o;o++){var a=e.pop();a==t.Event.LOOP_COMPLETE?n=!0:a==t.Event.COMPLETE?r=!0:this.dispatchEventWith(a)}n&&this.dispatchEventWith(t.Event.LOOP_COMPLETE),r&&this.dispatchEventWith(t.Event.COMPLETE)}},Object.defineProperty(i.prototype,"totalFrames",{get:function(){return this.$totalFrames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentFrame",{get:function(){return this.$currentFrameNum},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentFrameLabel",{get:function(){var t=this.getFrameLabelByFrame(this.$currentFrameNum);return t&&t.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentLabel",{get:function(){var t=this.getFrameLabelForFrame(this.$currentFrameNum);return t?t.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"frameRate",{get:function(){return this.$frameRate},set:function(t){t!=this.$frameRate&&(this.$frameRate=t,this.frameIntervalTime=1e3/this.$frameRate)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this.$isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"movieClipData",{get:function(){return this.$movieClipData},set:function(t){this.setMovieClipData(t)},enumerable:!0,configurable:!0}),i.prototype.setMovieClipData=function(t){this.$movieClipData!=t&&(this.$movieClipData=t,this.$init())},i.prototype.setPlayTimes=function(t){(0>t||t>=1)&&(this.playTimes=0>t?-1:Math.floor(t))},i.prototype.setIsStopped=function(e){this.isStopped!=e&&(this.isStopped=e,e?t.ticker.$stopTick(this.advanceTime,this):(this.playTimes=0==this.playTimes?1:this.playTimes,this.lastTime=t.getTimer(),t.ticker.$startTick(this.advanceTime,this)))},i}(t.BKDisplayObject);t.BKMovieClip=e,__reflect(e.prototype,"egret.BKMovieClip"),"webgl"!=window.renderMode&&(t.MovieClip=e)}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(r){var n=e.call(this)||this;n.stage=new t.Stage,n._mainTicker=BK.Director.ticker,n._viewRect=new t.Rectangle,n._touch=new t.sys.TouchHandler(n.stage),n._displayList=[],i.instance=n,n._options=r,BK.Director.root.addChild(n.stage._bkNode),t.lifecycle.stage=n.stage,t.sys.$TempStage=n.stage,n.stage.$screen=n,n.stage.maxTouches=10,n.stage.frameRate=n._options.frameRate,n.stage.orientation=n._options.orientation,n.stage.scaleMode=n._options.scaleMode,n._mainTicker.add(function(){n._touchHandler(),t.ticker.update(),t.ticker.callLaters();for(var e=0,i=n._displayList;e<i.length;e++){var r=i[e];r.$getRenderNode()}},n),n.updateScreenSize(),n.updateMaxTouches();var o=new BK.Texture("GameRes://resource/pixel.png"),a=new BK.Sprite(0,0,o,0,1,1,1),s=r.background.toString(16),h=parseInt(s.substring(0,2),16)/255,c=parseInt(s.substring(2,4),16)/255,l=parseInt(s.substring(4,6),16)/255;a.vertexColor={r:h,g:c,b:l,a:1},a.size={width:n.stage.stageWidth,height:n.stage.stageHeight},a.position={x:0,y:-n.stage.stageHeight},BK.Director.root.addChild(a),a.zOrder=1;var u,d=n._options.entryClassName;if(d&&(u=t.getDefinitionByName(d)),u){var p=new u;p.addChild&&n.stage.addChild(p)}return n}return __extends(i,e),i.prototype._touchHandler=function(){var t=BK.TouchEvent.getTouchEvent();if(t&&0!==t.length){for(var e=0,i=t;e<i.length;e++){var r=i[e],n=r.id,o=(BK.Director.screenPixelSize,BK.Director.root.convertToNodeSpace(r)),a=o.x,s=-o.y;1===r.status?this._touch.onTouchEnd(a,s,n):2===r.status?this._touch.onTouchBegin(a,s,n):3===r.status&&this._touch.onTouchMove(a,s,n)}BK.TouchEvent.updateTouchStatus()}},i.prototype.updateScreenSize=function(){var e=BK.Director.screenPixelSize,i=e.width,r=e.height;t.Capabilities.$boundingClientWidth=i,t.Capabilities.$boundingClientHeight=r;var n=t.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,i,r,this._options.contentWidth,this._options.contentHeight),o=n.stageWidth,a=n.stageHeight,s=n.displayWidth,h=n.displayHeight,c=(r-h)/2,l=(i-s)/2;this.stage.$stageWidth=o,this.stage.$stageHeight=a,BK.Director.root.position={x:l,y:BK.Director.screenPixelSize.height-c},BK.Director.root.scale={x:s/o,y:h/a},this._viewRect.setTo(l,c,o,a),this.stage.dispatchEventWith(t.Event.RESIZE)},i.prototype.setContentSize=function(t,e){var i=this._options;i.contentWidth=t,i.contentHeight=e,this.updateScreenSize()},i.prototype.updateMaxTouches=function(){this._touch.$initMaxTouches()},i}(t.HashObject);t.BKPlayer=e,__reflect(e.prototype,"egret.BKPlayer",["egret.sys.Screen"])}(egret||(egret={}));var egret;!function(t){var e=function(){function t(t,e){this.surface={},this.context={}}return Object.defineProperty(t.prototype,"width",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return 0},enumerable:!0,configurable:!0}),t.prototype.resize=function(t,e,i){},t.prototype.getPixels=function(t,e,i,r){return void 0===i&&(i=1),void 0===r&&(r=1),[]},t.prototype.toDataURL=function(t,e){return""},t.prototype.clear=function(){},t.prototype.destroy=function(){},t}();t.BKRenderBuffer=e,__reflect(e.prototype,"egret.BKRenderBuffer",["egret.sys.RenderBuffer"]),t.sys.RenderBuffer=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.drawToTexture=function(e,i,r){if(void 0===r&&(r=1),i&&(0==i.width||0==i.height))return!1;var n=i||e.$getOriginalBounds();if(0==n.width||0==n.height)return!1;r/=t.$TextureScaleFactor;var o=(n.x+n.width)*r,a=(n.y+n.height)*r;i&&(o=n.width*r,a=n.height*r);var s,h=e._bkNode,c=(h.parent,BK.Texture.createTexture(o,a));e.invalidUpdate();var l=e.$getMatrix().clone(),u=t.Matrix.create();t.lifecycle.stage.stageHeight;if(u.translate(-n.x,-n.y-n.height),e.$setMatrix(u),e.$getRenderNode(),i){var d=new BK.ClipRectNode(0,0,n.width,n.height);d.position={x:0,y:0};var p=h.parent;p&&h.removeFromParent(),d.addChild(h);var f=BK.Texture.createTexture(n.width,n.height);BK.Render.renderToTexture(d,f),h.removeFromParent(),p&&p.addChild(h),e.$setMatrix(l),e.$getRenderNode(),s=new t.BKBitmapData(f,!0)}else BK.Render.renderToTexture(h,c),e.$setMatrix(l),e.$getRenderNode(),s=new t.BKBitmapData(c,!0);return this._setBitmapData(s),this.$bitmapData.width=o,this.$bitmapData.height=a,this.$initData(0,0,o,a,0,0,o,a,o,a),!0},i.prototype.getPixel32=function(t,e){var i;return i},i.prototype.dispose=function(){e.prototype.dispose.call(this),this.$renderBuffer=null},i}(t.Texture);t.BKRenderTexture=e,__reflect(e.prototype,"egret.BKRenderTexture"),"webgl"!=window.renderMode&&(t.RenderTexture=t.BKRenderTexture)}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.$graphics=new t.Graphics,i.$graphics.$setTarget(i),i}return __extends(i,e),Object.defineProperty(i.prototype,"graphics",{get:function(){return this.$graphics},enumerable:!0,configurable:!0}),i.prototype.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},i.prototype.$hitTest=function(t,i){var r=e.prototype.$hitTest.call(this,t,i);return r==this&&(r=this.$graphics.$hitTest(t,i)),r},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},i}(t.BKDisplayObject);t.BKShape=e,__reflect(e.prototype,"egret.BKShape"),"webgl"!=window.renderMode&&(t.Shape=t.BKShape)}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.type=t.Sound.EFFECT,i}return __extends(i,e),i.prototype.load=function(e){this.url=e,BK.FileUtil.isFileExist(this.url)?t.$callAsync(t.Event.dispatchEvent,t.Event,this,t.Event.COMPLETE):t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,this,t.IOErrorEvent.IO_ERROR)},i.prototype.play=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var r=new t.BKSoundChannel;return r.$loops=i,r.$startTime=e,r.$type=this.type,r.$url=this.url,r.$play(),r},i.prototype.close=function(){},i.MUSIC="music",i.EFFECT="effect",i}(t.EventDispatcher);t.BKSound=e,__reflect(e.prototype,"egret.BKSound",["egret.Sound"]),t.Sound=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.$play=function(){var e;switch(this.$type){case t.Sound.MUSIC:e=0;break;case t.Sound.EFFECT:e=1}var i=0===this.$loops?-1:this.$loops,r=this.$url.indexOf("GameRes://")>=0?this.$url:"GameRes://"+this.$url;this._bkAudio=new BK.Audio(e,r,i,0),this._bkAudio.startMusic()},i.prototype.stop=function(){this._bkAudio.stopMusic()},i}(t.EventDispatcher);t.BKSoundChannel=e,__reflect(e.prototype,"egret.BKSoundChannel",["egret.SoundChannel","egret.IEventDispatcher"])}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.$graphics=new t.Graphics,i.$graphics.$setTarget(i),i}return __extends(i,e),Object.defineProperty(i.prototype,"graphics",{get:function(){return this.$graphics},enumerable:!0,configurable:!0}),i.prototype.$hitTest=function(e,i){if(!this.$visible)return null;var r=this.$getInvertedConcatenatedMatrix(),n=r.a*e+r.c*i+r.tx,o=r.b*e+r.d*i+r.ty,a=this.$scrollRect?this.$scrollRect:this.$maskRect;if(a&&!a.contains(n,o))return null;if(this.$mask&&!this.$mask.$hitTest(e,i))return null;for(var s=this.$children,h=!1,c=null,l=s.length-1;l>=0;l--){var u=s[l];if(!u.$maskedObject&&(c=u.$hitTest(e,i))){if(h=!0,c.$touchEnabled)break;c=null}}return c?this.$touchChildren?c:this:h?this:(c=t.DisplayObject.prototype.$hitTest.call(this,e,i),c&&(c=this.$graphics.$hitTest(e,i)),c)},i.prototype.$measureContentBounds=function(t){this.$graphics.$measureContentBounds(t)},i.prototype.$onRemoveFromStage=function(){e.prototype.$onRemoveFromStage.call(this),this.$graphics&&this.$graphics.$onRemoveFromStage()},i}(t.BKDisplayObjectContainer);t.BKSprite=e,__reflect(e.prototype,"egret.BKSprite"),"webgl"!=window.renderMode&&(t.Sprite=t.BKSprite)}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.$stageWidth=0,i.$stageHeight=0,i.$scaleMode=t.StageScaleMode.SHOW_ALL,i.$orientation=t.OrientationMode.AUTO,i.$maxTouches=99,i.$stage=i,i.$nestLevel=1,i}return __extends(i,e),Object.defineProperty(i.prototype,"frameRate",{get:function(){return t.ticker.$frameRate},set:function(e){t.ticker.$setFrameRate(e)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stageWidth",{get:function(){return this.$stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"stageHeight",{get:function(){return this.$stageHeight},enumerable:!0,configurable:!0}),i.prototype.invalidate=function(){t.sys.$invalidateRenderFlag=!0},i.prototype.registerImplementation=function(e,i){t.registerImplementation(e,i)},i.prototype.getImplementation=function(e){return t.getImplementation(e)},Object.defineProperty(i.prototype,"scaleMode",{get:function(){return this.$scaleMode},set:function(t){this.$scaleMode!=t&&(this.$scaleMode=t,this.$screen.updateScreenSize())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"orientation",{get:function(){return this.$orientation},set:function(t){this.$orientation!=t&&(this.$orientation=t,this.$screen.updateScreenSize())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"textureScaleFactor",{get:function(){return t.$TextureScaleFactor},set:function(e){t.$TextureScaleFactor=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxTouches",{get:function(){return this.$maxTouches},set:function(t){this.$maxTouches!=t&&(this.$maxTouches=t,this.$screen.updateMaxTouches())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dirtyRegionPolicy",{get:function(){return null},set:function(t){},enumerable:!0,configurable:!0}),i.prototype.setContentSize=function(t,e){this.$screen.setContentSize(t,e)},i}(t.BKDisplayObjectContainer);t.BKStage=e,__reflect(e.prototype,"egret.BKStage"),"webgl"!=window.renderMode&&(t.Stage=t.BKStage)}(egret||(egret={}));var egret;!function(t){var e=function(){function t(){}return t.prototype.render=function(t,e,i,r){return 0},t.prototype.drawNodeToBuffer=function(t,e,i,r){},t}();t.BKSystemRenderer=e,__reflect(e.prototype,"egret.BKSystemRenderer",["egret.sys.SystemRenderer"])}(egret||(egret={}));var egret;!function(t){function e(e,i,r){r=r||{};var n=null==r.italic?i[16]:r.italic,o=null==r.bold?i[15]:r.bold,a=null==r.size?i[0]:r.size,s=r.fontFamily||i[8]||t.TextField.default_fontFamily;return t.sys.measureText(e,s,a,o,n)}function i(t,e){if(c.length>0){var i=c.pop();return i.updateText(e,t),i}var r=new BK.TextNode(e,t);return r}function r(t,e,i,r,n){a||(a=new BK.TextNode(h,"")),h.fontSize=i,h.bold=r?1:0,h.italic=n?1:0;var o=a.measureTextSize(h,t);return o.contentWidth}var n=new RegExp("(?=[\\u00BF-\\u1FFF\\u2C00-\\uD7FF]|\\b|\\s)(?![。，！、》…）)}”】\\.\\,\\!\\?\\]\\:])"),o=function(r){function o(){var e=r.call(this)||this;return e.$inputEnabled=!1,e.inputUtils=null,e.graphicsNode=null,e.isFlow=!1,e.textArr=[],e.linesArr=[],e.$isTyping=!1,e._bkNodes=[],e.$TextField={0:t.TextField.default_size,1:0,2:t.TextField.default_textColor,3:0/0,4:0/0,5:0,6:0,7:0,8:t.TextField.default_fontFamily,9:"left",10:"top",11:"#ffffff",12:"",13:"",14:[],15:!1,16:!1,17:!0,18:!1,19:!1,20:!1,21:0,22:0,23:0,24:t.TextFieldType.DYNAMIC,25:0,26:"#000000",27:0,28:-1,29:0,30:!1,31:!1,32:0,33:!1,34:16777215,35:null,36:null,37:t.TextFieldInputType.TEXT},e}return __extends(o,r),o.prototype.isInput=function(){return this.$TextField[24]==t.TextFieldType.INPUT},o.prototype.$setTouchEnabled=function(t){r.prototype.$setTouchEnabled.call(this,t),this.isInput()&&(this.$inputEnabled=!0)},Object.defineProperty(o.prototype,"fontFamily",{get:function(){return this.$TextField[8]},set:function(t){this.$setFontFamily(t)},enumerable:!0,configurable:!0}),o.prototype.$setFontFamily=function(t){var e=this.$TextField;return e[8]==t?!1:(e[8]=t,this.invalidateFontString(),!0)},Object.defineProperty(o.prototype,"size",{get:function(){return this.$TextField[0]},set:function(t){this.$setSize(t)},enumerable:!0,configurable:!0}),o.prototype.$setSize=function(t){t=+t||0;var e=this.$TextField;return e[0]==t?!1:(e[0]=t,this.invalidateFontString(),this._transformDirty=!0,!0)},Object.defineProperty(o.prototype,"bold",{get:function(){return this.$TextField[15]},set:function(t){this.$setBold(t)},enumerable:!0,configurable:!0}),o.prototype.$setBold=function(t){t=!!t;var e=this.$TextField;return t==e[15]?!1:(e[15]=t,this.invalidateFontString(),this._transformDirty=!0,!0)},Object.defineProperty(o.prototype,"italic",{get:function(){return this.$TextField[16]},set:function(t){this.$setItalic(t)},enumerable:!0,configurable:!0}),o.prototype.$setItalic=function(t){t=!!t;var e=this.$TextField;return t==e[16]?!1:(e[16]=t,this.invalidateFontString(),this._transformDirty=!0,!0)},o.prototype.invalidateFontString=function(){this.$TextField[17]=!0,this.$invalidateTextField()},Object.defineProperty(o.prototype,"textAlign",{get:function(){return this.$TextField[9]},set:function(t){this.$setTextAlign(t)},enumerable:!0,configurable:!0}),o.prototype.$setTextAlign=function(t){var e=this.$TextField;return e[9]==t?!1:(e[9]=t,this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"verticalAlign",{get:function(){return this.$TextField[10]},set:function(t){this.$setVerticalAlign(t)},enumerable:!0,configurable:!0}),o.prototype.$setVerticalAlign=function(t){var e=this.$TextField;return e[10]==t?!1:(e[10]=t,this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"lineSpacing",{get:function(){return this.$TextField[1]},set:function(t){this.$setLineSpacing(t)},enumerable:!0,configurable:!0}),o.prototype.$setLineSpacing=function(t){t=+t||0;var e=this.$TextField;return e[1]==t?!1:(e[1]=t,this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"textColor",{get:function(){return this.$TextField[2]},set:function(t){this.$setTextColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setTextColor=function(t){t=0|+t;var e=this.$TextField;return e[2]==t?!1:(e[2]=t,this.inputUtils&&this.inputUtils._setColor(this.$TextField[2]),this.$invalidateTextField(),!0)},Object.defineProperty(o.prototype,"wordWrap",{get:function(){return this.$TextField[19]},set:function(t){this.$setWordWrap(t)},enumerable:!0,configurable:!0}),o.prototype.$setWordWrap=function(t){t=!!t;var e=this.$TextField;t!=e[19]&&(e[20]||(e[19]=t,this.$invalidateTextField()))},Object.defineProperty(o.prototype,"type",{get:function(){return this.$TextField[24]},set:function(t){this.$setType(t)},enumerable:!0,configurable:!0}),o.prototype.$setType=function(e){var i=this.$TextField;return i[24]!=e?(i[24]=e,e==t.TextFieldType.INPUT?(isNaN(i[3])&&this.$setWidth(100),isNaN(i[4])&&this.$setHeight(30),this.$setTouchEnabled(!0),null==this.inputUtils&&(this.inputUtils=new t.InputController),this.inputUtils.init(this),this.$invalidateTextField(),this.$stage&&this.inputUtils._addStageText()):(this.inputUtils&&(this.inputUtils._removeStageText(),this.inputUtils=null),this.$setTouchEnabled(!1)),!0):!1},Object.defineProperty(o.prototype,"inputType",{get:function(){return this.$TextField[37]},set:function(t){this.$TextField[37]=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"text",{get:function(){return this.$getText()},set:function(t){this.$setText(t)},enumerable:!0,configurable:!0}),o.prototype.$getText=function(){return this.$TextField[24]==t.TextFieldType.INPUT?this.inputUtils._getText():this.$TextField[13]},o.prototype.$setBaseText=function(t){null==t&&(t=""),t=t.toString(),this.isFlow=!1;var e=this.$TextField;if(e[13]!=t){this.$invalidateTextField(),e[13]=t;var i="";return i=e[20]?this.changeToPassText(t):t,this.setMiddleStyle([{text:i}]),this._transformDirty=!0,!0}return!1},o.prototype.$setText=function(t){null==t&&(t="");var e=this.$setBaseText(t);return this.inputUtils&&this.inputUtils._setText(this.$TextField[13]),e},Object.defineProperty(o.prototype,"displayAsPassword",{get:function(){return this.$TextField[20]},set:function(t){this.$setDisplayAsPassword(t)},enumerable:!0,configurable:!0}),o.prototype.$setDisplayAsPassword=function(t){var e=this.$TextField;if(e[20]!=t){e[20]=t,this.$invalidateTextField();var i="";return i=t?this.changeToPassText(e[13]):e[13],this.setMiddleStyle([{text:i}]),!0}return!1},Object.defineProperty(o.prototype,"strokeColor",{get:function(){return this.$TextField[25]},set:function(t){t=+t||0,this.$setStrokeColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setStrokeColor=function(e){var i=this.$TextField;return i[25]!=e?(this.$invalidateTextField(),i[25]=e,i[26]=t.toColorString(e),!0):!1},Object.defineProperty(o.prototype,"stroke",{get:function(){return this.$TextField[27]},set:function(t){this.$setStroke(t)},enumerable:!0,configurable:!0}),o.prototype.$setStroke=function(t){return this.$TextField[27]!=t?(this.$invalidateTextField(),this.$TextField[27]=t,this._transformDirty=!0,!0):!1},Object.defineProperty(o.prototype,"maxChars",{get:function(){return this.$TextField[21]},set:function(t){this.$setMaxChars(t)},enumerable:!0,configurable:!0}),o.prototype.$setMaxChars=function(t){return this.$TextField[21]!=t?(this.$TextField[21]=t,!0):!1},Object.defineProperty(o.prototype,"scrollV",{get:function(){return Math.min(Math.max(this.$TextField[28],1),this.maxScrollV)},set:function(t){this.$TextField[28]=Math.max(t,1),this.$invalidateTextField()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"maxScrollV",{get:function(){return this.$getLinesArr(),Math.max(this.$TextField[29]-t.TextFieldUtils.$getScrollNum(this)+1,1)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionBeginIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionEndIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"caretIndex",{get:function(){return 0},enumerable:!0,configurable:!0}),o.prototype.$setSelection=function(t,e){return!1},o.prototype.$getLineHeight=function(){return this.$TextField[1]+this.$TextField[0]},Object.defineProperty(o.prototype,"numLines",{get:function(){return this.$getLinesArr(),this.$TextField[29]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"multiline",{get:function(){return this.$TextField[30]},set:function(t){this.$setMultiline(t)},enumerable:!0,configurable:!0}),o.prototype.$setMultiline=function(t){return this.$TextField[30]=t,this.$invalidateTextField(),!0},Object.defineProperty(o.prototype,"restrict",{get:function(){var t=this.$TextField,e=null;return null!=t[35]&&(e=t[35]),null!=t[36]&&(null==e&&(e=""),e+="^"+t[36]),e},set:function(t){var e=this.$TextField;if(null==t)e[35]=null,e[36]=null;else{for(var i=-1;i<t.length&&(i=t.indexOf("^",i),0!=i)&&i>0&&"\\"==t.charAt(i-1);)i++;0==i?(e[35]=null,e[36]=t.substring(i+1)):i>0?(e[35]=t.substring(0,i),e[36]=t.substring(i+1)):(e[35]=t,e[36]=null)}},enumerable:!0,configurable:!0}),o.prototype.$setWidth=function(t){var e=this.$TextField;
if(isNaN(t)){if(isNaN(e[3]))return!1;e[3]=0/0}else{if(e[3]==t)return!1;e[3]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),this._transformDirty=!0,!0)},o.prototype.$setHeight=function(t){var e=this.$TextField;if(isNaN(t)){if(isNaN(e[4]))return!1;e[4]=0/0}else{if(e[4]==t)return!1;e[4]=t}return t=+t,0>t?!1:(this.$invalidateTextField(),this._transformDirty=!0,!0)},o.prototype.$getWidth=function(){var t=this.$TextField;return isNaN(t[3])?this.$getContentBounds().width:t[3]},o.prototype.$getHeight=function(){var t=this.$TextField;return isNaN(t[4])?this.$getContentBounds().height:t[4]},Object.defineProperty(o.prototype,"border",{get:function(){return this.$TextField[31]},set:function(t){this.$setBorder(t)},enumerable:!0,configurable:!0}),o.prototype.$setBorder=function(t){this.$TextField[31]=!!t},Object.defineProperty(o.prototype,"borderColor",{get:function(){return this.$TextField[32]},set:function(t){this.$setBorderColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setBorderColor=function(t){this.$TextField[32]=+t||0},Object.defineProperty(o.prototype,"background",{get:function(){return this.$TextField[33]},set:function(t){this.$setBackground(t)},enumerable:!0,configurable:!0}),o.prototype.$setBackground=function(t){this.$TextField[33]=t},Object.defineProperty(o.prototype,"backgroundColor",{get:function(){return this.$TextField[34]},set:function(t){this.$setBackgroundColor(t)},enumerable:!0,configurable:!0}),o.prototype.$setBackgroundColor=function(t){this.$TextField[34]=t},o.prototype.fillBackground=function(e){var i=this.graphicsNode;i&&i.clear();var r=this.$TextField;if(r[33]||r[31]||e&&e.length>0){if(!i){i=this.graphicsNode=new t.sys.GraphicsNode;var n=new t.sys.GroupNode;n.addNode(i),n.addNode(this.textNode),this.$renderNode=n}var o=void 0,a=void 0;if(r[33]&&(o=i.beginFill(r[34]),o.drawRect(0,0,this.$getWidth(),this.$getHeight())),r[31]&&(a=i.lineStyle(1,r[32]),a.drawRect(0,0,this.$getWidth()-1,this.$getHeight()-1)),e&&e.length>0)for(var s=r[2],h=-1,c=e.length,l=0;c>l;l+=4){var u=e[l],d=e[l+1],p=e[l+2],f=e[l+3]||s;(0>h||h!=f)&&(h=f,a=i.lineStyle(2,f,1,t.CapsStyle.NONE)),a.moveTo(u,d),a.lineTo(u+p,d)}}if(i){var g=this.$getRenderBounds();i.x=g.x,i.y=g.y,i.width=g.width,i.height=g.height,t.Rectangle.release(g)}},o.prototype.setFocus=function(){this.type==t.TextFieldType.INPUT&&this.$stage&&this.inputUtils.$onFocus()},o.prototype.$onRemoveFromStage=function(){r.prototype.$onRemoveFromStage.call(this),this.removeEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._removeStageText(),this.textNode&&this.textNode.clean()},o.prototype.$onAddToStage=function(e,i){r.prototype.$onAddToStage.call(this,e,i),this.addEvent(),this.$TextField[24]==t.TextFieldType.INPUT&&this.inputUtils._addStageText()},o.prototype.$invalidateTextField=function(){var t=this;t.$renderDirty=!0,t.$TextField[18]=!0;var e=t.$parent;e&&!e.$cacheDirty&&(e.$cacheDirty=!0,e.$cacheDirtyUp());var i=t.$maskedObject;i&&!i.$cacheDirty&&(i.$cacheDirty=!0,i.$cacheDirtyUp())},o.prototype.$getRenderBounds=function(){var e=this.$getContentBounds(),i=t.Rectangle.create();i.copyFrom(e),this.$TextField[31]&&(i.width+=2,i.height+=2);var r=2*this.$TextField[27];return r>0&&(i.width+=2*r,i.height+=2*r),i.x-=r+2,i.y-=r+2,i.width=Math.ceil(i.width)+4,i.height=Math.ceil(i.height)+4,i},o.prototype.$measureContentBounds=function(e){this.$getLinesArr();var i=isNaN(this.$TextField[3])?this.$TextField[5]:this.$TextField[3],r=isNaN(this.$TextField[4])?t.TextFieldUtils.$getTextHeight(this):this.$TextField[4];e.setTo(0,0,i,r)},o.prototype.$updateRenderNode=function(){if(this.$TextField[24]==t.TextFieldType.INPUT){if(this.inputUtils._updateProperties(),this.$isTyping)return void this.fillBackground()}else if(0==this.$TextField[3])return;this.drawText()},Object.defineProperty(o.prototype,"textFlow",{get:function(){return this.textArr},set:function(t){this.isFlow=!0;var e="";null==t&&(t=[]);for(var i=0;i<t.length;i++){var r=t[i];e+=r.text}this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.setMiddleStyle(t))},enumerable:!0,configurable:!0}),o.prototype.changeToPassText=function(t){if(this.$TextField[20]){for(var e="",i=0,r=t.length;r>i;i++)switch(t.charAt(i)){case"\n":e+="\n";break;case"\r":break;default:e+="*"}return e}return t},o.prototype.setMiddleStyle=function(t){this.$TextField[18]=!0,this.textArr=t,this.$invalidateTextField()},Object.defineProperty(o.prototype,"textWidth",{get:function(){return this.$getLinesArr(),this.$TextField[5]},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"textHeight",{get:function(){return this.$getLinesArr(),t.TextFieldUtils.$getTextHeight(this)},enumerable:!0,configurable:!0}),o.prototype.appendText=function(t){this.appendElement({text:t})},o.prototype.appendElement=function(t){var e=this.$TextField[13]+t.text;this.$TextField[20]?this.$setBaseText(e):(this.$TextField[13]=e,this.textArr.push(t),this.setMiddleStyle(this.textArr))},o.prototype.$getLinesArr=function(){var i=this.$TextField;if(!i[18])return this.linesArr;i[18]=!1;var r=this.textArr;this.linesArr.length=0,i[6]=0,i[5]=0;var o=i[3];if(!isNaN(o)&&0==o)return i[29]=0,[{width:0,height:0,charNum:0,elements:[],hasNextLine:!1}];for(var a,s=this.linesArr,h=0,c=0,l=0,u=0,d=0,p=r.length;p>d;d++){var f=r[d];if(f.text){f.style=f.style||{};for(var g=f.text.toString(),v=g.split(/(?:\r\n|\r|\n)/),y=0,x=v.length;x>y;y++){null==s[u]&&(a={width:0,height:0,elements:[],charNum:0,hasNextLine:!1},s[u]=a,h=0,l=0,c=0),l=i[24]==t.TextFieldType.INPUT?i[0]:Math.max(l,f.style.size||i[0]);var b=!0;if(""==v[y])y==x-1&&(b=!1);else{var $=e(v[y],i,f.style);if(isNaN(o))h+=$,c+=v[y].length,a.elements.push({width:$,text:v[y],style:f.style}),y==x-1&&(b=!1);else if(o>=h+$)a.elements.push({width:$,text:v[y],style:f.style}),h+=$,c+=v[y].length,y==x-1&&(b=!1);else{var m=0,T=0,_=v[y],w=void 0;w=i[19]?_.split(n):_.match(/./g);for(var S=w.length,B=0;S>m;m++){var E=w[m].length,C=!1;if(1==E&&S-1>m){var R=w[m].charCodeAt(0),F=w[m+1].charCodeAt(0);if(R>=55296&&56319>=R&&56320==(64512&F)){var L=w[m]+w[m+1];E=2,C=!0,$=e(L,i,f.style)}else $=e(w[m],i,f.style)}else $=e(w[m],i,f.style);if(0!=h&&h+$>o&&h+m!=0)break;if(T+$>o)for(var D=w[m].match(/./g),O=0,A=D.length;A>O;O++){var E=D[O].length,M=!1;if(1==E&&A-1>O){var R=D[O].charCodeAt(0),F=D[O+1].charCodeAt(0);if(R>=55296&&56319>=R&&56320==(64512&F)){var L=D[O]+D[O+1];E=2,M=!0,$=e(L,i,f.style)}else $=e(D[O],i,f.style)}else $=e(D[O],i,f.style);if(O>0&&h+$>o)break;B+=E,T+=$,h+=$,c+=B,M&&O++}else B+=E,T+=$,h+=$,c+=B;C&&m++}if(m>0){a.elements.push({width:T,text:_.substring(0,B),style:f.style});var N=_.substring(B),k=void 0,P=N.length;for(k=0;P>k&&" "==N.charAt(k);k++);v[y]=N.substring(k)}""!=v[y]&&(y--,b=!1)}}b&&(c++,a.hasNextLine=!0),y<v.length-1&&(a.width=h,a.height=l,a.charNum=c,i[5]=Math.max(i[5],h),i[6]+=l,u++)}d==r.length-1&&a&&(a.width=h,a.height=l,a.charNum=c,i[5]=Math.max(i[5],h),i[6]+=l)}else a&&(a.width=h,a.height=l,a.charNum=c,i[5]=Math.max(i[5],h),i[6]+=l)}return i[29]=s.length,s},o.prototype.drawText=function(){var e=this.$TextField,r=this.$getLinesArr();if(0==e[5])return[];var n=isNaN(e[3])?e[5]:e[3],o=t.TextFieldUtils.$getTextHeight(this),a=0,h=t.TextFieldUtils.$getStartLine(this),l=e[4];if(!isNaN(l)&&l>o){var u=t.TextFieldUtils.$getValign(this);a+=u*(l-o)}a=Math.round(a);for(var d=t.TextFieldUtils.$getHalign(this),p=0,f=0,g=[],v=h,y=e[29];y>v;v++){var x=r[v],b=x.height;if(a+=b,v!=h){if(e[24]==t.TextFieldType.INPUT&&!e[30])break;if(!isNaN(l)&&a>l)break}f=Math.round((n-x.width)*d);for(var $=0,m=x.elements.length;m>$;$++){var T=x.elements[$],_=T.style.size||e[0];s.italic=T.style.italic?1:e[16],s.bold=T.style.bold?1:e[15],s.fontSize=_,s.strokeSize=isNaN(Number(T.style.stroke))?e[27]:T.style.stroke,s.strokeColor=4278190080+(isNaN(Number(T.style.strokeColor))?e[25]:T.style.strokeColor),s.textColor=4278190080+(isNaN(Number(T.style.textColor))?e[2]:T.style.textColor),s.width=s.maxWidth=T.width,s.height=s.maxHeight=1.15*_;var w=void 0;p<this._bkNodes.length?(w=this._bkNodes[p],w.updateText(s,T.text)):(w=i(T.text,s),this._bkNodes[p]=w,this._bkNode.addChild(w)),w.position={x:f,y:-a},p++,T.style.underline&&g.push(f,a,T.width,T.style.textColor),f+=T.width}a+=e[1]}for(var v=p;v<this._bkNodes.length;++v){var w=this._bkNodes[v];c.push(w),this._bkNode.removeChild(w)}return this._bkNodes.length=p,g},o.prototype.addEvent=function(){this.addEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.prototype.removeEvent=function(){this.removeEventListener(t.TouchEvent.TOUCH_TAP,this.onTapHandler,this)},o.prototype.onTapHandler=function(e){if(this.$TextField[24]!=t.TextFieldType.INPUT){var i=t.TextFieldUtils.$getTextElement(this,e.localX,e.localY);if(null!=i){var r=i.style;if(r&&r.href)if(r.href.match(/^event:/)){var n=r.href.match(/^event:/)[0];t.TextEvent.dispatchTextEvent(this,t.TextEvent.LINK,r.href.substring(n.length))}else open(r.href,r.target||"_blank")}}},o.prototype._updateSelfColor=function(){for(var t=0,e=this._bkNodes;t<e.length;t++){var i=e[t];i.vertexColor=this._color}},o.default_fontFamily="Arial",o.default_size=30,o.default_textColor=16777215,o}(t.BKDisplayObject);t.BKTextField=o,__reflect(o.prototype,"egret.BKTextField");var a,s={fontSize:t.TextField.default_size,textColor:t.TextField.default_textColor+4278190080,maxWidth:64,maxHeight:64,width:64,height:64,textAlign:0,bold:0,italic:0,strokeColor:4278190080,strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:4278190080},h={fontSize:t.TextField.default_size,textColor:t.TextField.default_textColor+4278190080,maxWidth:1280,maxHeight:512,width:1280,height:512,textAlign:0,bold:0,italic:0,strokeColor:4278190080,strokeSize:0,shadowRadius:0,shadowDx:0,shadowDy:0,shadowColor:4278190080},c=[];t.sys.measureText=r,"webgl"!=window.renderMode&&(t.TextField=t.BKTextField)}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(){}return t.blur_frag="precision mediump float;\nuniform vec2 blur;\nuniform sampler2D uSampler;\nvarying vec2 vTextureCoord;\nuniform vec2 uTextureSize;\nvoid main()\n{\n    const int sampleRadius = 5;\n    const int samples = sampleRadius * 2 + 1;\n    vec2 blurUv = blur / uTextureSize;\n    vec4 color = vec4(0, 0, 0, 0);\n    vec2 uv = vec2(0.0, 0.0);\n    blurUv /= float(sampleRadius);\n    for (int i = -sampleRadius; i <= sampleRadius; i++) {\n        uv.x = vTextureCoord.x + float(i) * blurUv.x;\n        uv.y = vTextureCoord.y + float(i) * blurUv.y;\n        color += texture2D(uSampler, uv);\n    }\n    color /= float(samples);\n    gl_FragColor = color;\n}",t.colorTransform_frag="precision mediump float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform mat4 matrix;\nuniform vec4 colorAdd;\nuniform sampler2D uSampler;\nvoid main(void) {\n    vec4 texColor = texture2D(uSampler, vTextureCoord);\n    if(texColor.a > 0.) {\n        texColor = vec4(texColor.rgb / texColor.a, texColor.a);\n    }\n    vec4 locColor = clamp(texColor * matrix + colorAdd, 0., 1.);\n    gl_FragColor = vColor * vec4(locColor.rgb * locColor.a, locColor.a);\n}",t.default_vert="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",t.glow_frag="precision highp float;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float dist;\nuniform float angle;\nuniform vec4 color;\nuniform float alpha;\nuniform float blurX;\nuniform float blurY;\nuniform float strength;\nuniform float inner;\nuniform float knockout;\nuniform float hideObject;\nuniform vec2 uTextureSize;\nfloat random()\n{\n    return fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\nvoid main(void) {\n    vec2 px = vec2(1.0 / uTextureSize.x, 1.0 / uTextureSize.y);\n    const float linearSamplingTimes = 7.0;\n    const float circleSamplingTimes = 12.0;\n    vec4 ownColor = texture2D(uSampler, vTextureCoord);\n    vec4 curColor;\n    float totalAlpha = 0.0;\n    float maxTotalAlpha = 0.0;\n    float curDistanceX = 0.0;\n    float curDistanceY = 0.0;\n    float offsetX = dist * cos(angle) * px.x;\n    float offsetY = dist * sin(angle) * px.y;\n    const float PI = 3.14159265358979323846264;\n    float cosAngle;\n    float sinAngle;\n    float offset = PI * 2.0 / circleSamplingTimes * random();\n    float stepX = blurX * px.x / linearSamplingTimes;\n    float stepY = blurY * px.y / linearSamplingTimes;\n    for (float a = 0.0; a <= PI * 2.0; a += PI * 2.0 / circleSamplingTimes) {\n        cosAngle = cos(a + offset);\n        sinAngle = sin(a + offset);\n        for (float i = 1.0; i <= linearSamplingTimes; i++) {\n            curDistanceX = i * stepX * cosAngle;\n            curDistanceY = i * stepY * sinAngle;\n            \n            curColor = texture2D(uSampler, vec2(vTextureCoord.x + curDistanceX - offsetX, vTextureCoord.y + curDistanceY + offsetY));\n            totalAlpha += (linearSamplingTimes - i) * curColor.a;\n            maxTotalAlpha += (linearSamplingTimes - i);\n        }\n    }\n    ownColor.a = max(ownColor.a, 0.0001);\n    ownColor.rgb = ownColor.rgb / ownColor.a;\n    float outerGlowAlpha = (totalAlpha / maxTotalAlpha) * strength * alpha * (1. - inner) * max(min(hideObject, knockout), 1. - ownColor.a);\n    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * strength * alpha * inner * ownColor.a;\n    ownColor.a = max(ownColor.a * knockout * (1. - hideObject), 0.0001);\n    vec3 mix1 = mix(ownColor.rgb, color.rgb, innerGlowAlpha / (innerGlowAlpha + ownColor.a));\n    vec3 mix2 = mix(mix1, color.rgb, outerGlowAlpha / (innerGlowAlpha + ownColor.a + outerGlowAlpha));\n    float resultAlpha = min(ownColor.a + outerGlowAlpha + innerGlowAlpha, 1.);\n    gl_FragColor = vec4(mix2 * resultAlpha, resultAlpha);\n}",t.primitive_frag="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvoid main(void) {\n    gl_FragColor = vColor;\n}",t.texture_frag="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor;\n}",t}();t.EgretShaderLib=e,__reflect(e.prototype,"egret.web.EgretShaderLib")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){function e(t,e){for(var i=Object.getOwnPropertyNames(t),r=function(i){Object.defineProperty(e,i,{get:function(){return t[i]},set:function(e){t[i]=e}})},n=0,o=i;n<o.length;n++){var a=o[n];r(a)}}function i(t){for(var e=new ArrayBuffer(t.bufferLength()),i=new Uint8Array(e),r=0;r<t.bufferLength();)i[r++]=t.readUint8Buffer();return e}function r(t){for(var e=new BK.Buffer(t.byteLength),i=new Uint8Array(t),r=0;r<t.byteLength;)e.writeUint8Buffer(i[r++]);return e}t.emptyTexture=BK.Texture.createTexture(1,1),t.defineProxyProperties=e,t.bricksBufferToArrayBuffer=i,t.arrayBufferToBricksBuffer=r}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._url="",t._method="",t.urlData={},t.responseHeader="",t}return __extends(i,e),Object.defineProperty(i.prototype,"responseType",{get:function(){return this._responseType},set:function(t){this._responseType=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"response",{get:function(){return this._response},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"withCredentials",{get:function(){return this._withCredentials},set:function(t){this._withCredentials=t},enumerable:!0,configurable:!0}),i.prototype.open=function(t,e){void 0===e&&(e="GET"),this._url=t,this._method=e},i.prototype.send=function(e){var i=this;if(i.isNetUrl(i._url)){var r=i._url,n=this.encodeURL(r);this._bkHttpRequest=new BK.HttpUtil(n);var o=void 0;this._method===t.HttpMethod.GET?o="get":this._method===t.HttpMethod.POST&&(o="post"),this._bkHttpRequest.setHttpMethod(o),this._method===t.HttpMethod.POST&&this._bkHttpRequest.setHttpPostData(e),this._bkHttpRequest.setHttpCookie(e),this._bkHttpRequest.requestAsync(function(e,r){if(200===Number(r)){if(i._responseType===t.HttpResponseType.ARRAY_BUFFER)i._response=t.bricksBufferToArrayBuffer(e);else{var n=new t.ByteArray(t.bricksBufferToArrayBuffer(e));i._response=n.readUTFBytes(n.length)}t.$callAsync(t.Event.dispatchEvent,t.Event,i,t.Event.COMPLETE)}else t.$warn(1019,r),t.Event.dispatchEvent(i,t.IOErrorEvent.IO_ERROR)})}else if(BK.FileUtil.isFileExist(i._url)){var a=BK.FileUtil.readFile(i._url);i._responseType===t.HttpResponseType.ARRAY_BUFFER?i._response=t.bricksBufferToArrayBuffer(a):i._response=a.readAsString()||"",t.$callAsync(t.Event.dispatchEvent,t.Event,i,t.Event.COMPLETE)}else t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,i,t.IOErrorEvent.IO_ERROR)},i.prototype.encodeURL=function(t){if(!t||""===t)return"";var e=t.indexOf("?");if(0>e)return t;for(var i=t.slice(0,e),r=t.slice(e+1),n=r.split("&"),o="",a=0;a<n.length;a++){var s=n[a],h=s.split("="),c=h[0],l=h[1]?h[1]:"";o+=c+"="+encodeURIComponent(l),a<n.length-1&&(o+="&")}return i+"?"+o},i.prototype.isNetUrl=function(t){return-1!=t.indexOf("http://")||-1!=t.indexOf("HTTP://")||-1!=t.indexOf("https://")||-1!=t.indexOf("HTTPS://")},i.prototype.abort=function(){},i.prototype.onResponseHeader=function(t){this.responseHeader="";var e=JSON.parse(t);for(var i in e)this.responseHeader+=i+": "+e[i]+"\r\n"},i.prototype.getAllResponseHeaders=function(){return this.responseHeader},i.prototype.setRequestHeader=function(t,e){this.headerObj||(this.headerObj={}),this.headerObj[t]=e},i.prototype.getResponseHeader=function(t){return""},i}(t.EventDispatcher);t.BKHttpRequest=e,__reflect(e.prototype,"egret.BKHttpRequest",["egret.HttpRequest"]),t.HttpRequest=e}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.data=null,t._crossOrigin=null,t._hasCrossOriginSet=!1,t}return __extends(i,e),Object.defineProperty(i.prototype,"crossOrigin",{get:function(){return this._crossOrigin},set:function(t){this._hasCrossOriginSet=!0,this._crossOrigin=t},enumerable:!0,configurable:!0}),i.prototype.load=function(e){e.indexOf("http://")>=0||e.indexOf("https://")>=0||(BK.FileUtil.isFileExist(e)?(this.data=new t.BitmapData(e),t.$callAsync(t.Event.dispatchEvent,t.Event,this,t.Event.COMPLETE)):t.$callAsync(t.Event.dispatchEvent,t.IOErrorEvent,this,t.IOErrorEvent.IO_ERROR))},i.crossOrigin=null,i}(t.EventDispatcher);t.BKImageLoader=e,__reflect(e.prototype,"egret.BKImageLoader",["egret.ImageLoader"]),t.ImageLoader=e}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}return e.prototype.addCallBacks=function(t,e,i,r,n){this.onConnect=t,this.onClose=e,this.onSocketData=i,this.onError=r,this.thisObject=n},e.prototype.connect=function(t,e){var i=t+":"+e;this.connectByUrl(i)},e.prototype.connectByUrl=function(t){this.$websocket=new BK.WebSocket(t),this.$websocket.connect(),this._bindEvent()},e.prototype.BKSocketConnect=function(t){this.$websocket=t,this.$websocket.connect(),this._bindEvent()},e.prototype._bindEvent=function(){var e=this,i=this.$websocket;i.onOpen=function(t){e.onConnect&&e.onConnect.call(e.thisObject)},i.onClose=function(t){e.onClose&&e.onClose.call(e.thisObject)},i.onError=function(t){e.onError&&e.onError.call(e.thisObject)},i.onMessage=function(i,r){if(e.onSocketData){var n=void 0,o=r.data;if(r.isBinary)n=t.bricksBufferToArrayBuffer(o);else{var a=new t.ByteArray(t.bricksBufferToArrayBuffer(o));n=a.readUTFBytes(a.length)}e.onSocketData.call(e.thisObject,n)}}},e.prototype.send=function(e){if("string"==typeof e)this.$websocket.send(e);else if(e instanceof ArrayBuffer){var i=t.arrayBufferToBricksBuffer(e);this.$websocket.send(i)}},e.prototype.resHandler=function(e){switch(e.type){case t.Event.COMPLETE:var i=e.currentTarget;i.response;console.log()}},e.prototype.close=function(){this.$websocket.close()},e.prototype.disconnect=function(){},e}();t.BKSocket=e,__reflect(e.prototype,"egret.BKSocket",["egret.ISocket"]),t.ISocket=e}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(i){function r(r){var n=i.call(this)||this;return n.isStage=!1,n.$renderNode=new e.BitmapNode,n.renderBuffer=null,n.offsetX=0,n.offsetY=0,n.offsetMatrix=new t.Matrix,n.$canvasScaleX=1,n.$canvasScaleY=1,n.root=r,n.isStage=r instanceof t.Stage,n}return __extends(r,i),r.create=function(i){var r=new t.sys.DisplayList(i);try{var n=new e.RenderBuffer;r.renderBuffer=n}catch(o){return null}return r.root=i,r},r.prototype.$getRenderNode=function(){return this.$renderNode},r.prototype.setClipRect=function(t,i){t*=e.DisplayList.$canvasScaleX,i*=e.DisplayList.$canvasScaleY,this.renderBuffer.resize(t,i)},r.prototype.drawToSurface=function(){var i=0;this.$canvasScaleX=this.offsetMatrix.a=e.DisplayList.$canvasScaleX,this.$canvasScaleY=this.offsetMatrix.d=e.DisplayList.$canvasScaleY,this.isStage||this.changeSurfaceSize();var r=this.renderBuffer;if(r.clear(),i=e.systemRenderer.render(this.root,r,this.offsetMatrix),!this.isStage){var n=r.surface,o=this.$renderNode;o.drawData.length=0;var a=n.width,s=n.height;this.bitmapData?(this.bitmapData.source=n,this.bitmapData.width=a,this.bitmapData.height=s):this.bitmapData=new t.BitmapData(n),o.image=this.bitmapData,o.imageWidth=a,o.imageHeight=s,o.drawImage(0,0,a,s,-this.offsetX,-this.offsetY,a/this.$canvasScaleX,s/this.$canvasScaleY)}return i},r.prototype.changeSurfaceSize=function(){var t=(this.root,this.offsetX),e=this.offsetY,i=this.root.$getOriginalBounds(),r=this.$canvasScaleX,n=this.$canvasScaleY;this.offsetX=-i.x,this.offsetY=-i.y,this.offsetMatrix.setTo(this.offsetMatrix.a,0,0,this.offsetMatrix.d,this.offsetX,this.offsetY);var o=this.renderBuffer,a=Math.max(257,i.width*r),s=Math.max(257,i.height*n);(this.offsetX!=t||this.offsetY!=e||o.surface.width!=a||o.surface.height!=s)&&o.resize(a,s)},r.$setCanvasScale=function(t,i){e.DisplayList.$canvasScaleX=t,e.DisplayList.$canvasScaleY=i},r.$canvasScaleFactor=1,r.$canvasScaleX=1,r.$canvasScaleY=1,r}(t.HashObject);e.BKDisplayList=i,__reflect(i.prototype,"egret.sys.BKDisplayList"),t.sys.DisplayList=i}(e=t.sys||(t.sys={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(t,e,i){this.surface={width:t,height:e},this.context=new BK.Canvas(t,e),this.context&&(this.context.$offsetX=0,this.context.$offsetY=0)}return Object.defineProperty(t.prototype,"width",{get:function(){return this.surface.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.surface.height},enumerable:!0,configurable:!0}),t.prototype.resize=function(t,e,i){var r=this.surface;if(i){var n=!1;r.width<t&&(r.width=t,n=!0),r.height<e&&(r.height=e,n=!0),n||(this.context.globalCompositeOperation="source-over",this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1)}else r.width!=t&&(r.width=t),r.height!=e&&(r.height=e);this.clear()},t.prototype.getPixels=function(t,e,i,r){return void 0===i&&(i=1),void 0===r&&(r=1),this.context.getImageData(t,e,i,r).data},t.prototype.toDataURL=function(t,e){return this.surface.toDataURL(t,e)},t.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.surface.width,this.surface.height)},t.prototype.destroy=function(){this.surface.width=this.surface.height=0},t}();t.CanvasRenderBuffer=e,__reflect(e.prototype,"egret.web.CanvasRenderBuffer",["egret.sys.RenderBuffer"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(t){t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.FLOAT=5126]="FLOAT",t[t.BYTE=65535]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT"}(e=t.WEBGL_ATTRIBUTE_TYPE||(t.WEBGL_ATTRIBUTE_TYPE={}));var i=function(){function t(t,e,i){this.gl=t,this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getAttribLocation(e,this.name),this.count=0,this.initCount(t),this.format=t.FLOAT,this.initFormat(t)}return t.prototype.initCount=function(t){var i=this.type;switch(i){case e.FLOAT:case e.BYTE:case e.UNSIGNED_BYTE:case e.UNSIGNED_SHORT:this.count=1;break;case e.FLOAT_VEC2:this.count=2;break;case e.FLOAT_VEC3:this.count=3;break;case e.FLOAT_VEC4:this.count=4}},t.prototype.initFormat=function(t){var i=this.type;switch(i){case e.FLOAT:case e.FLOAT_VEC2:case e.FLOAT_VEC3:case e.FLOAT_VEC4:this.format=t.FLOAT;break;case e.UNSIGNED_BYTE:this.format=t.UNSIGNED_BYTE;break;case e.UNSIGNED_SHORT:this.format=t.UNSIGNED_SHORT;break;case e.BYTE:this.format=t.BYTE}},t}();t.EgretWebGLAttribute=i,__reflect(i.prototype,"egret.web.EgretWebGLAttribute")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){function e(t,e,i){var r=t.createShader(e);t.shaderSource(r,i),t.compileShader(r);var n=t.getShaderParameter(r,t.COMPILE_STATUS);return n||(console.log("shader not compiled!"),console.log(t.getShaderInfoLog(r))),r}function i(t,e,i){var r=t.createProgram();return t.attachShader(r,e),t.attachShader(r,i),t.linkProgram(r),r}function r(e,i){for(var r={},n=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES),o=0;n>o;o++){var a=e.getActiveAttrib(i,o),s=a.name,h=new t.EgretWebGLAttribute(e,i,a);r[s]=h}return r}function n(e,i){for(var r={},n=e.getProgramParameter(i,e.ACTIVE_UNIFORMS),o=0;n>o;o++){var a=e.getActiveUniform(i,o),s=a.name,h=new t.EgretWebGLUniform(e,i,a);r[s]=h}return r}var o=function(){function t(t,o,a){this.vshaderSource=o,this.fshaderSource=a,this.vertexShader=e(t,t.VERTEX_SHADER,this.vshaderSource),this.fragmentShader=e(t,t.FRAGMENT_SHADER,this.fshaderSource),this.id=i(t,this.vertexShader,this.fragmentShader),this.uniforms=n(t,this.id),this.attributes=r(t,this.id)}return t.getProgram=function(e,i,r,n){return this.programCache[n]||(this.programCache[n]=new t(e,i,r)),this.programCache[n]},t.deleteProgram=function(t,e,i,r){},t.programCache={},t}();t.EgretWebGLProgram=o,__reflect(o.prototype,"egret.web.EgretWebGLProgram")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e;!function(t){t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.BYTE=65535]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}(e=t.WEBGL_UNIFORM_TYPE||(t.WEBGL_UNIFORM_TYPE={}));var i=function(){function t(t,e,i){this.gl=t,this.name=i.name,this.type=i.type,this.size=i.size,this.location=t.getUniformLocation(e,this.name),this.setDefaultValue(),this.generateSetValue(),this.generateUpload()}return t.prototype.setDefaultValue=function(){var t=this.type;switch(t){case e.FLOAT:case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.value=0;break;case e.FLOAT_VEC2:case e.BOOL_VEC2:case e.INT_VEC2:this.value=[0,0];break;case e.FLOAT_VEC3:case e.BOOL_VEC3:case e.INT_VEC3:this.value=[0,0,0];break;case e.FLOAT_VEC4:case e.BOOL_VEC4:case e.INT_VEC4:this.value=[0,0,0,0];break;case e.FLOAT_MAT2:this.value=new Float32Array([1,0,0,1]);break;case e.FLOAT_MAT3:this.value=new Float32Array([1,0,0,0,1,0,0,0,1]);break;case e.FLOAT_MAT4:this.value=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},t.prototype.generateSetValue=function(){var t=this.type;switch(t){case e.FLOAT:case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.setValue=function(t){var e=this.value!==t;this.value=t,e&&this.upload()};break;case e.FLOAT_VEC2:case e.BOOL_VEC2:case e.INT_VEC2:this.setValue=function(t){var e=this.value[0]!==t.x||this.value[1]!==t.y;this.value[0]=t.x,this.value[1]=t.y,e&&this.upload()};break;case e.FLOAT_VEC3:case e.BOOL_VEC3:case e.INT_VEC3:this.setValue=function(t){this.value[0]=t.x,this.value[1]=t.y,this.value[2]=t.z,this.upload()};break;case e.FLOAT_VEC4:case e.BOOL_VEC4:case e.INT_VEC4:this.setValue=function(t){this.value[0]=t.x,this.value[1]=t.y,this.value[2]=t.z,this.value[3]=t.w,this.upload()};break;case e.FLOAT_MAT2:case e.FLOAT_MAT3:case e.FLOAT_MAT4:this.setValue=function(t){this.value.set(t),this.upload()}}},t.prototype.generateUpload=function(){var t=this.gl,i=this.type,r=this.location;switch(i){case e.FLOAT:this.upload=function(){var e=this.value;t.uniform1f(r,e)};break;case e.FLOAT_VEC2:this.upload=function(){var e=this.value;t.uniform2f(r,e[0],e[1])};break;case e.FLOAT_VEC3:this.upload=function(){var e=this.value;t.uniform3f(r,e[0],e[1],e[2])};break;case e.FLOAT_VEC4:this.upload=function(){var e=this.value;t.uniform4f(r,e[0],e[1],e[2],e[3])};break;case e.SAMPLER_2D:case e.SAMPLER_CUBE:case e.BOOL:case e.INT:this.upload=function(){var e=this.value;t.uniform1i(r,e)};break;case e.BOOL_VEC2:case e.INT_VEC2:this.upload=function(){var e=this.value;t.uniform2i(r,e[0],e[1])};break;case e.BOOL_VEC3:case e.INT_VEC3:this.upload=function(){var e=this.value;t.uniform3i(r,e[0],e[1],e[2])};break;case e.BOOL_VEC4:case e.INT_VEC4:this.upload=function(){var e=this.value;t.uniform4i(r,e[0],e[1],e[2],e[3])};break;case e.FLOAT_MAT2:this.upload=function(){var e=this.value;t.uniformMatrix2fv(r,!1,e)};break;case e.FLOAT_MAT3:this.upload=function(){var e=this.value;t.uniformMatrix3fv(r,!1,e)};break;case e.FLOAT_MAT4:this.upload=function(){var e=this.value;t.uniformMatrix4fv(r,!1,e)}}},t}();t.EgretWebGLUniform=i,__reflect(i.prototype,"egret.web.EgretWebGLUniform")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e=function(){function e(t){if(this.format="image",this.$deleteSource=!0,"string"==typeof t){var e=BK.Image.loadImage(t,6);this.source=e,this.width=e.width,this.height=e.height,this.BK_format=e.format}}return e.create=function(e,i,r){var n="";n="arraybuffer"===e?t.Base64Util.encode(i):i;var o="image/png";"/"===n.charAt(0)?o="image/jpeg":"R"===n.charAt(0)?o="image/gif":"i"===n.charAt(0)&&(o="image/png");var a=new Image;a.src="data:"+o+";base64,"+n,a.crossOrigin="*";var s=new t.BitmapData(a);return a.onload=function(){a.onload=void 0,s.source=a,s.height=a.height,s.width=a.width,r&&r(s)},s},e.prototype.$dispose=function(){this.source&&this.source.dispose&&this.source.dispose(),this.source=null,t.BitmapData.$dispose(this)},e.$addDisplayObject=function(t,e){if(e){var i=e.hashCode;if(i){if(!this._displayList[i])return void(this._displayList[i]=[t]);var r=this._displayList[i];r.indexOf(t)<0&&r.push(t)}}},e.$removeDisplayObject=function(t,e){if(e){var i=e.hashCode;if(i&&this._displayList[i]){var r=this._displayList[i],n=r.indexOf(t);n>=0&&r.splice(n)}}},e.$invalidate=function(e){if(e){var i=e.hashCode;if(i&&this._displayList[i])for(var r=this._displayList[i],n=0;n<r.length;n++){r[n]instanceof t.Bitmap&&r[n].$refreshImageData();var o=r[n];o.$renderDirty=!0;var a=o.$parent;a&&!a.$cacheDirty&&(a.$cacheDirty=!0,a.$cacheDirtyUp());var s=o.$maskedObject;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp())}}},e.$dispose=function(e){if(e){var i=e.hashCode;if(i&&this._displayList[i]){for(var r=this._displayList[i],n=0,o=r;n<o.length;n++){var a=o[n];a instanceof t.Bitmap&&(a.$bitmapData=null),a.$renderDirty=!0;var s=a.$parent;s&&!s.$cacheDirty&&(s.$cacheDirty=!0,s.$cacheDirtyUp());var h=a.$maskedObject;h&&!h.$cacheDirty&&(h.$cacheDirty=!0,h.$cacheDirtyUp())}delete this._displayList[i]}}},e._displayList=t.createMap(),e}();t.WebGLBitmapData=e,__reflect(e.prototype,"egret.WebGLBitmapData"),"webgl"==window.renderMode&&(t.BitmapData=t.WebGLBitmapData)
}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(){this.drawData=[],this.drawDataLen=0}return t.prototype.pushDrawRect=function(){if(0==this.drawDataLen||1!=this.drawData[this.drawDataLen-1].type){var t=this.drawData[this.drawDataLen]||{};t.type=1,t.count=0,this.drawData[this.drawDataLen]=t,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=2},t.prototype.pushDrawTexture=function(t,e,i,r,n){if(void 0===e&&(e=2),i){var o=this.drawData[this.drawDataLen]||{};o.type=0,o.texture=t,o.filter=i,o.count=e,o.textureWidth=r,o.textureHeight=n,this.drawData[this.drawDataLen]=o,this.drawDataLen++}else{if(0==this.drawDataLen||0!=this.drawData[this.drawDataLen-1].type||t!=this.drawData[this.drawDataLen-1].texture||this.drawData[this.drawDataLen-1].filter){var o=this.drawData[this.drawDataLen]||{};o.type=0,o.texture=t,o.count=0,this.drawData[this.drawDataLen]=o,this.drawDataLen++}this.drawData[this.drawDataLen-1].count+=e}},t.prototype.pushChangeSmoothing=function(t,e){t.smoothing=e;var i=this.drawData[this.drawDataLen]||{};i.type=10,i.texture=t,i.smoothing=e,this.drawData[this.drawDataLen]=i,this.drawDataLen++},t.prototype.pushPushMask=function(t){void 0===t&&(t=1);var e=this.drawData[this.drawDataLen]||{};e.type=2,e.count=2*t,this.drawData[this.drawDataLen]=e,this.drawDataLen++},t.prototype.pushPopMask=function(t){void 0===t&&(t=1);var e=this.drawData[this.drawDataLen]||{};e.type=3,e.count=2*t,this.drawData[this.drawDataLen]=e,this.drawDataLen++},t.prototype.pushSetBlend=function(t){for(var e=this.drawDataLen,i=!1,r=e-1;r>=0;r--){var n=this.drawData[r];if(n){if((0==n.type||1==n.type)&&(i=!0),!i&&4==n.type){this.drawData.splice(r,1),this.drawDataLen--;continue}if(4==n.type){if(n.value==t)return;break}}}var o=this.drawData[this.drawDataLen]||{};o.type=4,o.value=t,this.drawData[this.drawDataLen]=o,this.drawDataLen++},t.prototype.pushResize=function(t,e,i){var r=this.drawData[this.drawDataLen]||{};r.type=5,r.buffer=t,r.width=e,r.height=i,this.drawData[this.drawDataLen]=r,this.drawDataLen++},t.prototype.pushClearColor=function(){var t=this.drawData[this.drawDataLen]||{};t.type=6,this.drawData[this.drawDataLen]=t,this.drawDataLen++},t.prototype.pushActivateBuffer=function(t){for(var e=this.drawDataLen,i=!1,r=e-1;r>=0;r--){var n=this.drawData[r];!n||(4!=n.type&&7!=n.type&&(i=!0),i||7!=n.type)||(this.drawData.splice(r,1),this.drawDataLen--)}var o=this.drawData[this.drawDataLen]||{};o.type=7,o.buffer=t,o.width=t.rootRenderTarget.width,o.height=t.rootRenderTarget.height,this.drawData[this.drawDataLen]=o,this.drawDataLen++},t.prototype.pushEnableScissor=function(t,e,i,r){var n=this.drawData[this.drawDataLen]||{};n.type=8,n.x=t,n.y=e,n.width=i,n.height=r,this.drawData[this.drawDataLen]=n,this.drawDataLen++},t.prototype.pushDisableScissor=function(){var t=this.drawData[this.drawDataLen]||{};t.type=9,this.drawData[this.drawDataLen]=t,this.drawDataLen++},t.prototype.clear=function(){for(var t=0;t<this.drawDataLen;t++){var e=this.drawData[t];e.type=0,e.count=0,e.texture=null,e.filter=null,e.uv=null,e.value="",e.buffer=null,e.width=0,e.height=0}this.drawDataLen=0},t}();t.WebGLDrawCmdManager=e,__reflect(e.prototype,"egret.web.WebGLDrawCmdManager")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(i){function n(r,n,o){var a=i.call(this)||this;if(a.globalAlpha=1,a.stencilState=!1,a.$stencilList=[],a.stencilHandleCount=0,a.$scissorState=!1,a.scissorRect=new t.Rectangle,a.$hasScissor=!1,a.$drawCalls=0,a.$computeDrawCall=!1,a.globalMatrix=new t.Matrix,a.savedGlobalMatrix=new t.Matrix,a.$offsetX=0,a.$offsetY=0,a.context=e.WebGLRenderContext.getInstance(r,n),a.rootRenderTarget=new e.WebGLRenderTarget(a.context.context,3,3),r&&n&&a.resize(r,n),a.root=o,a.root)a.context.pushBuffer(a),a.surface=a.context.surface,a.$computeDrawCall=!0;else{var s=a.context.activatedBuffer;s&&s.rootRenderTarget.activate(),a.rootRenderTarget.initFrameBuffer(),a.surface=a.rootRenderTarget}return a}return __extends(n,i),n.prototype.enableStencil=function(){this.stencilState||(this.context.enableStencilTest(),this.stencilState=!0)},n.prototype.disableStencil=function(){this.stencilState&&(this.context.disableStencilTest(),this.stencilState=!1)},n.prototype.restoreStencil=function(){this.stencilState?this.context.enableStencilTest():this.context.disableStencilTest()},n.prototype.enableScissor=function(t,e,i,r){this.$scissorState||(this.$scissorState=!0,this.scissorRect.setTo(t,e,i,r),this.context.enableScissorTest(this.scissorRect))},n.prototype.disableScissor=function(){this.$scissorState&&(this.$scissorState=!1,this.scissorRect.setEmpty(),this.context.disableScissorTest())},n.prototype.restoreScissor=function(){this.$scissorState?this.context.enableScissorTest(this.scissorRect):this.context.disableScissorTest()},Object.defineProperty(n.prototype,"width",{get:function(){return this.rootRenderTarget.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.rootRenderTarget.height},enumerable:!0,configurable:!0}),n.prototype.resize=function(t,e,i){t=t||1,e=e||1,this.context.pushBuffer(this),(t!=this.rootRenderTarget.width||e!=this.rootRenderTarget.height)&&(this.context.drawCmdManager.pushResize(this,t,e),this.rootRenderTarget.width=t,this.rootRenderTarget.height=e),this.root&&this.context.resize(t,e,i),this.context.clear(),this.context.popBuffer()},n.prototype.getPixels=function(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=1);var n=new Uint8Array(4*i*r),o=this.rootRenderTarget.useFrameBuffer;this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.getPixels(t,e,i,r,n),this.rootRenderTarget.useFrameBuffer=o,this.rootRenderTarget.activate();for(var a=new Uint8Array(4*i*r),s=0;r>s;s++)for(var h=0;i>h;h++){var c=4*(i*(r-s-1)+h),l=4*(i*s+h),u=n[l+3];a[c]=Math.round(n[l]/u*255),a[c+1]=Math.round(n[l+1]/u*255),a[c+2]=Math.round(n[l+2]/u*255),a[c+3]=n[l+3]}return a},n.prototype.toDataURL=function(t,e){return""},n.prototype.destroy=function(){this.context.destroy()},n.prototype.onRenderFinish=function(){this.$drawCalls=0},n.prototype.drawFrameBufferToSurface=function(t,e,i,r,n,o,a,s,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.rootRenderTarget,t,e,i,r,n,o,a,s,i,r,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.drawSurfaceToFrameBuffer=function(t,e,i,r,n,o,a,s,h){void 0===h&&(h=!1),this.rootRenderTarget.useFrameBuffer=!0,this.rootRenderTarget.activate(),this.context.disableStencilTest(),this.context.disableScissorTest(),this.setTransform(1,0,0,1,0,0),this.globalAlpha=1,this.context.setGlobalCompositeOperation("source-over"),h&&this.context.clear(),this.context.drawImage(this.context.surface,t,e,i,r,n,o,a,s,i,r,!1),this.context.$drawWebGL(),this.rootRenderTarget.useFrameBuffer=!1,this.rootRenderTarget.activate(),this.restoreStencil(),this.restoreScissor()},n.prototype.clear=function(){this.context.pushBuffer(this),this.context.clear(),this.context.popBuffer()},n.prototype.setTransform=function(t,e,i,r,n,o){var a=this.globalMatrix;a.a=t,a.b=e,a.c=i,a.d=r,a.tx=n,a.ty=o},n.prototype.transform=function(t,e,i,r,n,o){var a=this.globalMatrix,s=a.a,h=a.b,c=a.c,l=a.d;(1!=t||0!=e||0!=i||1!=r)&&(a.a=t*s+e*c,a.b=t*h+e*l,a.c=i*s+r*c,a.d=i*h+r*l),a.tx=n*s+o*c+a.tx,a.ty=n*h+o*l+a.ty},n.prototype.useOffset=function(){var t=this;(0!=t.$offsetX||0!=t.$offsetY)&&(t.globalMatrix.append(1,0,0,1,t.$offsetX,t.$offsetY),t.$offsetX=t.$offsetY=0)},n.prototype.saveTransform=function(){var t=this.globalMatrix,e=this.savedGlobalMatrix;e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.tx=t.tx,e.ty=t.ty},n.prototype.restoreTransform=function(){var t=this.globalMatrix,e=this.savedGlobalMatrix;t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.tx=e.tx,t.ty=e.ty},n.create=function(t,e){var i=r.pop();if(i){i.resize(t,e);var o=i.globalMatrix;o.a=1,o.b=0,o.c=0,o.d=1,o.tx=0,o.ty=0,i.globalAlpha=1,i.$offsetX=0,i.$offsetY=0}else i=new n(t,e),i.$computeDrawCall=!1;return i},n.release=function(t){r.push(t)},n.autoClear=!0,n}(t.HashObject);e.WebGLRenderBuffer=i,__reflect(i.prototype,"egret.web.WebGLRenderBuffer",["egret.sys.RenderBuffer"]);var r=[]}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(){function i(t,i){this.glID=null,this.projectionX=0/0,this.projectionY=0/0,this.contextLost=!1,this.$scissorState=!1,this.vertSize=5,this.surface={width:t,height:i},this.initWebGL(),this.$bufferStack=[];var r=this.context;this.vertexBuffer=r.createBuffer(),this.indexBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.drawCmdManager=new e.WebGLDrawCmdManager,this.vao=new e.WebGLVertexArrayObject,this.setGlobalCompositeOperation("source-over")}return i.getInstance=function(t,e){return this.instance?this.instance:(this.instance=new i(t,e),this.instance)},i.prototype.pushBuffer=function(t){this.$bufferStack.push(t),t!=this.currentBuffer&&(this.currentBuffer,this.drawCmdManager.pushActivateBuffer(t)),this.currentBuffer=t},i.prototype.popBuffer=function(){if(!(this.$bufferStack.length<=1)){var t=this.$bufferStack.pop(),e=this.$bufferStack[this.$bufferStack.length-1];t!=e&&this.drawCmdManager.pushActivateBuffer(e),this.currentBuffer=e}},i.prototype.activateBuffer=function(t){t.rootRenderTarget.activate(),this.bindIndices||this.uploadIndicesArray(this.vao.getIndices()),t.restoreStencil(),t.restoreScissor(),this.onResize(t.width,t.height)},i.prototype.uploadVerticesArray=function(t){for(var e=this.context,i=new BK.Buffer(t.length,!1),r=0;r<t.length;r++)i.writeFloatBuffer(t[r]);e.bufferData(e.ARRAY_BUFFER,i,e.STREAM_DRAW)},i.prototype.uploadIndicesArray=function(t){for(var e=this.context,i=new BK.Buffer(t.length,!1),r=0;r<t.length;r++)i.writeFloatBuffer(t[r]);e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this.bindIndices=!0},i.prototype.destroy=function(){this.surface.width=this.surface.height=0},i.prototype.onResize=function(t,e){t=t||this.surface.width,e=e||this.surface.height,this.projectionX=t/2,this.projectionY=-e/2,this.context&&this.context.viewport(0,0,t,e)},i.prototype.resize=function(t,e,i){var r=this.surface;i?(r.width<t&&(r.width=t),r.height<e&&(r.height=e)):(r.width!=t&&(r.width=t),r.height!=e&&(r.height=e)),this.onResize()},i.prototype.initWebGL=function(){this.onResize(),this.getWebGLContext();var t=this.context;this.$maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)},i.prototype.handleContextLost=function(){this.contextLost=!0},i.prototype.handleContextRestored=function(){this.initWebGL(),this.contextLost=!1},i.prototype.getWebGLContext=function(){var e;({antialias:i.antialias,stencil:!0});e=bkWebGLGetInstance(),e||t.$error(1021),this.setContext(e)},i.prototype.setContext=function(t){this.context=t,t.id=i.glContextId++,this.glID=t.id,t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.colorMask(!0,!0,!0,!0),t.activeTexture(t.TEXTURE0)},i.prototype.enableStencilTest=function(){var t=this.context;t.enable(t.STENCIL_TEST)},i.prototype.disableStencilTest=function(){var t=this.context;t.disable(t.STENCIL_TEST)},i.prototype.enableScissorTest=function(t){var e=this.context;e.enable(e.SCISSOR_TEST),e.scissor(t.x,t.y,t.width,t.height)},i.prototype.disableScissorTest=function(){var t=this.context;t.disable(t.SCISSOR_TEST)},i.prototype.getPixels=function(t,e,i,r,n){var o=this.context;o.readPixels(t,e,i,r,o.RGBA,o.UNSIGNED_BYTE,n)},i.prototype.createTexture=function(t){var e=this.context,i=e.createTexture();if(!i)return void(this.contextLost=!0);i.glContext=e,e.bindTexture(e.TEXTURE_2D,i),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);var r=t.source;return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),i},i.prototype.createTextureFromCompressedData=function(t,e,i,r,n){return null},i.prototype.updateTexture=function(t,e){var i=this.context;i.bindTexture(i.TEXTURE_2D,t);var r=e.source.buffer;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r)},i.prototype.getWebGLTexture=function(t){return t.webGLTexture||("image"==t.format?t.webGLTexture=this.createTexture(t):"pvr"==t.format&&(t.webGLTexture=this.createTextureFromCompressedData(t.source.pvrtcData,t.width,t.height,t.source.mipmapsCount,t.source.format)),t.$deleteSource&&t.webGLTexture&&(t.source=null),t.webGLTexture.smoothing=!0),t.webGLTexture},i.prototype.clearRect=function(t,e,i,r){if(0!=t||0!=e||i!=this.surface.width||r!=this.surface.height){var n=this.currentBuffer;if(n.$hasScissor)this.setGlobalCompositeOperation("destination-out"),this.drawRect(t,e,i,r),this.setGlobalCompositeOperation("source-over");else{var o=n.globalMatrix;0==o.b&&0==o.c?(t=t*o.a+o.tx,e=e*o.d+o.ty,i*=o.a,r*=o.d,this.enableScissor(t,-e-r+n.height,i,r),this.clear(),this.disableScissor()):(this.setGlobalCompositeOperation("destination-out"),this.drawRect(t,e,i,r),this.setGlobalCompositeOperation("source-over"))}}else this.clear()},i.prototype.setGlobalCompositeOperation=function(t){this.drawCmdManager.pushSetBlend(t)},i.prototype.drawImage=function(t,e,i,r,n,o,a,s,h,c,l,u,d){var p=this.currentBuffer;if(!this.contextLost&&t&&p){var f,g,v;if(t.texture||t.source&&t.source.texture)f=t.texture||t.source.texture,p.saveTransform(),g=p.$offsetX,v=p.$offsetY,p.useOffset(),p.transform(1,0,0,-1,0,h+2*a);else{if(!t.source&&!t.webGLTexture)return;f=this.getWebGLTexture(t)}f&&(this.drawTexture(f,e,i,r,n,o,a,s,h,c,l,void 0,void 0,void 0,void 0,u,d),t.source&&t.source.texture&&(p.$offsetX=g,p.$offsetY=v,p.restoreTransform()))}},i.prototype.drawMesh=function(t,e,i,r,n,o,a,s,h,c,l,u,d,p,f,g,v){var y=this.currentBuffer;if(!this.contextLost&&t&&y){var x,b,$;if(t.texture||t.source&&t.source.texture)x=t.texture||t.source.texture,y.saveTransform(),b=y.$offsetX,$=y.$offsetY,y.useOffset(),y.transform(1,0,0,-1,0,h+2*a);else{if(!t.source&&!t.webGLTexture)return;x=this.getWebGLTexture(t)}x&&(this.drawTexture(x,e,i,r,n,o,a,s,h,c,l,u,d,p,f,g,v),(t.texture||t.source&&t.source.texture)&&(y.$offsetX=b,y.$offsetY=$,y.restoreTransform()))}},i.prototype.drawTexture=function(t,e,i,r,n,o,a,s,h,c,l,u,d,p,f,g,v){var y=this.currentBuffer;if(!this.contextLost&&t&&y){d&&p?this.vao.reachMaxSize(d.length/2,p.length)&&this.$drawWebGL():this.vao.reachMaxSize()&&this.$drawWebGL(),void 0!=v&&t.smoothing!=v&&this.drawCmdManager.pushChangeSmoothing(t,v),u&&this.vao.changeToMeshIndices();var x=p?p.length/3:2;this.drawCmdManager.pushDrawTexture(t,x,this.$filter,c,l),this.vao.cacheArrays(y,e,i,r,n,o,a,s,h,c,l,u,d,p,g)}},i.prototype.drawRect=function(t,e,i,r){var n=this.currentBuffer;!this.contextLost&&n&&(this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushDrawRect(),this.vao.cacheArrays(n,0,0,i,r,t,e,i,r,i,r))},i.prototype.pushMask=function(t,e,i,r){var n=this.currentBuffer;!this.contextLost&&n&&(n.$stencilList.push({x:t,y:e,width:i,height:r}),this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPushMask(),this.vao.cacheArrays(n,0,0,i,r,t,e,i,r,i,r))},i.prototype.popMask=function(){var t=this.currentBuffer;if(!this.contextLost&&t){var e=t.$stencilList.pop();this.vao.reachMaxSize()&&this.$drawWebGL(),this.drawCmdManager.pushPopMask(),this.vao.cacheArrays(t,0,0,e.width,e.height,e.x,e.y,e.width,e.height,e.width,e.height)}},i.prototype.clear=function(){this.drawCmdManager.pushClearColor()},i.prototype.enableScissor=function(t,e,i,r){var n=this.currentBuffer;this.drawCmdManager.pushEnableScissor(t,e,i,r),n.$hasScissor=!0},i.prototype.disableScissor=function(){var t=this.currentBuffer;this.drawCmdManager.pushDisableScissor(),t.$hasScissor=!1},i.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen&&!this.contextLost){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var t=this.drawCmdManager.drawDataLen,e=0,i=0;t>i;i++){var r=this.drawCmdManager.drawData[i];e=this.drawData(r,e),7==r.type&&(this.activatedBuffer=r.buffer),(0==r.type||1==r.type||2==r.type||3==r.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear();var n=this.context;n.glCommit()}},i.prototype.drawData=function(t,i){if(t){var r,n=this.context,o=t.filter;switch(t.type){case 0:o?"custom"===o.type?r=e.EgretWebGLProgram.getProgram(n,o.$vertexSrc,o.$fragmentSrc,o.$shaderKey):"colorTransform"===o.type?r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.colorTransform_frag,"colorTransform"):"blurX"===o.type?r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"blurY"===o.type?r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"glow"===o.type&&(r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.glow_frag,"glow")):r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.texture_frag,"texture"),this.activeProgram(n,r),this.syncUniforms(r,o,t.textureWidth,t.textureHeight),i+=this.drawTextureElements(t,i);break;case 1:r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(n,r),this.syncUniforms(r,o,t.textureWidth,t.textureHeight),i+=this.drawRectElements(t,i);break;case 2:r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(n,r),this.syncUniforms(r,o,t.textureWidth,t.textureHeight),i+=this.drawPushMaskElements(t,i);break;case 3:r=e.EgretWebGLProgram.getProgram(n,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(n,r),this.syncUniforms(r,o,t.textureWidth,t.textureHeight),i+=this.drawPopMaskElements(t,i);break;case 4:this.setBlendMode(t.value);break;case 5:t.buffer.rootRenderTarget.resize(t.width,t.height),this.onResize(t.width,t.height);break;case 6:if(this.activatedBuffer){var a=this.activatedBuffer.rootRenderTarget;(0!=a.width||0!=a.height)&&a.clear(!0)}break;case 7:this.activateBuffer(t.buffer);break;case 8:var s=this.activatedBuffer;s&&(s.rootRenderTarget&&s.rootRenderTarget.enabledStencil(),s.enableScissor(t.x,t.y,t.width,t.height));break;case 9:s=this.activatedBuffer,s&&s.disableScissor();break;case 10:n.bindTexture(n.TEXTURE_2D,t.texture),t.smoothing?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST))}return i}},i.prototype.activeProgram=function(t,e){if(e!=this.currentProgram){t.useProgram(e.id);var i=e.attributes;for(var r in i)"aVertexPosition"===r?(t.vertexAttribPointer(i.aVertexPosition.location,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(i.aVertexPosition.location)):"aTextureCoord"===r?(t.vertexAttribPointer(i.aTextureCoord.location,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(i.aTextureCoord.location)):"aColor"===r&&(t.vertexAttribPointer(i.aColor.location,1,t.FLOAT,!1,20,16),t.enableVertexAttribArray(i.aColor.location));this.currentProgram=e}},i.prototype.syncUniforms=function(t,e,i,r){var n=t.uniforms;e&&"custom"===e.type;for(var o in n)if("projectionVector"===o)n[o].setValue({x:this.projectionX,y:this.projectionY});else if("uTextureSize"===o)n[o].setValue({x:i,y:r});else if("uSampler"===o);else{var a=e.$uniforms[o];void 0!==a&&n[o].setValue(a)}},i.prototype.drawTextureElements=function(t,e){var i=this.context;i.bindTexture(i.TEXTURE_2D,t.texture);var r=3*t.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*e),r},i.prototype.drawRectElements=function(t,e){var i=this.context,r=3*t.count;return i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*e),r},i.prototype.drawPushMaskElements=function(t,e){var i=this.context,r=3*t.count,n=this.activatedBuffer;if(n){n.rootRenderTarget&&n.rootRenderTarget.enabledStencil(),0==n.stencilHandleCount&&(n.enableStencil(),i.clear(i.STENCIL_BUFFER_BIT));var o=n.stencilHandleCount;n.stencilHandleCount++,i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,o,255),i.stencilOp(i.KEEP,i.KEEP,i.INCR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*e),i.stencilFunc(i.EQUAL,o+1,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},i.prototype.drawPopMaskElements=function(t,e){var i=this.context,r=3*t.count,n=this.activatedBuffer;if(n)if(n.stencilHandleCount--,0==n.stencilHandleCount)n.disableStencil();else{var o=n.stencilHandleCount;i.colorMask(!1,!1,!1,!1),i.stencilFunc(i.EQUAL,o+1,255),i.stencilOp(i.KEEP,i.KEEP,i.DECR),i.drawElements(i.TRIANGLES,r,i.UNSIGNED_SHORT,2*e),i.stencilFunc(i.EQUAL,o,255),i.colorMask(!0,!0,!0,!0),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}return r},i.prototype.setBlendMode=function(t){var e=this.context,r=i.blendModesForGL[t];r&&e.blendFunc(r[0],r[1])},i.prototype.drawTargetWidthFilters=function(t,i){var r,n=i,o=t.length;if(o>1)for(var a=0;o-1>a;a++){var s=t[a],h=i.rootRenderTarget.width,c=i.rootRenderTarget.height;r=e.WebGLRenderBuffer.create(h,c),r.setTransform(1,0,0,1,0,0),r.globalAlpha=1,this.drawToRenderTarget(s,i,r),i!=n&&e.WebGLRenderBuffer.release(i),i=r}var l=t[o-1];this.drawToRenderTarget(l,i,this.currentBuffer),i!=n&&e.WebGLRenderBuffer.release(i)},i.prototype.drawToRenderTarget=function(t,i,r){if(!this.contextLost){this.vao.reachMaxSize()&&this.$drawWebGL(),this.pushBuffer(r);var n,o=i,a=i.rootRenderTarget.width,s=i.rootRenderTarget.height;if("blur"==t.type){var h=t.blurXFilter,c=t.blurYFilter;0!=h.blurX&&0!=c.blurY?(n=e.WebGLRenderBuffer.create(a,s),n.setTransform(1,0,0,1,0,0),n.globalAlpha=1,this.drawToRenderTarget(t.blurXFilter,i,n),i!=o&&e.WebGLRenderBuffer.release(i),i=n,t=c):t=0===h.blurX?c:h}r.saveTransform(),r.transform(1,0,0,-1,0,s),this.vao.cacheArrays(r,0,0,a,s,0,0,a,s,a,s),r.restoreTransform(),this.drawCmdManager.pushDrawTexture(i.rootRenderTarget.texture,2,t,a,s),i!=o&&e.WebGLRenderBuffer.release(i),this.popBuffer()}},i.initBlendMode=function(){i.blendModesForGL={},i.blendModesForGL["source-over"]=[1,771],i.blendModesForGL.lighter=[1,1],i.blendModesForGL["lighter-in"]=[770,771],i.blendModesForGL["destination-out"]=[0,771],i.blendModesForGL["destination-in"]=[0,770]},i.glContextId=0,i.blendModesForGL=null,i}();e.WebGLRenderContext=i,__reflect(i.prototype,"egret.web.WebGLRenderContext"),i.initBlendMode()}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=["source-over","lighter","destination-out"],r="source-over",n=[],o=function(){function o(){this.nestLevel=0}return o.prototype.render=function(e,i,r,o){this.nestLevel++;var a=i,s=a.context;s.pushBuffer(a),a.transform(r.a,r.b,r.c,r.d,0,0),this.drawDisplayObject(e,a,r.tx,r.ty,!0),s.$drawWebGL();var h=a.$drawCalls;a.onRenderFinish(),s.popBuffer();var c=t.Matrix.create();if(r.$invertInto(c),a.transform(c.a,c.b,c.c,c.d,0,0),t.Matrix.release(c),this.nestLevel--,0===this.nestLevel){n.length>6&&(n.length=6);for(var l=n.length,u=0;l>u;u++)n[u].resize(0,0)}return h},o.prototype.drawDisplayObject=function(e,i,r,n,o){var a,s=0,h=e.$displayList;if(h&&!o?((e.$cacheDirty||e.$renderDirty||h.$canvasScaleX!=t.sys.DisplayList.$canvasScaleX||h.$canvasScaleY!=t.sys.DisplayList.$canvasScaleY)&&(s+=h.drawToSurface()),a=h.$renderNode):a=e.$renderDirty?e.$getRenderNode():e.$renderNode,e.$cacheDirty=!1,a){switch(s++,i.$offsetX=r,i.$offsetY=n,a.type){case 1:this.renderBitmap(a,i);break;case 2:this.renderText(a,i);break;case 3:this.renderGraphics(a,i);break;case 4:this.renderGroup(a,i);break;case 5:this.renderMesh(a,i);break;case 6:this.renderNormalBitmap(a,i)}i.$offsetX=0,i.$offsetY=0}if(h&&!o)return s;var c=e.$children;if(c)for(var l=c.length,u=0;l>u;u++){var d=c[u],p=void 0,f=void 0,g=void 0;1!=d.$alpha&&(g=i.globalAlpha,i.globalAlpha*=d.$alpha);var v=void 0;if(d.$useTranslate){var y=d.$getMatrix();p=r+d.$x,f=n+d.$y;var x=i.globalMatrix;v=t.Matrix.create(),v.a=x.a,v.b=x.b,v.c=x.c,v.d=x.d,v.tx=x.tx,v.ty=x.ty,i.transform(y.a,y.b,y.c,y.d,p,f),p=-d.$anchorOffsetX,f=-d.$anchorOffsetY}else p=r+d.$x-d.$anchorOffsetX,f=n+d.$y-d.$anchorOffsetY;switch(d.$renderMode){case 1:break;case 2:s+=this.drawWithFilter(d,i,p,f);break;case 3:s+=this.drawWithClip(d,i,p,f);break;case 4:s+=this.drawWithScrollRect(d,i,p,f);break;default:s+=this.drawDisplayObject(d,i,p,f)}if(g&&(i.globalAlpha=g),v){var y=i.globalMatrix;y.a=v.a,y.b=v.b,y.c=v.c,y.d=v.d,y.tx=v.tx,y.ty=v.ty,t.Matrix.release(v)}}return s},o.prototype.drawWithFilter=function(e,o,a,s){var h=0;if(e.$children&&0==e.$children.length&&(!e.$renderNode||0==e.$renderNode.$getRenderCount()))return h;var c,l=e.$filters,u=0!==e.$blendMode;u&&(c=i[e.$blendMode],c||(c=r));var d=e.$getOriginalBounds(),p=d.x,f=d.y,g=d.width,v=d.height;if(0>=g||0>=v)return h;if(!e.mask&&1==l.length&&("colorTransform"==l[0].type||"custom"===l[0].type&&0===l[0].padding)){var y=this.getRenderCount(e);if(!e.$children||1==y)return u&&o.context.setGlobalCompositeOperation(c),o.context.$filter=l[0],h+=e.$mask?this.drawWithClip(e,o,a,s):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,o,a,s):this.drawDisplayObject(e,o,a,s),o.context.$filter=null,u&&o.context.setGlobalCompositeOperation(r),h}var x=this.createRenderBuffer(g,v);if(x.context.pushBuffer(x),h+=e.$mask?this.drawWithClip(e,x,-p,-f):e.$scrollRect||e.$maskRect?this.drawWithScrollRect(e,x,-p,-f):this.drawDisplayObject(e,x,-p,-f),x.context.popBuffer(),h>0){u&&o.context.setGlobalCompositeOperation(c),h++,o.$offsetX=a+p,o.$offsetY=s+f;var b=t.Matrix.create(),$=o.globalMatrix;b.a=$.a,b.b=$.b,b.c=$.c,b.d=$.d,b.tx=$.tx,b.ty=$.ty,o.useOffset(),o.context.drawTargetWidthFilters(l,x),$.a=b.a,$.b=b.b,$.c=b.c,$.d=b.d,$.tx=b.tx,$.ty=b.ty,t.Matrix.release(b),u&&o.context.setGlobalCompositeOperation(r)}return n.push(x),h},o.prototype.getRenderCount=function(t){var e=0;if(t.$children)for(var i=0,r=t.$children;i<r.length;i++){var n=r[i],o=n.$getRenderNode();o&&(e+=o.$getRenderCount()),n.$children&&(e+=this.getRenderCount(n))}return e},o.prototype.drawWithClip=function(e,o,a,s){var h,c=0,l=0!==e.$blendMode;l&&(h=i[e.$blendMode],h||(h=r));var u=e.$scrollRect?e.$scrollRect:e.$maskRect,d=e.$mask;if(d){var p=d.$getMatrix();if(0==p.a&&0==p.b||0==p.c&&0==p.d)return c}if(d||e.$children&&0!=e.$children.length){var f=e.$getOriginalBounds(),g=f.x,v=f.y,y=f.width,x=f.height,b=this.createRenderBuffer(y,x);if(b.context.pushBuffer(b),c+=this.drawDisplayObject(e,b,-g,-v),d){var $=this.createRenderBuffer(y,x);$.context.pushBuffer($);var m=t.Matrix.create();m.copyFrom(d.$getConcatenatedMatrix()),d.$getConcatenatedMatrixAt(e,m),m.translate(-g,-v),$.setTransform(m.a,m.b,m.c,m.d,m.tx,m.ty),t.Matrix.release(m),c+=this.drawDisplayObject(d,$,0,0),$.context.popBuffer(),b.context.setGlobalCompositeOperation("destination-in"),b.setTransform(1,0,0,-1,0,$.height),b.globalAlpha=1;var T=$.rootRenderTarget.width,_=$.rootRenderTarget.height;b.context.drawTexture($.rootRenderTarget.texture,0,0,T,_,0,0,T,_,T,_),b.setTransform(1,0,0,1,0,0),b.context.setGlobalCompositeOperation("source-over"),n.push($)}if(b.context.setGlobalCompositeOperation(r),b.context.popBuffer(),c>0){c++,l&&o.context.setGlobalCompositeOperation(h),u&&o.context.pushMask(u.x+a,u.y+s,u.width,u.height),o.globalAlpha=1;var w=t.Matrix.create(),S=o.globalMatrix;w.a=S.a,w.b=S.b,w.c=S.c,w.d=S.d,w.tx=S.tx,w.ty=S.ty,S.append(1,0,0,-1,a+g,s+v+b.height);var B=b.rootRenderTarget.width,E=b.rootRenderTarget.height;o.context.drawTexture(b.rootRenderTarget.texture,0,0,B,E,0,0,B,E,B,E),u&&b.context.popMask(),l&&o.context.setGlobalCompositeOperation(r);var C=o.globalMatrix;C.a=w.a,C.b=w.b,C.c=w.c,C.d=w.d,C.tx=w.tx,C.ty=w.ty,t.Matrix.release(w)}return n.push(b),c}return u&&o.context.pushMask(u.x+a,u.y+s,u.width,u.height),l&&o.context.setGlobalCompositeOperation(h),c+=this.drawDisplayObject(e,o,a,s),l&&o.context.setGlobalCompositeOperation(r),u&&o.context.popMask(),c},o.prototype.drawWithScrollRect=function(t,e,i,r){var n=0,o=t.$scrollRect?t.$scrollRect:t.$maskRect;if(o.isEmpty())return n;t.$scrollRect&&(i-=o.x,r-=o.y);var a=e.globalMatrix,s=e.context,h=!1;if(e.$hasScissor||0!=a.b||0!=a.c)e.context.pushMask(o.x+i,o.y+r,o.width,o.height);else{var c=a.a,l=a.d,u=a.tx,d=a.ty,p=o.x+i,f=o.y+r,g=p+o.width,v=f+o.height,y=void 0,x=void 0,b=void 0,$=void 0;if(1==c&&1==l)y=p+u,x=f+d,b=g+u,$=v+d;else{var m=c*p+u,T=l*f+d,_=c*g+u,w=l*f+d,S=c*g+u,B=l*v+d,E=c*p+u,C=l*v+d,R=0;m>_&&(R=m,m=_,_=R),S>E&&(R=S,S=E,E=R),y=S>m?m:S,b=_>E?_:E,T>w&&(R=T,T=w,w=R),B>C&&(R=B,B=C,C=R),x=B>T?T:B,$=w>C?w:C}s.enableScissor(y,-$+e.height,b-y,$-x),h=!0}return n+=this.drawDisplayObject(t,e,i,r),h?s.disableScissor():s.popMask(),n},o.prototype.drawNodeToBuffer=function(t,e,i,r){var n=e;n.context.pushBuffer(n),n.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty),this.renderNode(t,e,0,0,r),n.context.$drawWebGL(),n.onRenderFinish(),n.context.popBuffer()},o.prototype.drawDisplayToBuffer=function(t,e,i){e.context.pushBuffer(e),i&&e.setTransform(i.a,i.b,i.c,i.d,i.tx,i.ty);var r;r=t.$renderDirty?t.$getRenderNode():t.$renderNode;var n=0;if(r)switch(n++,r.type){case 1:this.renderBitmap(r,e);break;case 2:this.renderText(r,e);break;case 3:this.renderGraphics(r,e);break;case 4:this.renderGroup(r,e);break;case 5:this.renderMesh(r,e);break;case 6:this.renderNormalBitmap(r,e)}var o=t.$children;if(o)for(var a=o.length,s=0;a>s;s++){var h=o[s];switch(h.$renderMode){case 1:break;case 2:n+=this.drawWithFilter(h,e,0,0);break;case 3:n+=this.drawWithClip(h,e,0,0);break;case 4:n+=this.drawWithScrollRect(h,e,0,0);break;default:n+=this.drawDisplayObject(h,e,0,0)}}return e.context.$drawWebGL(),e.onRenderFinish(),e.context.popBuffer(),n},o.prototype.renderNode=function(t,e,i,r,n){switch(e.$offsetX=i,e.$offsetY=r,t.type){case 1:this.renderBitmap(t,e);break;case 2:this.renderText(t,e);break;case 3:this.renderGraphics(t,e,n);break;case 4:this.renderGroup(t,e);break;case 5:this.renderMesh(t,e);break;case 6:this.renderNormalBitmap(t,e)}},o.prototype.renderNormalBitmap=function(t,e){var i=t.image;i&&e.context.drawImage(i,t.sourceX,t.sourceY,t.sourceW,t.sourceH,t.drawX,t.drawY,t.drawW,t.drawH,t.imageWidth,t.imageHeight,t.rotated,t.smoothing)},o.prototype.renderBitmap=function(e,n){var o=e.image;if(o){var a,s,h,c=e.drawData,l=c.length,u=0,d=e.matrix,p=e.blendMode,f=e.alpha;if(d){a=t.Matrix.create();var g=n.globalMatrix;a.a=g.a,a.b=g.b,a.c=g.c,a.d=g.d,a.tx=g.tx,a.ty=g.ty,s=n.$offsetX,h=n.$offsetY,n.useOffset(),n.transform(d.a,d.b,d.c,d.d,d.tx,d.ty)}p&&n.context.setGlobalCompositeOperation(i[p]);var v;if(f==f&&(v=n.globalAlpha,n.globalAlpha*=f),e.filter){for(n.context.$filter=e.filter;l>u;)n.context.drawImage(o,c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);n.context.$filter=null}else for(;l>u;)n.context.drawImage(o,c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],e.imageWidth,e.imageHeight,e.rotated,e.smoothing);if(p&&n.context.setGlobalCompositeOperation(r),f==f&&(n.globalAlpha=v),d){var y=n.globalMatrix;y.a=a.a,y.b=a.b,y.c=a.c,y.d=a.d,y.tx=a.tx,y.ty=a.ty,n.$offsetX=s,n.$offsetY=h,t.Matrix.release(a)}}},o.prototype.renderMesh=function(e,n){var o,a,s,h=e.image,c=e.drawData,l=c.length,u=0,d=e.matrix,p=e.blendMode,f=e.alpha;if(d){o=t.Matrix.create();var g=n.globalMatrix;o.a=g.a,o.b=g.b,o.c=g.c,o.d=g.d,o.tx=g.tx,o.ty=g.ty,a=n.$offsetX,s=n.$offsetY,n.useOffset(),n.transform(d.a,d.b,d.c,d.d,d.tx,d.ty)}p&&n.context.setGlobalCompositeOperation(i[p]);
var v;if(f==f&&(v=n.globalAlpha,n.globalAlpha*=f),e.filter){for(n.context.$filter=e.filter;l>u;)n.context.drawMesh(h,c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds,e.rotated,e.smoothing);n.context.$filter=null}else for(;l>u;)n.context.drawMesh(h,c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],c[u++],e.imageWidth,e.imageHeight,e.uvs,e.vertices,e.indices,e.bounds,e.rotated,e.smoothing);if(p&&n.context.setGlobalCompositeOperation(r),f==f&&(n.globalAlpha=v),d){var y=n.globalMatrix;y.a=o.a,y.b=o.b,y.c=o.c,y.d=o.d,y.tx=o.tx,y.ty=o.ty,n.$offsetX=a,n.$offsetY=s,t.Matrix.release(o)}},o.prototype.renderText=function(t,e){},o.prototype.renderGraphics=function(e,i,r){var n=e.width,o=e.height;if(!(0>=n||0>=o)&&n&&o&&0!=e.drawData.length){var a=t.sys.DisplayList.$canvasScaleX,s=t.sys.DisplayList.$canvasScaleY;(1>n*a||1>o*s)&&(a=s=1),(e.$canvasScaleX!=a||e.$canvasScaleY!=s)&&(e.$canvasScaleX=a,e.$canvasScaleY=s,e.dirtyRender=!0),n*=a,o*=s;var h=Math.ceil(n),c=Math.ceil(o);if(a*=h/n,s*=c/o,n=h,o=c,this.canvasRenderBuffer&&this.canvasRenderBuffer.context?(e.dirtyRender||r)&&this.canvasRenderBuffer.resize(n,o):(this.canvasRenderer=new t.CanvasRenderer,this.canvasRenderBuffer=new t.sys.CanvasRenderBuffer(n,o)),this.canvasRenderBuffer.context){(1!=a||1!=s)&&this.canvasRenderBuffer.context.setTransform(a,0,0,s,0,0),(e.x||e.y)&&((e.dirtyRender||r)&&this.canvasRenderBuffer.context.translate(-e.x,-e.y),i.transform(1,0,0,1,e.x,e.y));var l=this.canvasRenderBuffer.surface;if(r){this.canvasRenderer.renderGraphics(e,this.canvasRenderBuffer.context,!0),t.WebGLUtils.deleteWebGLTexture(l);var u=i.context.getWebGLTexture(l);i.context.drawTexture(u,0,0,n,o,0,0,n,o,l.width,l.height)}else{if(e.dirtyRender){this.canvasRenderer.renderGraphics(e,this.canvasRenderBuffer.context);var u=e.$texture;u?i.context.updateTexture(u,l):(u=i.context.createTexture(l),e.$texture=u),e.$textureWidth=l.width,e.$textureHeight=l.height}var d=e.$textureWidth,p=e.$textureHeight;i.context.drawTexture(e.$texture,0,0,d,p,0,0,d/a,p/s,d,p)}(e.x||e.y)&&((e.dirtyRender||r)&&this.canvasRenderBuffer.context.translate(e.x,e.y),i.transform(1,0,0,1,-e.x,-e.y)),r||(e.dirtyRender=!1)}}},o.prototype.renderGroup=function(e,i){var r,n,o,a=e.matrix;if(a){r=t.Matrix.create();var s=i.globalMatrix;r.a=s.a,r.b=s.b,r.c=s.c,r.d=s.d,r.tx=s.tx,r.ty=s.ty,n=i.$offsetX,o=i.$offsetY,i.useOffset(),i.transform(a.a,a.b,a.c,a.d,a.tx,a.ty)}for(var h=e.drawData,c=h.length,l=0;c>l;l++){var u=h[l];this.renderNode(u,i,i.$offsetX,i.$offsetY)}if(a){var d=i.globalMatrix;d.a=r.a,d.b=r.b,d.c=r.c,d.d=r.d,d.tx=r.tx,d.ty=r.ty,i.$offsetX=n,i.$offsetY=o,t.Matrix.release(r)}},o.prototype.createRenderBuffer=function(t,i){var r=n.pop();return r?r.resize(t,i):(r=new e.WebGLRenderBuffer(t,i),r.$computeDrawCall=!1),r},o}();e.WebGLRenderer=o,__reflect(o.prototype,"egret.web.WebGLRenderer",["egret.sys.SystemRenderer"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(t,i,r){var n=e.call(this)||this;return n.clearColor=[0,0,0,0],n.useFrameBuffer=!0,n.gl=t,n.width=i||1,n.height=r||1,n}return __extends(i,e),i.prototype.resize=function(t,e){var i=this.gl;this.width=t,this.height=e,this.frameBuffer&&(i.bindTexture(i.TEXTURE_2D,this.texture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t,e,0,i.RGBA,i.UNSIGNED_BYTE,null)),this.stencilBuffer&&(i.deleteRenderbuffer(this.stencilBuffer),this.stencilBuffer=null)},i.prototype.activate=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer())},i.prototype.getFrameBuffer=function(){return this.useFrameBuffer?this.frameBuffer:null},i.prototype.initFrameBuffer=function(){if(!this.frameBuffer){var t=this.gl;this.texture=this.createTexture(),this.frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},i.prototype.createTexture=function(){var t=this.gl,e=t.createTexture();return e.glContext=t,t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),e},i.prototype.clear=function(t){var e=this.gl;t&&this.activate(),e.colorMask(!0,!0,!0,!0),e.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e.clear(e.COLOR_BUFFER_BIT)},i.prototype.enabledStencil=function(){if(this.frameBuffer&&!this.stencilBuffer){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),this.stencilBuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.stencilBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,this.width,this.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.stencilBuffer)}},i.prototype.dispose=function(){t.WebGLUtils.deleteWebGLTexture(this.texture)},i}(t.HashObject);e.WebGLRenderTarget=i,__reflect(i.prototype,"egret.web.WebGLRenderTarget")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e=function(){function e(){}return e.compileProgram=function(e,i,r){var n=t.WebGLUtils.compileFragmentShader(e,r),o=t.WebGLUtils.compileVertexShader(e,i),a=e.createProgram();return e.attachShader(a,o),e.attachShader(a,n),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)||t.$warn(1020),a},e.compileFragmentShader=function(t,e){return this._compileShader(t,e,t.FRAGMENT_SHADER)},e.compileVertexShader=function(t,e){return this._compileShader(t,e,t.VERTEX_SHADER)},e._compileShader=function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:null},e.checkCanUseWebGL=function(){return!0},e.deleteWebGLTexture=function(t){if(t){var e=t.glContext;e&&e.deleteTexture(t)}},e}();t.BKWebGLUtils=e,__reflect(e.prototype,"egret.BKWebGLUtils"),t.WebGLUtils=e}(egret||(egret={}));var egret;!function(t){var e;!function(t){var e=function(){function t(){this.size=2e3,this.vertexMaxSize=4*this.size,this.indicesMaxSize=6*this.size,this.vertSize=5,this.vertices=null,this.indices=null,this.indicesForMesh=null,this.vertexIndex=0,this.indexIndex=0,this.hasMesh=!1;var t=this.vertexMaxSize*this.vertSize,e=this.indicesMaxSize;this.vertices=new Float32Array(t),this.indices=new Uint16Array(e),this.indicesForMesh=new Uint16Array(e);for(var i=0,r=0;e>i;i+=6,r+=4)this.indices[i+0]=r+0,this.indices[i+1]=r+1,this.indices[i+2]=r+2,this.indices[i+3]=r+0,this.indices[i+4]=r+2,this.indices[i+5]=r+3}return t.prototype.reachMaxSize=function(t,e){return void 0===t&&(t=4),void 0===e&&(e=6),this.vertexIndex>this.vertexMaxSize-t||this.indexIndex>this.indicesMaxSize-e},t.prototype.getVertices=function(){var t=this.vertices.subarray(0,this.vertexIndex*this.vertSize);return t},t.prototype.getIndices=function(){return this.indices},t.prototype.getMeshIndices=function(){return this.indicesForMesh},t.prototype.changeToMeshIndices=function(){if(!this.hasMesh){for(var t=0,e=this.indexIndex;e>t;++t)this.indicesForMesh[t]=this.indices[t];this.hasMesh=!0}},t.prototype.isMesh=function(){return this.hasMesh},t.prototype.cacheArrays=function(t,e,i,r,n,o,a,s,h,c,l,u,d,p,f){var g=t.globalAlpha,v=t.globalMatrix,y=v.a,x=v.b,b=v.c,$=v.d,m=v.tx,T=v.ty,_=t.$offsetX,w=t.$offsetY;if((0!=_||0!=w)&&(m=_*y+w*b+m,T=_*x+w*$+T),!d){(0!=o||0!=a)&&(m=o*y+a*b+m,T=o*x+a*$+T);var S=s/r;1!=S&&(y=S*y,x=S*x);var B=h/n;1!=B&&(b=B*b,$=B*$)}if(d){var E=this.vertices,C=this.vertexIndex*this.vertSize,R=0,F=0,L=0,D=0,O=0,A=0,M=0;for(R=0,L=u.length;L>R;R+=2)F=C+5*R/2,A=d[R],M=d[R+1],D=u[R],O=u[R+1],E[F+0]=y*A+b*M+m,E[F+1]=x*A+$*M+T,f?(E[F+2]=(e+(1-O)*n)/c,E[F+3]=(i+D*r)/l):(E[F+2]=(e+D*r)/c,E[F+3]=(i+O*n)/l),E[F+4]=g;if(this.hasMesh)for(var N=0,k=p.length;k>N;++N)this.indicesForMesh[this.indexIndex+N]=p[N]+this.vertexIndex;this.vertexIndex+=u.length/2,this.indexIndex+=p.length}else{var P=c,I=l,G=r,W=n;e/=P,i/=I;var E=this.vertices,C=this.vertexIndex*this.vertSize;if(f){var U=r;r=n/P,n=U/I,E[C++]=m,E[C++]=T,E[C++]=r+e,E[C++]=i,E[C++]=g,E[C++]=y*G+m,E[C++]=x*G+T,E[C++]=r+e,E[C++]=n+i,E[C++]=g,E[C++]=y*G+b*W+m,E[C++]=$*W+x*G+T,E[C++]=e,E[C++]=n+i,E[C++]=g,E[C++]=b*W+m,E[C++]=$*W+T,E[C++]=e,E[C++]=i,E[C++]=g}else r/=P,n/=I,E[C++]=m,E[C++]=T,E[C++]=e,E[C++]=i,E[C++]=g,E[C++]=y*G+m,E[C++]=x*G+T,E[C++]=r+e,E[C++]=i,E[C++]=g,E[C++]=y*G+b*W+m,E[C++]=$*W+x*G+T,E[C++]=r+e,E[C++]=n+i,E[C++]=g,E[C++]=b*W+m,E[C++]=$*W+T,E[C++]=e,E[C++]=n+i,E[C++]=g;if(this.hasMesh){var K=this.indicesForMesh;K[this.indexIndex+0]=0+this.vertexIndex,K[this.indexIndex+1]=1+this.vertexIndex,K[this.indexIndex+2]=2+this.vertexIndex,K[this.indexIndex+3]=0+this.vertexIndex,K[this.indexIndex+4]=2+this.vertexIndex,K[this.indexIndex+5]=3+this.vertexIndex}this.vertexIndex+=4,this.indexIndex+=6}},t.prototype.clear=function(){this.hasMesh=!1,this.vertexIndex=0,this.indexIndex=0},t}();t.WebGLVertexArrayObject=e,__reflect(e.prototype,"egret.web.WebGLVertexArrayObject")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(t){var i=e.call(this)||this;return i._mainTicker=BK.Director.ticker,i.init(t),i}return __extends(i,e),i.prototype.init=function(e){var i=this.readOption(e),r=new t.Stage;r.$screen=this,r.$scaleMode=i.scaleMode,r.$orientation=i.orientation,r.$maxTouches=i.maxTouches,r.frameRate=i.frameRate,r.textureScaleFactor=i.textureScaleFactor;var n=new t.sys.RenderBuffer(void 0,void 0,!0);t.lifecycle.stage=r,this.playerOption=i,this.stage=r,this._touches=new t.sys.TouchHandler(this.stage),this._entryClassName=i.entryClassName,this.screenDisplayList=this.createDisplayList(r,n),this.updateScreenSize(),this.updateMaxTouches(),this.start()},i.prototype.readOption=function(e){var i={};return i.entryClassName=e.entryClassName,i.scaleMode=e.scaleMode||t.StageScaleMode.NO_SCALE,i.frameRate=+e.frameRate||30,i.contentWidth=+e.contentWidth||480,i.contentHeight=+e.contentHeight||800,i.orientation=e.orientation||t.OrientationMode.AUTO,i.maxTouches=10,i.textureScaleFactor=1,i},i.prototype.createDisplayList=function(e,i){var r=new t.sys.BKDisplayList(e);return r.renderBuffer=i,e.$displayList=r,r},i.prototype.updateScreenSize=function(){var e=BK.Director.screenPixelSize,i=e.width,r=e.height;t.Capabilities.$boundingClientWidth=i,t.Capabilities.$boundingClientHeight=r;var n=t.sys.screenAdapter.calculateStageSize(this.stage.$scaleMode,i,r,this.playerOption.contentWidth,this.playerOption.contentHeight),o=n.stageWidth,a=n.stageHeight,s=n.displayWidth,h=n.displayHeight;this.stage.$stageWidth=o,this.stage.$stageHeight=a;var c=s/o,l=h/a,u=c*t.sys.DisplayList.$canvasScaleFactor,d=l*t.sys.DisplayList.$canvasScaleFactor;t.sys.DisplayList.$setCanvasScale(u,d),this.updateStageSize(o,a)},i.prototype.updateStageSize=function(e,i){var r=this.stage;r.$stageWidth=e,r.$stageHeight=i,this.screenDisplayList.setClipRect(e,i),r.dispatchEventWith(t.Event.RESIZE)},i.prototype.setContentSize=function(t,e){var i=this.playerOption;i.contentWidth=t,i.contentHeight=e,this.updateScreenSize()},i.prototype.updateMaxTouches=function(){this._touches.$initMaxTouches()},i.prototype.start=function(){var e,i=this._entryClassName;if(i&&(e=t.getDefinitionByName(i)),e){var r=new e;r instanceof t.DisplayObject&&this.stage.addChild(r)}t.ticker.$addPlayer(this)},i.prototype.$render=function(t,e){var i=this.stage;i.$displayList.drawToSurface()},i}(t.HashObject);e.BKWebPlayer=i,__reflect(i.prototype,"egret.web.BKWebPlayer",["egret.sys.Screen"])}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e;!function(e){var i=function(e){function i(i,r){var n=e.call(this)||this;return n.onTouchBegin=function(t){var e=n.getLocation(t);n.touch.onTouchBegin(e.x,e.y,t.identifier)},n.onMouseMove=function(t){0==t.buttons?n.onTouchEnd(t):n.onTouchMove(t)},n.onTouchMove=function(t){var e=n.getLocation(t);n.touch.onTouchMove(e.x,e.y,t.identifier)},n.onTouchEnd=function(t){var e=n.getLocation(t);n.touch.onTouchEnd(e.x,e.y,t.identifier)},n.scaleX=1,n.scaleY=1,n.rotation=0,n.canvas=r,n.touch=new t.sys.TouchHandler(i),n.addListeners(),n}return __extends(i,e),i.prototype.addListeners=function(){var e=this;window.navigator.msPointerEnabled?(this.canvas.addEventListener("MSPointerDown",function(t){t.identifier=t.pointerId,e.onTouchBegin(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerMove",function(t){t.identifier=t.pointerId,e.onTouchMove(t),e.prevent(t)},!1),this.canvas.addEventListener("MSPointerUp",function(t){t.identifier=t.pointerId,e.onTouchEnd(t),e.prevent(t)},!1)):(t.Capabilities.isMobile||this.addMouseListener(),this.addTouchListener())},i.prototype.addMouseListener=function(){this.canvas.addEventListener("mousedown",this.onTouchBegin),this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseup",this.onTouchEnd)},i.prototype.addTouchListener=function(){var t=this;this.canvas.addEventListener("touchstart",function(e){for(var i=e.changedTouches.length,r=0;i>r;r++)t.onTouchBegin(e.changedTouches[r]);t.prevent(e)},!1),this.canvas.addEventListener("touchmove",function(e){for(var i=e.changedTouches.length,r=0;i>r;r++)t.onTouchMove(e.changedTouches[r]);t.prevent(e)},!1),this.canvas.addEventListener("touchend",function(e){for(var i=e.changedTouches.length,r=0;i>r;r++)t.onTouchEnd(e.changedTouches[r]);t.prevent(e)},!1),this.canvas.addEventListener("touchcancel",function(e){for(var i=e.changedTouches.length,r=0;i>r;r++)t.onTouchEnd(e.changedTouches[r]);t.prevent(e)},!1)},i.prototype.prevent=function(t){t.stopPropagation(),1==t.isScroll||this.canvas.userTyping||t.preventDefault()},i.prototype.getLocation=function(e){e.identifier=+e.identifier||0;var i=document.documentElement,r=this.canvas.getBoundingClientRect(),n=r.left+window.pageXOffset-i.clientLeft,o=r.top+window.pageYOffset-i.clientTop,a=e.pageX-n,s=a,h=e.pageY-o,c=h;return 90==this.rotation?(s=h,c=r.width-a):-90==this.rotation&&(s=r.height-h,c=a),s/=this.scaleX,c/=this.scaleY,t.$TempPoint.setTo(Math.round(s),Math.round(c))},i.prototype.updateScaleMode=function(t,e,i){this.scaleX=t,this.scaleY=e,this.rotation=i},i.prototype.$updateMaxTouches=function(){this.touch.$initMaxTouches()},i}(t.HashObject);e.WebTouchHandler=i,__reflect(i.prototype,"egret.web.WebTouchHandler")}(e=t.web||(t.web={}))}(egret||(egret={}));var egret;!function(t){var e=function(e){function i(t){void 0===t&&(t=null);var i=e.call(this,new BK.Sprite(0,0,{},0,1,1,1))||this;return i.$explicitBitmapWidth=0/0,i.$explicitBitmapHeight=0/0,i._size={width:0,height:0},i.hasScale9Grid=!1,i.$bitmapData=null,i.$texture=null,i.$scale9Grid=null,i._bkSprite=i._bkNode,i.texture=t,i}return __extends(i,e),i.prototype._updateBKNodeMatrix=function(){if(this.$texture){var t=this.$getMatrix(),e=this._bkNode.transform.matrix,i=t.tx,r=t.ty,n=this.$anchorOffsetX,o=this.$anchorOffsetY-this._size.height;(0!==n||0!==o)&&(i-=t.a*n+t.c*o,r-=t.b*n+t.d*o),e.set(t.a,-t.b,-t.c,t.d,i,-r)}},Object.defineProperty(i.prototype,"texture",{get:function(){return this.$texture},set:function(t){this.$texture!==t&&this.$setTexture(t)},enumerable:!0,configurable:!0}),i.prototype.$setTexture=function(e){if(this.$texture=e,this.$texture)if(this._transformDirty=!0,this.$bitmapData=this.$texture.bitmapData,this.$bitmapData.bkTexture){if(this._bkSprite.setTexture(this.$bitmapData.bkTexture),this.$bitmapData.isFlip&&this._bkSprite.setUVFlip(0,0),this._bkSprite.adjustTexturePosition(this.$texture.$bitmapX,this.$texture.$sourceHeight-(this.$texture.$bitmapY+this.$texture.$bitmapHeight),this.$texture.$bitmapWidth,this.$texture.$bitmapHeight,this.$texture.$rotated),this._size.width=this.$getWidth(),this._size.height=this.$getHeight(),this._bkSprite.size=this._size,this.$texture.scale9Grid&&!this.hasScale9Grid){var i=new t.Rectangle;i.setTo(this.$texture.scale9Grid.x,this.$texture.scale9Grid.y,this.$texture.scale9Grid.width,this.$texture.scale9Grid.height),this.$setScale9Grid(i)}}else this.$bitmapData=null,this._bkSprite.setTexture({});else this.$bitmapData=null,this._bkSprite.setTexture({})},Object.defineProperty(i.prototype,"scale9Grid",{get:function(){return this.$scale9Grid},set:function(t){this.$setScale9Grid(t)},enumerable:!0,configurable:!0}),i.prototype.$setScale9Grid=function(e){var i=this;i.$scale9Grid!=e&&(i.$scale9Grid?e?this._bkSprite.setScale9Grid(e):(this._bkSprite=new BK.Sprite(0,0,{},0,1,1,1),this._replaceNode(this._bkSprite),this.$setTexture(this.$texture)):e&&(this._bkSprite=new t.BKSprite9,this._replaceNode(this._bkSprite),this._bkSprite.setScale9Grid(e),this.hasScale9Grid=!0,this.$setTexture(this.$texture)),this._bkSprite.size=this._size,i.$scale9Grid=e,i.$renderDirty=!0)},i.prototype.$setWidth=function(t){var e=this;return 0>t||t==e.$explicitBitmapWidth?!1:(e.$explicitBitmapWidth=t,this._transformDirty=!0,this._size.width=t,this._bkSprite.size=this._size,!0)},i.prototype.$setHeight=function(t){var e=this;return 0>t||t==e.$explicitBitmapHeight?!1:(e.$explicitBitmapHeight=t,this._transformDirty=!0,this._size.height=t,this._bkSprite.size=this._size,!0)},i.prototype.$getWidth=function(){return isNaN(this.$explicitBitmapWidth)?this.$getContentBounds().width:this.$explicitBitmapWidth},i.prototype.$getHeight=function(){return isNaN(this.$explicitBitmapHeight)?this.$getContentBounds().height:this.$explicitBitmapHeight},i.prototype.$measureContentBounds=function(t){if(this.$texture){var e=isNaN(this.$explicitBitmapWidth)?this.$texture.$getTextureWidth():this.$explicitBitmapWidth,i=isNaN(this.$explicitBitmapHeight)?this.$texture.$getTextureHeight():this.$explicitBitmapHeight;t.setTo(0,0,e,i)}else{var e=isNaN(this.$explicitBitmapWidth)?0:this.$explicitBitmapWidth,i=isNaN(this.$explicitBitmapHeight)?0:this.$explicitBitmapHeight;t.setTo(0,0,e,i)}},i}(t.BKDisplayObject);t.BKBitmap=e,__reflect(e.prototype,"egret.BKBitmap"),"webgl"!=window.renderMode&&(t.Bitmap=t.BKBitmap)}(egret||(egret={}));