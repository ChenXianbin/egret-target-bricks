var isBrowser;if(isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document))"undefined"!=typeof BK==0&&(BK={}),function(e,t){"object"==typeof e&&void 0===e.MQQ&&(e.MQQ={Webview:function(){function e(){}return e.open=function(e){__browserMsg.send(JSON.stringify({url:e}),"cs.openWebView.local")},e.openTransparent=function(e,t){void 0===t&&(t=1),__browserMsg.send(JSON.stringify({url:e}),"cs.openWebViewWithoutUrl.local")},e.onMessageHandle=function(e){},e}()})}(BK);else{function clone_(e){var t,r,n;if("object"!=typeof e||null===e)return e;if(e instanceof Array)for(t=[],r=0,n=e.length;r<n;r++)"object"==typeof e[r]&&null!=e[r]?t[r]=arguments.callee(e[r]):t[r]=e[r];else for(r in t={},e)"object"==typeof e[r]&&null!=e[r]?t[r]=arguments.callee(e[r]):t[r]=e[r];return t}BK.Misc.BKBufferToArrayBuffer=function(e){e.rewind();for(var t=new ArrayBuffer(e.length),r=new DataView(t);!e.eof;)r.setUint8(e.pointer,e.readUint8Buffer());return t},BK.Misc.arrayBufferToBKBuffer=function(e){for(var t=new BK.Buffer(e.byteLength),r=new DataView(e),n=0;n<e.byteLength;n++)t.writeUint8Buffer(r.getUint8(n));return BK.Time.clock,t},enGameHallSucc=0,eReqDataLenErr=1e3,eReqMagicErr=1001,eReqFrontCmdErr=1002,eReqBackCmdErr=1003,eReqBackSrcErr=1004,eReqFromIdErr=1005,eSTDecryErr=1006,eReqDecryErr=1007,eSTExpire=1008,eSystmeErr=1009,eVerUnvalid=1010,eReqLimit=1011,eGetSvrErr=1012,eInitMemErr=2001,eQueryMemErr=2002,eUpdateMemErr=2003,eDelMemErr=2004,eGetConfigErr=2005,eNotifyCreateErr=2006,eGetRoomIdErr=2007,eCmdInvalid=2008,eRoomNotExist=2009,eInBlackList=2010,eMatchTimeOut=2011,eGetRoomErr=3e3,eRoomStatusErr=3001,eIsNotCreator=3002,eIsNotInRoom=3003,eFlushTsErr=3004,eLogoutIdErr=3005,eIsNotInSvc=3006,eUsrOverFlow=3007,eRoomOverFlow=3008,eRoomIsExist=3009,eRmvUsrErr=3010,eLoginSysErr=3011,eUsrHasLoginErr=3012,eRoomIsFullErr=3013,eCreateRoomErr=3014,ePlayerHasJoin=3015,eUgcDataAnti=3020,eFowardToClientErr=4e3,eFowardToSvrErr=4001;var DebugRecommandRoomSvrHost="139.199.216.130",DebugRecommandRoomSvrPort=10060,NormalRecommandRoomSvrHost="139.199.216.128",NormalRecommandRoomSvrPort=10060,TLVType=new Object;TLVType.Int8=33,TLVType.Uint8=34,TLVType.Int16=33,TLVType.Uint16=36,TLVType.Int32=37,TLVType.Uint32=38,TLVType.Int64=39,TLVType.Uint64=40,TLVType.Byte=41,TLVType.Double=42,TLVType.Float=43,TLVType.Int8Repeated=49,TLVType.Uint8Repeated=50,TLVType.Int16Repeated=51,TLVType.Uint16Repeated=52,TLVType.Int32Repeated=53,TLVType.Uint32Repeated=54,TLVType.Int64Repeated=55,TLVType.Uint64Repeated=56,TLVType.ByteRepeated=57,TLVType.DoubleRepeated=58,TLVType.FloatRepeated=59;var currentRenderMode,fixedHeaderLen=120,HeaderLen=12,currentGameMode=GameStatusInfo.gameMode,fromPlatform=GameStatusInfo.platform,currentAioType=GameStatusInfo.aioType,currentPlayerOpenId=GameStatusInfo.openId,isMaster=GameStatusInfo.isMaster;function Device(){this.isKeepScreenOnInit=!1,this.userSetDeviceScreenValue=void 0,BK.Director.isKeepScreenOn=!1}NETWORK_ENVIRONMENT_QQ_RELEASE=0,NETWORK_ENVIRONMENT_QQ_DEBUG=1,NETWORK_ENVIRONMENT_DEMO_DEV=2,CMSHOW_SRV_CMD_JOIN_ROOM="apollo_aio_game.join_room",CMSHOW_SRV_CMD_QUIT_GAME="apollo_aio_game.quit_room",CMSHOW_SRV_CMD_START_GAME="apollo_aio_game.start_game",CMSHOW_SRV_CMD_CANCEL_GAME="apollo_aio_game.cancel_game_room",CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC="apollo_game_openapi.custom_game_logic",CMSHOW_SRV_GET_RANK_LIST="apollo_router_game.game_rank_linkcmd_get_fri_rank_for_engine",CMSHOW_SRV_PUSH_PUBLIC_MSG="apollo_router_game.push_pub_msg_linkcmd_ssoreport",CMSHOW_SC_CMD_STOP_GAME="sc.force_stop_game.local",CMSHOW_CS_CMD_MINI_WND="cs.make_room_min.local",CMSHOW_CS_CMD_CLOSE_WND="cs.close_room.local",CMSHOW_CS_CMD_CREATE_ROOM="cs.create_room.local",CMSHOW_CS_CMD_JOIN_ROOM="cs.join_room.local",CMSHOW_CS_CMD_SEND_GAME_MSG="cs.send_game_msg.local",CMSHOW_CS_CMD_GAME_TIPS="cs.game_tips.local",CMSHOW_CS_CMD_GET_PLAYER_DRESS="cs.get_dress_path.local",CMSHOW_CS_CMD_GAME_READY="cs.game_ready.local",CMSHOW_CS_CMD_GAME_START="cs.game_start.local",CMSHOW_CS_CMD_SAVE_RECOMM_VIP="cs.save_recommend_ip.local",CMSHOW_CS_CMD_GET_SRV_IP_PORT="cs.get_server_ip_port.local",CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE="cs.check_pubAccount_state.local",CMSHOW_CS_CMD_ENTER_PUBACCOUNT_CARD="cs.enter_pubAccount_card.local",CMSHOW_CS_CMD_SHARE_PIC="cs.share_pic.local",CMSHOW_CS_CMD_SHARE_IN_ARK="cs.share_game_in_ark.local",CMSHOW_AIO_PAUSE="sc.aio_pause.local",CMSHOW_AIO_RESUME="sc.aio_resume.local",CMD_CMSHOW_GAME_ENTER_BACKGROUND="sc.game_enter_background.local",CMD_CMSHOW_GAME_ENTER_FORGROUND="sc.game_enter_foreground.local",CMD_CMSHOW_GAME_MAXIMIZE="sc.game_maximize.local",CMD_CMSHOW_GAME_MINIMIZE="sc.game_minimize.local",CMSHOW_CS_CMD_AUDIOROOM_ENTERN="cs.audioRoom_enter.local",CMSHOW_CS_CMD_AUDIOROOM_EXIT="cs.audioRoom_exit.local",CMSHOW_CS_CMD_AUDIOROOM_UPDATEUSERINFO="cs.audioRoom_update_userinfo.local",CMSHOW_CS_CMD_AUDIOROOM_SET_MIC="cs.audioRoom_set_mic.local",CMSHOW_CS_CMD_AUDIOROOM_SET_SPEAKER="cs.audioRoom_set_speaker.local",CMSHOW_CS_CMD_AUDIOROOM_INIT="cs.audioRoom_init.local",CMSHOW_CS_CMD_AUDIOROOM_DISCONNECT="cs.audioRoom_disconnect.local",CMSHOW_CS_CMD_AUDIOROOM_CAMERASWITCH="cs.audioRoom_cameraswitch.local",CMSHOW_CS_CMD_AUDIOROOM_SET_BEAUTY="cs.audioRoom_set_beauty.local",CMSHOW_CS_CMD_AUDIOROOM_REQ_AUDIO_SESSION="cs.audioRoom_req_audio_session.local",checkRenderMode=function(){0==currentRenderMode&&(BK.Script.renderMode=1,currentRenderMode=1)},BK.QQ=new function(){this.gameCfg=clone_(GameStatusInfo),this.gameCfg.gameId=parseInt(this.gameCfg.gameId),this.gameCfg.gameMode=0,GameStatusInfo.gameMode=0,this.arkData={modeWording:""},this.setArkData=function(e){this.arkData.modeWording=e},this.gameCfg.roomId&&(this.gameCfg.roomId=parseInt(this.gameCfg.roomId)),1==this.gameCfg.isMaster?this.gameCfg.isCreator=!0:this.gameCfg.isCreator=!1,this.delegate={},this.ssoJoinRoomCallback,this.ssoJoinRoomCallbackPublic,BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,function(){1==("android"==GameStatusInfo.platform?1:2)&&BK.Director.tickerPause()}),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_FORGROUND,this,function(){1==("android"==GameStatusInfo.platform?1:2)&&BK.Director.tickerResume()}),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MINIMIZE,this,function(){1==("android"==GameStatusInfo.platform?1:2)&&(BK.Script.renderMode=0,renderTicker.paused=!0,currentRenderMode=0)}),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MAXIMIZE,this,function(){1==("android"==GameStatusInfo.platform?1:2)&&(BK.Script.renderMode=1,renderTicker.paused=!1,currentRenderMode=1)}),this.qPayPurchase=function(e,t,r,n){var i=1;i=1==t?1:0;var a={gameOrientation:e,openId:GameStatusInfo.openId,transparent:i,businessType:1,itemList:r};if(n){var o="sc.apolloGameWebMessage.local";BK.MQQ.SsoRequest.removeListener(o,this),BK.MQQ.SsoRequest.addListener(o,this,function(e,t,r){0==e&&r.op&&"apolloGamePlatform.buyProps"==r.op&&n(r.data.code,r.data)}.bind(this))}BK.MQQ.SsoRequest.send(a,"cs.openWebViewWithoutUrl.local")},this.consumeItems=function(e,a){var t="apollo_game_item.consume_game_items",r={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:e};a&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(e,t,r){var n=[],i=[];0==e&&(n=r.data.succList,i=r.data.failList),a(e,n,i)}.bind(this))),BK.MQQ.SsoRequest.send(r,t)},this.rollbackGameItems=function(e,a){var t="apollo_game_item.rollback_game_items",r={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,items:e};a&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,function(e,t,r){var n=[],i=[];0==e&&(n=r.data.succList,i=r.data.failList),a(e,n,i)}.bind(this))),BK.MQQ.SsoRequest.send(r,t)},this.shareToMQQ=function(e,t,r,n){var i="cs.share_game_result.local",a={cmd:i,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,gameVersion:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,title:e,summary:t,detailUrl:r,picUrl:n};BK.MQQ.SsoRequest.send(a,i)},this.scoreUpload=function(e,t,r){var n="apollo_aio_game.report_user_score_3rd",i={cmd:n,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,gData:e};r&&(i.arkData=r),t&&(BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,t)),BK.MQQ.SsoRequest.send(i,n)},this.getRoomUserScoreInfo=function(e,t){var r="apollo_aio_game.get_room_info_3rd",n={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,version:GameStatusInfo.gameVersion,roomId:e};t&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,t)),BK.MQQ.SsoRequest.send(n,r)},this.getUserGameinfo=function(e,t,r){var n="apollo_aio_game.get_user_gameinfo_3rd",i={cmd:n,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,roomId:GameStatusInfo.roomId,toOpenId:e,cycleNum:t};r&&(BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,r)),BK.MQQ.SsoRequest.send(i,n)},this.getUserCurrencyInfo=function(e,t){var r="apollo_aio_game.get_user_curreInfo",n={cmd:r,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId,version:GameStatusInfo.gameVersion,mask:e};t&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,t)),BK.MQQ.SsoRequest.send(n,r)},this.getCmshowDressInfo=function(e,t){var r="cs.get_dress_path.local";t&&(BK.MQQ.SsoRequest.removeListener(r,this),BK.MQQ.SsoRequest.addListener(r,this,t));var n={openId:e};BK.MQQ.SsoRequest.send(n,"cs.get_dress_path.local")},this.getGameItemList=function(e){var t="apollo_aio_game.get_game_itemList",r={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(r,t)},this.getUserGameItems=function(e){var t="apollo_aio_game.get_user_game_items",r={cmd:t,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,openId:GameStatusInfo.openId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(r,t)},this.buyGameItems=function(e,t,r){var n="apollo_aio_game.buy_game_items",i={cmd:n,from:GameStatusInfo.platform,gameId:GameStatusInfo.gameId,curreType:e,itemIdList:t};r&&(BK.MQQ.SsoRequest.removeListener(n,this),BK.MQQ.SsoRequest.addListener(n,this,r)),BK.MQQ.SsoRequest.send(i,n)},this.notifyNewRoom=function(e,t){var r={gameId:this.gameCfg.gameId,roomId:e,retcode:t};this.gameCfg.roomId||(this.gameCfg.roomId=e),BK.Script.log(0,0,"BK.QQ.notifyNewRoom!gameId = "+r.gameId+", roomId = "+r.roomId+", retCode = "+t),BK.MQQ.SsoRequest.send(r,CMSHOW_CS_CMD_CREATE_ROOM)},this.notifyHideGame=function(){var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,sessionId:Number(this.gameCfg.sessionId)};BK.Script.log(0,0,"BK.QQ.notifyHideGame!gameId = "+e.gameId+", roomId = "+e.roomId+", sessionId = "+e.sessionId),1==("android"==GameStatusInfo.platform?1:2)&&(BK.Script.renderMode=0,currentRenderMode=0),BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_MINI_WND)},this.notifyCloseGame=function(){this._closeRoom();var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,sessionId:Number(this.gameCfg.sessionId)};BK.Script.log(0,0,"BK.QQ.notifyCloseGame!gameId = "+e.gameId+", roomId = "+e.roomId+", sessioinId = "+e.sessionId),BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_CLOSE_WND)},this.notifyReadyGame=function(){var e={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,sessionId:Number(this.gameCfg.sessionId)};BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_GAME_READY)},this.notifyGameTips=function(e){var t={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,sessionId:Number(this.gameCfg.sessionId),tips:e};BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_GAME_TIPS)},this.notifyGameTipsWaiting=function(){this.notifyGameTips("等待玩家加入")},this.notifyGameTipsSomeOneJoinRoom=function(e){this.notifyGameTips(e+"加入房间")},this.notifyGameTipsSomeOneLeaveRoom=function(e){this.notifyGameTips(e+"离开房间")},this.notifyGameTipsReady=function(){this.notifyGameTips("游戏即将开始")},this.notifyGameTipsPlaying=function(){this.notifyGameTips("游戏进行中")},this.notifyGameTipsGameOver=function(){this.notifyGameTips("游戏已结束")},this.inviteFriend=function(e,t){var r="cs.invite_friends.local",n={cmd:r,wording:e,gameId:this.gameCfg.gameId,gameMode:8,extendInfo:{}};t&&(n.roomId=t),BK.MQQ.SsoRequest.send(n,r)},this.uploadData=function(e,t,r,n,i,a){var o="cs.report_data_2_compass.local",s=this.gameCfg.gameId;"ios"==this.gameCfg.platform&&(e=e.toString(),r=r.toString());var f={cmd:o,actionName:e,enter:t,result:r,r2:s.toString(),r3:n,r4:i,r5:a};BK.MQQ.SsoRequest.send(f,o)},this.sharePic=function(e){var t={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,sessionId:Number(this.gameCfg.sessionId),path:e};BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_SHARE_PIC)},this.addSSOJoinRoomCallBack=function(e){this.ssoJoinRoomCallbackPublic=e},this.checkPubAccountState=function(e,t){t&&(BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,this,t));var r=CMSHOW_CS_CMD_CHECK_PUBACCOUNT_STATE,n={cmd:r,puin:e};BK.MQQ.SsoRequest.send(n,r)},this.enterPubAccountCard=function(e){var t=CMSHOW_CS_CMD_ENTER_PUBACCOUNT_CARD,r={cmd:t,puin:e};BK.MQQ.SsoRequest.send(r,t)},this.fetchOpenKey=function(e){var t="cs.on_get_open_key.local",r={gameId:GameStatusInfo.gameId};e&&(BK.MQQ.SsoRequest.removeListener(t,this),BK.MQQ.SsoRequest.addListener(t,this,e)),BK.MQQ.SsoRequest.send(r,t)},this.listenGameEventEnterBackground=function(e,t){var r="sc.game_enter_background.local";t&&(BK.MQQ.SsoRequest.removeListener(r,e),BK.MQQ.SsoRequest.addListener(r,e,t))},this.listenGameEventEnterForeground=function(e,t){var r="sc.game_enter_foreground.local";t&&(BK.MQQ.SsoRequest.removeListener(r,e),BK.MQQ.SsoRequest.addListener(r,e,t))},this.listenGameEventMaximize=function(e,t){var r="sc.game_maximize.local";t&&(BK.MQQ.SsoRequest.removeListener(r,e),BK.MQQ.SsoRequest.addListener(r,e,t))},this.listenGameEventMinimize=function(e,t){var r="sc.game_minimize.local";t&&(BK.MQQ.SsoRequest.removeListener(r,e),BK.MQQ.SsoRequest.addListener(r,e,t))},this._event4GetVIPInfo=function(e,t,r){BK.Script.log(0,0,"BK.QQ._event4GetVIPInfo!errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(r)),this.delegate.onGetVIPInfoEvent&&this.delegate.onGetVIPInfoEvent(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this)},this.notifyGetVIPInfo=function(){BK.MQQ.SsoRequest.send({},CMSHOW_CS_CMD_GET_SRV_IP_PORT),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_GET_SRV_IP_PORT,this,this._event4GetVIPInfo.bind(this))},this.notifySaveRecommVIP=function(e,t){BK.Script.log(0,0,"BK.QQ.notifySaveRecommVIP!ip = "+e+", port = "+t);var r={gameId:this.gameCfg.gameId,roomId:this.game.roomId,sessionId:Number(this.gameCfg.sessionId),ip:e,port:t};BK.MQQ.SsoRequest.send(r,CMSHOW_CS_CMD_SAVE_RECOMM_VIP)},this._event4GetPlayerDress=function(e,t,r){BK.Script.log(0,0,"BK.QQ._event4GetPlayerDress!errCode = "+e+", cmd = "+t+", data = "+JSON.stringify(r)),this.delegate.onGetPlayerDressEvent&&this.delegate.onGetPlayerDressEvent(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this)},this.notifyGetPlayerDress=function(e){var t={openId:e};BK.MQQ.SsoRequest.removeListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this),BK.MQQ.SsoRequest.addListener(CMSHOW_CS_CMD_GET_PLAYER_DRESS,this,this._event4GetPlayerDress.bind(this)),BK.MQQ.SsoRequest.send(t,CMSHOW_CS_CMD_GET_PLAYER_DRESS)},this._startGameLocal=function(e,t){var r={gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId,sessionId:Number(this.gameCfg.sessionId),resp:t,retcode:e,gameMode:this.gameCfg.gameMode};BK.MQQ.SsoRequest.send(r,CMSHOW_CS_CMD_GAME_START)},this.notifyJoinRoom=function(e,o,s){e&&0<e.length?e.forEach(function(e){var t=e.openId==currentPlayerOpenId;BK.Script.log(1,1,"player.openid="+e.openId+" currentPlayerOpenId="+currentPlayerOpenId);var r=0;o&&o.data&&o.data.avRoomId&&(r=o.data.avRoomId);var n=0;o&&o.data&&o.data.sdkAppId&&(n=o.data.sdkAppId);var i=0;o&&o.data&&o.data.accountType&&(i=o.data.accountType);var a={gameId:this.gameCfg.gameId,openId:e.openId,isCreator:this.gameCfg.isCreator&&e.openId==currentPlayerOpenId?1:0,roomId:this.gameCfg.roomId,resp:o,retcode:s,gameMode:this.gameCfg.gameMode,avRoomId:r,sdkAppId:n,accountType:i,isMine:t,isDisableSendMsg:this.isAutoSendJoinRoomNotify?0:1};BK.Script.log(0,0,"BK.QQ.notifyJoinroom isDisableSendMsg: "+a.isDisableSendMsg),BK.MQQ.SsoRequest.send(a,CMSHOW_CS_CMD_JOIN_ROOM)},this):BK.Script.log(0,0,"BK.QQ.notifyJoinRoom!newJoinPlayers data error")},this.sendGameMsg=function(){if(this.gameCfg.roomId&&0<this.gameCfg.roomId){var e={gameId:this.gameCfg.gameId,openId:GameStatusInfo.openId,roomId:this.gameCfg.roomId,gameMode:this.gameCfg.gameMode};BK.Script.log(0,0,"SendGameMsg : gameId="+e.gameId+"  openId="+e.openId+" roomId="+e.roomId+"  gameMode="+e.gameMode),BK.MQQ.SsoRequest.send(e,CMSHOW_CS_CMD_SEND_GAME_MSG)}},this.shareToArk=function(e,t,r,n,i){"boolean"==typeof n&&(n=1==n?1:0);var a={summary:t,picUrl:r,gameId:this.gameCfg.gameId,roomId:e,gameMode:this.gameCfg.gameMode,isSelectFriend:n,extendInfo:i};BK.Script.log(0,0,"ShareToArk summary="+a.summary+" roomId="+a.roomId+"  gameMode="+a.gameMode+"picUrl="+a.picUrl+"  gameId="+a.gameId),BK.MQQ.SsoRequest.send(a,CMSHOW_CS_CMD_SHARE_IN_ARK)},this._event4QuitGame=function(e,t,r){BK.Script.log(0,0,"BK.QQ._event4QuitGame errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(r)),this.delegate.onQuitGameEvent&&this.delegate.onQuitGameEvent(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_QUIT_GAME,this)},this._event4CancelGame=function(e,t,r){BK.Script.log(0,0,"BK.QQ._event4CancelGame errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(r)),this.delegate.onCancelGameEvent&&this.delegate.onCancelGameEvent(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CANCEL_GAME,this)},this.notifyQuitGameSrv=function(){var e={cmd:CMSHOW_SRV_CMD_QUIT_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyQuitGameSrv!, cmd = "+e.cmd+", from = "+e.from+", gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_QUIT_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_QUIT_GAME,this,this._event4QuitGame.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_QUIT_GAME)},this.notifyCancelGameSrv=function(){var e={cmd:CMSHOW_SRV_CMD_CANCEL_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyCancelGameSrv!, cmd = "+e.cmd+", from = "+e.from+", gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CANCEL_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_CANCEL_GAME,this,this._event4CancelGame.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_CANCEL_GAME)},this._event4StartGame=function(e,t,r){BK.Script.log(0,0,"BK.QQ._event4StartGame! errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(r)),this.hasStartGameSucc=0==e,this._startGameLocal(e,r),this.delegate.onStartGameEvent&&this.delegate.onStartGameEvent(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_START_GAME,this)},this.notifyStartGameSrv=function(){var e={cmd:CMSHOW_SRV_CMD_START_GAME,from:this.gameCfg.platform,gameId:this.gameCfg.gameId,roomId:this.gameCfg.roomId};BK.Script.log(0,0,"BK.QQ.notifyStartGameSrv!, cmd = "+e.cmd+", from = "+e.from+", gameId = "+e.gameId+", roomId = "+e.roomId),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_START_GAME,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_START_GAME,this,this._event4StartGame.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_START_GAME)},this._event4JoinRoom=function(e,t,r){BK.Script.log(0,0,"BK.QQ._event4JoinRoom errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(r)),this.delegate.onJoinRoomEvent&&this.delegate.onJoinRoomEvent(e,t,r),this.hasJoinRoomSucc=0==e,BK.QQ.notifyJoinRoom(this.newJoinPlayers,r,e),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_JOIN_ROOM,this),this.ssoJoinRoomCallback&&this.ssoJoinRoomCallback(e,t,r),this.ssoJoinRoomCallbackPublic&&(r.gameId=this.gameCfg.gameId,r.gameRoomId=this.gameCfg.roomId,r.avRoomId=r.data.avRoomId?r.data.avRoomId:0,r.sdkAppId=r.data.sdkAppId?r.data.sdkAppId:0,r.accountType=r.data.accountType?r.data.accountType:0,this.ssoJoinRoomCallbackPublic(e,t,r))},this.notifyNewOrJoinRoomSrv=function(e,t,r){var n={cmd:CMSHOW_SRV_CMD_JOIN_ROOM,from:this.gameCfg.platform,aioType:this.gameCfg.aioType,sessionId:Number(this.gameCfg.sessionId),gameId:this.gameCfg.gameId,version:this.gameCfg.gameVersion,roomId:t,opType:r,gameMode:this.gameCfg.gameMode,roomVol:this.roomVol,arkData:this.arkData};BK.Script.log(1,1,"BK.QQ.notifyNewOrJoinRoomSrv!, cmd = "+n.cmd+", from = "+n.from+", aioType = "+n.aioType+", sessionId = "+n.sessionId+", gameId = "+n.gameId+", version = "+n.version+", roomId = "+n.roomId+", opType = "+n.opType),this.newJoinPlayers=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_JOIN_ROOM,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_JOIN_ROOM,this,this._event4JoinRoom.bind(this)),BK.MQQ.SsoRequest.send(n,CMSHOW_SRV_CMD_JOIN_ROOM)},this._customGameLogicCallBack=void 0,this._event4CustomLogic=function(e,t,r){null!=this._customGameLogicCallBack&&this._customGameLogicCallBack(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this)},this.reqCustomLogic=function(e,t){null!=e?(this._customGameLogicCallBack=t,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC,this,this._event4CustomLogic.bind(this)),BK.MQQ.SsoRequest.send(e,CMSHOW_SRV_CMD_CUSTOM_GAME_LOGIC)):BK.Script.log(0,0,"reqCustomLogic data undefined!")},this._getRankListLogicCallBack=void 0,this._event4GetRankList=function(e,t,r){BK.Script.log(1,1,"BK.QQ.reqGetRankList! callback cmd"+t+" errCode:"+e+"  data:"+JSON.stringify(r)),null!=this._getRankListLogicCallBack&&this._getRankListLogicCallBack(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_GET_RANK_LIST,this)},this.getRankList=function(e,t){var r={cmd:CMSHOW_SRV_GET_RANK_LIST,from:"default",objType:1,objId:0,busType:3,busId:this.gameCfg.gameId.toString()};t&&(t.objType&&(r.objType=t.objType),t.objId&&(r.objId=t.objId),t.from&&(r.from=t.from)),BK.Script.log(1,1,"BK.QQ.reqGetRankList! "+JSON.stringify(r)),null!=r?(this._getRankListLogicCallBack=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_GET_RANK_LIST,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_GET_RANK_LIST,this,this._event4GetRankList.bind(this)),BK.MQQ.SsoRequest.send(r,CMSHOW_SRV_GET_RANK_LIST)):BK.Script.log(0,0,"reqGetRankList data undefined!")},this._pushPublicMsgCallBack=void 0,this._event4PushPublicMsg=function(e,t,r){BK.Script.log(1,1,"BK.QQ.pushPublicMsg! callback cmd"+t+" errCode:"+e+"  data:"+JSON.stringify(r)),null!=this._pushPublicMsgCallBack&&this._pushPublicMsgCallBack(e,t,r),BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_PUSH_PUBLIC_MSG,this)},this.pushPublicMsg=function(e,t){var r={gameid:this.gameCfg.gameId,templateid:t.templateid,report_ts:t.report_ts,tmpl_param:t.tmpl_param};BK.Script.log(1,1,"BK.QQ.pushPublicMsg! "+JSON.stringify(r)),null!=r?(this._pushPublicMsgCallBack=e,BK.MQQ.SsoRequest.removeListener(CMSHOW_SRV_PUSH_PUBLIC_MSG,this),BK.MQQ.SsoRequest.addListener(CMSHOW_SRV_PUSH_PUBLIC_MSG,this,this._event4PushPublicMsg.bind(this)),BK.MQQ.SsoRequest.send(r,CMSHOW_SRV_PUSH_PUBLIC_MSG)):BK.Script.log(0,0,"pushPublicMsg data undefined!")},this.hasJoinRoom=function(){return this.hasJoinRoomSucc},this.hasStartGame=function(){return this.hasStartGameSucc},this._event4StopGame=function(e,t,r){BK.Script.log(0,0,"BK.QQ._event4StopGame!errCode = "+e+" cmd = "+t+" data = "+JSON.stringify(r)),this._closeRoom(),this.delegate.onStopGameEvent&&this.delegate.onStopGameEvent(e,t,r)},this._closeRoom=function(e){BK.QQ.isNeedSSOServer=null==e||null==e||e,1==Boolean(BK.QQ.isNeedSSOServer)&&(this.hasStartGameSucc||this.gameCfg.roomId&&0!=this.gameCfg.roomId&&(this.gameCfg.isCreator?this.notifyCancelGameSrv():this.notifyQuitGameSrv()))},BK.MQQ.SsoRequest.addListener(CMSHOW_SC_CMD_STOP_GAME,this,this._event4StopGame.bind(this))},BK.Room=function(){this.roomId,this.gameId,this.mId,this.ownerId,this.createTs,this.status,this.playerNum,this.ip0,this.ip1,this.msgSeq=1,this.ackSeq,this.lastFrame=0,this.startGameTs=0,this.createRoomCallBack,this.queryRoomInfoCallBack,this.joinRoomCallBack,this.leaveRoomCallBack,this.startGameCallBack,this.broadcastDataCallBack,this.sensitiveWordCallBack,this.setUserDataCallBack,this.getUserDataCallBack,this.sendSyncOptCallBack,this.forceStopGameCallBack,this.frameSyncListener,this.queryFrameDataCallBack,this.matchGameCallBack,this.queryMatchGameCallBack,this.quitMatchGameCallBack,this.disconnectNetCallBack,this.reJoinRoomCallBack,this.socket=new BK.Socket,this.reqArray=new Array,this.newJoinPlayers=[],this.currentPlayers=[],this.isCreator=1==GameStatusInfo.isMaster,this.gameStatusInfo=GameStatusInfo,this.serverConnected,this._environment=GameStatusInfo.isWhiteUser,this.headerVersion=769,this.recommandRoomSvrHost=NormalRecommandRoomSvrHost,this.recommandRoomSvrPort=NormalRecommandRoomSvrPort,this.netTimeOutTs=0,this.options=null,this.setArkData=function(e){BK.QQ.setArkData(e)},this.setRoomVol=function(e){BK.QQ.roomVol=e},this.read32BytesToString=function(e){for(var t="",r=0;r<32;r++){var n=e.readUint8Buffer();t+=String.fromCharCode(n)}return t},this.writeOpenIdIntoBuffer=function(e,t){var r=new BK.Buffer(32);if(32==t.length)for(var n=0;n<32;n++){var i=t.charCodeAt(n);r.writeUint8Buffer(i)}else{for(n=0;n<32;n++)r.writeUint8Buffer(0);BK.Script.log(0,0,"writeOpenIdIntoBuffer.length is not 32 bytes,Write empty data")}e.writeBuffer(r)},this.addHeader=function(e,t,r){e.writeUint16Buffer(4660),e.writeUint16Buffer(this.headerVersion),e.writeUint16Buffer(0),e.writeUint16Buffer(r),e.writeUint32Buffer(t)},this.addFixedHeader=function(e,t,r,n,i,a,o,s,f){null==a&&(a=""),null==o&&(o=0),null==s&&(s=0),null==f&&(f=0),e.writeUint16Buffer(72),e.writeUint16Buffer(t),e.writeUint32Buffer(0),e.writeUint64Buffer(1111),e.writeUint64Buffer(r),e.writeUint64Buffer(n),this.writeOpenIdIntoBuffer(e,i),this.writeOpenIdIntoBuffer(e,a),e.writeUint64Buffer(o),e.writeUint64Buffer(s),e.writeUint64Buffer(f)},this.getHeader=function(e){var t=e.readUint16Buffer(),r=e.readUint16Buffer(),n=e.readUint16Buffer(),i=e.readUint16Buffer(),a=e.readUint32Buffer(),o=new Object;return o.magic=t,o.ver=r,o.stlen=i,o.bodyLen=a,o.seq=n,o},this.getFixedHeader=function(e){var t,r,n=e.readUint16Buffer(),i=e.readUint16Buffer(),a=e.readUint32Buffer(),o=e.readUint64Buffer(),s=e.readUint64Buffer(),f=e.readUint64Buffer();t=this.read32BytesToString(e),r=this.read32BytesToString(e);var u=e.readUint64Buffer(),_=e.readUint64Buffer(),c=e.readUint64Buffer(),d=new Object;return d.fixLen=n,d.cmd=i,d.ret=a,d.date=o,d.gameId=s,d.roomId=f,d.fromId=t,d.toId=r,d.token=u,d.appId=_,d.accessToken=c,d},this.matchGame=function(e,t,r){this.mId=t,this.gameId=parseInt(e),BK.QQ.gameCfg.gameMode=6,GameStatusInfo.gameMode=6;var n=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+n),-1==n?BK.Script.log(0,0,"socket connect failed! "+n):this.serverConnected=1,this.matchGameCallBack=r;var i=new Object;i.cmd=36,i.arg0=e,i.arg1=t,this.reqArray.push(i),BK.Script.log(0,0,"createRoom ")},this.requestMatch=function(e,t){BK.Script.log(0,0,"match game request in");var r=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(r,36,e,0,t);var n=BK.Security.getST();BK.Security.encrypt(r);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+i,1);return this.addHeader(a,r.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(r),BK.Script.log(0,0,"match game request buffer : "+a.bufferLength()+" body len:"+r.bufferLength()),a},this.queryMatchGame=function(e,t,r){BK.Script.log(0,0,"queryMatchGame in "),this.mId=t,this.gameId=parseInt(e),this.queryMatchGameCallBack=r;var n=new Object;n.cmd=38,n.arg0=e,n.arg1=t,this.reqArray.push(n)},this.requestQueryMatch=function(e,t){BK.Script.log(0,0,"query match game request in");var r=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(r,38,e,0,t);var n=BK.Security.getST();BK.Security.encrypt(r);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+i,1);return this.addHeader(a,r.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(r),BK.Script.log(0,0,"query match game request buffer : "+a.bufferLength()+" body len:"+r.bufferLength()),a},this.quitMatchGame=function(e,t,r){BK.Script.log(0,0,"quitMatchGame in "),this.mId=t,this.gameId=parseInt(e),this.quitMatchGameCallBack=r;var n=new Object;n.cmd=40,n.arg0=e,n.arg1=t,this.reqArray.push(n)},this.requestQuitMatch=function(e,t){BK.Script.log(0,0,"quit match game request in");var r=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(r,40,e,0,t);var n=BK.Security.getST();BK.Security.encrypt(r);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+i,1);return this.addHeader(a,r.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(r),BK.Script.log(0,0,"quit match game request buffer : "+a.bufferLength()+" body len:"+r.bufferLength()),a},this.createRoom=function(e,t,r){if(this.mId=t,this.gameId=parseInt(e),1!=this.serverConnected){var n=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+n),-1==n?BK.Script.log(0,0,"socket connect failed! "+n):this.serverConnected=1}this.createRoomCallBack=r;var i=new Object;i.cmd=6,i.arg0=e,i.arg1=t,this.reqArray.push(i),BK.Script.log(0,0,"createRoom ")},this.requestCreateRoom=function(e,t){BK.Script.log(0,0,"create room request in");var r=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(r,6,e,0,t);var n=BK.Security.getST();BK.Security.encrypt(r);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+i,1);return this.addHeader(a,r.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(r),BK.Script.log(0,0,"create room request buffer : "+a.bufferLength()+" body len:"+r.bufferLength()),a},this.requestQueryRoom=function(){var e=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(e,10,this.gameId,this.roomId,this.mId);var t=BK.Security.getST();BK.Security.encrypt(e);var r=t.bufferLength(),n=new BK.Buffer(HeaderLen+e.bufferLength()+r,1);return this.addHeader(n,e.bufferLength(),r),n.writeBuffer(t),n.writeBuffer(e),n},this.queryRoom=function(e,t,r,n){this.mId=r,this.roomId=parseFloat(t),this.gameId=parseInt(e),this.queryRoomInfoCallBack=n;var i=new Object;i.cmd=10,this.reqArray.push(i),BK.Script.log(0,0,"queryRoom push")},this.joinRoom=function(e,t,r,n){this.joinRoomCallBack=t,BK.QQ.isNeedSSOServer=null==n||null==n||n,BK.QQ.isAutoSendJoinRoomNotify=null==r||null==r||r,BK.Script.log(0,0,"BK.QQ.notifyJoinroom isDisableSendMsg   isAuto: "+r+",isAutoSendJoin:  "+BK.QQ.isAutoSendJoinRoomNotify);var i=new Object;i.cmd=2,i.arg0=e,this.reqArray.push(i)},this.requestJoinRoom=function(e){BK.Script.log(0,0,"join room request");var t=new BK.Buffer(fixedHeaderLen+5,1);this.addFixedHeader(t,2,this.gameId,this.roomId,this.mId);var r=new BK.TLV(5);r.bkJSTLVWriteUInt8(e,TLVType.Uint8,201),t.writeBuffer(r.bkJSTLVGetBuffer());var n=BK.Security.getST();BK.Security.encrypt(t);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+t.bufferLength()+i,1);return this.addHeader(a,t.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(t),a},this.setReJoinRoomCallBack=function(e){this.reJoinRoomCallBack=e},this.reConnectAndJoinRoom=function(){var e=this.socket.connect(this.gameSvrIp,this.gameSvrPort);if(BK.Script.log(0,0,"socket con ="+e),-1==e)return BK.Script.log(0,0,"socket connect failed! "+e),-1;this.serverConnected=1,0==e&&BK.Script.log(0,0,"socket connect =0 "),0<=e&&(BK.Script.log(0,0,"rejoinroom send"),this.joinRoom(1,function(e,t){BK.Script.log(0,0,"rejoinroom statusCode:"+e+" roomid is "+t.roomId),this.reJoinRoomCallBack&&this.reJoinRoomCallBack(e,this)}))},this.leaveRoom=function(e,t){null==t&&(t=-1);var r=new Object;r.cmd=4,r.arg0=t,this.reqArray.push(r),this.leaveRoomCallBack=e,BK.Script.log(0,0,"leaveRoom push")},this.setLeaveRoomCallback=function(e){this.leaveRoomCallBack=e},this.requestLeaveRoom=function(e){var t=new BK.TLV(44),r=new BK.Buffer(40,1);this.writeOpenIdIntoBuffer(r,this.mId),r.writeUint64Buffer(e),t.bkJSTLVWriteBuffer(r,TLVType.Byte,201);var n=new BK.Buffer(fixedHeaderLen+t.bkJSTLVGetLength(),1);this.addFixedHeader(n,4,this.gameId,this.roomId,this.mId),n.writeBuffer(t.bkJSTLVGetBuffer());var i=BK.Security.getST(),a=i.bufferLength();return BK.Security.encrypt(n),buff=new BK.Buffer(HeaderLen+n.bufferLength()+a,1),this.addHeader(buff,n.bufferLength(),a),buff.writeBuffer(i),buff.writeBuffer(n),BK.Script.log(0,0,"leave room buffer : "+buff.bufferLength()+" body len:"+n.bufferLength()),buff},this.startGame=function(e){this.startGameCallBack=e;var t=new Object;t.cmd=8,this.reqArray.push(t),BK.Script.log(0,0,"startGame push")},this.setStartGameCallback=function(e){this.startGameCallBack=e},this.requestStartGame=function(){var e=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(e,8,this.gameId,this.roomId,this.mId);var t=BK.Security.getST();BK.Security.encrypt(e);var r=t.bufferLength(),n=new BK.Buffer(HeaderLen+e.bufferLength()+r,1);return this.addHeader(n,e.bufferLength(),r),n.writeBuffer(t),n.writeBuffer(e),n},this.setBroadcastDataCallBack=function(e){this.broadcastDataCallBack=e},this.sendBroadcastData=function(e){var t=new Object;t.cmd=1,t.arg0=e,this.reqArray.push(t)},this.requestsendBroadcastData=function(e){var t=e.capacity?e.capacity:e.bufferLength(),r=new BK.Buffer(fixedHeaderLen+t,1);this.addFixedHeader(r,1,this.gameId,this.roomId,this.mId),r.writeBuffer(e);var n=BK.Security.getST();BK.Security.encrypt(r);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+i,1);return this.addHeader(a,r.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(r),a},this.setSensitiveWordCallBack=function(e){this.sensitiveWordCallBack=e},this.sendSensitiveWordData=function(e){var t=new Object;t.cmd=50,t.arg0=e,this.reqArray.push(t)},this.requestSendSendSensitiveWordData=function(e){var t=e.capacity?e.capacity:e.bufferLength(),r=new BK.Buffer(fixedHeaderLen+t,1);this.addFixedHeader(r,50,this.gameId,this.roomId,this.mId),r.writeBuffer(e);var n=BK.Security.getST();BK.Security.encrypt(r);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+i,1);return this.addHeader(a,r.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(r),a},this.setUserData=function(e,t){BK.Script.log(0,0,"setUserData call"),this.setUserDataCallBack=t;var r=new Object;r.cmd=32,r.arg0=e,this.reqArray.push(r),BK.Script.log(0,0,"setUserData push")},this.requestSetUserData=function(e){var t=e.capacity?e.capacity:e.bufferLength(),r=new BK.Buffer(fixedHeaderLen+t,1);this.addFixedHeader(r,32,this.gameId,this.roomId,this.mId),r.writeBuffer(e);var n=BK.Security.getST();BK.Security.encrypt(r);var i=n.bufferLength(),a=new BK.Buffer(HeaderLen+r.bufferLength()+i,1);return this.addHeader(a,r.bufferLength(),i),a.writeBuffer(n),a.writeBuffer(r),a},this.getUserData=function(e,t){null==e&&(e=0),this.getUserDataCallBack=t;var r=new Object;r.cmd=34,r.arg0=e,this.reqArray.push(r),BK.Script.log(0,0,"getUserData push roomId = "+e)},this.requestGetUserData=function(e){var t=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(t,34,this.gameId,this.roomId,this.mId);var r=BK.Security.getST();BK.Security.encrypt(t);var n=r.bufferLength(),i=new BK.Buffer(HeaderLen+t.bufferLength()+n,1);return this.addHeader(i,t.bufferLength(),n),i.writeBuffer(r),i.writeBuffer(t),i},this.syncOpt=function(e,t,r,n,i){this.sendSyncOptCallBack=i;var a=new Object;a.cmd=14,a.arg0=e,a.arg1=t,a.arg2=r,a.arg3=n,this.reqArray.push(a)},this.sendSyncOpt=function(e,t){var r=new BK.Buffer(1,1);r.writeUint8Buffer(0);var n=new BK.Buffer(1,1);n.writeUint8Buffer(0),this.syncOpt(r,e,n,void 0,t)},this.requestSyncOpt=function(e,t,r,n){var i=20+(e.capacity?e.capacity:e.bufferLength())+4+(t.capacity?t.capacity:t.bufferLength())+4+(r.capacity?r.capacity:r.bufferLength());if(n){var a=n.capacity?n.capacity:n.bufferLength();i=i+4+a,BK.Script.log(0,0,"requestSyncOpt with item len"+a)}var o=new BK.TLV(i);o.bkJSTLVWriteUInt32(this.msgSeq,TLVType.Uint32,201),o.bkJSTLVWriteUInt32(this.lastFrame,TLVType.Uint32,202),o.bkJSTLVWriteBuffer(e,TLVType.Byte,203),o.bkJSTLVWriteBuffer(t,TLVType.Byte,204),o.bkJSTLVWriteBuffer(r,TLVType.Byte,205),n&&o.bkJSTLVWriteBuffer(n,TLVType.Byte,206),BK.Script.log(0,0,"requestSyncOpt this.msgSeq:"+this.msgSeq+" this.lastFrame:"+this.lastFrame);o.bkJSParseTLV();BK.Script.log(0,0,"requestSyncOpt tlv len:"+o.bkJSTLVGetLength()+" fix header:"+fixedHeaderLen);var s=new BK.Buffer(fixedHeaderLen+o.bkJSTLVGetLength(),1);this.addFixedHeader(s,14,this.gameId,this.roomId,this.mId),s.writeBuffer(o.bkJSTLVGetBuffer());var f=BK.Security.getST();BK.Security.encrypt(s);var u=f.bufferLength(),_=new BK.Buffer(HeaderLen+s.bufferLength()+u,1);return this.addHeader(_,s.bufferLength(),u),_.writeBuffer(f),_.writeBuffer(s),this.msgSeq+=1,_},this.setFrameSyncListener=function(e){this.frameSyncListener=e},this.queryFrameData=function(e,t,r){this.queryFrameDataCallBack=r;var n=new Object;n.cmd=18,n.arg0=e,n.arg1=t,this.reqArray.push(n)},this.requestQueryFrameData=function(e,t){var r=new BK.TLV(22);r.bkJSTLVWriteUInt32(this.lastFrame,TLVType.Uint32,201),r.bkJSTLVWriteUInt32(e,TLVType.Uint32,202),r.bkJSTLVWriteUInt16(t,TLVType.Uint16,203);var n=new BK.Buffer(fixedHeaderLen+r.bkJSTLVGetLength(),1);this.addFixedHeader(n,18,this.gameId,this.roomId,this.mId),n.writeBuffer(r.bkJSTLVGetBuffer());var i=BK.Security.getST();BK.Security.encrypt(n);var a=i.bufferLength(),o=new BK.Buffer(HeaderLen+n.bufferLength()+a,1);return this.addHeader(o,n.bufferLength(),a),o.writeBuffer(i),o.writeBuffer(n),o},this.sendControlCommand=function(e,t,r,n){var i=new Object;i.cmd=48,i.arg0=e,i.arg1=t,i.arg2=r,this.reqArray.push(i),this.controlCommandCallback=n},this.requestControlCommand=function(e,t,r){var n=new BK.TLV(14+t.bufferLength()+r.bufferLength());n.bkJSTLVWriteBuffer(t,TLVType.Byte,201),n.bkJSTLVWriteUInt16(e,TLVType.Uint16,202),n.bkJSTLVWriteBuffer(r,TLVType.Byte,203);var i=new BK.Buffer(fixedHeaderLen+n.bkJSTLVGetLength(),1);this.addFixedHeader(i,48,this.gameId,this.roomId,this.mId),i.writeBuffer(n.bkJSTLVGetBuffer()),BK.Security.encrypt(i);var a=BK.Security.getST(),o=a.bufferLength(),s=new BK.Buffer(HeaderLen+i.bufferLength()+o,1);return this.addHeader(s,i.bufferLength(),o),s.writeBuffer(a),s.writeBuffer(i),s},this.sendKeepAlive=function(){var e=new Object;(e.cmd=12,this.reqArray.push(e),0!=this.netTimeOutTs)&&(5<BK.Time.timestamp-this.netTimeOutTs&&this.disconnectNetCallBack&&this.disconnectNetCallBack())},this.requestSendKeepAlive=function(){var e=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(e,12,this.gameId,this.roomId,this.mId);var t=BK.Security.getST();BK.Security.encrypt(e);var r=t.bufferLength(),n=new BK.Buffer(HeaderLen+e.bufferLength()+r,1);return this.addHeader(n,e.bufferLength(),r),n.writeBuffer(t),n.writeBuffer(e),n},this.recvCreateRoom=function(e,t){BK.Script.log(0,0,"recvCreateRoom bodyLen="+t);var r=e.readBuffer(t),n=new BK.TLV(r).bkJSParseTLV();if(n){var i=n.tag202,a=i.readUint8Buffer(),o=i.readUint8Buffer(),s=i.readUint16Buffer();i.readUint64Buffer(),i.readUint32Buffer();var f=i.readUint8Buffer(),u=i.readUint8Buffer(),_=i.readUint8Buffer(),c=i.readUint8Buffer(),d=n.tag201,h=d.readUint8Buffer(),l=d.readUint8Buffer(),g=d.readUint16Buffer();d.readUint64Buffer(),d.readUint32Buffer();var m=d.readUint8Buffer(),p=d.readUint8Buffer(),S=d.readUint8Buffer(),b=d.readUint8Buffer(),x=new Object;return x.ipType_1=a,x.resServe_1=o,x.ipType_2=h,x.resServe_2=l,x.port_1=s,x.ip_1=f+"."+u+"."+_+"."+c,x.port_2=g,x.ip_2=m+"."+p+"."+S+"."+b,this.ip0=x.ip_1,this.ip1=x.ip_2,x}BK.Script.log(0,0,"recvCreateRoom parse failed.")},this.recvQueryRoom=function(e,t){BK.Script.log(0,0,"recvQueryRoom bodyLen:"+t);var r=e.readBuffer(t),n=new BK.TLV(r).bkJSParseTLV();if(n){var i=n.tag202,a=i.readUint8Buffer(),o=i.readUint8Buffer(),s=i.readUint16Buffer();i.readUint64Buffer(),i.readUint32Buffer();var f=i.readUint8Buffer(),u=i.readUint8Buffer(),_=i.readUint8Buffer(),c=i.readUint8Buffer(),d=n.tag201,h=d.readUint8Buffer(),l=d.readUint8Buffer(),g=d.readUint16Buffer();d.readUint64Buffer(),d.readUint32Buffer();var m=d.readUint8Buffer(),p=d.readUint8Buffer(),S=d.readUint8Buffer(),b=d.readUint8Buffer(),x=n.tag203,C=this.read32BytesToString(x),v=x.readUint64Buffer(),O=x.readUint8Buffer(),E=x.readUint8Buffer(),B=n.tag205;null==B&&(B=0);for(var T=[],M=0;M<E;M++){var A={};A.uid=this.read32BytesToString(x),A.status=x.readUint8Buffer(),T.push(A)}var R=new Object;return R.ipType_1=a,R.resServe_1=o,R.ipType_2=h,R.resServe_2=l,R.port_1=s,R.ip_1=f+"."+u+"."+_+"."+c,R.port_2=g,R.ip_2=m+"."+p+"."+S+"."+b,R.ownerId=C,R.createTs=v,R.status=O,R.playerNum=E,R.ext_num=B,this.ip0=R.ip_1,this.ip1=R.ip_2,this.ownerId=C,this.createTs=v,this.status=O,this.playerNum=E,this.players=T,R}BK.Script.log(0,0,"recvQueryRoom parse failed.bodyLen is 0")},this.recvJoinRoom=function(e,t){for(var r=e.readBuffer(t),n=new BK.TLV(r).bkJSParseTLV().tag201,i=this.read32BytesToString(n),a=n.readUint64Buffer(),o=n.readUint8Buffer(),s=n.readUint8Buffer(),f=[],u=0;u<s;u++){var _={},c=this.read32BytesToString(n),d=n.readUint64Buffer();o=n.readUint8Buffer();_.openId=c,_.status=o,_.joinTs=d,f.push(_)}if(this.ownerId=i,this.createTs=a,this.status=o,this.playerNum=s,0==this.currentPlayers.length)f.forEach(function(e){this.newJoinPlayers.push(e)},this);else{var h=[];BK.Script.log(0,0,"recvJoinRoom!curPlayers = "+JSON.stringify(this.currentPlayers)),BK.Script.log(0,0,"recvJoinRoom!joinPlayers = "+JSON.stringify(f));for(u=0;u<f.length;u++){_=f[u];for(var l=!1,g=0;g<this.currentPlayers.length;g++){if(this.currentPlayers[g].openId==_.openId){l=!0;break}}0==l&&h.push(_)}this.newJoinPlayers=h,BK.Script.log(0,0,"recvJoinRoom!newPlayers = "+JSON.stringify(this.newJoinPlayers))}this.currentPlayers=f,BK.Script.log(0,0,"recvJoinRoom ownerId="+i+",createTs ="+a+",playerNum:"+s)},this.recvLeaveRoom=function(e,t){var r=e.readBuffer(t),n=new BK.TLV(r).bkJSParseTLV();if(n){var i=n.tag201,a=this.read32BytesToString(i),o=e.readUint64Buffer(),s=new Object;return BK.Script.log(0,0,"recvLeaveRoom!ret = "+o),s.reason=o,s.logOutId=a,this.currentPlayers.splice(this.currentPlayers.indexOf(a)),s}BK.Script.log(0,0,"recvLeaveRoom parse failed.bodylen is "+t)},this.recvStartGame=function(e,t){this.startGameTs=BK.Time.timestamp,BK.Script.log(0,0,"recvStartGame")},this.recvPushFrameSync=function(e,t){for(var r=e.readBuffer(t),n=new BK.TLV(r).bkJSParseTLV(),i=(n.tag201,n.tag202,n.tag203),a=new Array,o=0;o<i.length;o++){var s=i[o].readUint32Buffer();this.lastFrame=s;var f=i[o].bufferLength()-4;BK.Script.log(0,0,"sync recv len= "+i[o].bufferLength()+" frameData.length="+i.length);for(var u=new Array;0<f;){BK.Script.log(0,0,"push frameNo="+this.lastFrame);var _=i[o].readUint16Buffer();BK.Script.log(0,0,"push databuf 2 datalen="+_);var c=this.read32BytesToString(i[o]),d=i[o].readUint64Buffer(),h={openId:c,itemId:d,dataBuffer:i[o].readBuffer(_)};BK.Script.log(0,0,"push databuf openid="+c),BK.Script.log(0,0,"push databuf itemid="+d),u.push(h),f-=42,f-=_}u.frameSeq=s,a.push(u)}this.frameSyncListener(a)},this.recvQueryFrameSync=function(e,t){var r=e.readBuffer(t),n=new BK.TLV(r).bkJSParseTLV();if(!n)return BK.Script.log(0,0,"recvQueryFrameSync empty."),void this.queryFrameDataCallBack(0,void 0);for(var i=n.tag201,a=new Array,o=0;o<i.length;o++){i[o].readUint32Buffer();var s=i[o].bufferLength()-4;BK.Script.log(0,0,"sync query recv = "+i[o].bufferLength()+" frameData.length="+i.length);for(var f=new Array;0<s;){BK.Script.log(0,0,"push frameNo="+this.lastFrame);var u=i[o].readUint16Buffer();BK.Script.log(0,0,"push databuf 2 datalen="+u);var _=this.read32BytesToString(i[o]),c=i[o].readUint64Buffer(),d={openId:_,itemId:c,dataBuffer:i[o].readBuffer(u)};BK.Script.log(0,0,"push databuf openid="+_),BK.Script.log(0,0,"push databuf itemid="+c),f.push(d),s-=42,s-=u}a.push(f)}BK.Script.log(0,0,"query end"),this.queryFrameDataCallBack(0,a)},this.recvControlCommand=function(e,t){var r=e.readBuffer(t),n=new BK.TLV(r).bkJSParseTLV(),i={};n.tag201&&(i=JSON.parse(n.tag201.readAsString())),this.controlCommandCallback&&this.controlCommandCallback(0,i)},this.recvSSOJoinRoom=function(e,t,r){if(BK.Script.log(1,1,"recvSSOJoinRoom = true data="+JSON.stringify(r)),0==e){var n=r.data.avRoomId,i=r.data.sdkAppId,a=r.data.accountType;GameStatusInfo.avAppId=i,GameStatusInfo.avAccountType=a,GameStatusInfo.avRoomId=n,GameStatusInfo.roomId=this.roomId}},this.handleServerError=function(e){switch(BK.Script.log(0,1,"handleServerError!cmd = "+e.cmd+", errCode = "+e.ret),e.cmd){case 7:this.roomId=e.roomId,this.createRoomCallBack(header.ret,null,e.roomId);break;case 11:this.queryRoomInfoCallBack(e.ret,null);break;case 3:this.joinRoomCallBack(e.ret,this);break;case 5:this.leaveRoomCallBack(e.ret,null);break;case 9:this.startGameCallBack(e.ret);break;case 1:this.broadcastDataCallBack(e.fromId,null);break;case 51:this.sensitiveWordCallBack(e.ret,e.fromId,null);break;case 33:this.setUserDataCallBack(e.ret);break;case 35:this.getUserDataCallBack(e.ret,null);break;case 15:this.sendSyncOptCallBack(e.ret,null);break;case 16:break;case 19:this.queryFrameDataCallBack(e.ret,null);break;case 37:this.matchGameCallBack(e.ret);break;case 39:this.queryMatchGameCallBack(e.ret);break;case 41:this.quitMatchGameCallBack(e.ret);break;case 49:this.controlCommandCallback&&this.controlCommandCallback(e.ret,{})}},this.handleRecv=function(e){var t=this.getHeader(e);if(0!=t.stlen){e.readBuffer(t.stlen);BK.Script.log(0,0,"st.len = "+t.stlen)}var r=e.readBuffer(t.bodyLen);BK.Security.decrypt(r);var n=this.getFixedHeader(r);if((this.netTimeOutTs=0)==n.ret)switch(BK.Script.log(0,0,"handleRecv = "+n.cmd+",bodyLen="+t.bodyLen+",bodyreal="+r.bufferLength()),n.cmd){case 7:this.roomId=n.roomId;var i=this.recvCreateRoom(r,r.bufferLength()-fixedHeaderLen);BK.Script.log(0,0,"magic = "+t.magic+",stlen = "+t.stlen+",bodyLen="+t.bodyLen+",cmd="+n.cmd+",roomId="+n.roomId),this.createRoomCallBack(n.ret,i,n.roomId),BK.QQ.notifyNewRoom(this.roomId,n.ret);break;case 11:var a=this.recvQueryRoom(r,r.bufferLength()-fixedHeaderLen);this.queryRoomInfoCallBack(n.ret,a),BK.Script.log(0,0,"magic = "+t.magic+",stlen = "+t.stlen+",bodyLen="+t.bodyLen+",cmd="+n.cmd+",roomId="+n.roomId);break;case 3:if(this.recvJoinRoom(r,r.bufferLength()-fixedHeaderLen),this.joinRoomCallBack(n.ret,this),1==Boolean(BK.QQ.isNeedSSOServer))for(var o=0;o<this.newJoinPlayers.length;o++)if(this.newJoinPlayers[o].openId==currentPlayerOpenId)return BK.QQ.ssoJoinRoomCallback=this.recvSSOJoinRoom.bind(this),void BK.QQ.notifyNewOrJoinRoomSrv(this.newJoinPlayers,this.roomId,this.ownerId==GameStatusInfo.openId?1:2);BK.QQ.notifyJoinRoom(this.newJoinPlayers,{},n.ret);break;case 5:var s=this.recvLeaveRoom(r,r.bufferLength()-fixedHeaderLen);this.leaveRoomCallBack&&this.leaveRoomCallBack(n.ret,s);break;case 9:this.recvStartGame(r,r.bufferLength()-fixedHeaderLen),this.startGameCallBack(n.ret),1==Boolean(BK.QQ.isNeedSSOServer)&&BK.QQ.notifyStartGameSrv();break;case 1:var f=r.readBuffer(r.bufferLength()-fixedHeaderLen);this.broadcastDataCallBack(n.fromId,f,n.toId);break;case 51:f=r.readBuffer(r.bufferLength()-fixedHeaderLen);this.sensitiveWordCallBack(n.ret,n.fromId,f,n.toId);break;case 33:f=r.readBuffer(r.bufferLength()-fixedHeaderLen);this.setUserDataCallBack(n.ret);break;case 35:f=r.readBuffer(r.bufferLength()-fixedHeaderLen);this.getUserDataCallBack(n.ret,f);break;case 15:var u=r.readUint32Buffer();this.ackSeq=u,this.sendSyncOptCallBack(n.ret,u);break;case 16:this.recvPushFrameSync(r,r.bufferLength()-fixedHeaderLen);break;case 19:this.recvQueryFrameSync(r,r.bufferLength()-fixedHeaderLen);break;case 37:this.matchGameCallBack(n.ret);break;case 39:this.roomId=n.roomId,this.queryMatchGameCallBack(n.ret);break;case 41:this.roomId=n.roomId,this.quitMatchGameCallBack(n.ret);break;case 49:this.recvControlCommand(r,r.bufferLength()-fixedHeaderLen)}else this.handleServerError(n)},this.requestSocket=function(e){var t;switch(BK.Script.log(0,0,"requestSocket = "+e.cmd),e.cmd){case 6:t=this.requestCreateRoom(e.arg0,e.arg1);break;case 10:t=this.requestQueryRoom();break;case 2:t=this.requestJoinRoom(e.arg0);break;case 4:t=this.requestLeaveRoom(e.arg0);break;case 8:t=this.requestStartGame();break;case 1:t=this.requestsendBroadcastData(e.arg0);break;case 50:t=this.requestSendSendSensitiveWordData(e.arg0);break;case 32:t=this.requestSetUserData(e.arg0);break;case 34:t=this.requestGetUserData(e.arg0);break;case 14:t=this.requestSyncOpt(e.arg0,e.arg1,e.arg2,e.arg3);break;case 18:t=this.requestQueryFrameData(e.arg0,e.arg1);break;case 36:t=this.requestMatch(e.arg0,e.arg1);break;case 38:t=this.requestQueryMatch(e.arg0,e.arg1);break;case 40:t=this.requestQuitMatch(e.arg0,e.arg1);break;case 12:t=this.requestSendKeepAlive(),0==this.netTimeOutTs&&(this.netTimeOutTs=BK.Time.timestamp);break;case 48:var r=new BK.Buffer,n=new BK.Buffer;r.writeAsString(e.arg1),n.writeAsString(e.arg2),t=this.requestControlCommand(e.arg0,r,n)}null!=t&&(BK.Script.log(0,0,"requestSocket = "+e.cmd),this.socket.send(t))},this.seperatePackHandle=function(){for(;;){var e=this.socket.receiveNotRemove(),t=e.bufferLength(),r=this.getHeader(e),n=r.stlen+r.bodyLen+HeaderLen;if(BK.Script.log(0,0,"this.socket.receive():totalLen = "+t+"  onePackLen="+n),t==n){var i;BK.Script.log(0,0,"  this.socket.receive():onePackLen="+n),null!=(i=this.socket.receive(n))&&this.handleRecv(i);break}if(t<n){BK.Script.log(0,0,"  this.socket.receive():part of onePackLen="+n);break}n<t&&(BK.Script.log(0,0,"  this.socket.receive():Multipacks onePackLen="+n),null!=(i=this.socket.receive(n))&&this.handleRecv(i))}},this.curConnRetrys=0,this.curConnTimeout=0,this.prevNetState=0,this.reConnectTime=0,this.updateNet=function(){var e=this.socket.update(),t=this.socket.state;if(-1!=e)switch(this.prevNetState){case 0:switch(t){case 3:this.onErrorEvent(this);break;case 1:this.onConnectingEvent(this);break;case 2:this.onConnectedEvent(this)}break;case 1:switch(t){case 2:switch(e){case 2:this.onConnectedEvent();break;case 3:BK.Script.log(0,0,"BK.Socket.update!unexcepted status")}}break;case 2:switch(t){case 2:this.onUpdateEvent();break;default:this.onErrorEvent()}}else switch(BK.Script.log(0,0,"BK.Socket.DisconnectEvent prevNetState="+this.prevNetState),this.prevNetState){case 3:case 2:case 1:this.onDisconnectEvent()}return this.prevNetState=t,e},this.onErrorEvent=function(){BK.Script.log(0,0,"BK.Socket.ErrorEvent")},this.onUpdateEvent=function(){return 0},this.onTimeoutEvent=function(){BK.Script.log(0,0,"BK.Socket.TimeoutEvent")},this.onConnectingEvent=function(){BK.Script.log(0,0,"BK.Socket.ConnectingEvent")},this.onConnectedEvent=function(){BK.Script.log(0,0,"BK.Socket.ConnectedEvent"),this.connectedNetCallback&&this.connectedNetCallback()},this.onReconnectEvent=function(){BK.Script.log(0,0,"BK.Socket.ReconnectEvent")},this.onDisconnectEvent=function(){(BK.Script.log(0,0,"BK.Socket.DisconnectEvent"),this.disconnectNetCallBack&&this.disconnectNetCallBack(),this.reConnectTime<3)?(BK.Script.log(0,0,"BK.Socket.DisconnectEvent reconnectAndJoinRoom"),(BK.Time.timestamp-this.startGameTs)/60<5?(this.reConnectTime++,this.reConnectAndJoinRoom()):BK.Script.log(0,0,"BK.Socket.DisconnectEvent over 5 min")):this.terminatedNetCallback&&this.terminatedNetCallback()},this.setConnectedNetCallBack=function(e){this.connectedNetCallback=e},this.setDisconnectNetCallBack=function(e){this.disconnectNetCallBack=e},this.setTerminatedNetCallback=function(e){this.terminatedNetCallback=e},this.updateSocket=function(){var e=this.updateNet();if((3==e||2==e)&&0<this.reqArray.length){var t=this.reqArray.pop();null!=t&&null!=t&&this.requestSocket(t)}return 3!=e&&1!=e||this.seperatePackHandle(),e},this.createAndJoinRoom=function(e,t,n,i,a){this.createRoom(e,t,function(e,t,r){0==e?(BK.Script.log(0,0,"创建游戏 statusCode:"+e+" roomId:"+r),this.gameSvrIp=t.ip_2,this.gameSvrPort=t.port_2,this.roomSvrIp=t.ip_1,this.roomSvrPort=t.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(e,t){BK.Script.log(0,0,"加入房间 statusCode:"+e+" roomid is "+t.roomId),0==e&&(GameStatusInfo.roomId=t.roomId,BK.QQ.gameCfg.roomId=t.roomId),n(e,this)},i,a)):n(e,this)})},this.queryAndJoinRoom=function(e,t,r,n,i,a){1!=this.serverConnected&&(this.socket.close(),this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort)),this.queryRoom(e,t,r,function(e,t){0==e?(this.gameSvrIp=t.ip_2,this.gameSvrPort=t.port_2,this.roomSvrIp=t.ip_1,this.roomSvrPort=t.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(e,t){BK.Script.log(0,0,"加入房间 statusCode:"+e+" roomid is "+t.roomId),n(e,this)},i,a)):n(e,void 0)})},this.forceLeaveRoom=function(e,t){var r=new Object;r.cmd=4,r.arg0=t,this.leaveRoomCallBack=e;var n=this.requestLeaveRoom(r.arg0),i=this.socket.update();3==i||2==i?(this.socket.send(n),BK.Script.log(0,0,"forceLeaveRoom push")):BK.Script.log(0,0,"forceLeaveRoom push Failed. Socket not allow Send.")},this._event4StopGame=function(e,t,r){BK.Script.log(0,0,"BK.Room._event4StopGame!errCode = "+e+", cmd = "+t+", data = "+JSON.stringify(r)),0==e&&this.forceLeaveRoom(function(e,t){BK.Script.log(0,0,"forceLeaveRoom callback")},0)},BK.MQQ.SsoRequest.addListener(CMSHOW_SC_CMD_STOP_GAME,this,this._event4StopGame.bind(this)),this.addDebugFunctions=function(){this.createFixedRoom=function(e,t,r,n){this.roomId=r,this.mId=t,this.gameId=e;var i=this.socket.connect(this.recommandRoomSvrHost,this.recommandRoomSvrPort);BK.Script.log(0,0,"socket con ="+i),-1!=i&&BK.Script.log(0,0,"socket connect failed! "+i),this.createRoomCallBack=n;var a=new Object;a.cmd=6,a.arg0=e,a.arg1=t,this.reqArray.push(a),BK.Script.log(0,0,"create Fixed Room ")},this.createAndJoinFixedRoom=function(e,t,r,n,i){this.createFixedRoom(e,t,r,function(e,t,r){0==e?(BK.Script.log(0,0,"创建固定房间号 游戏 statusCode:"+e+" roomId:"+r),this.gameSvrIp=t.ip_2,this.gameSvrPort=t.port_2,this.roomSvrIp=t.ip_1,this.roomSvrPort=t.port_1,this.socket.close(),this.socket.connect(this.gameSvrIp,this.gameSvrPort),this.joinRoom(0,function(e,t){BK.Script.log(0,0,"加入房间 statusCode:"+e+" roomid is "+t.roomId),n(e,this)},i)):n(e,this)})},this.requestCreateRoom=function(e,t){var r=this.roomId;r||(r=0),BK.Script.log(0,0,"create fixed room request in fixedRoomId:"+r);var n=new BK.Buffer(fixedHeaderLen,1);this.addFixedHeader(n,6,e,r,t);var i=BK.Security.getST();BK.Security.encrypt(n);var a=i.bufferLength(),o=new BK.Buffer(HeaderLen+n.bufferLength()+a,1);return this.addHeader(o,n.bufferLength(),a),o.writeBuffer(i),o.writeBuffer(n),BK.Script.log(0,0,"create room request buffer : "+o.bufferLength()+" body len:"+n.bufferLength()),o}},Object.defineProperty(this,"environment",{get:function(){return this._environment},set:function(e){BK.Script.log(1,1,"set Environment aaaaa"+e),e==NETWORK_ENVIRONMENT_QQ_DEBUG?(this.headerVersion=769,this.recommandRoomSvrHost=DebugRecommandRoomSvrHost,this.recommandRoomSvrPort=DebugRecommandRoomSvrPort):e==NETWORK_ENVIRONMENT_DEMO_DEV&&(this.addDebugFunctions(),this.headerVersion=257,this.recommandRoomSvrHost=DebugRecommandRoomSvrHost,this.recommandRoomSvrPort=DebugRecommandRoomSvrPort),this._environment=e}}),BK.Script.log(1,1,"environment aaaaa  xxxxxxxxxxx  "+this._environment),this._environment==NETWORK_ENVIRONMENT_QQ_DEBUG?(this.headerVersion=769,this.recommandRoomSvrHost=DebugRecommandRoomSvrHost,this.recommandRoomSvrPort=DebugRecommandRoomSvrPort):this._environment==NETWORK_ENVIRONMENT_DEMO_DEV&&(this.addDebugFunctions(),this.headerVersion=257,this.recommandRoomSvrHost=DebugRecommandRoomSvrHost,this.recommandRoomSvrPort=DebugRecommandRoomSvrPort)},BK.Script.log(0,0,"protocol.js Load Succeed!"),Device.prototype.innnerSetKeepScreenOn=function(e){this.isKeepScreenOnInit?(BK.QQ.uploadData("call_screen_on",GameStatusInfo.src,e?1:0,"","",""),BK.Director.isKeepScreenOn=e):BK.Script.log(1,1,"user unset keepScreenOn,ignore the value")},Device.prototype.setKeepScreenOn=function(e){BK.Script.log(1,1,"user set keepScreenOn "+e),this.userSetDeviceScreenValue=e,this.isKeepScreenOnInit=!0,this.innnerSetKeepScreenOn(e)},BK.Device||(BK.Device=new Device,BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_ENTER_BACKGROUND "),BK.Device.innnerSetKeepScreenOn(!1)}),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_ENTER_FORGROUND,this,function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_ENTER_FORGROUND "),BK.Device.isKeepScreenOnInit?BK.Device.innnerSetKeepScreenOn(BK.Device.userSetDeviceScreenValue):BK.Device.innnerSetKeepScreenOn(!1)}),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MINIMIZE,this,function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_MINIMIZE "),BK.Device.innnerSetKeepScreenOn(!1)}),BK.MQQ.SsoRequest.addListener(CMD_CMSHOW_GAME_MAXIMIZE,this,function(){BK.Script.log(1,1,"keepScreenOn CMD_CMSHOW_GAME_MAXIMIZE "),BK.Device.isKeepScreenOnInit?BK.Device.innnerSetKeepScreenOn(BK.Device.userSetDeviceScreenValue):BK.Device.innnerSetKeepScreenOn(!1)}),BK.MQQ.SsoRequest.addListener(CMSHOW_SC_CMD_STOP_GAME,this,function(){BK.Script.log(1,1,"keepScreenOn CMSHOW_SC_CMD_STOP_GAME "),BK.Device.innnerSetKeepScreenOn(!1)})),BK.Script.log(1,1,"load device.js success"),BK.Script.log(0,0,"filemanage.js is loaded"),BK.FileManager=function(){this.fileArray=[],this.readFile=function(e,t){var r=new BK.FileUtil(e);r.openFile();var n=new Object;return n.path=e,n.status=0,n.readCallBack=t,n.file=r,this.fileArray.push(n),n},this.update=function(){for(var e=0;e<this.fileArray.length;e++)if(1!=this.fileArray[e].status){var t=this.fileArray[e].file.update();if(1==t||3==t){var r=this.fileArray[e].file.readFileAsync();r&&(this.fileArray[e].readCallBack(r),this.fileArray[e].data=r,this.fileArray[e].status=1,this.fileArray[e].file.close())}}},this.getFileData=function(e){for(var t=0;t<this.fileArray.length;t++)if(this.fileArray[t].path==e&&1==this.fileArray[t].status)return this.fileArray[t].data},this.closeFile=function(e){for(var t=his.fileArray.length;0<t;t--)this.fileArray[t].path==file.path&&this.fileArray.splice(t,1);e.file.removeFromCache()}},BK.Script.log(1,1,"skeletonAnimationAsync js done");var fileManager=new BK.FileManager;function skeletonAnimationAsync(e,i,a,o,s,f){var t=e+".png",u=e+".atlas",_=e+".json",c=0;fileManager.readFile(t,function(e){if(BK.Script.log(0,0,"skeletonAnimationAsync Done"),3==++c){var t=BK.Script.pathForResource(_),r=BK.Script.pathForResource(u),n=new BK.SkeletonAnimation(r,t,i,a,o,s);f(n)}}),fileManager.readFile(u,function(e){if(BK.Script.log(0,0,"skeletonAnimationAsync Done"),3==++c){var t=BK.Script.pathForResource(_),r=BK.Script.pathForResource(u),n=new BK.SkeletonAnimation(r,t,i,a,o,s);f(n)}}),fileManager.readFile(_,function(e){if(BK.Script.log(0,0,"skeletonAnimationAsync Done"),3==++c){var t=BK.Script.pathForResource(_),r=BK.Script.pathForResource(u),n=new BK.SkeletonAnimation(r,t,i,a,o,s);f(n)}})}function setAccessoryAsync(n,e,i){var t=e+".png",a=e+".atlas",o=e+".json",s=0;fileManager.readFile(t,function(e){if(BK.Script.log(0,0,"setAccessoryAsync Done"),3==++s){var t=BK.Script.pathForResource(o),r=BK.Script.pathForResource(a);n.setAccessory(t,r),i()}}),fileManager.readFile(a,function(e){if(BK.Script.log(0,0,"setAccessoryAsync Done"),3==++s){var t=BK.Script.pathForResource(o),r=BK.Script.pathForResource(a);n.setAccessory(t,r),i()}}),fileManager.readFile(o,function(e){if(BK.Script.log(0,0,"setAccessoryAsync Done"),3==++s){var t=BK.Script.pathForResource(o),r=BK.Script.pathForResource(a);n.setAccessory(t,r),i()}})}function setAccessoryWithInfoAsync(n,e,i,a){var t=e+".png",o=e+".atlas",s=e+".json",f=0;fileManager.readFile(t,function(e){if(BK.Script.log(0,0,"setAccessoryWithInfo Done"),3==++f){var t=BK.Script.pathForResource(s),r=BK.Script.pathForResource(o);n.setAccessoryWithInfo(t,r,i),a()}}),fileManager.readFile(o,function(e){if(BK.Script.log(0,0,"setAccessoryWithInfo Done"),3==++f){var t=BK.Script.pathForResource(s),r=BK.Script.pathForResource(o);n.setAccessoryWithInfo(t,r,i),a()}}),fileManager.readFile(s,function(e){if(BK.Script.log(0,0,"setAccessoryWithInfo Done"),3==++f){var t=BK.Script.pathForResource(s),r=BK.Script.pathForResource(o);n.setAccessoryWithInfo(t,r,i),a()}})}function setAccessoryAnimationAsync(n,e,i,a){var t=e+".png",o=e+".atlas",s=e+".json",f=0;fileManager.readFile(t,function(e){if(BK.Script.log(0,0,"setAccessoryAnimationAsync Done"),3==++f){var t=BK.Script.pathForResource(s),r=BK.Script.pathForResource(o);n.setAccessoryAnimation(t,r,i),a()}}),fileManager.readFile(o,function(e){if(BK.Script.log(0,0,"setAccessoryAnimationAsync Done"),3==++f){var t=BK.Script.pathForResource(s),r=BK.Script.pathForResource(o);n.setAccessoryAnimation(t,r,i),a()}}),fileManager.readFile(s,function(e){if(BK.Script.log(0,0,"setAccessoryAnimationAsync Done"),3==++f){var t=BK.Script.pathForResource(s),r=BK.Script.pathForResource(o);n.setAccessoryAnimation(t,r,i),a()}})}BK.Director.ticker.add(function(e,t){fileManager.update()}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DNS=t())}(BK,function(){function e(){this.records=[],this.running=!1}return e.prototype.exists=function(e){for(var t=0;t<this.records.length;t++)if(this.records[t].hostname===e)return!0;return!1},e.prototype.query=function(e,t){for(var r=0;r<this.records.length;r++)if(this.records[r].af===t&&this.records[r].hostname===e)return this.records[r];return null},e.prototype.update=function(e,t,r,n){for(var i=0;i<this.records.length;i++)if(this.records[i].af===r&&this.records[i].hostname===e)return void this.records[i].callbacks.push(t);this.records.push({af:r,timeout:n,hostname:e,callbacks:[t]})},e.prototype.delete=function(e){for(var t=0;t<this.records.length;t++)if(this.records[t].hostname===e){this.records.splice(t);break}},e.prototype.start=function(){if(!this.running){this.running=!0;var r=this;BK.Director.ticker.add(function(e,t){r.records.length&&BK.Misc.handleDNSQueryResult()})}},e.prototype.queryIPAddress=function(a,e,t,r){var n=!this.exists(a);if(null==t&&(t=2),null==r&&(r=0),this.update(a,e,t,r),n){var o=this;o.start(),BK.Misc.queryIPAddress(a,function(e,t,r){for(var n=o.query(a,t).callbacks,i=0;i<n.length;i++)n[i].call(o,e,t,r);o.delete(a)},t,r)}},new e}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.HTTPParser=t())}(BK,function(){var c=81920,f=/^HTTP\/1\.([01]) ([0-9]{3})(?: ((?:[\x21-\x7E](?:[\t ]+[\x21-\x7E])*)*))?$/,u=/^([!#$%'*+\-.^_`|~0-9A-Za-z]+):[\t ]*((?:[\x21-\x7E](?:[\t ]+[\x21-\x7E])*)*)[\t ]*$/,_=/^[\t ]+(.*)$/;function r(e){this.onHeaders=void 0,this.onComplete=void 0,this.reinitialize(e)}return r.prototype.reinitialize=function(e){this.execute=this._executeHeader,(this.type=e)===r.RESPONSE&&(this._state=1),this._err=void 0,this._flags=0,this._contentLen=void 0,this._nbytes=0,this._nhdrbytes=0,this._nhdrpairs=0,this._buf="",this._seenCR=!1,this.headers={},this.httpMajor=1,this.httpMinor=void 0,this.maxHeaderPairs=2e3,this.method=void 0,this.url=void 0,this.statusCode=void 0,this.statusText=void 0},r.prototype._processHdrLine=function(e){switch(this._state){case 2:if(0===e.length)return void this._headersEnd();if(null===(s=u.exec(e))){if(null===(s=_.exec(e)))return this.execute=this._executeError,this._err=new Error("Malformed header line"),this.execute(this._err),this._err;var t=s[1];0<t.length&&BK.Script.log(1,0,"processHdrLine!extra = "+t)}else{var r=s[1],n=s[2];switch(r.toLowerCase()){case"connection":"close"===(i=n.toLowerCase()).substring(0,5)?this._flags|=4:"keep-alive"===i.substring(0,10)?this._flags|=2:"upgrade"===i.substring(0,7)&&(this._flags|=8);break;case"transfer-encoding":var i;"chunked"===(i=n.toLowerCase()).substring(0,7)&&(this._flags|=1);break;case"upgrade":this._flags|=32;break;case"content-length":var a=parseInt(n,10);if(isNaN(a)||524288<a)return this.execute=this._executeError,this._err=new Error("Bad Content-Length: "+inspect(a)),this.execute(this._err),this._err;this._contentLen=a}var o=this.maxHeaderPairs;(o<=0||++this._nhdrpairs<o)&&(this.headers[r.toLowerCase()]=n)}break;case 1:if(0===e.length)return!0;var s;if(null===(s=f.exec(e)))return this.execute=this._executeError,this._err=new Error("Malformed status line"),this.execute(this._err),this._err;this.httpMinor=parseInt(s[1],10),this.statusCode=parseInt(s[2],10),this.statusText=s[3]||"",this._state=2;break;default:return this.execute=this._executeError,this._err=new Error("Unexpected HTTP parser state: "+this._state),this.execute(this._err),this._err}},r.prototype._headersEnd=function(){var e=this._flags,t=this.method&&this.method.toLowerCase(),r=40==(40&e)||"connect"===t,n=0==(4&e),i=this._contentLen;if(this._buf="",this._seenCR=!1,((this._nbytes=0)===this.httpMajor&&9===this.httpMinor||0===this.httpMinor&&0==(2&e))&&(n=!1),0<(16&e))return this.onComplete&&this.onComplete(),void this.reinitialize(this.type);if(this.onHeaders){var a=this.headers;!0===this.onHeaders(this.httpMajor,this.httpMinor,a,this.method,this.url,this.statusCode,this.statusText,r,n)&&(e=this._flags|=64)}r?(this.onComplete&&this.onComplete(),this._state=3):(0===i||0<(64&e)||0==(1&e)&&void 0===i&&!this._needsEOF())&&(this.onComplete&&this.onComplete(),this.reinitialize(this.type))},r.prototype._executeHeader=function(e){for(var t,r,n=0,i=e.length,a=this._seenCR,o=this._buf,s=this._nhdrbytes;n<i;){if(a)if(a=!1,10===e.charCodeAt(n)){if(++n,t=this._processHdrLine(o),o="","object"==typeof t)return this._err=t,this.execute(this._err),t;if(void 0===t&&2!==(u=this._state))return u<3&&n<i?"number"!=typeof(t=this.execute(e.slice(n)))?(this._err=t,this.execute(this._err),t):n+t:(3===u&&this.reinitialize(this.type),n)}else if(o+="\r",c<++s)return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;var f,u;if(!(-1<(f=e.indexOf("\r\n",n)))){var _;if(13===e.charCodeAt(i-1)?(a=!0,_=i-1):_=i,c<(s+=_-n))return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;o+=e.substring(n,_);break}if(0<(r=f-n)){if(c<(s+=r))return this.execute=this._executeError,this._err=new Error("Header size limit exceeded (81920)"),this.execute(this._err),this._err;o+=e.substring(n,f)}if(n=f+2,t=this._processHdrLine(o),o="","object"==typeof t)return this._err=t,this.execute(this._err),t;if(void 0===t&&2!==(u=this._state))return u<3&&n<i?"number"!=typeof(t=this.execute(e.slice(n)))?(this._err=t,this.execute(this._err),t):n+t:(3===u&&this.reinitialize(this.type),n)}return this._buf=o,this._seenCR=a,this._nhdrbytes=s,i},r.prototype._executeError=function(e){return BK.Script.log(1,0,"_executeError!err = "+e.message),this._err},r.prototype.execute=r.prototype._executeHeader,r.prototype._needsEOF=function(){if(this.type===r.REQUEST)return!1;var e=this.statusCode,t=this._flags;return!(void 0!==e&&(204===e||304===e||1===parseInt(String(e/100),1))||64&t)&&!(0<(1&t)||null!=this._contentLen)},r.REQUEST=0,r.RESPONSE=1,r}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.URL=t())}(BK,function(){return function(){function i(){return new RegExp(/(.*?)\.?([^\.]*?)\.?(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function a(e,t){var r=e.charAt(0),n=t.split(r);return r===e?n:n[(e=parseInt(e.substring(1),10))<0?n.length+e:e-1]}function o(e,t){for(var r,n=e.charAt(0),i=t.split("&"),a=[],o={},s=[],f=e.substring(1),u=0,_=i.length;u<_;u++)if((a=i[u].match(/(.*?)=(.*)/))||(a=[i[u],i[u],""]),""!==a[1].replace(/\s/g,"")){if(a[2]=(r=a[2]||"",decodeURIComponent(r.replace(/\+/g," "))),f===a[1])return a[2];(s=a[1].match(/(.*)\[([0-9]+)\]/))?(o[s[1]]=o[s[1]]||[],o[s[1]][s[2]]=a[2]):o[a[1]]=a[2]}return n===e?o:o[f]}return function(e,t){var r,n={};if("tld?"===e)return i();if(t=t||window.location.toString(),!e)return t;if(e=e.toString(),r=t.match(/^mailto:([^\/].+)/))n.protocol="mailto",n.email=r[1];else{if((r=t.match(/(.*?)\/#\!(.*)/))&&(t=r[1]+r[2]),(r=t.match(/(.*?)#(.*)/))&&(n.hash=r[2],t=r[1]),n.hash&&e.match(/^#/))return o(e,n.hash);if((r=t.match(/(.*?)\?(.*)/))&&(n.query=r[2],t=r[1]),n.query&&e.match(/^\?/))return o(e,n.query);if((r=t.match(/(.*?)\:?\/\/(.*)/))&&(n.protocol=r[1].toLowerCase(),t=r[2]),(r=t.match(/(.*?)(\/.*)/))&&(n.path=r[2],t=r[1]),n.path=(n.path||"").replace(/^([^\/])/,"/$1"),e.match(/^[\-0-9]+$/)&&(e=e.replace(/^([^\/])/,"/$1")),e.match(/^\//))return a(e,n.path.substring(1));if((r=a("/-1",n.path.substring(1)))&&(r=r.match(/(.*?)\.(.*)/))&&(n.file=r[0],n.filename=r[1],n.fileext=r[2]),(r=t.match(/(.*)\:([0-9]+)$/))&&(n.port=r[2],t=r[1]),(r=t.match(/(.*?)@(.*)/))&&(n.auth=r[1],t=r[2]),n.auth&&(r=n.auth.match(/(.*)\:(.*)/),n.user=r?r[1]:n.auth,n.pass=r?r[2]:void 0),n.hostname=t.toLowerCase(),"."===e.charAt(0))return a(e,n.hostname);i()&&(r=n.hostname.match(i()))&&(n.tld=r[3],n.domain=r[2]?r[2]+"."+r[3]:void 0,n.sub=r[1]||void 0),n.port||("http"===n.protocol||"ws"===n.protocol?n.port="80":"https"!==n.protocol&&"wss"!==n.protocol||(n.port="443"))}return e in n?n[e]:"{}"===e?n:void 0}}()});var gl,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}();function Canvas(){var e=arguments.length;(this._shadowColor={r:0,g:0,b:0,a:0},this._shadowOffset={x:0,y:0},this._shadowRadius=0,this._textBaseLine=0,this._textAlign=0,this._useH5Mode=0,2==e)&&(this.__nativeObj=new BK.CanvasNode(arguments[0],arguments[1]),this.setFlipXY(0,1),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;"scale"!=t&&"contentSize"!=t&&"size"!=t&&Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(Canvas.prototype,"contentSize",{get:function(){return this.__nativeObj.contentSize},set:function(e){this.__nativeObj.contentSize=e,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"size",{get:function(){return this.__nativeObj.size},set:function(e){this.__nativeObj.size=e,this.__nativeObj.resetCanvas()},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"textBaseline",{get:function(){return this._textBaseLine},set:function(e){switch(e){case 0:case 1:case 2:this._textBaseLine=e;break;case"bottom":case"Bottom":this._textBaseLine=0;break;case"Middle":case"middle":this._textBaseLine=1;break;case"Top":case"top":this._textBaseLine=2}},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"textAlign",{get:function(){return this._textAlign},set:function(e){switch(e){case 0:case 1:case 2:this._textAlign=e;break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}this.__nativeObj.setTextAlign(this._textAlign)},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"lineWidth",{get:function(){return this.__nativeObj.lineWidth},set:function(e){this.__nativeObj.lineWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"globalAlpha",{get:function(){return this.__nativeObj.globalAlpha},set:function(e){e=Math.min(1,e),e=Math.max(0,e),this.__nativeObj.globalAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"fillColor",{get:function(){return this.__nativeObj.fillColor},set:function(e){this.__nativeObj.fillColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"strokeColor",{get:function(){return this.__nativeObj.strokeColor},set:function(e){this.__nativeObj.strokeColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"lineCap",{get:function(){return this.__nativeObj.lineCap},set:function(e){this.__nativeObj.lineCap=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"lineJoin",{get:function(){return this.__nativeObj.lineJoin},set:function(e){this.__nativeObj.lineJoin=e},enumerable:!0,configurable:!0}),Object.defineProperty(Canvas.prototype,"miterLimit",{get:function(){return this.__nativeObj.miterLimit},set:function(e){this.__nativeObj.miterLimit=e},enumerable:!0,configurable:!0}))}function Sprite(){this.imagePath=null;var e=arguments.length;7==e?this.__nativeObj=new BK.SpriteNode(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]):1==e?(this.__nativeObj=new BK.SpriteNode(arguments[0]),this.imagePath=arguments[0]):this.__nativeObj=new BK.SpriteNode,Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this);var t=function(t,r,e){Object.defineProperty(t,e,{get:function(){return t.__nativeObj[r]},set:function(e){t.__nativeObj[r]=e}})};t(this,"contentSize","size"),t(this,"localPivot","pivot"),t(this,"localAnchor","anchor")}function bkWebGLGetInstance(){return gl||(gl=new BK.WebGL,attatchConst(),attachMethod(),gl.OpenOptMode=OpenOptMode,gl.viewport(0,0,BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height)),Object.prototype.hasOwnProperty.call(this,"renderTicker")&&renderTicker.setTickerCallBack(function(e,t){}),gl}function __TypedArrayGetData(e){if(Object.prototype.hasOwnProperty.call(e,"__rawBKData"))return e.__rawBKData;if(Object.prototype.hasOwnProperty.call(e,"__nativeObj"))return e.__nativeObj;if(e instanceof Int8Array==1){for(var t=new BK.Buffer(e.byteLength,!1),r=0;r<e.length;r++)t.writeInt8Buffer(e[r]);return t}if(e instanceof Uint8Array==1){for(t=new BK.Buffer(e.byteLength,!1),r=0;r<e.length;r++)t.writeUint8Buffer(e[r]);return t}if(e instanceof Int16Array==1){for(t=new BK.Buffer(e.byteLength,!1),r=0;r<e.length;r++)t.writeInt16Buffer(e[r]);return t}if(e instanceof Uint16Array==1){for(t=new BK.Buffer(e.byteLength,!1),r=0;r<e.length;r++)t.writeUint16Buffer(e[r]);return t}if(e instanceof Int32Array==1){for(t=new BK.Buffer(e.byteLength,!1),r=0;r<e.length;r++)t.writeInt32Buffer(e[r]);return t}if(e instanceof Uint32Array==1){for(t=new BK.Buffer(e.byteLength,!1),r=0;r<e.length;r++)t.writeUint32Buffer(e[r]);return t}if(e instanceof Float32Array==1){for(t=new BK.Buffer(e.byteLength,!1),r=0;r<e.length;r++)t.writeFloatBuffer(e[r]);return t}if(e instanceof ArrayBuffer==1){t=new BK.Buffer(e.byteLength,!1);var n=new DataView(e);for(r=0;r<e.byteLength;r++)t.writeUint8Buffer(n.getUint8(r));return t}return e}!function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.WebSocket=t())}(BK,function(){var r=function(){function r(){this._wsArray=[],BK.Director.ticker.add(function(e,t){r.Instance.dispatchEvent()})}return r.prototype.add=function(e){this._wsArray.push(e),BK.Script.log(1,0,"SocketEventMgr.add!so = "+e)},r.prototype.del=function(e){var t=this._wsArray.indexOf(e,0);0<=t&&(this._wsArray.splice(t,1),BK.Script.log(1,0,"SocketEventMgr.del!so = "+e))},r.prototype.dispatchEvent=function(){this._wsArray.forEach(function(e,t,r){e&&e.update()})},r}();r.Instance=new r;var e=function(){function e(e,t){this.ip=e,this.port=t,this.__nativeObj=new BK.Socket,this.prevConnTs=0,this.curConnRetrys=0,this.curConnTimeout=0,this.prevNetState=0,this.options={ConnectRetryCount:3,ConnectTimeoutInterval:3e3}}return e.prototype.__internalClose=function(){return this.__nativeObj?this.__nativeObj.close():-2},e.prototype.__internalSend=function(e){return this.__nativeObj?this.__nativeObj.send(e):-2},e.prototype.__internalRecv=function(e){if(this.__nativeObj)return this.__nativeObj.receive(e)},e.prototype.__internalUpdate=function(){return this.__nativeObj?this.__nativeObj.update():-2},e.prototype.__internalConnect=function(){if(this.__nativeObj){var e=this.__nativeObj.connect(this.ip,this.port),t=this.curNetState();switch(this.prevNetState){case 3:this.onReconnectEvent(this);case 0:switch(t){case 3:this.onErrorEvent(this);break;case 1:case 4:this.prevConnTs=BK.Time.clock,this.curConnTimeout||(this.curConnTimeout=this.options.ConnectTimeoutInterval),this.onConnectingEvent(this),e=0;break;case 2:case 5:this.onConnectedEvent(this),e=0}}return this.prevNetState=t,e}return-2},e.prototype.__internalCanReadLength=function(){return this.__nativeObj?this.__nativeObj.canReadLength():0},e.prototype.__internalIsEnableSSL=function(){return!!this.__nativeObj&&this.__nativeObj.getSSLEnable()},e.prototype.__internalEnableSSL=function(e){this.__nativeObj&&this.__nativeObj.setSSLEnable(e)},e.prototype.__internalUpdateSSL=function(){var e=this.__internalUpdate(),t=this.curNetState();if(-1!=e)switch(this.prevNetState){case 1:switch(t){case 2:BK.Script.log(1,0,"BK.Socket.update.ssl!connected, ip = "+this.ip+", port = "+this.port);break;default:var r=BK.Time.clock;return 1e3*BK.Time.diffTime(this.prevConnTs,r)>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),e}break;case 2:break;case 4:switch(t){case 5:switch(e){case 2:case 3:this.onConnectedEvent(this)}break;default:r=BK.Time.clock;return 1e3*BK.Time.diffTime(this.prevConnTs,r)>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),e}break;case 5:switch(t){case 5:this.onUpdateEvent(this);break;case 3:this.onDisconnectEvent(this);break;default:this.onErrorEvent(this)}}else switch(this.prevNetState){case 2:case 1:this.onDisconnectEvent(this);break;case 4:case 6:case 5:this.onErrorEvent(this)}return this.prevNetState=t,e},e.prototype.__internalUpdateNoSSL=function(){var e=this.__internalUpdate(),t=this.curNetState();if(-1!=e)switch(this.prevNetState){case 1:switch(t){case 2:switch(e){case 2:this.onConnectedEvent(this);break;case 3:BK.Script.log(1,0,"BK.Socket.update!unexcepted status")}break;default:var r=BK.Time.clock;return 1e3*BK.Time.diffTime(this.prevConnTs,r)>=this.curConnTimeout&&(this.curConnRetrys=this.curConnRetrys+1,this.curConnRetrys<this.options.ConnectRetryCount?(this.close(),this.connect(),this.curConnTimeout=2*this.curConnTimeout):(this.onTimeoutEvent(this),this.close())),e}break;case 2:switch(t){case 2:this.onUpdateEvent(this);break;case 3:this.onDisconnectEvent(this);break;default:this.onErrorEvent(this)}}else switch(this.prevNetState){case 2:case 1:this.onDisconnectEvent(this)}return this.prevNetState=t,e},e.prototype.curNetState=function(){return this.__nativeObj?this.__nativeObj.state:0},e.prototype.close=function(){var e=this.__internalClose();return e||(this.prevNetState=0),r.Instance.del(this),e},e.prototype.send=function(e){return this.__internalSend(e)},e.prototype.recv=function(e){return this.__internalRecv(e)},e.prototype.canRecvLength=function(){return this.__internalCanReadLength()},e.prototype.update=function(){return this.isEnableSSL()?this.__internalUpdateSSL():this.__internalUpdateNoSSL()},e.prototype.connect=function(){var e=this.curNetState();if(0==e||3==e){var t=this.__internalConnect();return t||r.Instance.add(this),t}return 0},e.prototype.isEnableSSL=function(){return this.__internalIsEnableSSL()},e.prototype.enableSSL=function(e){this.__internalEnableSSL(e)},e.prototype.onErrorEvent=function(e){BK.Script.log(1,0,"BK.Socket.ErrorEvent")},e.prototype.onUpdateEvent=function(e){return 0},e.prototype.onTimeoutEvent=function(e){BK.Script.log(1,0,"BK.Socket.TimeoutEvent")},e.prototype.onConnectingEvent=function(e){BK.Script.log(1,0,"BK.Socket.ConnectingEvent")},e.prototype.onConnectedEvent=function(e){BK.Script.log(1,0,"BK.Socket.ConnectedEvent")},e.prototype.onReconnectEvent=function(e){BK.Script.log(1,0,"BK.Socket.ReconnectEvent")},e.prototype.onDisconnectEvent=function(e){BK.Script.log(1,0,"BK.Socket.DisconnectEvent")},e}(),i=function(e,t){this.data=e,this.isBinary=t},n=function(u){function _(e,t,r,n,i){var a=u.call(this,e,t)||this;return a.path=n||"/",a.host=r,a.query=i,a.httpVer=1.1,a.httpParser=new BK.HTTPParser(BK.HTTPParser.RESPONSE),a.version=13,a.protocols=new Array,a.extensions=new Array,a.delegate={onOpen:null,onClose:null,onError:null,onMessage:null,onSendComplete:null},a.options||(a.options={}),a.options.DrainSegmentCount=8,a.options.DefaultSegmentSize=4096,a.options.PingPongInterval=0,a.options.HandleShakeRequestTimeout=1e4,a.options.HandleShakeResponseTimeout=1e4,a.options.CloseAckTimeout=2e4,a.options.PingPongTimeout=3e3,a.clear(),a}return __extends(_,u),_.prototype.clear=function(){this.mask4=new BK.Buffer(4,!1),this.txbuf=new BK.Buffer(128,!0),this.rxbuf=new BK.Buffer(128,!0),this.txbufQue=new Array,this.rxbufQue=new Array,this.udataQue=new Array,this.peerClosed=!1,this.txSegCount=0,this.rxSegCount=0,this.rxFrameType=-1,this.isFinalSeg=!1,this.inTxSegFrame=!1,this.inRxSegFrame=!1,this.inPartialTxbuf=!1,this.inPingFrame=!1,this.inPongFrame=!1,this.errcode=65535,this.state=0,this.parseState=0,this.phaseTimeout=0,this.pingpongTimer=0,this.prevPhaseTickCount=0,this.prevPingPongTickCount=0},_.prototype.getReadyState=function(){return this.state},_.prototype.getErrorCode=function(){return this.errcode},_.prototype.getErrorString=function(){return this.message},_.prototype.randomN=function(e){for(var t=new BK.Buffer(e,!1),r=0;r<e;r++){var n=Math.round(65535*Math.random());t.writeUint8Buffer(n)}return t},_.prototype.toHex=function(e){if(0<=e&&e<=9)return e.toString();switch(e){case 10:return"A";case 11:return"B";case 12:return"C";case 13:return"D";case 14:return"E";case 15:return"F"}return"u"},_.prototype.bufferToHexString=function(e){var t="";for(e.rewind();!e.eof;){var r=e.readUint8Buffer();t=t.concat("x"+this.toHex((240&r)>>4)+this.toHex(15&r)+" ")}return t},_.prototype.startPhaseTimeout=function(e){if(6==e)this.phaseTimeout=e,this.prevPhaseTickCount=0;else switch(this.state){case 2:1==e&&(this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock);break;case 3:2==e&&(this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock);break;case 1:3==e&&(this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock);break;case 4:switch(e){case 4:this.options.PingPongTimeout=Math.min(this.options.PingPongTimeout,this.options.PingPongInterval)}this.phaseTimeout=e,this.prevPhaseTickCount=BK.Time.clock}},_.prototype.handlePhaseTimeout=function(){if(6!=this.phaseTimeout){var e=BK.Time.diffTime(this.prevPhaseTickCount,BK.Time.clock);switch(this.phaseTimeout){case 1:1e3*e>this.options.HandleShakeRequestTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!handshake request timeout"),this.prevPhaseTickCount=BK.Time.clock,this.state=-1,this.errcode=4096,this.message="handshake request timeout",u.prototype.close.call(this),this.delegate.onError&&this.delegate.onError(this));break;case 2:1e3*e>this.options.HandleShakeResponseTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!handshake response timeout"),this.prevPhaseTickCount=BK.Time.clock,this.state=-1,this.errcode=4097,this.message="handshake response timeout",u.prototype.close.call(this),this.delegate.onError&&this.delegate.onError(this));break;case 3:1e3*e>this.options.CloseAckTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!close ack timeout"),this.prevPhaseTickCount=BK.Time.clock,1==this.state&&(this.peerClosed||(this.errcode=1006,this.message="abnormal close",this.startPhaseTimeout(6)),u.prototype.close.call(this),this.delegate.onError&&this.delegate.onError(this)));break;case 4:1e3*e>this.options.PingPongTimeout&&(BK.Script.log(1,0,"BK.WebSocket.handlePhaseTimeout!receive pong timeout"),this.prevPhaseTickCount=BK.Time.clock)}}},_.prototype.restartPingPongTimer=function(){4==this.state&&0<this.options.PingPongInterval&&(this.prevPingPongTickCount=BK.Time.clock)},_.prototype.handlePingPongTimer=function(){4==this.state&&0<this.options.PingPongInterval&&(1e3*BK.Time.diffTime(this.prevPingPongTickCount,BK.Time.clock)>this.options.PingPongInterval&&(this.inPingFrame=!1,this.txPingData=this.randomN(16),this.sendPingFrame(this.txPingData),this.restartPingPongTimer()))},_.prototype.doHandshakePhase=function(){var e="";e=e.concat("GET "+this.path+" HTTP/"+this.httpVer+"\r\n"),e=(e=(e=80==this.port||443==this.port?e.concat("Host:"+this.host+"\r\n"):e.concat("Host:"+this.host+":"+this.port+"\r\n")).concat("Upgrade:websocket\r\n")).concat("Connection:Upgrade\r\n");var t=this.randomN(16),r=BK.Misc.encodeBase64FromBuffer(t);if(e=(e=e.concat("Sec-WebSocket-Key:"+r+"\r\n")).concat("Sec-WebSocket-Version:"+this.version+"\r\n"),this.query)for(var n=this.query.split("&"),i=0;i<n.length;i++){var a=n[i].split("=");0<a.length&&(e=e.concat(a[0]+":"+a[1]+"\r\n"))}e=e.concat("\r\n");var o=BK.Misc.sha1(r.concat("258EAFA5-E914-47DA-95CA-C5AB0DC85B11"));this.handshakeSig=BK.Misc.encodeBase64FromBuffer(o);var s=new BK.Buffer(e.length,!1);s.writeAsString(e,!1),u.prototype.send.call(this,s),this.state=2,this.startPhaseTimeout(1)},_.prototype.doSvrHandshakePhase1=function(e){var t=this;e&&(this.httpParser.onComplete||(this.httpParser.onComplete=function(){for(var e in t.httpParser.headers);t.doSvrHandshakePhase2()?(t.restartPingPongTimer(),t.startPhaseTimeout(6),t.delegate.onOpen&&t.delegate.onOpen(t)):(t.errcode=4098,t.message="handshake parse error",t.startPhaseTimeout(6),u.prototype.close.call(t),t.delegate.onError&&t.delegate.onError(t))}),this.httpParser.execute(e),2==this.state&&(this.state=3,this.startPhaseTimeout(2)))},_.prototype.doSvrHandshakePhase2=function(){switch(this.httpParser.statusCode){case 101:return null==this.httpParser.headers.upgrade?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'upgrade' header"),!1):null==this.httpParser.headers.connection?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'connection' header"),!1):"upgrade"!=this.httpParser.headers.connection.toLowerCase()?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!error 'connection' header"),!1):null==this.httpParser.headers["sec-websocket-accept"]?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!missing 'sec-websocket-accept' header"),!1):this.handshakeSig!=this.httpParser.headers["sec-websocket-accept"]?(this.state=-1,BK.Script.log(1,0,"BK.WebSocket.doSvrHandshakePhase2!error 'sec-websocket-accept' header"),!1):(this.state=4,!0)}return!1},_.prototype.doFrameDataPhase=function(e,t,r){void 0===r&&(r=!1);var n=6,i=e.length;this.extensions.length,n+=i;var a=new BK.Buffer(n,!1),o=0,s=!1;switch(this.version){case 13:s=!0,o=128}var f=!0;switch(t){case 1:case 2:r?this.inTxSegFrame?(f=!1,t=0):(f=!1,this.inTxSegFrame=!0):this.inTxSegFrame&&(t=0)}if(f?a.writeUint8Buffer(128|15&t):a.writeUint8Buffer(15&t),i<126?a.writeUint8Buffer(o|127&e.length):i<65536?(a.writeUint8Buffer(126|o),_.isLittleEndian?(a.writeUint8Buffer((65280&i)>>8),a.writeUint8Buffer(255&i)):(a.writeUint8Buffer(255&i),a.writeUint8Buffer((65280&i)>>8))):BK.Script.log(1,0,"BK.WebSocket.doFrameDataPhase!js don't support 64bit data type"),s){var u=this.randomN(4);BK.Misc.encodeBufferXorMask4(e,u),a.writeBuffer(u)}return a.writeBuffer(e),a},_.prototype.doSvrFrameDataPhase=function(e){if(!e)return!0;for(;!e.eof;){switch(this.parseState){case 0:this.mask4.rewind(),this.rxbuf=new BK.Buffer(this.options.DefaultSegmentSize,!0),this.maskBit=0,this.rxbuflen=0,this.isFinalSeg=!1,this.parseState=1;case 1:var t=e.readUint8Buffer();switch(this.isFinalSeg=!!(128&t),this.opcode=15&t,this.version){case 13:switch(this.opcode){case 3:case 4:case 5:case 6:case 7:case 11:case 12:case 13:case 14:case 15:return this.errcode=1002,this.message="protocol error",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!unknown opcode = "+this.opcode),!1}}switch(this.opcode){case 8:case 9:case 10:case 0:break;default:if(!this.isFinalSeg&&1!=this.opcode&&2!=this.opcode)return this.errcode=1003,this.message="unsupported data",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!illegal opcode = "+this.opcode),!1;if(-1==this.rxFrameType)this.rxFrameType=this.opcode;else if(this.rxFrameType!=this.opcode)return this.errcode=1002,this.message="protocol error",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!rxFrameType = "+this.rxFrameType+", illegal opcode = "+this.opcode),!1}if(this.parseState=2,e.eof)return!0;case 2:var r=e.readUint8Buffer();switch(this.maskBit=(128&r)>>7,127&r){case 126:if(this.parseState=3,e.eof)return!0;break;case 127:if(this.parseState=5,e.eof)return!0;break;default:if(this.rxbuflen=127&r,1==this.maskBit?this.parseState=13:this.parseState=17,0<this.rxbuflen&&e.eof)return!0}}switch(this.parseState){case 3:var n=e.readUint8Buffer();if(this.rxbuflen|=_.isLittleEndian?(255&n)<<8:255&n,e.eof)return!0;case 4:n=e.readUint8Buffer();if(this.rxbuflen|=_.isLittleEndian?255&n:(255&n)<<8,1==this.maskBit?this.parseState=13:this.parseState=17,0<this.rxbuflen&&e.eof)return!0;break;case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:return this.errcode=1002,this.message="protocol errors",BK.Script.log(1,0,"BK.WebSocket.doSvrFrameDataPhase!js don't support 64bit data type"),!1}switch(this.parseState){case 13:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=14,e.eof)return!0;case 14:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=15,e.eof)return!0;case 15:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=16,e.eof)return!0;case 16:if(this.mask4.writeUint8Buffer(e.readUint8Buffer()),this.parseState=17,e.eof)return!0}if(17==this.parseState){var i=e.length-e.pointer;if(i<=this.rxbuflen-this.rxbuf.length?this.rxbuf.writeBuffer(e.readBuffer(i)):this.rxbuf.writeBuffer(e.readBuffer(this.rxbuflen-this.rxbuf.length)),this.rxbuf.length==this.rxbuflen)if(this.rxSegCount=this.rxSegCount+1,this.parseState=0,this.isFinalSeg)switch(this.rxbuf.rewind(),this.opcode){case 8:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive close frame"),this.handleCloseFrame();break;case 9:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive ping frame"),this.handlePingFrame();break;case 10:BK.Script.log(0,0,"BK.WebSocket.doSvrFrameDataPhase!receive pong frame"),this.handlePongFrame();break;default:this.rxbufQue.push(this.rxbuf),this.recvFrameFromRxQ(this.rxFrameType),this.rxSegCount=0,this.rxFrameType=-1}else this.rxbuf.rewind(),this.rxbufQue.push(this.rxbuf)}}return!0},_.prototype.handleCloseFrame=function(){if(this.peerClosed=!0,4==this.state){var e=this.rxbuf.readUint16Buffer(),t=this.rxbuf.readBuffer(this.rxbuflen-2);e?(this.errcode=e,this.message=t.readAsString()):(this.errcode=1005,this.message="no status recv"),BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame!errcode = "+this.errcode+", msg = "+this.message),this.sendCloseFrame(this.errcode,this.message)}else 1==this.state&&(BK.Script.log(1,0,"BK.WebSocket.handleCloseFrame!normal closed"),this.close(),this.state=0,this.delegate.onClose&&this.delegate.onClose(this))},_.prototype.handlePingFrame=function(){if(4==this.state){if(125<this.rxbuflen)return this.errcode=4099,void(this.message="ping packet large");if(this.inPongFrame)return void BK.Script.log(1,0,"BK.WebSocket.handlePingFrame!already recv ping, drop it.");this.rxPongData=new BK.Buffer(this.rxbuflen,!0),this.rxPongData.writeBuffer(this.rxbuf.readBuffer(this.rxbuflen)),this.sendPongFrame(this.rxPongData)}},_.prototype.handlePongFrame=function(){if(4==this.state){var e=new BK.Buffer(this.rxbuflen,!0);e.writeBuffer(this.rxbuf.readBuffer(this.rxbuflen)),this.startPhaseTimeout(6),BK.Script.log(0,0,"BK.WebSocket.handlePongFrame!pong data = "+this.bufferToHexString(e))}},_.prototype.sendFrameFromTxQ=function(e){if(4==this.state){if(this.inPartialTxbuf){if(!(0<(a=u.prototype.send.call(this,this.txbuf))))return BK.Script.log(1,a,"BK.WebSocket.sendFrameFromTxQ!partial send failed, data type = "+e),!1;if(this.restartPingPongTimer(),a<this.txbuf.length){var t=this.txbuf.length-a,r=new BK.Buffer(t,!1);return this.txbuf.rewind(),this.txbuf.jumpBytes(a),r.writeBuffer(this.txbuf.readBuffer(t)),this.txbuf=r,!1}this.inPartialTxbuf=!1}for(var n=!0,i=Math.min(this.options.DrainSegmentCount,this.txbufQue.length);0<i;i--){var a,o=this.txbufQue.shift(),s=0<this.txbufQue.length,f=this.doFrameDataPhase(o,e,s);if(!(0<(a=u.prototype.send.call(this,f)))){n=!1,BK.Script.log(1,a,"BK.WebSocket.sendFrameFromTxQ!send failed, data type = "+e);break}if(this.restartPingPongTimer(),a<f.length){f.rewind(),f.jumpBytes(a),this.txbuf.rewind(),this.txbuf.writeBuffer(f.readBuffer(f.length-a)),n=!(this.inPartialTxbuf=!0),BK.Script.log(1,0,"BK.WebSocket.sendFrameFromTxQ!partial send, total size = "+f.length+", tx size = "+a);break}}return n&&!this.txbufQue.length&&this.inTxSegFrame&&(this.inTxSegFrame=!1),n}},_.prototype.recvFrameFromRxQ=function(e){for(var t=2==e,r=new BK.Buffer(128,!0);0<this.rxbufQue.length;){var n=this.rxbufQue.shift();r.writeBuffer(n),0==t&&r.writeUint8Buffer(0)}r.rewind(),this.udataQue.push(new i(r,t))},_.prototype.__sendBinaryFrame=function(e,t){var r=e.length,n=this.options.DefaultSegmentSize,i=0;for(e.rewind();n<r;){var a=new BK.Buffer(n,!1);e.rewind(),e.jumpBytes(i),a.writeBuffer(e.readBuffer(n)),a.rewind(),this.txbufQue.push(a),i+=n,r-=n}if(0<r){a=new BK.Buffer(r,!1);e.rewind(),e.jumpBytes(i),a.writeBuffer(e.readBuffer(r)),a.rewind(),this.txbufQue.push(a)}return this.txFrameType=t,this.sendFrameFromTxQ(t)},_.prototype.sendTextFrame=function(e){if(4!=this.state)return!1;var t=new BK.Buffer(128,!0);return t.writeAsString(e,!1),t.rewind(),this.__sendBinaryFrame(t,1)},_.prototype.sendBinaryFrame=function(e){if(4==this.state)return this.__sendBinaryFrame(e,2)},_.prototype.sendCloseFrame=function(e,t){if(!this.isSendClose){this.isSendClose=!0;var r=new BK.Buffer(t.length+1,!1),n=new BK.Buffer(3+t.length,!1);_.isLittleEndian?(n.writeUint8Buffer((65280&e)>>8),n.writeUint8Buffer(255&e)):(n.writeUint8Buffer(255&e),n.writeUint8Buffer((65280&e)>>8)),r.writeAsString(t,!0),n.writeBuffer(r);var i=this.doFrameDataPhase(n,8);u.prototype.send.call(this,i),this.state=1,this.startPhaseTimeout(3),BK.Script.log(1,0,"BK.WebSocket.sendCloseFrame!code = "+e+", reason = "+t)}},_.prototype.sendPingFrame=function(e){if(!this.inPingFrame){BK.Script.log(0,0,"BK.WebSocket.sendPingFrame!ping data = "+this.bufferToHexString(e));var t=this.doFrameDataPhase(e,9);u.prototype.send.call(this,t),this.inPingFrame=!0,this.startPhaseTimeout(4)}},_.prototype.sendPongFrame=function(e){if(!this.inPongFrame){var t=this.doFrameDataPhase(e,10);u.prototype.send.call(this,t),this.inPongFrame=!0}},_.prototype.onErrorEvent=function(e){0!=this.state&&1!=this.state&&(u.prototype.onErrorEvent.call(this,e),this.state=-1,this.errcode=1006,this.message="abnormal closure",this.delegate.onError&&this.delegate.onError(this))},_.prototype.onTimeoutEvent=function(e){u.prototype.onErrorEvent.call(this,e),this.state=0,this.errcode=-1e3,this.message="socket connect timeout",this.delegate.onError&&this.delegate.onError(this)},_.prototype.onDisconnectEvent=function(e){switch(u.prototype.onDisconnectEvent.call(this,e),this.state){case 2:case 3:case 4:this.state=-1,this.errcode=1006,this.message="abnormal closure",this.delegate.onError&&this.delegate.onError(this);break;case 1:this.state=0,this.delegate.onClose&&this.delegate.onClose(this),BK.Script.log(1,0,"BK.WebSocket.onDisconnectEvent!enter closed state")}},_.prototype.onConnectedEvent=function(e){u.prototype.onConnectedEvent.call(this,e),0==this.state&&(this.clear(),this.doHandshakePhase())},_.prototype.onUpdateEvent=function(e){switch(u.prototype.onUpdateEvent.call(this,e),this.state){case 2:case 3:if(0<(i=e.canRecvLength())){var t=this.recv(i);null!=t&&this.doSvrHandshakePhase1(t.readAsString(!0))}this.handlePhaseTimeout();break;case 4:if(0<(i=e.canRecvLength()))for(var r=this.recv(i);!r.eof;)if(!this.doSvrFrameDataPhase(r)){this.sendCloseFrame(this.errcode,this.message),this.delegate.onError&&this.delegate.onError(this);break}if(this.delegate.onMessage)for(;0<this.udataQue.length;){var n=this.udataQue.shift();this.delegate.onMessage(this,n)}0<this.txbufQue.length?this.sendFrameFromTxQ(this.txFrameType):this.delegate.onSendComplete&&this.delegate.onSendComplete(this),this.inPongFrame=!1,this.handlePhaseTimeout(),this.handlePingPongTimer();break;case 1:var i;if(0<(i=e.canRecvLength())&&this.doSvrFrameDataPhase(this.recv(i))&&this.delegate.onMessage)for(;0<this.udataQue.length;){n=this.udataQue.shift();this.delegate.onMessage(this,n)}this.handlePhaseTimeout()}return 0},_}(e);n.isLittleEndian=BK.Misc.isLittleEndian();var a=function(e,t){this.data=e,this.isBinary=t};return function(){function e(e){var a=this;this.__url=e,this.options=null,this.inTrans=!1,this.isPendingConn=!0,this.txdataQ=new Array;var t=BK.URL("{}",e);this.scheme=t.protocol,this.port=t.port,this.path=t.path,this.query=t.query,this.host=t.hostname,BK.DNS.queryIPAddress(t.hostname,function(e,t,r){switch(e){case 0:BK.Script.log(1,0,"BK.WebSocket.queryIPAddress!iplist = "+JSON.stringify(r)),a.iplist=r,a.__nativeObj=new n(r[0],a.port,a.host,a.path,a.query),"wss"==a.scheme&&a.__nativeObj.enableSSL(!0),a.options&&(a.setOptions(a.options),a.options=null),a.isPendingConn&&(a.connect(),a.isPendingConn=!1),a.__nativeObj.delegate.onOpen=function(e){0<a.txdataQ.length&&a.send(a.txdataQ.shift()),a.onOpen?a.onOpen(a):a.onopen&&a.onopen.call(a)},a.__nativeObj.delegate.onClose=function(e){var t={};t.code=a.getErrorCode(),t.reason=a.getErrorString(),a.onClose?a.onClose(a,t):a.onclose&&a.onclose.call(a,t)},a.__nativeObj.delegate.onError=function(e){var t={};t.code=a.getErrorCode(),t.reason=a.getErrorString(),a.onError?a.onError(a,t):a.onerror&&a.onerror.call(a,t)},a.__nativeObj.delegate.onMessage=function(e,t){if(a.onMessage)a.onMessage(a,t);else if(a.onmessage){if(1==t.isBinary){var r=t.data;r.rewind();for(var n=new ArrayBuffer(r.length),i=new DataView(n);!r.eof;)i.setUint8(r.pointer,r.readUint8Buffer());t.data=n}a.onmessage.call(a,t)}},a.__nativeObj.delegate.onSendComplete=function(e){if(0<a.txdataQ.length){var t=a.txdataQ.shift();t.isBinary?a.__sendBinaryFrame(t.data):a.__nativeObj.sendTextFrame(t.data),a.inTrans=!0}else a.inTrans=!1}}})}return Object.defineProperty(e.prototype,"url",{get:function(){return this.__url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.getReadyState()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){for(var e=0,t=0;t<this.txdataQ.length;t++)e+=this.txdataQ[t].data.length;return e},enumerable:!0,configurable:!0}),e.prototype.__sendBinaryFrame=function(e){if(Object.prototype.hasOwnProperty.call(e,"__rawBKData"))return this.__nativeObj.sendBinaryFrame(e.__rawBKData);if(e instanceof Int8Array==1||e instanceof Uint8Array==1||e instanceof Int16Array==1||e instanceof Uint16Array==1||e instanceof Int32Array==1||e instanceof Uint32Array==1||e instanceof Float32Array==1){for(var t=new BK.Buffer(e.byteLength),r=new DataView(e.buffer),n=0;n<e.byteLength;n++)t.writeUint8Buffer(r.getUint8(n));return this.__nativeObj.sendBinaryFrame(t)}if(e instanceof ArrayBuffer==1){for(t=new BK.Buffer(e.byteLength),r=new DataView(e),n=0;n<e.byteLength;n++)t.writeUint8Buffer(r.getUint8(n));return this.__nativeObj.sendBinaryFrame(t)}return this.__nativeObj.sendBinaryFrame(e)},e.prototype.getReadyState=function(){return this.__nativeObj?this.__nativeObj.getReadyState():0},e.prototype.getErrorCode=function(){return this.__nativeObj?this.__nativeObj.getErrorCode():65535},e.prototype.getErrorString=function(){return this.__nativeObj?this.__nativeObj.getErrorString():""},e.prototype.close=function(){4==this.getReadyState()&&this.__nativeObj.sendCloseFrame(1e3,"see ya")},e.prototype.connect=function(){return!this.__nativeObj||0!=this.__nativeObj.connect()},e.prototype.send=function(e){var t=this.getReadyState();if(1==t||0==t)return!1;if("string"==typeof e){if(!this.inTrans&&4==t)return this.inTrans=!0,this.__nativeObj.sendTextFrame(e);this.txdataQ.push(new a(e,!1))}else if("object"==typeof e){if(!this.inTrans&&4==t)return this.inTrans=!0,this.__sendBinaryFrame(e);this.txdataQ.push(new a(e,!0))}return!1},e.prototype.setOptions=function(e){this.__nativeObj?(e.DrainSegmentCount&&(this.__nativeObj.options.DrainSegmentCount=e.DrainSegmentCount),e.DefaultSegmentSize&&(this.__nativeObj.options.DefaultSegmentSize=e.DefaultSegmentSize),e.PingPongInterval&&(this.__nativeObj.options.PingPongInterval=e.PingPongInterval),e.HandleShakeRequestTimeout&&(this.__nativeObj.options.HandleShakeRequestTimeout=e.HandleShakeRequestTimeout),e.HandleShakeResponseTimeout&&(this.__nativeObj.options.HandleShakeResponseTimeout=e.HandleShakeResponseTimeout),e.CloseAckTimeout&&(this.__nativeObj.options.CloseAckTimeout=e.CloseAckTimeout),e.PingPongTimeout&&(this.__nativeObj.options.PingPongTimeout=e.PingPongTimeout)):this.options=e},e}()}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.AnimatedSprite=t())}(BK,function(){return function(){function e(e){this.paused=!1,this.delayUnits=1/30,this.tmpPlayingIdx=0,this.previousTs=-1,this.playedCount=0,this.size={width:0,height:0},this.readyTextureInfo(e),this.onInit(this.size.width,this.size.height),this.displayFrame(0),this.paused=!0,BK.Director.ticker.add(function(e,t,r){r.update(e,t)},this)}return e.prototype.onInit=function(e,t){this.createSprites(e,t),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.size},set:function(e){this.__nativeObj.size=e,this.displayFrame(this.currDisplayIdx)}})},e.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},e.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},e.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.addChild=function(e,t){return this.__nativeObj.addChild(e,t)},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},e.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},e.prototype.createSprites=function(e,t){this.__nativeObj=new BK.Sprite(e,t,null,0,1,1,1),this.contentSprite=new BK.Sprite(e,t,null,0,1,1,1),this.__nativeObj.addChild(this.contentSprite)},e.prototype.readyTextureInfo=function(e){var t=this;this.textureInfoArr=[],e.forEach(function(e){e.texturePath&&(e.texture=new BK.Texture(e.texturePath),t.textureInfoArr.push(e),t.size={width:e.frameInfo.sourceSize.w,height:e.frameInfo.sourceSize.h})})},e.prototype.displayFrame=function(e){if(0<this.textureInfoArr.length){var t=this.textureInfoArr[e];if(t){this.currDisplayIdx=e;var r=t.texture,n=t.frameInfo;if(1==t.frameInfo.trimmed){var i=t.frameInfo.spriteSourceSize.x,a=t.frameInfo.spriteSourceSize.y,o=t.frameInfo.spriteSourceSize.w,s=t.frameInfo.spriteSourceSize.h,f=t.frameInfo.sourceSize,u=this.__nativeObj.size;i=u.width*i/f.w,a=u.height*a/f.h,o=u.width*o/f.w,s=u.height*s/f.h,this.contentSprite.position={x:i,y:a},this.contentSprite.size={width:o,height:s}}else this.contentSprite.size=this.__nativeObj.size;this.currTexturePath&&this.currTexturePath==t.texturePath||(BK.Script.log(1,-1,"this.currTexture != tex"),this.currTexturePath=t.texturePath,this.contentSprite.setTexture(r)),this.contentSprite.adjustTexturePosition(n.frame.x,n.frame.y,n.frame.w,n.frame.h,n.rotated)}else BK.Script.log(1,-1,"displayFrame failed! textureInfo is null. index is "+e)}else BK.Script.log(1,-1,"displayFrame failed! textureInfoArr.length is 0")},e.prototype.render=function(){this.tmpPlayingIdx>this.textureInfoArr.length-1&&(this.tmpPlayingIdx=0),this.displayFrame(this.tmpPlayingIdx),this.tmpPlayingIdx++,this.currDisplaySum++,this.updateCallback()},e.prototype.update=function(e,t){0==this.paused&&(this.previousTs<0?(this.previousTs=e,this.render()):e-this.previousTs>1e3*this.delayUnits&&(this.previousTs=e,this.render()))},e.prototype.play=function(e,t){void 0===e&&(e=0),void 0===t&&(t=-1),e>this.textureInfoArr.length-1?this.tmpPlayingIdx=0:this.tmpPlayingIdx=e,this.paused=!1,this.repeatCount=t,this.currDisplaySum=0,this.playedCount=0},e.prototype.stop=function(e){void 0===e&&(e=-1),this.paused=!0,-1<e&&this.displayFrame(e)},e.prototype.updateCallback=function(){var e=this.textureInfoArr.length;this.currDisplaySum%e==0&&(this.playedCount=parseInt(String(this.currDisplaySum/e)),this.completeCallback&&this.completeCallback(this,this.playedCount),0<this.repeatCount&&this.repeatCount<=this.playedCount&&(this.endCallback&&this.endCallback(this,this.playedCount),this.stop()))},e.prototype.setCompleteCallback=function(e){this.completeCallback=e},e.prototype.setEndCallback=function(e){this.endCallback=e},e}()}),Canvas.prototype.setImagePath=function(e){if(e){this.imagePath=e;var t=new BK.Texture(e);this.__nativeObj.setTexture(t)}},Canvas.prototype.getImagePath=function(){return this.imagePath},Canvas.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},Canvas.prototype.setFlipXY=function(e,t){this.__nativeObj.setUVFlip(e,t)},Canvas.prototype.setUVFlip=function(e,t){this.__nativeObj.setUVFlip(e,t)},Canvas.prototype.setUVWrap=function(e,t){this.__nativeObj.setUVWrap(e,t)},Canvas.prototype.setXYStretch=function(e,t){this.__nativeObj.setXYStretch(e,t)},Canvas.prototype.adjustTexturePosition=function(e,t,r,n,i){this.__nativeObj.adjustTexturePosition(e,t,r,n,i)},Canvas.prototype.addChild=function(e){return this.__nativeObj.addChild(e)},Canvas.prototype.dispose=function(){return this.__nativeObj.dispose()},Canvas.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},Canvas.prototype.removeChildById=function(e){return this.__nativeObj.removeChildById(e)},Canvas.prototype.removeChildByName=function(e){return this.__nativeObj.removeChildByName(e)},Canvas.prototype.removeChildByTag=function(e){return this.__nativeObj.removeChildByTag(e)},Canvas.prototype.queryChildAtIndex=function(e){return this.__nativeObj.queryChildAtIndex(e)},Canvas.prototype.queryChildById=function(e){return this.__nativeObj.queryChildById(e)},Canvas.prototype.queryChildByName=function(e){return this.__nativeObj.queryChildByName(e)},Canvas.prototype.queryChildByTag=function(e){return this.__nativeObj.queryChildByTag(e)},Canvas.prototype.getChildCount=function(){return this.__nativeObj.getChildCount()},Canvas.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},Canvas.prototype.attachComponent=function(e){return this.__nativeObj.attachComponent(e)},Canvas.prototype.detachComponent=function(e){return this.__nativeObj.detachComponent(e)},Canvas.prototype.queryComponent=function(e){return this.__nativeObj.queryComponent(e)},Canvas.prototype.queryComponentList=function(e){return this.__nativeObj.queryComponentList(e)},Canvas.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},Canvas.prototype.isEqual=function(e){return this.__nativeObj.isEqual(e)},Canvas.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},Canvas.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},Canvas.prototype.setAtlas=function(e,t){if(this.__nativeObj){BK.CanvasSheetCache.loadSheet(e);var r=BK.CanvasSheetCache.getTexturePathByFilename(t),n=new BK.Texture(r);this.__nativeObj.setTexture(n);var i=BK.CanvasSheetCache.getFrameInfoByFilename(t);this.__nativeObj.adjustTexturePosition(i.frame.x,i.frame.y,i.frame.w,i.frame.h,i.rotated)}return 0},Canvas.prototype.useH5Mode=function(){return this.__nativeObj?(this._useH5Mode=1)==arguments.length?(this._useH5Mode=arguments[0],this.__nativeObj.useH5Mode(arguments[0])):this.__nativeObj.useH5Mode():0},Canvas.prototype.drawCircle=function(){return this.__nativeObj?this.__nativeObj.drawCircle(arguments[0],arguments[1],arguments[2]):0},Canvas.prototype.drawEllipse=function(){return this.__nativeObj?this.__nativeObj.drawEllipse(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.drawImage=function(){if(this.__nativeObj){var e=arguments.length;if(9==e)this.__nativeObj.drawImage(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);else if(5==e)this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],arguments[3],arguments[4]);else{if(3!=e)return;this.__nativeObj.drawImage(arguments[0],0,0,0,0,arguments[1],arguments[2],0,0)}}return 0},Canvas.prototype.fill=function(){return this.__nativeObj?this.__nativeObj.fill():0},Canvas.prototype.stroke=function(){return this.__nativeObj?this.__nativeObj.stroke():0},Canvas.prototype.rect=function(){return this.__nativeObj?this.__nativeObj.rect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.fillRect=function(){return this.__nativeObj?this.__nativeObj.fillRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.strokeRect=function(){return this.__nativeObj?this.__nativeObj.strokeRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.clearRect=function(){return this.__nativeObj?this.__nativeObj.clearRect(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.beginPath=function(){return this.__nativeObj?this.__nativeObj.beginPath():0},Canvas.prototype.closePath=function(){return this.__nativeObj?this.__nativeObj.closePath():0},Canvas.prototype.moveTo=function(){return this.__nativeObj?this.__nativeObj.moveTo(arguments[0],arguments[1]):0},Canvas.prototype.lineTo=function(){return this.__nativeObj?this.__nativeObj.lineTo(arguments[0],arguments[1]):0},Canvas.prototype.arcTo=function(){return this.__nativeObj?this.__nativeObj.arcTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):0},Canvas.prototype.arc=function(){if(this.__nativeObj){var e=arguments.length;return 5==e?this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):this.__nativeObj.arc(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])}return 0},Canvas.prototype.quadraticCurveTo=function(){return this.__nativeObj?this.__nativeObj.quadraticCurveTo(arguments[0],arguments[1],arguments[2],arguments[3]):0},Canvas.prototype.bezierCurveTo=function(){return this.__nativeObj?this.__nativeObj.bezierCurveTo(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]):0},Canvas.prototype.save=function(){return this.__nativeObj?this.__nativeObj.save():0},Canvas.prototype.restore=function(){return this.__nativeObj?this.__nativeObj.restore():0},Canvas.prototype.fillText=function(){if(3==arguments.length){var e=this.measureText(arguments[0],2048,1024),t=arguments[1],r=arguments[2],n=1==this._useH5Mode?2-this._textBaseLine:this._textBaseLine;switch(n){case 1:r-=.5*e.height;break;case 2:r-=1*e.height}switch(BK.Script.log(0,0,"filltext baseLineType "+n),this._textAlign){case 1:t-=.5*e.width;break;case 2:t-=1*e.width}return this.__nativeObj.fillText(arguments[0],t,r,Math.min(2048,e.width),Math.min(1024,e.height))}return 0},Canvas.prototype.clip=function(){return this.__nativeObj?this.__nativeObj.clip():0},Canvas.prototype.isPointInPath=function(){if(this.__nativeObj)return this.__nativeObj.isPointInPath(arguments[0],arguments[1])},Canvas.prototype.scale=function(){if(this.__nativeObj)return this.__nativeObj.scales(arguments[0],arguments[1])},Canvas.prototype.rotate=function(){if(this.__nativeObj)return this.__nativeObj.rotate(arguments[0])},Canvas.prototype.translate=function(){if(this.__nativeObj)return this.__nativeObj.translate(arguments[0],arguments[1])},Canvas.prototype.transforms=function(){if(this.__nativeObj)return this.__nativeObj.transforms(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},Canvas.prototype.shadowColor=function(){if(this._shadowColor=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.shadowRadius=function(){if(this._shadowRadius=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.shadowOffsetX=function(){if(this._shadowOffset.x=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.shadowOffsetY=function(){if(this._shadowOffset.y=arguments[0],this.__nativeObj)return this.__nativeObj.setTextShadow(this._shadowOffset.x,this._shadowOffset.y,this._shadowRadius,this._shadowColor)},Canvas.prototype.clear=function(){if(this.__nativeObj)return this.__nativeObj.clear()},Canvas.prototype.getTexture=function(){return this.__nativeObj?this.__nativeObj.getTexture():null},Canvas.prototype.drawText=function(){return this.__nativeObj?this.__nativeObj.drawText(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):null},Canvas.prototype.setTextSize=function(){return this.__nativeObj?this.__nativeObj.setTextSize(arguments[0]):null},Canvas.prototype.setTextAlign=function(){if(this.__nativeObj){switch(arguments[0]){case 0:case 1:case 2:this._textAlign=arguments[0];break;case"left":this._textAlign=0;break;case"center":this._textAlign=1;break;case"right":this._textAlign=2}return this.__nativeObj.setTextAlign(this._textAlign)}return null},Canvas.prototype.setTextBold=function(){return this.__nativeObj?this.__nativeObj.setTextBold(arguments[0]):null},Canvas.prototype.setTextItalic=function(){return this.__nativeObj?this.__nativeObj.setTextItalic(arguments[0]):null},Canvas.prototype.measureText=function(){return this.__nativeObj?this.__nativeObj.measureText(arguments[0],arguments[1],arguments[2]):null},Canvas.prototype.updateCanvasTexture=function(){return this.__nativeObj?this.__nativeObj.updateCanvasTexture():null},Canvas.prototype.saveTo=function(){var e=arguments.length;return this.__nativeObj&&1==e&&this.__nativeObj.saveTo(arguments[0]),null},BK.Canvas=Canvas,BK.Script.log(0,0,"Load Canvas.js succeed."),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SpriteSheetCache=t())}(BK,function(){var s=function(){function e(e,t,r,n,i,a,o){this.flipU=0,this.flipV=1,this.stretchX=1,this.stretchY=1,this.size={width:0,height:0},this.flipU=0,this.flipV=1,this.stretchX=1,this.stretchY=1,n&&(this.flipU=n),i&&(this.flipV=i),a&&(this.stretchX=a),o&&(this.stretchY=o),t&&(this.size.width=t),r&&(this.size.height=r),this.textureInfo=e,this.onInit(this.size.width,this.size.height),this.adjustWithTextureInfo(e)}return e.prototype.onInit=function(e,t){this.createSprites(e,t),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this),Object.defineProperty(this,"size",{get:function(){return this.__nativeObj.size},set:function(e){this.__nativeObj.size=e,this.updateSize(this.textureInfo)}})},e.prototype.updateSize=function(e){if(1==e.frameInfo.trimmed){var t=e.frameInfo.spriteSourceSize.x,r=e.frameInfo.spriteSourceSize.y,n=e.frameInfo.spriteSourceSize.w,i=e.frameInfo.spriteSourceSize.h,a=e.frameInfo.sourceSize,o=this.__nativeObj.size;t=o.width*t/a.w,r=o.height*r/a.h,n=o.width*n/a.w,i=o.height*i/a.h,this.contentSprite.position={x:t,y:r},this.contentSprite.size={width:n,height:i}}else this.contentSprite.size=this.__nativeObj.size},e.prototype.adjustWithTextureInfo=function(e){if(e){var t=(this.textureInfo=e).frameInfo;this.updateSize(e),this.currTexturePath=e.texturePath;var r=new BK.Texture(this.currTexturePath);this.contentSprite.setTexture(r),this.contentSprite.adjustTexturePosition(t.frame.x,t.frame.y,t.frame.w,t.frame.h,t.rotated)}},e.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},e.prototype.dispose=function(){BK.Director.ticker.remove(this),this.__nativeObj.dispose()},e.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},e.prototype.removeChildById=function(e,t){return this.__nativeObj.removeChildById(e,t)},e.prototype.removeChildByName=function(e,t){return this.__nativeObj.removeChildByName(e,t)},e.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},e.prototype.addChild=function(e,t){return this.__nativeObj.addChild(e,t)},e.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},e.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},e.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},e.prototype.createSprites=function(e,t){this.__nativeObj=new BK.Sprite(e,t,void 0,this.flipU,this.flipV,this.stretchX,this.stretchY),this.contentSprite=new BK.Sprite(e,t,void 0,this.flipU,this.flipV,this.stretchX,this.stretchY),this.__nativeObj.addChild(this.contentSprite)},e}();return function(){function e(){this.sheets={},this.jsonConfigs={}}return e.prototype.log=function(e){BK.Script.log(0,0,"SpriteSheetCache:"+e)},e.prototype.getFrameInfoByFilename=function(e){for(var t in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(t)){var r=this.jsonConfigs[t],n=(this.sheets[t],r.frames),i=r.meta;this.fullWidth=i.size.w,this.fullHeight=i.size.h;for(var a=0;a<n.length;a++){var o=n[a];if(e==o.filename){var s={x:0,y:1,w:0,h:0},f=o.rotated,u=o.trimmed,_=o.spriteSourceSize,c=o.sourceSize;return f?(s.x=o.frame.x,s.y=this.fullHeight-o.frame.y-o.frame.w):(s.x=o.frame.x,s.y=this.fullHeight-o.frame.y-o.frame.h),s.w=o.frame.w,s.h=o.frame.h,_.y=c.h-_.y-_.h,{filename:e,frame:s,rotated:f,trimmed:u,spriteSourceSize:_,sourceSize:c}}}}return null},e.prototype.getTexturePathByFilename=function(e){for(var t in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(t))for(var r=this.jsonConfigs[t].frames,n=0;n<r.length;n++){if(r[n].filename==e)return t}return null},e.prototype.loadSheet=function(e,t,r,n,i,a,o){void 0===r&&(r=4),void 0===n&&(n=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===o&&(o=1);var s=BK.FileUtil.readFile(e).readAsString();if(s){var f=JSON.parse(s);void 0===t&&(t=e.replace(/.json$/,".png")),this.jsonConfigs[t]=f,void 0===r&&(r=4),r=4,void 0===n&&(n=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===o&&(o=1);var u=new BK.Texture(t,r,n,i,a,o);this.sheets[t]=u}else BK.Script.log(0,0,"loadSheet Failed.Please check path")},e.prototype.removeSheet=function(e,t){if(this.jsonConfigs[t])for(var r in this.jsonConfigs)if(this.jsonConfigs.hasOwnProperty(r)){var n=this.jsonConfigs[r];r==t&&(delete this.jsonConfigs[t],BK.Script.log(0,0,"Delete jsonConfigs key:"+r+" val:"+n))}if(this.sheets[t])for(var r in this.sheets)if(this.sheets.hasOwnProperty(r)){n=this.sheets[r];r==t&&(delete this.sheets[t],BK.Script.log(0,0,"Delete sheets key:"+r+" val:"+n))}},e.prototype.getTextureByFilename=function(e){var t=this.getFrameInfoByFilename(e),r=this.getTexturePathByFilename(e);return t&&r?new BK.Texture(r):(BK.Script.log(0,0,"getTexture Failed.Please check path"),null)},e.prototype.createSheetSprite=function(e,t,r){var n=this.getTextureFrameInfoByFileName(e);if(n){var i=n.frameInfo,a=n.texturePath,o=new BK.Texture(a);return t||(t=i.frame.w),r||(r=i.frame.h),this.log("SheetSprite  texture:"+o+" width:"+t+" height:"+r),new s(n,t,r)}return null},e.prototype.getTextureFrameInfoByFileName=function(e){var t=this.getFrameInfoByFilename(e),r=this.getTexturePathByFilename(e);return t&&r?{frameInfo:t,texturePath:r}:null},e}()}),Sprite.prototype.setImagePath=function(e){if(e){this.imagePath=e;var t=new BK.Texture(e);this.__nativeObj.setTexture(t)}},Sprite.prototype.getImagePath=function(){return this.imagePath},Sprite.prototype.setTexture=function(e){this.__nativeObj.setTexture(e)},Sprite.prototype.setFlipXY=function(e,t){this.__nativeObj.setFlipXY(e,t)},Sprite.prototype.setUVFlip=function(e,t){this.__nativeObj.setUVFlip(e,t)},Sprite.prototype.setUVWrap=function(e,t){this.__nativeObj.setUVWrap(e,t)},Sprite.prototype.setXYStretch=function(e,t){this.__nativeObj.setXYStretch(e,t)},Sprite.prototype.adjustTexturePosition=function(e,t,r,n,i){this.__nativeObj.adjustTexturePosition(e,t,r,n,i)},Sprite.prototype.addChild=function(e){return this.__nativeObj.addChild(e)},Sprite.prototype.dispose=function(){return this.__nativeObj.dispose()},Sprite.prototype.removeChild=function(e){return this.__nativeObj.removeChild(e)},Sprite.prototype.removeChildById=function(e){return this.__nativeObj.removeChildById(e)},Sprite.prototype.removeChildByName=function(e){return this.__nativeObj.removeChildByName(e)},Sprite.prototype.removeChildByTag=function(e){return this.__nativeObj.removeChildByTag(e)},Sprite.prototype.queryChildAtIndex=function(e){return this.__nativeObj.queryChildAtIndex(e)},Sprite.prototype.queryChildById=function(e){return this.__nativeObj.queryChildById(e)},Sprite.prototype.queryChildByName=function(e){return this.__nativeObj.queryChildByName(e)},Sprite.prototype.queryChildByTag=function(e){return this.__nativeObj.queryChildByTag(e)},Sprite.prototype.getChildCount=function(){return this.__nativeObj.getChildCount()},Sprite.prototype.removeFromParent=function(){return this.__nativeObj.removeFromParent()},Sprite.prototype.attachComponent=function(e){return this.__nativeObj.attachComponent(e)},Sprite.prototype.detachComponent=function(e){return this.__nativeObj.detachComponent(e)},Sprite.prototype.queryComponent=function(e){return this.__nativeObj.queryComponent(e)},Sprite.prototype.queryComponentList=function(e){return this.__nativeObj.queryComponentList(e)},Sprite.prototype.hittest=function(e){return this.__nativeObj.hittest(e)},Sprite.prototype.isEqual=function(e){return this.__nativeObj.isEqual(e)},Sprite.prototype.convertToWorldSpace=function(e){return this.__nativeObj.convertToWorldSpace(e)},Sprite.prototype.convertToNodeSpace=function(e){return this.__nativeObj.convertToNodeSpace(e)},Sprite.prototype.setAtlas=function(e,t){if(this.__nativeObj){BK.SpriteSheetCache.loadSheet(e);var r=BK.SpriteSheetCache.getTexturePathByFilename(t),n=new BK.Texture(r);this.__nativeObj.setTexture(n);var i=BK.SpriteSheetCache.getFrameInfoByFilename(t);this.__nativeObj.adjustTexturePosition(i.frame.x,i.frame.y,i.frame.w,i.frame.h,i.rotated)}return 0},Sprite.prototype.getTexture=function(){return this.__nativeObj?this.__nativeObj.getTexture():null},BK.Sprite=Sprite,BK.Script.log(0,0,"Load Sprite.js succeed.");var firstFrameUpload=!(BK.ScreenShot=function(){this.origin={x:0,y:0},this.size={width:0,height:0},this.judge=function(){(null==this.origin.x||this.origin.x<0||this.origin.x>BK.Director.screenPixelSize.width)&&(this.origin.x=0),(null==this.origin.y||this.origin.y<0||this.origin.y>BK.Director.screenPixelSize.height)&&(this.origin.y=0),(null==this.size.width||this.size.width<=0||this.size.width>BK.Director.screenPixelSize.width-this.origin.x)&&(this.origin.x=0,this.size.width=BK.Director.screenPixelSize.width),(null==this.size.height||this.size.height<=0||this.size.height>BK.Director.screenPixelSize.height-this.origin.y)&&(this.origin.y=0,this.size.height=BK.Director.screenPixelSize.height)},this.shotToFileFromNode=function(e,t,r){var n="GameSandBox://"+t+"."+r,i=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(e,i),i.writeToDiskWithXY(n,e.position.x,e.position.y,e.contentSize.width,e.contentSize.height),n},this.shotToBuffFromNode=function(e){var t=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(e,t),t.readPixels(e.position.x,e.position.y,e.contentSize.width,e.contentSize.height)},this.shotToFile=function(e,t){this.judge();var r="GameSandBox://"+e+"."+t,n=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(BK.Director.root,n),n.writeToDiskWithXY(r,this.origin.x,this.origin.y,this.size.width,this.size.height),r},this.shotToBuff=function(){this.judge();var e=new BK.RenderTexture(BK.Director.screenPixelSize.width,BK.Director.screenPixelSize.height);return BK.Render.renderToTexture(BK.Director.root,e),e.readPixels(this.origin.x,this.origin.y,this.size.width,this.size.height)}});function checkFirstFrames(){0==firstFrameUpload&&(BK.MQQ.SsoRequest.send({},"cs.first_frame_drawn.local"),firstFrameUpload=!0)}function activeTexture(e){gl.glActiveTexture(e)}function attachShader(e,t){gl.glAttachShader(e,t)}function bindAttribLocation(e,t,r){gl.glBindAttribLocation(e,t,r)}function bindBuffer(e,t){gl.glBindBuffer(e,t)}function bindFramebuffer(e,t){gl.glBindFramebuffer(e,t)}function bindRenderbuffer(e,t){gl.glBindRenderbuffer(e,t)}function bindTexture(e,t){gl.glBindTexture(e,t)}function blendColor(e,t,r,n){gl.glBlendColor(e,t,r,n)}function blendEquation(e){gl.glBlendEquation(e)}function blendEquationSeparate(e,t){gl.glBlendEquationSeparate(e,t)}function blendFunc(e,t){gl.glBlendFunc(e,t)}function blendFuncSeparate(e,t,r,n){gl.glBlendFuncSeparate(e,t,r,n)}function bufferData(e,t,r){gl.glBufferData(e,t,r)}function bufferData(e,t,r){gl.glBufferData(e,__TypedArrayGetData(t),r)}function bufferSubData(e,t,r){gl.glBufferSubData(e,t,__TypedArrayGetData(r))}function checkFramebufferStatus(e){return gl.glCheckFramebufferStatus(e)}function clear(e){gl.glClear(e)}function clearColor(e,t,r,n){gl.glClearColor(e,t,r,n)}function clearDepth(e){gl.glClearDepth(e)}function clearStencil(e){gl.glClearStencil(e)}function colorMask(e,t,r,n){gl.glColorMask(e,t,r,n)}function compileShader(e){gl.glCompileShader(e)}function compressedTexImage2D(e,t,r,n,i,a,o){gl.glCompressedTexImage2D(e,t,r,n,i,a,o)}function compressedTexSubImage2D(e,t,r,n,i,a,o,s){gl.glCompressedTexSubImage2D(e,t,r,n,i,a,o,s)}function copyTexImage2D(e,t,r,n,i,a,o,s){gl.glCopyTexImage2D(e,t,r,n,i,a,o,s)}function copyTexSubImage2D(e,t,r,n,i,a,o,s){gl.glCopyTexSubImage2D(e,t,r,n,i,a,o,s)}function createBuffer(){return gl.glCreateBuffer()}function createFramebuffer(){return gl.glCreateFramebuffer()}function createProgram(){return gl.glCreateProgram()}function createRenderbuffer(){return gl.glCreateRenderbuffer()}function createShader(e){return gl.glCreateShader(e)}function createTexture(){return gl.glCreateTexture()}function cullFace(e){gl.glCullFace(e)}function deleteBuffer(e){gl.glDeleteBuffer(e)}function deleteFramebuffer(e){gl.glDeleteFramebuffer(e)}function deleteProgram(e){gl.glDeleteProgram(e)}function deleteRenderbuffer(e){gl.glDeleteRenderbuffer(e)}function deleteShader(e){gl.glDeleteShader(e)}function deleteTexture(e){gl.glDeleteTexture(e)}function depthFunc(e){gl.glDepthFunc(e)}function depthMask(e){gl.glDepthMask(e)}function depthRange(e,t){gl.glDepthRange(e,t)}function detachShader(e,t){gl.glDetachShader(e,t)}function disable(e){gl.glDisable(e)}function disableVertexAttribArray(e){gl.glDisableVertexAttribArray(e)}function drawArrays(e,t,r){gl.glDrawArrays(e,t,r),0<r&&checkFirstFrames()}function drawElements(e,t,r,n){gl.glDrawElements(e,t,r,n),0<t&&checkFirstFrames()}function enable(e){gl.glEnable(e)}function enableVertexAttribArray(e){gl.glEnableVertexAttribArray(e)}function finish(){gl.glFinish()}function flush(){gl.glFlush()}function framebufferRenderbuffer(e,t,r,n){gl.glFramebufferRenderbuffer(e,t,r,n)}function framebufferTexture2D(e,t,r,n,i){gl.glFramebufferTexture2D(e,t,r,n,i)}function frontFace(e){gl.glFrontFace(e)}function generateMipmap(e){gl.glGenerateMipmap(e)}function getAttribLocation(e,t){return gl.glGetAttribLocation(e,t)}function getError(){return gl.glGetError()}function getShaderPrecisionFormat(e,t){return gl.glGetShaderPrecisionFormat(e,t)}function getProgramInfoLog(e){return gl.glGetProgramInfoLog(e)}function getShaderInfoLog(e){return gl.glGetShaderInfoLog(e)}function getShaderSource(e){return gl.glGetShaderSource(e)}function getUniformLocation(e,t){return gl.glGetUniformLocation(e,t)}function getVertexAttribOffset(e,t){return gl.glGetVertexAttribOffset(e,t)}function hint(e,t){gl.glHint(e,t)}function isBuffer(e){return gl.glIsBuffer(e)}function isEnabled(e){return gl.glIsEnabled(e)}function isFramebuffer(e){return gl.glIsFramebuffer(e)}function isProgram(e){return gl.glIsProgram(e)}function isRenderbuffer(e){return gl.glIsRenderbuffer(e)}function isShader(e){return gl.glIsShader(e)}function isTexture(e){return gl.glIsTexture(e)}function lineWidth(e){gl.glLineWidth(e)}function linkProgram(e){gl.glLinkProgram(e)}function pixelStorei(e,t){gl.glPixelStorei(e,t)}function polygonOffset(e,t){gl.glPolygonOffset(e,t)}function readPixels(e,t,r,n,i,a,o){gl.glReadPixels(e,t,r,n,i,a,o)}function renderbufferStorage(e,t,r,n){gl.glRenderbufferStorage(e,t,r,n)}function sampleCoverage(e,t){gl.glSampleCoverage(e,t)}function scissor(e,t,r,n){gl.glScissor(e,t,r,n)}function shaderSource(e,t){gl.glShaderSource(e,t)}function stencilFunc(e,t,r){gl.glStencilFunc(e,t,r)}function stencilFuncSeparate(e,t,r,n){gl.glStencilFuncSeparate(e,t,r,n)}function stencilMask(e){gl.glStencilMask(e)}function stencilMaskSeparate(e,t){gl.glStencilMaskSeparate(e,t)}function stencilOp(e,t,r){gl.glStencilOp(e,t,r)}function stencilOpSeparate(e,t,r,n){gl.glStencilOpSeparate(e,t,r,n)}function texImage2D(e,t,r){switch(arguments.length){case 6:var n=arguments[3],i=arguments[4],a=arguments[5];Object.prototype.hasOwnProperty.call(a,"__nativeObj")?gl.glTexImage2D(e,t,r,n,i,a.__nativeObj):gl.glTexImage2D(e,t,r,n,i,a);break;case 9:var o=arguments[3],s=arguments[4],f=arguments[5],u=(n=arguments[6],i=arguments[7],arguments[8]);gl.glTexImage2D(e,t,r,o,s,f,n,i,u)}}function texParameterf(e,t,r){gl.glTexParameterf(e,t,r)}function texParameteri(e,t,r){gl.glTexParameteri(e,t,r)}function texSubImage2D(e,t,r,n){switch(arguments.length){case 7:var i=arguments[4],a=arguments[5],o=arguments[6];Object.prototype.hasOwnProperty.call(o,"__nativeObj")?gl.glTexSubImage2D(e,t,r,n,i,a,o.__nativeObj):gl.glTexSubImage2D(e,t,r,n,i,a,o);break;case 9:var s=arguments[4],f=arguments[5],u=(i=arguments[6],a=arguments[7],arguments[8]);gl.glTexSubImage2D(e,t,r,n,s,f,i,a,u)}}function uniform1f(e,t){gl.glUniform1f(e,t)}function uniform2f(e,t,r){gl.glUniform2f(e,t,r)}function uniform3f(e,t,r,n){gl.glUniform3f(e,t,r,n)}function uniform4f(e,t,r,n,i){gl.glUniform4f(e,t,r,n,i)}function uniform1i(e,t){gl.glUniform1i(e,t)}function uniform2i(e,t,r){gl.glUniform2i(e,t,r)}function uniform3i(e,t,r,n){gl.glUniform3i(e,t,r,n)}function uniform4i(e,t,r,n,i){gl.glUniform4i(e,t,r,n,i)}function uniform1fv(e,t){gl.glUniform1fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform2fv(e,t){gl.glUniform2fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform3fv(e,t){gl.glUniform3fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform4fv(e,t){gl.glUniform4fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function uniform1iv(e,t){gl.glUniform1iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniform2iv(e,t){gl.glUniform2iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniform3iv(e,t){gl.glUniform3iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniform4iv(e,t){gl.glUniform4iv(e,__TypedArrayGetData(t instanceof Array==1?new Int32Array(t):t))}function uniformMatrix2fv(e,t,r){gl.glUniformMatrix2fv(e,t,__TypedArrayGetData(r instanceof Array==1?new Float32Array(r):r))}function uniformMatrix3fv(e,t,r){gl.glUniformMatrix3fv(e,t,__TypedArrayGetData(r instanceof Array==1?new Float32Array(r):r))}function uniformMatrix4fv(e,t,r){gl.glUniformMatrix4fv(e,t,__TypedArrayGetData(r instanceof Array==1?new Float32Array(r):r))}function useProgram(e){gl.glUseProgram(e)}function validateProgram(e){gl.glValidateProgram(e)}function vertexAttrib1f(e,t){gl.glVertexAttrib1f(e,t)}function vertexAttrib2f(e,t,r){gl.glVertexAttrib2f(e,t,r)}function vertexAttrib3f(e,t,r,n){gl.glVertexAttrib3f(e,t,r,n)}function vertexAttrib4f(e,t,r,n,i){gl.glVertexAttrib4f(e,t,r,n,i)}function vertexAttrib1fv(e,t){gl.glVertexAttrib1fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttrib2fv(e,t){gl.glVertexAttrib2fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttrib3fv(e,t){gl.glVertexAttrib3fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttrib4fv(e,t){gl.glVertexAttrib4fv(e,__TypedArrayGetData(t instanceof Array==1?new Float32Array(t):t))}function vertexAttribPointer(e,t,r,n,i,a){gl.glVertexAttribPointer(e,t,r,n,i,a)}function viewport(e,t,r,n){gl.glViewport(e,t,r,n)}function getActiveAttrib(e,t){return gl.glGetActiveAttrib(e,t)}function getActiveUniform(e,t){return gl.glGetActiveUniform(e,t)}function getAttachedShaders(e){return gl.glGetAttachedShaders(e)}function getBufferParameter(e,t){return gl.glGetBufferParameter(e,t)}function getFramebufferAttachmentParameter(e,t,r){return gl.glGetFramebufferAttachmentParameter(e,t,r)}function getProgramParameter(e,t){return gl.glGetProgramParameter(e,t)}function getRenderbufferParameter(e,t){return gl.glGetRenderbufferParameter(e,t)}function getShaderParameter(e,t){return gl.glGetShaderParameter(e,t)}function getTexParameter(e,t){return gl.glGetTexParameter(e,t)}function getVertexAttrib(e,t){return gl.glGetVertexAttrib(e,t)}function getUniform(e,t){return gl.glGetUniform(e,t)}function getParameter(e){switch(e){case gl.ACTIVE_TEXTURE:case gl.ALPHA_BITS:case gl.ARRAY_BUFFER_BINDING:case gl.BLUE_BITS:case gl.CULL_FACE_MODE:case gl.CURRENT_PROGRAM:case gl.DEPTH_BITS:case gl.DEPTH_FUNC:case gl.ELEMENT_ARRAY_BUFFER_BINDING:case gl.FRAMEBUFFER_BINDING:case gl.FRONT_FACE:case gl.GENERATE_MIPMAP_HINT:case gl.GREEN_BITS:case gl.IMPLEMENTATION_COLOR_READ_FORMAT:case gl.IMPLEMENTATION_COLOR_READ_TYPE:case gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS:case gl.MAX_CUBE_MAP_TEXTURE_SIZE:case gl.MAX_FRAGMENT_UNIFORM_VECTORS:case gl.MAX_RENDERBUFFER_SIZE:case gl.MAX_TEXTURE_IMAGE_UNITS:case gl.MAX_TEXTURE_SIZE:case gl.MAX_VARYING_VECTORS:case gl.MAX_VERTEX_ATTRIBS:case gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS:case gl.MAX_VERTEX_UNIFORM_VECTORS:case gl.MAX_VIEWPORT_DIMS:case gl.NUM_COMPRESSED_TEXTURE_FORMATS:case gl.NUM_SHADER_BINARY_FORMATS:case gl.PACK_ALIGNMENT:case gl.RED_BITS:case gl.RENDERBUFFER_BINDING:case gl.SAMPLE_BUFFERS:case gl.SAMPLES:case gl.STENCIL_BACK_FAIL:case gl.STENCIL_BACK_FUNC:case gl.STENCIL_BACK_PASS_DEPTH_FAIL:case gl.STENCIL_BACK_PASS_DEPTH_PASS:case gl.STENCIL_BACK_REF:case gl.STENCIL_BACK_VALUE_MASK:case gl.STENCIL_BACK_WRITEMASK:case gl.STENCIL_BITS:case gl.STENCIL_CLEAR_VALUE:case gl.STENCIL_FAIL:case gl.STENCIL_FUNC:case gl.STENCIL_PASS_DEPTH_FAIL:case gl.STENCIL_PASS_DEPTH_PASS:case gl.STENCIL_REF:case gl.STENCIL_VALUE_MASK:case gl.STENCIL_WRITEMASK:case gl.SUBPIXEL_BITS:case gl.TEXTURE_BINDING_2D:case gl.TEXTURE_BINDING_CUBE_MAP:case gl.UNPACK_ALIGNMENT:case gl.BLEND_DST_ALPHA:case gl.BLEND_DST_RGB:case gl.BLEND_EQUATION_ALPHA:case gl.BLEND_EQUATION_RGB:case gl.BLEND_SRC_ALPHA:case gl.BLEND_SRC_RGB:return gl.glGetParameterInt(e,1);case gl.ALIASED_LINE_WIDTH_RANGE:case gl.ALIASED_POINT_SIZE_RANGE:case gl.DEPTH_RANGE:case gl.MAX_VIEWPORT_DIMS:return gl.glGetParameterFloat(e,2);case gl.BLEND:case gl.CULL_FACE:case gl.DEPTH_TEST:case gl.DEPTH_WRITEMASK:case gl.DITHER:case gl.POLYGON_OFFSET_FILL:case gl.SAMPLE_ALPHA_TO_COVERAGE:case gl.SAMPLE_COVERAGE:case gl.SAMPLE_COVERAGE_INVERT:case gl.SCISSOR_TEST:case gl.SHADER_COMPILER:case gl.STENCIL_TEST:return gl.glGetParameterBool(e,1);case gl.BLEND_COLOR:case gl.COLOR_CLEAR_VALUE:return gl.glGetParameterFloat(e,4);case gl.SCISSOR_BOX:case gl.VIEWPORT:return gl.glGetParameterInt(e,4);case gl.COLOR_WRITEMASK:return gl.glGetParameterBool(e,4);case gl.POLYGON_OFFSET_FACTOR:case gl.POLYGON_OFFSET_UNITS:case gl.SAMPLE_COVERAGE_VALUE:return gl.glGetParameterFloat(e,1);case gl.SHADER_BINARY_FORMATS:var t=gl.glGetParameterInt(gl.NUM_SHADER_BINARY_FORMATS,1);return gl.glGetParameterInt(e,t);case gl.COMPRESSED_TEXTURE_FORMATS:t=gl.glGetParameterInt(gl.NUM_COMPRESSED_TEXTURE_FORMATS,1);return gl.glGetParameterInt(e,t)}}function attachMethod(){gl.activeTexture=activeTexture,gl.attachShader=attachShader,gl.bindAttribLocation=bindAttribLocation,gl.bindBuffer=bindBuffer,gl.bindFramebuffer=bindFramebuffer,gl.bindRenderbuffer=bindRenderbuffer,gl.bindTexture=bindTexture,gl.blendColor=blendColor,gl.blendEquation=blendEquation,gl.blendEquationSeparate=blendEquationSeparate,gl.blendFunc=blendFunc,gl.blendFuncSeparate=blendFuncSeparate,gl.bufferData=bufferData,gl.bufferData=bufferData,gl.bufferSubData=bufferSubData,gl.checkFramebufferStatus=checkFramebufferStatus,gl.clear=clear,gl.clearColor=clearColor,gl.clearDepth=clearDepth,gl.clearStencil=clearStencil,gl.colorMask=colorMask,gl.compileShader=compileShader,gl.compressedTexImage2D=compressedTexImage2D,gl.compressedTexSubImage2D=compressedTexSubImage2D,gl.copyTexImage2D=copyTexImage2D,gl.copyTexSubImage2D=copyTexSubImage2D,gl.createBuffer=createBuffer,gl.createFramebuffer=createFramebuffer,gl.createProgram=createProgram,gl.createRenderbuffer=createRenderbuffer,gl.createShader=createShader,gl.createTexture=createTexture,gl.cullFace=cullFace,gl.deleteBuffer=deleteBuffer,gl.deleteFramebuffer=deleteFramebuffer,gl.deleteProgram=deleteProgram,gl.deleteRenderbuffer=deleteRenderbuffer,gl.deleteShader=deleteShader,gl.deleteTexture=deleteTexture,gl.depthFunc=depthFunc,gl.depthMask=depthMask,gl.depthRange=depthRange,gl.detachShader=detachShader,gl.disable=disable,gl.disableVertexAttribArray=disableVertexAttribArray,gl.drawArrays=drawArrays,gl.drawElements=drawElements,gl.enable=enable,gl.enableVertexAttribArray=enableVertexAttribArray,gl.finish=finish,gl.flush=flush,gl.framebufferRenderbuffer=framebufferRenderbuffer,gl.framebufferTexture2D=framebufferTexture2D,gl.frontFace=frontFace,gl.generateMipmap=generateMipmap,gl.getAttribLocation=getAttribLocation,gl.getError=getError,gl.getProgramInfoLog=getProgramInfoLog,gl.getShaderInfoLog=getShaderInfoLog,gl.getShaderSource=getShaderSource,gl.getUniformLocation=getUniformLocation,gl.getVertexAttribOffset=getVertexAttribOffset,gl.hint=hint,gl.isBuffer=isBuffer,gl.isEnabled=isEnabled,gl.isFramebuffer=isFramebuffer,gl.isProgram=isProgram,gl.isRenderbuffer=isRenderbuffer,gl.isShader=isShader,gl.isTexture=isTexture,gl.lineWidth=lineWidth,gl.linkProgram=linkProgram,gl.pixelStorei=pixelStorei,gl.polygonOffset=polygonOffset,gl.readPixels=readPixels,gl.renderbufferStorage=renderbufferStorage,gl.sampleCoverage=sampleCoverage,gl.scissor=scissor,gl.shaderSource=shaderSource,gl.stencilFunc=stencilFunc,gl.stencilFuncSeparate=stencilFuncSeparate,gl.stencilMask=stencilMask,gl.stencilMaskSeparate=stencilMaskSeparate,gl.stencilOp=stencilOp,gl.stencilOpSeparate=stencilOpSeparate,gl.texImage2D=texImage2D,gl.texSubImage2D=texSubImage2D,gl.texParameterf=texParameterf,gl.texParameteri=texParameteri,gl.uniform1f=uniform1f,gl.uniform2f=uniform2f,gl.uniform3f=uniform3f,gl.uniform4f=uniform4f,gl.uniform1i=uniform1i,gl.uniform2i=uniform2i,gl.uniform3i=uniform3i,gl.uniform4i=uniform4i,gl.uniform1fv=uniform1fv,gl.uniform2fv=uniform2fv,gl.uniform3fv=uniform3fv,gl.uniform4fv=uniform4fv,gl.uniform1iv=uniform1iv,gl.uniform2iv=uniform2iv,gl.uniform3iv=uniform3iv,gl.uniform4iv=uniform4iv,gl.uniformMatrix2fv=uniformMatrix2fv,gl.uniformMatrix3fv=uniformMatrix3fv,gl.uniformMatrix4fv=uniformMatrix4fv,gl.useProgram=useProgram,gl.validateProgram=validateProgram,gl.vertexAttrib1f=vertexAttrib1f,gl.vertexAttrib2f=vertexAttrib2f,gl.vertexAttrib3f=vertexAttrib3f,gl.vertexAttrib4f=vertexAttrib4f,gl.vertexAttrib1fv=vertexAttrib1fv,gl.vertexAttrib2fv=vertexAttrib2fv,gl.vertexAttrib3fv=vertexAttrib3fv,gl.vertexAttrib4fv=vertexAttrib4fv,gl.vertexAttribPointer=vertexAttribPointer,gl.viewport=viewport,gl.getActiveAttrib=getActiveAttrib,gl.getActiveUniform=getActiveUniform,gl.getAttachedShaders=getAttachedShaders,gl.getBufferParameter=getBufferParameter,gl.getFramebufferAttachmentParameter=getFramebufferAttachmentParameter,gl.getProgramParameter=getProgramParameter,gl.getRenderbufferParameter=getRenderbufferParameter,gl.getShaderParameter=getShaderParameter,gl.getTexParameter=getTexParameter,gl.getVertexAttrib=getVertexAttrib,gl.getParameter=getParameter,gl.getUniform=getUniform,gl.getShaderPrecisionFormat=getShaderPrecisionFormat}function attatchConst(){gl.DEPTH_BUFFER_BIT=256,gl.STENCIL_BUFFER_BIT=1024,gl.COLOR_BUFFER_BIT=16384,gl.POINTS=0,gl.LINES=1,gl.LINE_LOOP=2,gl.LINE_STRIP=3,gl.TRIANGLES=4,gl.TRIANGLE_STRIP=5,gl.TRIANGLE_FAN=6,gl.ZERO=0,gl.ONE=1,gl.SRC_COLOR=768,gl.ONE_MINUS_SRC_COLOR=769,gl.SRC_ALPHA=770,gl.ONE_MINUS_SRC_ALPHA=771,gl.DST_ALPHA=772,gl.ONE_MINUS_DST_ALPHA=773,gl.DST_COLOR=774,gl.ONE_MINUS_DST_COLOR=775,gl.SRC_ALPHA_SATURATE=776,gl.FUNC_ADD=32774,gl.BLEND_EQUATION=32777,gl.BLEND_EQUATION_RGB=32777,gl.BLEND_EQUATION_ALPHA=34877,gl.FUNC_SUBTRACT=32778,gl.FUNC_REVERSE_SUBTRACT=32779,gl.BLEND_DST_RGB=32968,gl.BLEND_SRC_RGB=32969,gl.BLEND_DST_ALPHA=32970,gl.BLEND_SRC_ALPHA=32971,gl.CONSTANT_COLOR=32769,gl.ONE_MINUS_CONSTANT_COLOR=32770,gl.CONSTANT_ALPHA=32771,gl.ONE_MINUS_CONSTANT_ALPHA=32772,gl.BLEND_COLOR=32773,gl.ARRAY_BUFFER=34962,gl.ELEMENT_ARRAY_BUFFER=34963,gl.ARRAY_BUFFER_BINDING=34964,gl.ELEMENT_ARRAY_BUFFER_BINDING=34965,gl.STREAM_DRAW=35040,gl.STATIC_DRAW=35044,gl.DYNAMIC_DRAW=35048,gl.BUFFER_SIZE=34660,gl.BUFFER_USAGE=34661,gl.CURRENT_VERTEX_ATTRIB=34342,gl.FRONT=1028,gl.BACK=1029,gl.FRONT_AND_BACK=1032,gl.CULL_FACE=2884,gl.BLEND=3042,gl.DITHER=3024,gl.STENCIL_TEST=2960,gl.DEPTH_TEST=2929,gl.SCISSOR_TEST=3089,gl.POLYGON_OFFSET_FILL=32823,gl.SAMPLE_ALPHA_TO_COVERAGE=32926,gl.SAMPLE_COVERAGE=32928,gl.NO_ERROR=0,gl.INVALID_ENUM=1280,gl.INVALID_VALUE=1281,gl.INVALID_OPERATION=1282,gl.OUT_OF_MEMORY=1285,gl.CW=2304,gl.CCW=2305,gl.LINE_WIDTH=2849,gl.ALIASED_POINT_SIZE_RANGE=33901,gl.ALIASED_LINE_WIDTH_RANGE=33902,gl.CULL_FACE_MODE=2885,gl.FRONT_FACE=2886,gl.DEPTH_RANGE=2928,gl.DEPTH_WRITEMASK=2930,gl.DEPTH_CLEAR_VALUE=2931,gl.DEPTH_FUNC=2932,gl.STENCIL_CLEAR_VALUE=2961,gl.STENCIL_FUNC=2962,gl.STENCIL_FAIL=2964,gl.STENCIL_PASS_DEPTH_FAIL=2965,gl.STENCIL_PASS_DEPTH_PASS=2966,gl.STENCIL_REF=2967,gl.STENCIL_VALUE_MASK=2963,gl.STENCIL_WRITEMASK=2968,gl.STENCIL_BACK_FUNC=34816,gl.STENCIL_BACK_FAIL=34817,gl.STENCIL_BACK_PASS_DEPTH_FAIL=34818,gl.STENCIL_BACK_PASS_DEPTH_PASS=34819,gl.STENCIL_BACK_REF=36003,gl.STENCIL_BACK_VALUE_MASK=36004,gl.STENCIL_BACK_WRITEMASK=36005,gl.VIEWPORT=2978,gl.SCISSOR_BOX=3088,gl.COLOR_CLEAR_VALUE=3106,gl.COLOR_WRITEMASK=3107,gl.UNPACK_ALIGNMENT=3317,gl.PACK_ALIGNMENT=3333,gl.MAX_TEXTURE_SIZE=3379,gl.MAX_VIEWPORT_DIMS=3386,gl.SUBPIXEL_BITS=3408,gl.RED_BITS=3410,gl.GREEN_BITS=3411,gl.BLUE_BITS=3412,gl.ALPHA_BITS=3413,gl.DEPTH_BITS=3414,gl.STENCIL_BITS=3415,gl.POLYGON_OFFSET_UNITS=10752,gl.POLYGON_OFFSET_FACTOR=32824,gl.TEXTURE_BINDING_2D=32873,gl.SAMPLE_BUFFERS=32936,gl.SAMPLES=32937,gl.SAMPLE_COVERAGE_VALUE=32938,gl.SAMPLE_COVERAGE_INVERT=32939,gl.COMPRESSED_TEXTURE_FORMATS=34467,gl.DONT_CARE=4352,gl.FASTEST=4353,gl.NICEST=4354,gl.GENERATE_MIPMAP_HINT=33170,gl.BYTE=5120,gl.UNSIGNED_BYTE=5121,gl.SHORT=5122,gl.UNSIGNED_SHORT=5123,gl.INT=5124,gl.UNSIGNED_INT=5125,gl.FLOAT=5126,gl.DEPTH_COMPONENT=6402,gl.ALPHA=6406,gl.RGB=6407,gl.RGBA=6408,gl.LUMINANCE=6409,gl.LUMINANCE_ALPHA=6410,gl.UNSIGNED_SHORT_4_4_4_4=32819,gl.UNSIGNED_SHORT_5_5_5_1=32820,gl.UNSIGNED_SHORT_5_6_5=33635,gl.FRAGMENT_SHADER=35632,gl.VERTEX_SHADER=35633,gl.MAX_VERTEX_ATTRIBS=34921,gl.MAX_VERTEX_UNIFORM_VECTORS=36347,gl.MAX_VARYING_VECTORS=36348,gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,gl.MAX_TEXTURE_IMAGE_UNITS=34930,gl.MAX_FRAGMENT_UNIFORM_VECTORS=36349,gl.SHADER_TYPE=35663,gl.DELETE_STATUS=35712,gl.LINK_STATUS=35714,gl.VALIDATE_STATUS=35715,gl.ATTACHED_SHADERS=35717,gl.ACTIVE_UNIFORMS=35718,gl.ACTIVE_ATTRIBUTES=35721,gl.SHADING_LANGUAGE_VERSION=35724,gl.CURRENT_PROGRAM=35725,gl.NEVER=512,gl.LESS=513,gl.EQUAL=514,gl.LEQUAL=515,gl.GREATER=516,gl.NOTEQUAL=517,gl.GEQUAL=518,gl.ALWAYS=519,gl.KEEP=7680,gl.REPLACE=7681,gl.INCR=7682,gl.DECR=7683,gl.INVERT=5386,gl.INCR_WRAP=34055,gl.DECR_WRAP=34056,gl.VENDOR=7936,gl.RENDERER=7937,gl.VERSION=7938,gl.NEAREST=9728,gl.LINEAR=9729,gl.NEAREST_MIPMAP_NEAREST=9984,gl.LINEAR_MIPMAP_NEAREST=9985,gl.NEAREST_MIPMAP_LINEAR=9986,gl.LINEAR_MIPMAP_LINEAR=9987,gl.TEXTURE_MAG_FILTER=10240,gl.TEXTURE_MIN_FILTER=10241,gl.TEXTURE_WRAP_S=10242,gl.TEXTURE_WRAP_T=10243,gl.TEXTURE_2D=3553,gl.TEXTURE=5890,gl.TEXTURE_CUBE_MAP=34067,gl.TEXTURE_BINDING_CUBE_MAP=34068,gl.TEXTURE_CUBE_MAP_POSITIVE_X=34069,gl.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,gl.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,gl.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,gl.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,gl.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,gl.MAX_CUBE_MAP_TEXTURE_SIZE=34076,gl.TEXTURE0=33984,gl.TEXTURE1=33985,gl.TEXTURE2=33986,gl.TEXTURE3=33987,gl.TEXTURE4=33988,gl.TEXTURE5=33989,gl.TEXTURE6=33990,gl.TEXTURE7=33991,gl.TEXTURE8=33992,gl.TEXTURE9=33993,gl.TEXTURE10=33994,gl.TEXTURE11=33995,gl.TEXTURE12=33996,gl.TEXTURE13=33997,gl.TEXTURE14=33998,gl.TEXTURE15=33999,gl.TEXTURE16=34e3,gl.TEXTURE17=34001,gl.TEXTURE18=34002,gl.TEXTURE19=34003,gl.TEXTURE20=34004,gl.TEXTURE21=34005,gl.TEXTURE22=34006,gl.TEXTURE23=34007,gl.TEXTURE24=34008,gl.TEXTURE25=34009,gl.TEXTURE26=34010,gl.TEXTURE27=34011,gl.TEXTURE28=34012,gl.TEXTURE29=34013,gl.TEXTURE30=34014,gl.TEXTURE31=34015,gl.ACTIVE_TEXTURE=34016,gl.REPEAT=10497,gl.CLAMP_TO_EDGE=33071,gl.MIRRORED_REPEAT=33648,gl.FLOAT_VEC2=35664,gl.FLOAT_VEC3=35665,gl.FLOAT_VEC4=35666,gl.INT_VEC2=35667,gl.INT_VEC3=35668,gl.INT_VEC4=35669,gl.BOOL=35670,gl.BOOL_VEC2=35671,gl.BOOL_VEC3=35672,gl.BOOL_VEC4=35673,gl.FLOAT_MAT2=35674,gl.FLOAT_MAT3=35675,gl.FLOAT_MAT4=35676,gl.SAMPLER_2D=35678,gl.SAMPLER_CUBE=35680,gl.VERTEX_ATTRIB_ARRAY_ENABLED=34338,gl.VERTEX_ATTRIB_ARRAY_SIZE=34339,gl.VERTEX_ATTRIB_ARRAY_STRIDE=34340,gl.VERTEX_ATTRIB_ARRAY_TYPE=34341,gl.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,gl.VERTEX_ATTRIB_ARRAY_POINTER=34373,gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,gl.IMPLEMENTATION_COLOR_READ_TYPE=35738,gl.IMPLEMENTATION_COLOR_READ_FORMAT=35739,gl.COMPILE_STATUS=35713,gl.LOW_FLOAT=36336,gl.MEDIUM_FLOAT=36337,gl.HIGH_FLOAT=36338,gl.LOW_INT=36339,gl.MEDIUM_INT=36340,gl.HIGH_INT=36341,gl.FRAMEBUFFER=36160,gl.RENDERBUFFER=36161,gl.RGBA4=32854,gl.RGB5_A1=32855,gl.RGB565=36194,gl.DEPTH_COMPONENT16=33189,gl.STENCIL_INDEX8=36168,gl.DEPTH_STENCIL=34041,gl.RENDERBUFFER_WIDTH=36162,gl.RENDERBUFFER_HEIGHT=36163,gl.RENDERBUFFER_INTERNAL_FORMAT=36164,gl.RENDERBUFFER_RED_SIZE=36176,gl.RENDERBUFFER_GREEN_SIZE=36177,gl.RENDERBUFFER_BLUE_SIZE=36178,gl.RENDERBUFFER_ALPHA_SIZE=36179,gl.RENDERBUFFER_DEPTH_SIZE=36180,gl.RENDERBUFFER_STENCIL_SIZE=36181,gl.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,gl.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,gl.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,gl.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,gl.COLOR_ATTACHMENT0=36064,gl.DEPTH_ATTACHMENT=36096,gl.STENCIL_ATTACHMENT=36128,gl.DEPTH_STENCIL_ATTACHMENT=33306,gl.NONE=0,gl.FRAMEBUFFER_COMPLETE=36053,gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,gl.FRAMEBUFFER_UNSUPPORTED=36061,gl.FRAMEBUFFER_BINDING=36006,gl.RENDERBUFFER_BINDING=36007,gl.MAX_RENDERBUFFER_SIZE=34024,gl.INVALID_FRAMEBUFFER_OPERATION=1286,gl.UNPACK_FLIP_Y_WEBGL=37440,gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,gl.CONTEXT_LOST_WEBGL=37442,gl.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,gl.BROWSER_DEFAULT_WEBGL=37444,gl.SHADER_BINARY_FORMATS=36344,gl.NUM_SHADER_BINARY_FORMATS=36345,gl.NUM_COMPRESSED_TEXTURE_FORMATS=34466}var buffer_data,bufferdata_array,bufferdata_view,GL_COMMAND_ACTIVE_TEXTURE=0,GL_COMMAND_ATTACH_SHADER=1,GL_COMMAND_BIND_ATTRIB_LOCATION=2,GL_COMMAND_BIND_BUFFER=3,GL_COMMAND_BIND_FRAME_BUFFER=4,GL_COMMAND_BIND_RENDER_BUFFER=5,GL_COMMAND_BIND_TEXTURE=6,GL_COMMAND_BLEND_COLOR=7,GL_COMMAND_BLEND_EQUATION=8,GL_COMMAND_BLEND_EQUATION_SEPARATE=9,GL_COMMAND_BLEND_FUNC=10,GL_COMMAND_BLEND_FUNC_SEPARATE=11,GL_COMMAND_BUFFER_DATA=12,GL_COMMAND_BUFFER_SUB_DATA=13,GL_COMMAND_CLEAR=14,GL_COMMAND_CLEAR_COLOR=15,GL_COMMAND_CLEAR_DEPTH=16,GL_COMMAND_CLEAR_STENCIL=17,GL_COMMAND_COLOR_MASK=18,GL_COMMAND_COMMIT=19,GL_COMMAND_COMPILE_SHADER=20,GL_COMMAND_COMPRESSED_TEX_IMAGE_2D=21,GL_COMMAND_COMPRESSED_TEX_SUB_IMAGE_2D=22,GL_COMMAND_COPY_TEX_IMAGE_2D=23,GL_COMMAND_COPY_TEX_SUB_IMAGE_2D=24,GL_COMMAND_CULL_FACE=25,GL_COMMAND_DELETE_BUFFER=26,GL_COMMAND_DELETE_FRAME_BUFFER=27,GL_COMMAND_DELETE_PROGRAM=28,GL_COMMAND_DELETE_RENDER_BUFFER=29,GL_COMMAND_DELETE_SHADER=30,GL_COMMAND_DELETE_TEXTURE=31,GL_COMMAND_DEPTH_FUNC=32,GL_COMMAND_DEPTH_MASK=33,GL_COMMAND_DEPTH_RANGE=34,GL_COMMAND_DETACH_SHADER=35,GL_COMMAND_DISABLE=36,GL_COMMAND_DISABLE_VERTEX_ATTRIB_ARRAY=37,GL_COMMAND_DRAW_ARRAYS=38,GL_COMMAND_DRAW_ELEMENTS=39,GL_COMMAND_ENABLE=40,GL_COMMAND_ENABLE_VERTEX_ATTRIB_ARRAY=41,GL_COMMAND_FINISH=42,GL_COMMAND_FLUSH=43,GL_COMMAND_FRAME_BUFFER_RENDER_BUFFER=44,GL_COMMAND_FRAME_BUFFER_TEXTURE_2D=45,GL_COMMAND_FRONT_FACE=46,GL_COMMAND_GENERATE_MIPMAP=47,GL_COMMAND_HINT=48,GL_COMMAND_LINE_WIDTH=49,GL_COMMAND_LINK_PROGRAM=50,GL_COMMAND_PIXEL_STOREI=51,GL_COMMAND_POLYGON_OFFSET=52,GL_COMMAND_RENDER_BUFFER_STORAGE=53,GL_COMMAND_SAMPLE_COVERAGE=54,GL_COMMAND_SCISSOR=55,GL_COMMAND_SHADER_SOURCE=56,GL_COMMAND_STENCIL_FUNC=57,GL_COMMAND_STENCIL_FUNC_SEPARATE=58,GL_COMMAND_STENCIL_MASK=59,GL_COMMAND_STENCIL_MASK_SEPARATE=60,GL_COMMAND_STENCIL_OP=61,GL_COMMAND_STENCIL_OP_SEPARATE=62,GL_COMMAND_TEX_IMAGE_2D=63,GL_COMMAND_TEX_PARAMETER_F=64,GL_COMMAND_TEX_PARAMETER_I=65,GL_COMMAND_TEX_SUB_IMAGE_2D=66,GL_COMMAND_UNIFORM_1F=67,GL_COMMAND_UNIFORM_1FV=68,GL_COMMAND_UNIFORM_1I=69,GL_COMMAND_UNIFORM_1IV=70,GL_COMMAND_UNIFORM_2F=71,GL_COMMAND_UNIFORM_2FV=72,GL_COMMAND_UNIFORM_2I=73,GL_COMMAND_UNIFORM_2IV=74,GL_COMMAND_UNIFORM_3F=75,GL_COMMAND_UNIFORM_3FV=76,GL_COMMAND_UNIFORM_3I=77,GL_COMMAND_UNIFORM_3IV=78,GL_COMMAND_UNIFORM_4F=79,GL_COMMAND_UNIFORM_4FV=80,GL_COMMAND_UNIFORM_4I=81,GL_COMMAND_UNIFORM_4IV=82,GL_COMMAND_UNIFORM_MATRIX_2FV=83,GL_COMMAND_UNIFORM_MATRIX_3FV=84,GL_COMMAND_UNIFORM_MATRIX_4FV=85,GL_COMMAND_USE_PROGRAM=86,GL_COMMAND_VALIDATE_PROGRAM=87,GL_COMMAND_VERTEX_ATTRIB_1F=88,GL_COMMAND_VERTEX_ATTRIB_2F=89,GL_COMMAND_VERTEX_ATTRIB_3F=90,GL_COMMAND_VERTEX_ATTRIB_4F=91,GL_COMMAND_VERTEX_ATTRIB_1FV=92,GL_COMMAND_VERTEX_ATTRIB_2FV=93,GL_COMMAND_VERTEX_ATTRIB_3FV=94,GL_COMMAND_VERTEX_ATTRIB_4FV=95,GL_COMMAND_VERTEX_ATTRIB_POINTER=96,GL_COMMAND_VIEW_PORT=97,total_size=1e5,next_index=0,bufferdata_pointer=0;function OpenOptMode(){gl.flushCommand&&isSupportTypeArray()&&attachMethodOpt(),buffer_data=new Float32Array(total_size)}function flushCommand(){0<next_index&&(gl.flushCommand(next_index,buffer_data),next_index=0)}function glCommitOpt(){flushCommand(),gl.commit()}function activeTextureOpt(e){total_size<next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ACTIVE_TEXTURE,buffer_data[next_index+1]=e,next_index+=2}function attachShaderOpt(e,t){total_size<next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ATTACH_SHADER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function bindAttribLocationOpt(e,t,r){flushCommand(),bindAttribLocation(e,t,r)}function bindBufferOpt(e,t){total_size<next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BIND_BUFFER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function bindFramebufferOpt(e,t){total_size<next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BIND_FRAME_BUFFER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function bindRenderbufferOpt(e,t){total_size<next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BIND_RENDER_BUFFER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function bindTextureOpt(e,t){total_size<next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BIND_TEXTURE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function blendColorOpt(e,t,r,n){total_size<next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_COLOR,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function blendEquationOpt(e){total_size<next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_EQUATION,buffer_data[next_index+1]=e,next_index+=2}function blendEquationSeparateOpt(e,t){total_size<next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_EQUATION_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function blendFuncOpt(e,t){total_size<next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_FUNC,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function blendFuncSeparateOpt(e,t,r,n){total_size<next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_BLEND_FUNC_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function bufferDataOpt(e,t,r){flushCommand(),bufferData(e,t,r)}function bufferSubDataOpt(e,t,r){flushCommand(),bufferSubData(e,t,r)}function checkFramebufferStatusOpt(e){flushCommand(),checkFramebufferStatus(e)}function clearOpt(e){total_size<next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR,buffer_data[next_index+1]=e,next_index+=2}function clearColorOpt(e,t,r,n){total_size<next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR_COLOR,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function clearDepthOpt(e){total_size<next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR_DEPTH,buffer_data[next_index+1]=e,next_index+=2}function clearStencilOpt(e){total_size<next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CLEAR_STENCIL,buffer_data[next_index+1]=e,next_index+=2}function colorMaskOpt(e,t,r,n){total_size<next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COLOR_MASK,buffer_data[next_index+1]=e?1:0,buffer_data[next_index+2]=t?1:0,buffer_data[next_index+3]=r?1:0,buffer_data[next_index+4]=n?1:0,next_index+=5}function compileShaderOpt(e){total_size<next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COMPILE_SHADER,buffer_data[next_index+1]=e,next_index+=2}function compressedTexImage2DOpt(e,t,r,n,i,a,o){flushCommand(),compressedTexImage2D(e,t,r,n,i,a,o)}function compressedTexSubImage2DOpt(e,t,r,n,i,a,o,s){flushCommand(),compressedTexSubImage2D(e,t,r,n,i,a,o,s)}function copyTexImage2DOpt(e,t,r,n,i,a,o,s){total_size<next_index+9&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COPY_TEX_IMAGE_2D,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,buffer_data[next_index+5]=i,buffer_data[next_index+6]=a,buffer_data[next_index+7]=o,buffer_data[next_index+8]=s,next_index+=9}function copyTexSubImage2DOpt(e,t,r,n,i,a,o,s){total_size<next_index+9&&flushCommand(),buffer_data[next_index]=GL_COMMAND_COPY_TEX_SUB_IMAGE_2D,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,buffer_data[next_index+5]=i,buffer_data[next_index+6]=a,buffer_data[next_index+7]=o,buffer_data[next_index+8]=s,next_index+=9}function createBufferOpt(){return flushCommand(),createBuffer()}function createFramebufferOpt(){return flushCommand(),createFramebuffer()}function createProgramOpt(){return flushCommand(),createProgram()}function createRenderbufferOpt(){return flushCommand(),createRenderbuffer()}function createShaderOpt(e){return flushCommand(),createShader(e)}function createTextureOpt(){return flushCommand(),createTexture()}function cullFaceOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_CULL_FACE,buffer_data[next_index+1]=e,next_index+=2}function deleteBufferOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_BUFFER,buffer_data[next_index+1]=e,next_index+=2}function deleteFramebufferOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_FRAME_BUFFER,buffer_data[next_index+1]=e,next_index+=2}function deleteProgramOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function deleteRenderbufferOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_RENDER_BUFFER,buffer_data[next_index+1]=e,next_index+=2}function deleteShaderOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_SHADER,buffer_data[next_index+1]=e,next_index+=2}function deleteTextureOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DELETE_TEXTURE,buffer_data[next_index+1]=e,next_index+=2}function depthFuncOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DEPTH_FUNC,buffer_data[next_index+1]=e,next_index+=2}function depthMaskOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DEPTH_MASK,buffer_data[next_index+1]=e?1:0,next_index+=2}function depthRangeOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DEPTH_RANGE,buffer_data[next_index+1]=e,buffer_data[next_index+1]=t,next_index+=3}function detachShaderOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DETACH_SHADER,buffer_data[next_index+1]=e,buffer_data[next_index+1]=t,next_index+=3}function disableOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DISABLE,buffer_data[next_index+1]=e,next_index+=2}function disableVertexAttribArrayOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DISABLE_VERTEX_ATTRIB_ARRAY,buffer_data[next_index+1]=e,next_index+=2}function drawArraysOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DRAW_ARRAYS,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4,0<r&&checkFirstFrames()}function drawElementsOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_DRAW_ELEMENTS,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5,0<t&&checkFirstFrames()}function enableOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ENABLE,buffer_data[next_index+1]=e,next_index+=2}function enableVertexAttribArrayOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_ENABLE_VERTEX_ATTRIB_ARRAY,buffer_data[next_index+1]=e,next_index+=2}function finishOpt(){total_size<=next_index+1&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FINISH,next_index+=1}function flushOpt(){total_size<=next_index+1&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FLUSH,next_index+=1}function framebufferRenderbufferOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FRAME_BUFFER_RENDER_BUFFER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function framebufferTexture2DOpt(e,t,r,n,i){total_size<=next_index+6&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FRAME_BUFFER_TEXTURE_2D,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,buffer_data[next_index+5]=i,next_index+=6}function frontFaceOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_FRONT_FACE,buffer_data[next_index+1]=e,next_index+=2}function generateMipmapOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_GENERATE_MIPMAP,buffer_data[next_index+1]=e,next_index+=2}function getActiveAttribOpt(e,t){return flushCommand(),getActiveAttrib(e,t)}function getActiveUniformOpt(e,t){return flushCommand(),getActiveUniform(e,t)}function getAttachedShadersOpt(e){return flushCommand(),getAttachedShaders(e)}function getAttribLocationOpt(e,t){return flushCommand(),getAttribLocation(e,t)}function getBufferParameterOpt(e,t){return flushCommand(),getBufferParameter(e,t)}function getParameterOpt(e){return flushCommand(),getParameter(e)}function getErrorOpt(){return flushCommand(),getError()}function getFramebufferAttachmentParameterOpt(e,t,r){return flushCommand(),getFramebufferAttachmentParameter(e,t,r)}function getProgramParameterOpt(e,t){return flushCommand(),getProgramParameter(e,t)}function getProgramInfoLogOpt(e){return flushCommand(),getProgramInfoLog(e)}function getRenderbufferParameterOpt(e,t){return flushCommand(),getRenderbufferParameter(e,t)}function getShaderParameterOpt(e,t){return flushCommand(),getShaderParameter(e,t)}function getShaderPrecisionFormatOpt(e,t){return flushCommand(),getShaderPrecisionFormat(e,t)}function getShaderInfoLogOpt(e){return flushCommand(),getShaderInfoLog(e)}function getShaderSourceOpt(e){return flushCommand(),getShaderSource(e)}function getTexParameterOpt(e,t){return flushCommand(),getTexParameter(e,t)}function getUniformOpt(e,t){return flushCommand(),getUniform(e,t)}function getUniformLocationOpt(e,t){return flushCommand(),getUniformLocation(e,t)}function getVertexAttribOpt(e,t){return flushCommand(),getVertexAttrib(e,t)}function getVertexAttribOffsetOpt(e,t){return flushCommand(),getVertexAttribOffset(e,t)}function hintOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_HINT,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function isBufferOpt(e){return flushCommand(),isBuffer(e)}function isEnabledOpt(e){return flushCommand(),isEnabled(e)}function isFramebufferOpt(e){return flushCommand(),isFramebuffer(e)}function isProgramOpt(e){return flushCommand(),isProgram(e)}function isRenderbufferOpt(e){return flushCommand(),isRenderbuffer(e)}function isShaderOpt(e){return flushCommand(),isShader(e)}function isTextureOpt(e){return flushCommand(),isTexture(e)}function lineWidthOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_LINE_WIDTH,buffer_data[next_index+1]=e,next_index+=2}function linkProgramOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_LINK_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function pixelStoreiOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_PIXEL_STOREI,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function polygonOffsetOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_POLYGON_OFFSET,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function readPixelsOpt(e,t,r,n,i,a,o){flushCommand(),readPixels(e,t,r,n,i,a,o)}function renderbufferStorageOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_RENDER_BUFFER_STORAGE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=internalFormat,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function sampleCoverageOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_SAMPLE_COVERAGE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t?1:0,next_index+=3}function scissorOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_SCISSOR,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function shaderSourceOpt(e,t){flushCommand(),shaderSource(e,t)}function stencilFuncOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_FUNC,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4}function stencilFuncSeparateOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_FUNC_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function stencilMaskOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_MASK,buffer_data[next_index+1]=e,next_index+=2}function stencilMaskSeparateOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_MASK_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function stencilOpOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_OP,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4}function stencilOpSeparateOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_STENCIL_OP_SEPARATE,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function texImage2DOpt(e,t,r){switch(flushCommand(),arguments.length){case 6:var n=arguments[3],i=arguments[4],a=arguments[5];Object.prototype.hasOwnProperty.call(a,"__nativeObj")?gl.glTexImage2D(e,t,r,n,i,a.__nativeObj):gl.glTexImage2D(e,t,r,n,i,a);break;case 9:var o=arguments[3],s=arguments[4],f=arguments[5],u=(n=arguments[6],i=arguments[7],arguments[8]);gl.glTexImage2D(e,t,r,o,s,f,n,i,u)}}function texParameterfOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_TEX_PARAMETER_F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4}function texParameteriOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_TEX_PARAMETER_I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4}function texSubImage2DOpt(e,t,r,n,i,a,o,s,f){flushCommand(),texSubImage2D(e,t,r,n,i,a,o,s,f)}function texSubImage2DOpt(e,t,r,n,i,a,o){flushCommand(),texSubImage2D(e,t,r,n,i,a,o)}function uniform1fOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function uniform2fOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4}function uniform3fOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function uniform4fOpt(e,t,r,n,i){total_size<=next_index+6&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,buffer_data[next_index+5]=i,next_index+=6}function uniform1iOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function uniform2iOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4}function uniform3iOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function uniform4iOpt(e,t,r,n,i){total_size<=next_index+6&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4I,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,buffer_data[next_index+5]=i,next_index+=6}function uniform1fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform2fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform3fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform4fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform1ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_1IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform2ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_2IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform3ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_3IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniform4ivOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_4IV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function uniformMatrix2fvOpt(e,t,r){next_index+4+r.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_MATRIX_2FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r.length,buffer_data.set(r,next_index+4),next_index+=4+r.length}function uniformMatrix3fvOpt(e,t,r){next_index+4+r.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_MATRIX_3FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r.length,buffer_data.set(r,next_index+4),next_index+=4+r.length}function uniformMatrix4fvOpt(e,t,r){next_index+4+r.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_UNIFORM_MATRIX_4FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r.length,buffer_data.set(r,next_index+4),next_index+=4+r.length}function useProgramOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_USE_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function validateProgramOpt(e){total_size<=next_index+2&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VALIDATE_PROGRAM,buffer_data[next_index+1]=e,next_index+=2}function vertexAttrib1fOpt(e,t){total_size<=next_index+3&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_1F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,next_index+=3}function vertexAttrib2fOpt(e,t,r){total_size<=next_index+4&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_2F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,next_index+=4}function vertexAttrib3fOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_3F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function vertexAttrib4fOpt(e,t,r,n,i){total_size<=next_index+6&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_4F,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,buffer_data[next_index+5]=i,next_index+=6}function vertexAttrib1fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_1FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttrib2fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_2FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttrib3fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_3FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttrib4fvOpt(e,t){next_index+3+t.length>=total_size&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_4FV,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t.length,buffer_data.set(t,next_index+3),next_index+=3+t.length}function vertexAttribPointerOpt(e,t,r,n,i,a){total_size<=next_index+7&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VERTEX_ATTRIB_POINTER,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n?1:0,buffer_data[next_index+5]=i,buffer_data[next_index+6]=a,next_index+=7}function viewportOpt(e,t,r,n){total_size<=next_index+5&&flushCommand(),buffer_data[next_index]=GL_COMMAND_VIEW_PORT,buffer_data[next_index+1]=e,buffer_data[next_index+2]=t,buffer_data[next_index+3]=r,buffer_data[next_index+4]=n,next_index+=5}function isSupportTypeArray(){if("android"==GameStatusInfo.platform)return!0;var e=BK.Director.queryDeviceInfo(),t=e.version.split(".");return"ios"==e.platform&&10<=Number(t[0])}function attachMethodOpt(){gl.activeTexture=activeTextureOpt,gl.attachShader=attachShaderOpt,gl.bindAttribLocation=bindAttribLocationOpt,gl.bindBuffer=bindBufferOpt,gl.bindFramebuffer=bindFramebufferOpt,gl.bindRenderbuffer=bindRenderbufferOpt,gl.bindTexture=bindTextureOpt,gl.blendColor=blendColorOpt,gl.blendEquation=blendEquationOpt,gl.blendEquationSeparate=blendEquationSeparateOpt,gl.blendFunc=blendFuncOpt,gl.blendFuncSeparate=blendFuncSeparateOpt,gl.bufferData=bufferDataOpt,gl.bufferData=bufferDataOpt,gl.bufferSubData=bufferSubDataOpt,gl.checkFramebufferStatus=checkFramebufferStatusOpt,gl.clear=clearOpt,gl.clearColor=clearColorOpt,gl.clearDepth=clearDepthOpt,gl.clearStencil=clearStencilOpt,gl.colorMask=colorMaskOpt,gl.compileShader=compileShaderOpt,gl.compressedTexImage2D=compressedTexImage2DOpt,gl.compressedTexSubImage2D=compressedTexSubImage2DOpt,gl.copyTexImage2D=copyTexImage2DOpt,gl.copyTexSubImage2D=copyTexSubImage2DOpt,gl.createBuffer=createBufferOpt,gl.createFramebuffer=createFramebufferOpt,gl.createProgram=createProgramOpt,gl.createRenderbuffer=createRenderbufferOpt,gl.createShader=createShaderOpt,gl.createTexture=createTextureOpt,gl.cullFace=cullFaceOpt,gl.deleteBuffer=deleteBufferOpt,gl.deleteFramebuffer=deleteFramebufferOpt,gl.deleteProgram=deleteProgramOpt,gl.deleteRenderbuffer=deleteRenderbufferOpt,gl.deleteShader=deleteShaderOpt,gl.deleteTexture=deleteTextureOpt,gl.depthFunc=depthFuncOpt,gl.depthMask=depthMaskOpt,gl.depthRange=depthRangeOpt,gl.detachShader=detachShaderOpt,gl.disable=disableOpt,gl.disableVertexAttribArray=disableVertexAttribArrayOpt,gl.drawArrays=drawArraysOpt,gl.drawElements=drawElementsOpt,gl.enable=enableOpt,gl.enableVertexAttribArray=enableVertexAttribArrayOpt,gl.finish=finishOpt,gl.flush=flushOpt,gl.framebufferRenderbuffer=framebufferRenderbufferOpt,gl.framebufferTexture2D=framebufferTexture2DOpt,gl.frontFace=frontFaceOpt,gl.generateMipmap=generateMipmapOpt,gl.getActiveAttrib=getActiveAttribOpt,gl.getActiveUniform=getActiveUniformOpt,gl.getAttachedShaders=getAttachedShadersOpt,gl.getAttribLocation=getAttribLocationOpt,gl.getBufferParameter=getBufferParameterOpt,gl.getParameter=getParameterOpt,gl.getError=getErrorOpt,gl.getFramebufferAttachmentParameter=getFramebufferAttachmentParameterOpt,gl.getProgramParameter=getProgramParameterOpt,gl.getProgramInfoLog=getProgramInfoLogOpt,gl.getRenderbufferParameter=getRenderbufferParameterOpt,gl.getShaderParameter=getShaderParameterOpt,gl.getShaderPrecisionFormat=getShaderPrecisionFormatOpt,gl.getShaderInfoLog=getShaderInfoLogOpt,gl.getShaderSource=getShaderSourceOpt,gl.getTexParameter=getTexParameterOpt,gl.getUniform=getUniformOpt,gl.getUniformLocation=getUniformLocationOpt,gl.getVertexAttrib=getVertexAttribOpt,gl.getVertexAttribOffset=getVertexAttribOffsetOpt,gl.hint=hintOpt,gl.isBuffer=isBufferOpt,gl.isEnabled=isEnabledOpt,gl.isFramebuffer=isFramebufferOpt,gl.isProgram=isProgramOpt,gl.isRenderbuffer=isRenderbufferOpt,gl.isShader=isShaderOpt,gl.isTexture=isTextureOpt,gl.lineWidth=lineWidthOpt,gl.linkProgram=linkProgramOpt,gl.pixelStorei=pixelStoreiOpt,gl.polygonOffset=polygonOffsetOpt,gl.readPixels=readPixelsOpt,gl.renderbufferStorage=renderbufferStorageOpt,gl.sampleCoverage=sampleCoverageOpt,gl.scissor=scissorOpt,gl.shaderSource=shaderSourceOpt,gl.stencilFunc=stencilFuncOpt,gl.stencilFuncSeparate=stencilFuncSeparateOpt,gl.stencilMask=stencilMaskOpt,gl.stencilMaskSeparate=stencilMaskSeparateOpt,gl.stencilOp=stencilOpOpt,gl.stencilOpSeparate=stencilOpSeparateOpt,gl.texImage2D=texImage2DOpt,gl.texImage2D=texImage2DOpt,gl.texParameterf=texParameterfOpt,gl.texParameteri=texParameteriOpt,gl.texSubImage2D=texSubImage2DOpt,gl.texSubImage2D=texSubImage2DOpt,gl.uniform1f=uniform1fOpt,gl.uniform2f=uniform2fOpt,gl.uniform3f=uniform3fOpt,gl.uniform4f=uniform4fOpt,gl.uniform1i=uniform1iOpt,gl.uniform2i=uniform2iOpt,gl.uniform3i=uniform3iOpt,gl.uniform4i=uniform4iOpt,gl.uniform1fv=uniform1fvOpt,gl.uniform2fv=uniform2fvOpt,gl.uniform3fv=uniform3fvOpt,gl.uniform4fv=uniform4fvOpt,gl.uniform1iv=uniform1ivOpt,gl.uniform2iv=uniform2ivOpt,gl.uniform3iv=uniform3ivOpt,gl.uniform4iv=uniform4ivOpt,gl.uniformMatrix2fv=uniformMatrix2fvOpt,gl.uniformMatrix3fv=uniformMatrix3fvOpt,gl.uniformMatrix4fv=uniformMatrix4fvOpt,gl.useProgram=useProgramOpt,gl.validateProgram=validateProgramOpt,gl.vertexAttrib1f=vertexAttrib1fOpt,gl.vertexAttrib2f=vertexAttrib2fOpt,gl.vertexAttrib3f=vertexAttrib3fOpt,gl.vertexAttrib4f=vertexAttrib4fOpt,gl.vertexAttrib1fv=vertexAttrib1fvOpt,gl.vertexAttrib2fv=vertexAttrib2fvOpt,gl.vertexAttrib3fv=vertexAttrib3fvOpt,gl.vertexAttrib4fv=vertexAttrib4fvOpt,gl.vertexAttribPointer=vertexAttribPointerOpt,gl.viewport=viewportOpt,gl.glCommit=glCommitOpt}!function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Text=t())}(BK,function(){return function(){function e(e,t){this.style={fontSize:20,textColor:4294901760,maxWidth:200,maxHeight:400,width:100,height:200,textAlign:0,bold:1,italic:1,strokeColor:4278190080,strokeSize:5,shadowRadius:5,shadowDx:10,shadowDy:10,shadowColor:4294901760},this.setStyle(e),this._content="",t&&(this._content=t),this.__nativeObj=new BK.TextNode(this.style,this._content),Object.getOwnPropertyNames(this.__nativeObj).forEach(function(e){var t=e;"__nativeObj"!=t&&Object.defineProperty(this,t,{get:function(){return this.__nativeObj[t]},set:function(e){this.__nativeObj[t]=e}})},this)}return Object.defineProperty(e.prototype,"content",{get:function(){return this._content},set:function(e){this._content=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this.style.fontSize},set:function(e){this.style.fontSize=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return{width:this.style.width,height:this.style.height}},set:function(e){this.style.width=e.width,this.style.height=e.height,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fontColor",{get:function(){return this.style.textColor},set:function(e){this.style.textColor=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxSize",{get:function(){return{width:this.style.maxWidth,height:this.style.maxHeight}},set:function(e){this.style.maxWidth=e.width,this.style.maxHeight=e.height,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bold",{get:function(){return this.style.bold},set:function(e){this.style.bold=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"italic",{get:function(){return this.style.italic},set:function(e){this.style.italic=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlign",{get:function(){return this.style.textAlign},set:function(e){this.style.textAlign=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strokeColor",{get:function(){return this.style.strokeColor},set:function(e){this.style.strokeColor=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strokeSize",{get:function(){return this.style.strokeSize},set:function(e){this.style.strokeSize=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(e){this.style.shadowColor=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowRadius",{get:function(){return this.style.shadowRadius},set:function(e){this.style.shadowRadius=e,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowOffset",{get:function(){return{x:this.style.shadowDx,y:this.style.shadowDy}},set:function(e){this.style.shadowDx=e.x,this.style.shadowDy=e.y,this.__nativeObj.updateText(this.style,this._content)},enumerable:!0,configurable:!0}),e.prototype.measureTextSize=function(){if(2==arguments.length)return BK.TextNode.measureTextSize(arguments[0],arguments[1])},e.measureTextSize=function(){if(2==arguments.length)return BK.TextNode.measureTextSize(arguments[0],arguments[1])},e.prototype.getTextSize=function(){},e.prototype.setStyle=function(e){e&&(this.style={fontSize:e.fontSize,textColor:e.textColor,maxWidth:e.maxWidth,maxHeight:e.maxHeight,width:e.width,height:e.height,textAlign:e.textAlign,bold:e.bold,italic:e.italic,strokeColor:e.strokeColor,strokeSize:e.strokeSize,shadowRadius:e.shadowRadius,shadowDx:e.shadowDx,shadowDy:e.shadowDy,shadowColor:e.shadowColor})},e.prototype.removeFromParent=function(){this.__nativeObj.removeFromParent()},e.prototype.setUVFlip=function(e,t){this.__nativeObj.setUVFlip(e,t)},e}()}),function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.MQQ.Webview.openTransparent=t())}(BK,function(){return function(e,t){void 0===t&&(t=1);var r={url:e,gameOrientation:t,businessType:2};GameStatusInfo.devPlatform&&BK.Script.log(0,0,"BK.MQQ.Webview.openTransparent rely QQ.Call Failed!"),BK.MQQ.SsoRequest.send(r,"cs.openWebViewWithoutUrl.local")}})}if(isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document)){var __browserMsgHdl={};function __dispatchEvent(t,r,n){console.log("__dispatchEvent err:"+t+" cmd:"+r+" data:"+n),__browserMsgHdl.listenerInfos.forEach(function(e){e.cmd==r&&(0,e.callback)(t,r,JSON.parse(n))},this)}__browserMsgHdl.listenerInfos=[],__browserMsgHdl.addListener=function(t,r,n){var e={cmd:t,target:r,callback:n},i=!1;__browserMsgHdl.listenerInfos.forEach(function(e){e.cmd==t&&e.target==r&&(e.callback=n,i=!0)},this),0==i&&__browserMsgHdl.listenerInfos.push(e)},__browserMsgHdl.removeListener=function(e,t){for(var r=__browserMsgHdl.listenerInfos.length,n=-1,i=0;i<r;i++){var a=__browserMsgHdl.listenerInfos[i];a.cmd==e&&a.target==t&&(n=i)}-1!=n&&__browserMsgHdl.listenerInfos.splice(n,1)}}!function(e,t){"object"==typeof e&&("object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Game=t())}(BK,function(){var e,t,r,n;(t=e||(e={}))[t.load=0]="load",t[t.min=1]="min",t[t.max=2]="max",t[t.share=3]="share",t[t.enterBackground=4]="enterBackground",t[t.enterForeground=5]="enterForeground",(n=r||(r={}))[n.native=0]="native",n[n.browser=1]="browser";var i=function(){function e(e){this.CMSHOW_CS_CMD_MINI_WND="cs.make_room_min.local",this.CMSHOW_CS_CMD_CLOSE_WND="cs.close_room.local",this.CMSHOW_CS_CMD_SHARE_INFO="cs.game_shell_share_callback.local",this.CMSHOW_SC_CMD_SHELL_PACK_UP="sc.game_shell_pack_up.local",this.CMSHOW_SC_CMD_SHELL_SHARE="sc.game_shell_share.local",this.CMSHOW_SC_CMD_SHELL_CLOSE="sc.game_shell_close.local",this.CMD_CMSHOW_GAME_ENTER_BACKGROUND="sc.game_enter_background.local",this.CMD_CMSHOW_GAME_ENTER_FORGROUND="sc.game_enter_foreground.local",this.CMD_CMSHOW_GAME_MAXIMIZE="sc.game_maximize.local",this.CMD_CMSHOW_GAME_MINIMIZE="sc.game_minimize.local",this.cfg=e,this.addAllListener(),this.cfg.onLoad(this)}return e.prototype.log=function(e){BK.Script.log(0,0,"Game:"+e)},e.prototype.platform=function(){return!("undefined"==typeof window||"undefined"==typeof navigator||!window.document)?r.browser:r.native},e.prototype.addAllListener=function(){this.platform()==r.native?(BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,this._onEnterBackground.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this,this._onEnterForeground.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this,this._onMax.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this,this._onMin.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this,this._onShare.bind(this)),BK.MQQ.SsoRequest.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._onClose.bind(this))):(__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this,this._onEnterBackground.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this,this._onEnterForeground.bind(this)),__browserMsgHdl.addListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this,this._onMax.bind(this)),__browserMsgHdl.addListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this,this._onMin.bind(this)),__browserMsgHdl.addListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this,this._onShare.bind(this)),__browserMsgHdl.addListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this,this._onClose.bind(this)))},e.prototype.removeAllListener=function(){this.platform()==r.native?(BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this),BK.MQQ.SsoRequest.removeListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this),BK.MQQ.SsoRequest.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this)):(__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_ENTER_BACKGROUND,this),__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_ENTER_FORGROUND,this),__browserMsgHdl.removeListener(this.CMD_CMSHOW_GAME_MAXIMIZE,this),__browserMsgHdl.removeListener(this.CMSHOW_SC_CMD_SHELL_PACK_UP,this),__browserMsgHdl.removeListener(this.CMSHOW_SC_CMD_SHELL_SHARE,this),__browserMsgHdl.removeListener(this.CMSHOW_SC_CMD_SHELL_CLOSE,this))},e.prototype._onEnterBackground=function(){this.cfg.onEnterBackground(this)},e.prototype._onEnterForeground=function(){this.cfg.onEnterForeground(this)},e.prototype._onMax=function(){this.cfg.onMaximize(this)},e.prototype._onMin=function(){this.cfg.onMinimize(this),this._confirmMin()},e.prototype._onShare=function(){},e.prototype._onClose=function(){this.cfg.onClose&&this.cfg.onClose(this),this._confirmClose()},e.prototype._confirmMin=function(){this.platform()==r.native?BK.MQQ.SsoRequest.send({},this.CMSHOW_CS_CMD_MINI_WND):__browserMsg.send("",this.CMSHOW_CS_CMD_MINI_WND)},e.prototype._confirmClose=function(){this.platform()==r.native?BK.MQQ.SsoRequest.send({},this.CMSHOW_CS_CMD_CLOSE_WND):__browserMsg.send("",this.CMSHOW_CS_CMD_CLOSE_WND)},e.prototype._confirmShare=function(e){var t=e||{};this.platform()==r.native?BK.MQQ.SsoRequest.send(t,this.CMSHOW_CS_CMD_SHARE_INFO):__browserMsg.send(JSON.stringify(t),this.CMSHOW_CS_CMD_SHARE_INFO)},e}();if(BK.MQQ&&BK.MQQ.Account){var s="GameSandBox://_head/";BK.FileUtil.isFileExist(s)||BK.FileUtil.makeDir(s),BK.MQQ.Account.getHeadEx||(BK.MQQ.Account.getHeadEx=function(a,o){BK.MQQ.Account.getHead(a,function(e,t){if(t&&t.buffer&&t.width&&t.height)if(BK.Image.saveImage)BK.Image.saveImage(t.buffer,t.width,t.height,s+e,"png"),o(e,s+e+".png");else{var r=new BK.Texture(t.buffer,t.width,t.height),n=new BK.Sprite(t.width,t.height,r,0,0,1,1),i=new BK.RenderTexture(t.width,t.height);BK.Render.renderToTexture(n.__nativeObj?n.__nativeObj:n,i),i.saveTo(s+e),o(a,s+e)}else o(a,"")})})}return i});